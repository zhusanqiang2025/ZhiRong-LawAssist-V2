# Word 模板使用说明

## 模板目录结构

```
backend/
├── templates/
│   └── documents/              # Word 模板目录
│       ├── contract_template.dotx      # 合同模板（推荐 .dotx 格式）
│       ├── letter_template.dotx        # 函件模板（推荐 .dotx 格式）
│       ├── judicial_template.dotx      # 司法文书模板（推荐 .dotx 格式）
│       └── simple_template.dotx        # 简单文档模板（推荐 .dotx 格式）
```

## 如何添加你的模板

1. **将你的 Word 模板文件复制到模板目录：**

   ```bash
   cp /path/to/your/template.dotx backend/templates/documents/contract_template.dotx
   ```

2. **支持的文件格式：**
   - `.dotx` - **推荐**（Word 启用宏的文档模板，无法意外编辑模板本身）
   - `.docx` - 普通文档（也可以作为模板使用）

3. **文件名规则：**
   - 系统优先查找 `.dotx` 格式
   - 如果 `.dotx` 不存在，则查找 `.docx` 格式
   - 支持的文件名：
     - `contract_template.dotx/docx` - 合同模板
     - `letter_template.dotx/docx` - 函件模板
     - `judicial_template.dotx/docx` - 司法文书模板
     - `simple_template.dotx/docx` - 简单文档模板

## .dotx vs .docx 模板格式对比

| 特性 | .dotx（推荐） | .docx |
|------|--------------|-------|
| 文件类型 | Word 模板 | 普通文档 |
| 防止意外修改 | ✅ 双击自动创建新文档 | ❌ 可能直接修改模板 |
| 包含宏 | ✅ 支持 .dotm | ❌ 不支持 |
| 专业性 | ✅ 更专业 | ⚠️ 可接受 |
| 兼容性 | ✅ Word 2007+ | ✅ Word 2007+ |

## 如何创建 .dotx 模板

### 方法一：在 Word 中另存为模板

1. 在 Word 中设计好你的文档格式
2. 点击 **文件 > 另存为**
3. 选择保存类型为 **Word 模板 (.dotx)**
4. 保存到项目模板目录

### 方法二：转换现有 .docx 为 .dotx

```bash
# 在 Windows 上使用 PowerShell
Copy-Item template.docx template.dotx
```

或者在 Word 中：
1. 打开 .docx 文件
2. **文件 > 另存为**
3. 保存类型选择 **Word 模板 (.dotx)**

## 模板占位符格式

在 Word 文档中，可以使用以下占位符格式：

| 格式 | 示例 | 说明 |
|------|------|------|
| `{{变量名}}` | `{{title}}` | 双花括号格式 |
| `${变量名}` | `${contract_number}` | 美元符号格式 |
| `%变量名%` | `%date%` | 百分号格式 |

## 可用的占位符

### 基本信息占位符

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `{{title}}` | 文档标题 | "销售合同" |
| `{{doc_type}}` | 文档类型 | "合同" |
| `{{contract_number}}` | 合同编号 | "SALE-2024-001" |
| `{{date}}` | 日期 | "2024年12月24日" |
| `{{keywords}}` | 关键词 | "销售, 采购, 商品" |

### 合同方占位符

| 占位符 | 说明 |
|--------|------|
| `{{party1_role}}` | 甲方角色 |
| `{{party1_name}}` | 甲方名称 |
| `{{party1_地址}}` | 甲方地址 |
| `{{party1_联系人}}` | 甲方联系人 |
| `{{party1_电话}}` | 甲方电话 |
| `{{party2_role}}` | 乙方角色 |
| `{{party2_name}}` | 乙方名称 |
| ... | 更多合同方字段 |

### 内容占位符

| 占位符 | 说明 |
|--------|------|
| `{{sections_content}}` | 所有章节内容（纯文本格式） |

## 模板设计建议

### 合同模板结构

```
__________________________
         {{title}}
__________________________

合同编号：{{contract_number}}
签署日期：{{date}}

甲方：{{party1_name}}
地址：{{party1_地址}}
联系人：{{party1_联系人}}

乙方：{{party2_name}}
地址：{{party2_地址}}
联系人：{{party2_联系人}}

{{sections_content}}

__________________________
           签署
__________________________

甲方（盖章）：___________
乙方（盖章）：___________
```

### 函件模板结构

```
      {{title}}

_____________

尊敬的{{recipient_name}}：

{{content}}

此致
敬礼！

签名：___________
日期：{{date}}
```

## 模板制作技巧

1. **使用样式**：在 Word 中定义好标题样式（标题1、标题2等）
2. **设置页边距**：标准合同建议 2.54cm 上下边距，3.17cm 左右边距
3. **字体设置**：
   - 标题：黑体，小二号
   - 正文：宋体，四号
   - 签署区：宋体，小四号
4. **行距**：正文建议 1.5 倍行距
5. **表格**：签署区可以使用表格布局，更美观

## 测试模板

添加模板后，系统会自动扫描并加载。可以通过以下方式测试：

1. 重启后端服务
2. 查看日志确认模板加载状态
3. 在前端测试文档生成功能

## 注意事项

- 模板文件必须是 `.docx` 格式（不支持旧版 `.doc`）
- 占位符区分大小写
- 如果模板不存在，系统会自动使用代码生成兜底
- 修改模板后需要重启服务才能生效
