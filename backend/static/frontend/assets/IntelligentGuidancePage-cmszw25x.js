import{r as n,z as O,_ as V,u as F,j as s,av as M,d as x,B as l,s as d,ax as H,y as C,T as W,S as z,I as J,o as U,ay as X,az as R,aA as Y}from"./index-BYD9hiRj.js";import{E as Z}from"./EnhancedModuleNavBar-Ovq8lb8Y.js";import{u as ss}from"./useSessionPersistence-E6fU_tid.js";import{R as es}from"./ReloadOutlined-Da_vttcL.js";import{S as $}from"./index-CMeDDP0a.js";import{P as ts}from"./progress-s1QZWrHJ.js";import{R as ns}from"./SendOutlined-TS7DvRPn.js";import"./ArrowLeftOutlined-CVuXMn9O.js";import"./DiffOutlined-m3bPN2jz.js";var as={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm198.4-588.1a32 32 0 00-24.5.5L414.9 415 296.4 686c-3.6 8.2-3.6 17.5 0 25.7 3.4 7.8 9.7 13.9 17.7 17 3.8 1.5 7.7 2.2 11.7 2.2 4.4 0 8.7-.9 12.8-2.7l271-118.6 118.5-271a32.06 32.06 0 00-17.7-42.7zM576.8 534.4l26.2 26.2-42.4 42.4-26.2-26.2L380 644.4 447.5 490 422 464.4l42.4-42.4 25.5 25.5L644.4 380l-67.6 154.4zM464.4 422L422 464.4l25.5 25.6 86.9 86.8 26.2 26.2 42.4-42.4-26.2-26.2-86.8-86.9z"}}]},name:"compass",theme:"outlined"},is=function(i,o){return n.createElement(O,V({},i,{ref:o,icon:as}))},I=n.forwardRef(is);const{Content:os}=M,{TextArea:cs}=J,{Text:f}=W,{Step:js}=$,ys=()=>{const[a,i]=n.useState([]),[o,u]=n.useState(""),[rs,b]=n.useState([]),[p,m]=n.useState(!0),[j,y]=n.useState(!1),[g,v]=n.useState(0),[h,S]=n.useState(0),k=n.useRef(null),N=F(),{hasSession:E,saveSession:w,clearSession:D,restoreSession:P}=ss("intelligent_guidance_session",{expirationTime:3600*1e3,autoRestore:!1,onRestore:(e,t)=>{console.log("[æ™ºèƒ½å¼•å¯¼] æ¢å¤ä¼šè¯:",e,t),S(t.currentStep),v(t.guidanceProgress),i(t.messages),m(t.showQuickActions),d.success("å·²æ¢å¤ä¹‹å‰çš„æ™ºèƒ½å¼•å¯¼ä¼šè¯")}}),T=[{id:"consultation",title:"æ™ºèƒ½å’¨è¯¢",icon:s.jsx(X,{}),category:"consultation",route:"/consultation",hasBackend:!0,description:"èµ„æ·±å¾‹å¸ˆä¸“ä¸šæ³•å¾‹å’¨è¯¢æœåŠ¡"},{id:"risk-analysis",title:"é£Žé™©è¯„ä¼°",icon:s.jsx(R,{}),category:"analysis",route:"/risk-analysis",hasBackend:!0,description:"æ·±åº¦åˆ†æžæ³•å¾‹æ–‡ä»¶ï¼Œè¯†åˆ«æ½œåœ¨é£Žé™©ç‚¹"},{id:"contract-generation",title:"åˆåŒç”Ÿæˆ",icon:s.jsx(Y,{}),category:"contract",route:"/contract/generate",hasBackend:!0,description:"åŸºäºŽéœ€æ±‚æ™ºèƒ½ç”Ÿæˆå„ç±»åˆåŒæ–‡ä¹¦"},{id:"case-analysis",title:"æ¡ˆä»¶åˆ†æž",icon:s.jsx(R,{}),category:"case",route:"/litigation-analysis",hasBackend:!0,description:"åˆ†æžæ¡ˆä»¶ææ–™ï¼Œåˆ¶å®šè¯‰è®¼ç­–ç•¥"}],A=["æˆ‘éœ€è¦æ³•å¾‹å’¨è¯¢æœåŠ¡","å¸®æˆ‘åˆ†æžè¿™ä»½åˆåŒçš„é£Žé™©","åˆ†æžä¸€ä¸‹è¿™ä¸ªæ¡ˆä»¶çš„èƒœè¯‰å¯èƒ½æ€§","æˆ‘éœ€è¦ç”Ÿæˆä¸€ä»½æŠ€æœ¯æœåŠ¡åˆåŒ","å¸®æˆ‘å®¡æŸ¥è¿™ä»½ç§ŸèµåˆåŒ","æŸ¥æ‰¾åŠ³åŠ¨åˆåŒæ¨¡æ¿","å¤„ç†è¿™ä¸ªPDFæ–‡æ¡£","å¸®æˆ‘èµ·è‰ä¸€ä»½å¾‹å¸ˆå‡½","è®¡ç®—è¯‰è®¼è´¹ç”¨å¤§æ¦‚å¤šå°‘é’±"],L=[{title:"éœ€æ±‚æŽ¢ç´¢",description:"äº†è§£æ‚¨çš„å…·ä½“éœ€æ±‚"},{title:"åœºæ™¯è¯†åˆ«",description:"ç¡®å®šé€‚ç”¨çš„æ³•å¾‹åœºæ™¯"},{title:"æ–¹æ¡ˆæŽ¨è",description:"æŽ¨èæœ€é€‚åˆçš„è§£å†³æ–¹æ¡ˆ"},{title:"è¡ŒåŠ¨å¼•å¯¼",description:"å¼•å¯¼æ‚¨å¼€å§‹ä½¿ç”¨"}];n.useEffect(()=>{const e={id:"welcome",content:`æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½æ³•å¾‹å¼•å¯¼åŠ©æ‰‹ ðŸ‘‹

ðŸŽ¯ **æˆ‘å¯ä»¥å¸®æ‚¨åšä»€ä¹ˆï¼Ÿ**
â€¢ é€šè¿‡å¯¹è¯å¿«é€Ÿäº†è§£æ‚¨çš„æ³•å¾‹éœ€æ±‚
â€¢ æŽ¨èæœ€é€‚åˆçš„æ³•å¾‹å·¥ä½œæµ
â€¢ æä¾›ç›´è¾¾åŠŸèƒ½é¡µé¢çš„ä¾¿æ·é€šé“

ðŸ”§ **æ”¯æŒçš„æ³•å¾‹æœåŠ¡ï¼š**
1. **æ™ºèƒ½å’¨è¯¢** - èµ„æ·±å¾‹å¸ˆæä¾›ä¸“ä¸šæ³•å¾‹å»ºè®®
2. **é£Žé™©è¯„ä¼°** - æ·±åº¦åˆ†æžæ³•å¾‹æ–‡ä»¶,è¯†åˆ«æ½œåœ¨é£Žé™©
3. **åˆåŒç”Ÿæˆ** - æ™ºèƒ½èµ·è‰å„ç±»åˆåŒæ–‡ä¹¦
4. **æ¡ˆä»¶åˆ†æž** - åˆ†æžæ¡ˆä»¶ææ–™,åˆ¶å®šè¯‰è®¼ç­–ç•¥

ðŸ’¡ **ä½¿ç”¨æ–¹æ³•ï¼š**
è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©,æˆ–è€…ç›´æŽ¥ç‚¹å‡»ä¸‹æ–¹çš„å¿«é€Ÿå¼€å§‹æŒ‰é’®ã€‚

ç¤ºä¾‹ï¼š
â€¢ "æˆ‘éœ€è¦æ³•å¾‹å’¨è¯¢æœåŠ¡"
â€¢ "å¸®æˆ‘åˆ†æžè¿™ä»½åˆåŒçš„é£Žé™©"
â€¢ "æˆ‘éœ€è¦ç”Ÿæˆä¸€ä»½æŠ€æœ¯æœåŠ¡åˆåŒ"`,role:"assistant",timestamp:new Date,suggestions:A.slice(0,4)};i([e])},[]),n.useEffect(()=>{_()},[a]),n.useEffect(()=>{if(a.length>1){const e=a.filter(t=>t.role==="user").length;S(Math.min(e,3)),v(Math.min(e*25,100))}},[a]),n.useEffect(()=>{a.length>1&&w(Date.now().toString(),{currentStep:h,guidanceProgress:g,messages:a,showQuickActions:p,userInputHistory:a.filter(e=>e.role==="user").map(e=>e.content)})},[h,g,a,p,w]);const _=()=>{k.current?.scrollIntoView({behavior:"smooth"})},B=async()=>{if(!o.trim())return;const e={id:`user-${Date.now()}`,content:o,role:"user",timestamp:new Date};i(t=>[...t,e]),u(""),m(!1),y(!0);try{const t=await U.intelligentGuidance({message:o,conversation_history:a.map(r=>({role:r.role,content:r.content}))}),c={id:`assistant-${Date.now()}`,content:t.data.response,role:"assistant",timestamp:new Date,suggestions:t.data.suggestions,actionButtons:t.data.action_buttons};i(r=>[...r,c]),b(t.data.suggestions)}catch(t){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",t),d.error("å‘é€æ¶ˆæ¯å¤±è´¥ï¼Œè¯·é‡è¯•");const c={id:`error-${Date.now()}`,content:"æŠ±æ­‰ï¼Œæˆ‘çŽ°åœ¨æ— æ³•å¤„ç†æ‚¨çš„è¯·æ±‚ã€‚è¯·ç¨åŽå†è¯•æˆ–å°è¯•é‡æ–°è¡¨è¿°æ‚¨çš„é—®é¢˜ã€‚",role:"assistant",timestamp:new Date};i(r=>[...r,c])}finally{y(!1)}},q=e=>{if(e.hasBackend){const t=`æˆ‘æƒ³${e.title.toLowerCase()}`;u(t),m(!1)}else N(e.route),d.info(`${e.title}åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­`)},K=e=>{u(e),m(!1)},Q=e=>{e.route?N(e.route,{state:e.params}):d.info("è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼")},G=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),B())};return s.jsxs(M,{className:"intelligent-guidance-layout",children:[s.jsx(Z,{currentModuleKey:"guidance",title:"æ™ºèƒ½å¼•å¯¼",icon:s.jsx(I,{})}),s.jsx(os,{className:"guidance-content",children:s.jsxs("div",{className:"guidance-container",children:[E&&s.jsxs(x,{className:"session-restore-card",size:"small",style:{marginBottom:"16px",backgroundColor:"#e6f7ff",borderColor:"#91d5ff"},children:[s.jsx("div",{style:{marginBottom:"8px",fontWeight:"bold"},children:"æ£€æµ‹åˆ°ä¹‹å‰çš„ä¼šè¯"}),s.jsx("div",{style:{fontSize:"14px",color:"#666",marginBottom:"12px"},children:"ç³»ç»Ÿæ£€æµ‹åˆ°æ‚¨ä¹‹å‰æœ‰ä¸€ä¸ªæœªå®Œæˆçš„æ™ºèƒ½å¼•å¯¼ä¼šè¯ã€‚æ‚¨å¯ä»¥ç»§ç»­ä¹‹å‰çš„å¯¹è¯ï¼Œæˆ–è€…é‡æ–°å¼€å§‹ã€‚"}),s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[s.jsx(l,{type:"primary",icon:s.jsx(I,{}),onClick:()=>{D(),d.info("å·²æ¸…é™¤ä¹‹å‰çš„ä¼šè¯ï¼Œé‡æ–°å¼€å§‹")},children:"é‡æ–°å¼€å§‹"}),s.jsx(l,{icon:s.jsx(es,{}),onClick:()=>{P()},children:"ç»§ç»­ä¹‹å‰ä¼šè¯"})]})]}),s.jsxs(x,{className:"progress-card",size:"small",children:[s.jsx($,{current:h,size:"small",items:L}),s.jsx(ts,{percent:g,size:"small",style:{marginTop:12},strokeColor:{"0%":"#108ee9","100%":"#52c41a"}})]}),s.jsxs("div",{className:"messages-container",children:[a.map(e=>s.jsxs("div",{className:`message ${e.role}`,children:[s.jsx("div",{className:"message-avatar",children:e.role==="user"?s.jsx(H,{}):s.jsx(C,{})}),s.jsxs("div",{className:"message-content",children:[s.jsx("div",{className:"message-bubble",children:s.jsx(f,{style:{whiteSpace:"pre-wrap"},children:e.content})}),e.actionButtons&&e.actionButtons.length>0&&s.jsxs("div",{className:"message-action-buttons",children:[s.jsx(f,{type:"secondary",style:{marginBottom:8,display:"block"},children:"æŽ¨èæ“ä½œï¼š"}),s.jsx(z,{wrap:!0,children:e.actionButtons.map((t,c)=>s.jsx(l,{type:"primary",size:"small",onClick:()=>Q(t),title:t.description,children:t.title},c))})]}),e.suggestions&&e.suggestions.length>0&&s.jsxs("div",{className:"message-suggestions",children:[s.jsx(f,{type:"secondary",style:{marginBottom:8,display:"block"},children:"æ‚¨å¯èƒ½æƒ³é—®ï¼š"}),s.jsx(z,{wrap:!0,children:e.suggestions.map((t,c)=>s.jsx(l,{size:"small",type:"dashed",onClick:()=>K(t),children:t},c))})]})]})]},e.id)),j&&s.jsxs("div",{className:"message assistant",children:[s.jsx("div",{className:"message-avatar",children:s.jsx(C,{})}),s.jsx("div",{className:"message-content",children:s.jsxs("div",{className:"typing-indicator",children:[s.jsx("span",{}),s.jsx("span",{}),s.jsx("span",{})]})})]}),s.jsx("div",{ref:k})]}),s.jsx("div",{className:"input-area",children:s.jsxs("div",{className:"input-container",children:[s.jsx(cs,{value:o,onChange:e=>u(e.target.value),onKeyPress:G,placeholder:"è¯·æè¿°æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Œä¾‹å¦‚ï¼šæˆ‘éœ€è¦ä¸€ä»½æŠ€æœ¯æœåŠ¡åˆåŒ...",autoSize:{minRows:2,maxRows:6},className:"message-input"}),s.jsx(l,{type:"primary",icon:s.jsx(ns,{}),onClick:B,loading:j,disabled:!o.trim(),className:"send-button",children:"å‘é€"})]})}),p&&s.jsx(x,{className:"quick-actions-card",title:"å¿«é€Ÿå¼€å§‹",style:{marginTop:"16px"},children:s.jsx("div",{className:"quick-actions-horizontal",children:T.map(e=>s.jsxs(l,{size:"large",className:"quick-action-button-horizontal",onClick:()=>q(e),children:[e.icon,e.title]},e.id))})})]})})]})};export{ys as default};
