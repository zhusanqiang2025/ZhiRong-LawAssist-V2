import{r as a,z as Nn,_ as Bn,R as ne,be as lt,bx as js,s as F,j as s,S as k,T as xt,p as Fn,H as Ye,h as mn,i as N,d as P,c as ct,C as le,y as Ss,aw as Hn,B as me,G as Un,k as Kt,b as Wn,o as J,e as Rs,aD as St,E as Rt,D as Cs,u as ks,w as Is,ba as Ds,g as _s,av as Gn,I as Vn}from"./index-roHVKWBY.js";import{R as Es}from"./InfoCircleOutlined-BY0eFwme.js";import{A as xe,R as Jt}from"./DownloadOutlined-rr9bHkiC.js";import{R as Ie}from"./CheckCircleOutlined-CAL-yran.js";import{R as xn}from"./SyncOutlined-DS1_hfBq.js";import{P as Ee}from"./progress-tAVtoyWK.js";import{S as we}from"./index-D5JXJEnK.js";import{R as _t}from"./ClockCircleOutlined-C2t8-iE_.js";import{D as Ke}from"./index-DDLkHvOg.js";import{C as Pt}from"./Collapse-D7Vq4seE.js";import{R as vn}from"./WarningOutlined-DRn33097.js";import{R as Ms}from"./react-markdown-laHtMECc.js";import{R as qt}from"./CloseCircleOutlined-DkwqTiEK.js";import{D as Ts,E as As,a as zs}from"./EnhancedAnalysisDisplay-BmLSEyQn.js";import{E as Ps,R as Os}from"./EnhancedModuleNavBar-BaLc5GU_.js";import{M as $s}from"./ModuleKnowledgeToggle-De2SgLln.js";import{R as Ls}from"./ReloadOutlined-BbVeIh-b.js";import{R as Ns}from"./DeleteOutlined-BTxcvY44.js";import{S as Bs}from"./index-DpzQQA4h.js";import{U as Fs}from"./index-CTgI8CvL.js";import{R as Hs}from"./UploadOutlined-CykSJ8pV.js";import{R as yn}from"./SendOutlined-KN9mdme5.js";import{D as Ht}from"./index-Dqc-jEZd.js";import{R as Ut}from"./index-64Mw5-Gk.js";import"./ApartmentOutlined-Bns5gBV0.js";import"./ArrowLeftOutlined-BgXNOdqB.js";import"./DiffOutlined-DzrLoxq_.js";import"./DatabaseOutlined-BsaLEKX6.js";import"./index-C4rn-wAu.js";import"./PaperClipOutlined-8mdHwa14.js";import"./useBubbleLock-DlAGXlXo.js";var Us={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 00-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 00-11.3 0L405.6 242.3a7.23 7.23 0 005.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 000 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 00.1-11.4z"}}]},name:"drag",theme:"outlined"},Ws=function(t,n){return a.createElement(Nn,Bn({},t,{ref:n,icon:Us}))},Gs=a.forwardRef(Ws),Vs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 00-44 44v148c0 81.7 60 149.6 138.2 162C265.7 630.2 359 721.7 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.7 758.3 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 00-44-44zM184 352V232h64v207.6a91.99 91.99 0 01-64-87.6zm520 128c0 49.1-19.1 95.4-53.9 130.1-34.8 34.8-81 53.9-130.1 53.9h-16c-49.1 0-95.4-19.1-130.1-53.9-34.8-34.8-53.9-81-53.9-130.1V184h384v296zm136-128c0 41-26.9 75.8-64 87.6V232h64v120z"}}]},name:"trophy",theme:"outlined"},Xs=function(t,n){return a.createElement(Nn,Bn({},t,{ref:n,icon:Vs}))},bn=a.forwardRef(Xs);function Ys(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.useMemo(()=>r=>{t.forEach(o=>o(r))},t)}const Ot=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function et(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function sn(e){return"nodeType"in e}function se(e){var t,n;return e?et(e)?e:sn(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function rn(e){const{Document:t}=se(e);return e instanceof t}function vt(e){return et(e)?!1:e instanceof se(e).HTMLElement}function Xn(e){return e instanceof se(e).SVGElement}function tt(e){return e?et(e)?e.document:sn(e)?rn(e)?e:vt(e)||Xn(e)?e.ownerDocument:document:document:document}const De=Ot?a.useLayoutEffect:a.useEffect;function on(e){const t=a.useRef(e);return De(()=>{t.current=e}),a.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}function Ks(){const e=a.useRef(null),t=a.useCallback((r,o)=>{e.current=setInterval(r,o)},[]),n=a.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function gt(e,t){t===void 0&&(t=[e]);const n=a.useRef(e);return De(()=>{n.current!==e&&(n.current=e)},t),n}function yt(e,t){const n=a.useRef();return a.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Mt(e){const t=on(e),n=a.useRef(null),r=a.useCallback(o=>{o!==n.current&&t?.(o,n.current),n.current=o},[]);return[n,r]}function Qt(e){const t=a.useRef();return a.useEffect(()=>{t.current=e},[e]),t.current}let Wt={};function bt(e,t){return a.useMemo(()=>{if(t)return t;const n=Wt[e]==null?0:Wt[e]+1;return Wt[e]=n,e+"-"+n},[e,t])}function Yn(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.reduce((i,l)=>{const u=Object.entries(l);for(const[f,p]of u){const h=i[f];h!=null&&(i[f]=h+e*p)}return i},{...t})}}const Ze=Yn(1),ht=Yn(-1);function Js(e){return"clientX"in e&&"clientY"in e}function an(e){if(!e)return!1;const{KeyboardEvent:t}=se(e.target);return t&&e instanceof t}function qs(e){if(!e)return!1;const{TouchEvent:t}=se(e.target);return t&&e instanceof t}function Zt(e){if(qs(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Js(e)?{x:e.clientX,y:e.clientY}:null}const pt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[pt.Translate.toString(e),pt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),wn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Qs(e){return e.matches(wn)?e:e.querySelector(wn)}const Zs={display:"none"};function er(e){let{id:t,value:n}=e;return ne.createElement("div",{id:t,style:Zs},n)}function tr(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return ne.createElement("div",{id:t,style:o,role:"status","aria-live":r,"aria-atomic":!0},n)}function nr(){const[e,t]=a.useState("");return{announce:a.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const Kn=a.createContext(null);function sr(e){const t=a.useContext(Kn);a.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function rr(){const[e]=a.useState(()=>new Set),t=a.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[a.useCallback(r=>{let{type:o,event:i}=r;e.forEach(l=>{var u;return(u=l[o])==null?void 0:u.call(l,i)})},[e]),t]}const or={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},ir={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function ar(e){let{announcements:t=ir,container:n,hiddenTextDescribedById:r,screenReaderInstructions:o=or}=e;const{announce:i,announcement:l}=nr(),u=bt("DndLiveRegion"),[f,p]=a.useState(!1);if(a.useEffect(()=>{p(!0)},[]),sr(a.useMemo(()=>({onDragStart(d){let{active:g}=d;i(t.onDragStart({active:g}))},onDragMove(d){let{active:g,over:c}=d;t.onDragMove&&i(t.onDragMove({active:g,over:c}))},onDragOver(d){let{active:g,over:c}=d;i(t.onDragOver({active:g,over:c}))},onDragEnd(d){let{active:g,over:c}=d;i(t.onDragEnd({active:g,over:c}))},onDragCancel(d){let{active:g,over:c}=d;i(t.onDragCancel({active:g,over:c}))}}),[i,t])),!f)return null;const h=ne.createElement(ne.Fragment,null,ne.createElement(er,{id:r,value:o.draggable}),ne.createElement(tr,{id:u,announcement:l}));return n?lt.createPortal(h,n):h}var B;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(B||(B={}));function Tt(){}function jn(e,t){return a.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function lr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const je=Object.freeze({x:0,y:0});function Jn(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function qn(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function cr(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Sn(e){let{left:t,top:n,height:r,width:o}=e;return[{x:t,y:n},{x:t+o,y:n},{x:t,y:n+r},{x:t+o,y:n+r}]}function Qn(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Rn(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const dr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=Rn(t,t.left,t.top),i=[];for(const l of r){const{id:u}=l,f=n.get(u);if(f){const p=Jn(Rn(f),o);i.push({id:u,data:{droppableContainer:l,value:p}})}}return i.sort(qn)},ur=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=Sn(t),i=[];for(const l of r){const{id:u}=l,f=n.get(u);if(f){const p=Sn(f),h=o.reduce((g,c,b)=>g+Jn(p[b],c),0),d=Number((h/4).toFixed(4));i.push({id:u,data:{droppableContainer:l,value:d}})}}return i.sort(qn)};function fr(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height),l=o-r,u=i-n;if(r<o&&n<i){const f=t.width*t.height,p=e.width*e.height,h=l*u,d=h/(f+p-h);return Number(d.toFixed(4))}return 0}const gr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=[];for(const i of r){const{id:l}=i,u=n.get(l);if(u){const f=fr(u,t);f>0&&o.push({id:l,data:{droppableContainer:i,value:f}})}}return o.sort(cr)};function hr(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function Zn(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:je}function pr(e){return function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return o.reduce((l,u)=>({...l,top:l.top+e*u.y,bottom:l.bottom+e*u.y,left:l.left+e*u.x,right:l.right+e*u.x}),{...n})}}const mr=pr(1);function xr(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function vr(e,t,n){const r=xr(t);if(!r)return e;const{scaleX:o,scaleY:i,x:l,y:u}=r,f=e.left-l-(1-o)*parseFloat(n),p=e.top-u-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),h=o?e.width/o:e.width,d=i?e.height/i:e.height;return{width:h,height:d,top:p,right:f+h,bottom:p+d,left:f}}const yr={ignoreTransform:!1};function nt(e,t){t===void 0&&(t=yr);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:p,transformOrigin:h}=se(e).getComputedStyle(e);p&&(n=vr(n,p,h))}const{top:r,left:o,width:i,height:l,bottom:u,right:f}=n;return{top:r,left:o,width:i,height:l,bottom:u,right:f}}function Cn(e){return nt(e,{ignoreTransform:!0})}function br(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function wr(e,t){return t===void 0&&(t=se(e).getComputedStyle(e)),t.position==="fixed"}function jr(e,t){t===void 0&&(t=se(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const i=t[o];return typeof i=="string"?n.test(i):!1})}function $t(e,t){const n=[];function r(o){if(t!=null&&n.length>=t||!o)return n;if(rn(o)&&o.scrollingElement!=null&&!n.includes(o.scrollingElement))return n.push(o.scrollingElement),n;if(!vt(o)||Xn(o)||n.includes(o))return n;const i=se(e).getComputedStyle(o);return o!==e&&jr(o,i)&&n.push(o),wr(o,i)?n:r(o.parentNode)}return e?r(e):n}function es(e){const[t]=$t(e,1);return t??null}function Gt(e){return!Ot||!e?null:et(e)?e:sn(e)?rn(e)||e===tt(e).scrollingElement?window:vt(e)?e:null:null}function ts(e){return et(e)?e.scrollX:e.scrollLeft}function ns(e){return et(e)?e.scrollY:e.scrollTop}function en(e){return{x:ts(e),y:ns(e)}}var H;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(H||(H={}));function ss(e){return!Ot||!e?!1:e===document.scrollingElement}function rs(e){const t={x:0,y:0},n=ss(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},o=e.scrollTop<=t.y,i=e.scrollLeft<=t.x,l=e.scrollTop>=r.y,u=e.scrollLeft>=r.x;return{isTop:o,isLeft:i,isBottom:l,isRight:u,maxScroll:r,minScroll:t}}const Sr={x:.2,y:.2};function Rr(e,t,n,r,o){let{top:i,left:l,right:u,bottom:f}=n;r===void 0&&(r=10),o===void 0&&(o=Sr);const{isTop:p,isBottom:h,isLeft:d,isRight:g}=rs(e),c={x:0,y:0},b={x:0,y:0},y={height:t.height*o.y,width:t.width*o.x};return!p&&i<=t.top+y.height?(c.y=H.Backward,b.y=r*Math.abs((t.top+y.height-i)/y.height)):!h&&f>=t.bottom-y.height&&(c.y=H.Forward,b.y=r*Math.abs((t.bottom-y.height-f)/y.height)),!g&&u>=t.right-y.width?(c.x=H.Forward,b.x=r*Math.abs((t.right-y.width-u)/y.width)):!d&&l<=t.left+y.width&&(c.x=H.Backward,b.x=r*Math.abs((t.left+y.width-l)/y.width)),{direction:c,speed:b}}function Cr(e){if(e===document.scrollingElement){const{innerWidth:i,innerHeight:l}=window;return{top:0,left:0,right:i,bottom:l,width:i,height:l}}const{top:t,left:n,right:r,bottom:o}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:o,width:e.clientWidth,height:e.clientHeight}}function os(e){return e.reduce((t,n)=>Ze(t,en(n)),je)}function kr(e){return e.reduce((t,n)=>t+ts(n),0)}function Ir(e){return e.reduce((t,n)=>t+ns(n),0)}function Dr(e,t){if(t===void 0&&(t=nt),!e)return;const{top:n,left:r,bottom:o,right:i}=t(e);es(e)&&(o<=0||i<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const _r=[["x",["left","right"],kr],["y",["top","bottom"],Ir]];class ln{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=$t(n),o=os(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[i,l,u]of _r)for(const f of l)Object.defineProperty(this,f,{get:()=>{const p=u(r),h=o[i]-p;return this.rect[f]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class dt{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var o;(o=this.target)==null||o.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function Er(e){const{EventTarget:t}=se(e);return e instanceof t?e:tt(e)}function Vt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var pe;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(pe||(pe={}));function kn(e){e.preventDefault()}function Mr(e){e.stopPropagation()}var A;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(A||(A={}));const is={start:[A.Space,A.Enter],cancel:[A.Esc],end:[A.Space,A.Enter,A.Tab]},Tr=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case A.Right:return{...n,x:n.x+25};case A.Left:return{...n,x:n.x-25};case A.Down:return{...n,y:n.y+25};case A.Up:return{...n,y:n.y-25}}};class cn{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new dt(tt(n)),this.windowListeners=new dt(se(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(pe.Resize,this.handleCancel),this.windowListeners.add(pe.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(pe.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&Dr(r),n(je)}handleKeyDown(t){if(an(t)){const{active:n,context:r,options:o}=this.props,{keyboardCodes:i=is,coordinateGetter:l=Tr,scrollBehavior:u="smooth"}=o,{code:f}=t;if(i.end.includes(f)){this.handleEnd(t);return}if(i.cancel.includes(f)){this.handleCancel(t);return}const{collisionRect:p}=r.current,h=p?{x:p.left,y:p.top}:je;this.referenceCoordinates||(this.referenceCoordinates=h);const d=l(t,{active:n,context:r.current,currentCoordinates:h});if(d){const g=ht(d,h),c={x:0,y:0},{scrollableAncestors:b}=r.current;for(const y of b){const j=t.code,{isTop:C,isRight:v,isLeft:w,isBottom:I,maxScroll:E,minScroll:M}=rs(y),D=Cr(y),_={x:Math.min(j===A.Right?D.right-D.width/2:D.right,Math.max(j===A.Right?D.left:D.left+D.width/2,d.x)),y:Math.min(j===A.Down?D.bottom-D.height/2:D.bottom,Math.max(j===A.Down?D.top:D.top+D.height/2,d.y))},L=j===A.Right&&!v||j===A.Left&&!w,$=j===A.Down&&!I||j===A.Up&&!C;if(L&&_.x!==d.x){const O=y.scrollLeft+g.x,q=j===A.Right&&O<=E.x||j===A.Left&&O>=M.x;if(q&&!g.y){y.scrollTo({left:O,behavior:u});return}q?c.x=y.scrollLeft-O:c.x=j===A.Right?y.scrollLeft-E.x:y.scrollLeft-M.x,c.x&&y.scrollBy({left:-c.x,behavior:u});break}else if($&&_.y!==d.y){const O=y.scrollTop+g.y,q=j===A.Down&&O<=E.y||j===A.Up&&O>=M.y;if(q&&!g.x){y.scrollTo({top:O,behavior:u});return}q?c.y=y.scrollTop-O:c.y=j===A.Down?y.scrollTop-E.y:y.scrollTop-M.y,c.y&&y.scrollBy({top:-c.y,behavior:u});break}}this.handleMove(t,Ze(ht(d,this.referenceCoordinates),c))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}cn.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=is,onActivation:o}=t,{active:i}=n;const{code:l}=e.nativeEvent;if(r.start.includes(l)){const u=i.activatorNode.current;return u&&e.target!==u?!1:(e.preventDefault(),o?.({event:e.nativeEvent}),!0)}return!1}}];function In(e){return!!(e&&"distance"in e)}function Dn(e){return!!(e&&"delay"in e)}class dn{constructor(t,n,r){var o;r===void 0&&(r=Er(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:i}=t,{target:l}=i;this.props=t,this.events=n,this.document=tt(l),this.documentListeners=new dt(this.document),this.listeners=new dt(r),this.windowListeners=new dt(se(l)),this.initialCoordinates=(o=Zt(i))!=null?o:je,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(pe.Resize,this.handleCancel),this.windowListeners.add(pe.DragStart,kn),this.windowListeners.add(pe.VisibilityChange,this.handleCancel),this.windowListeners.add(pe.ContextMenu,kn),this.documentListeners.add(pe.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Dn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(In(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:o}=this.props;o(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(pe.Click,Mr,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(pe.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:o,props:i}=this,{onMove:l,options:{activationConstraint:u}}=i;if(!o)return;const f=(n=Zt(t))!=null?n:je,p=ht(o,f);if(!r&&u){if(In(u)){if(u.tolerance!=null&&Vt(p,u.tolerance))return this.handleCancel();if(Vt(p,u.distance))return this.handleStart()}if(Dn(u)&&Vt(p,u.tolerance))return this.handleCancel();this.handlePending(u,p);return}t.cancelable&&t.preventDefault(),l(f)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===A.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Ar={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class un extends dn{constructor(t){const{event:n}=t,r=tt(n.target);super(t,Ar,r)}}un.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r?.({event:n}),!0)}}];const zr={move:{name:"mousemove"},end:{name:"mouseup"}};var tn;(function(e){e[e.RightClick=2]="RightClick"})(tn||(tn={}));class Pr extends dn{constructor(t){super(t,zr,tt(t.event.target))}}Pr.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===tn.RightClick?!1:(r?.({event:n}),!0)}}];const Xt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Or extends dn{constructor(t){super(t,Xt)}static setup(){return window.addEventListener(Xt.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Xt.move.name,t)};function t(){}}}Or.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:o}=n;return o.length>1?!1:(r?.({event:n}),!0)}}];var ut;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(ut||(ut={}));var At;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(At||(At={}));function $r(e){let{acceleration:t,activator:n=ut.Pointer,canScroll:r,draggingRect:o,enabled:i,interval:l=5,order:u=At.TreeOrder,pointerCoordinates:f,scrollableAncestors:p,scrollableAncestorRects:h,delta:d,threshold:g}=e;const c=Nr({delta:d,disabled:!i}),[b,y]=Ks(),j=a.useRef({x:0,y:0}),C=a.useRef({x:0,y:0}),v=a.useMemo(()=>{switch(n){case ut.Pointer:return f?{top:f.y,bottom:f.y,left:f.x,right:f.x}:null;case ut.DraggableRect:return o}},[n,o,f]),w=a.useRef(null),I=a.useCallback(()=>{const M=w.current;if(!M)return;const D=j.current.x*C.current.x,_=j.current.y*C.current.y;M.scrollBy(D,_)},[]),E=a.useMemo(()=>u===At.TreeOrder?[...p].reverse():p,[u,p]);a.useEffect(()=>{if(!i||!p.length||!v){y();return}for(const M of E){if(r?.(M)===!1)continue;const D=p.indexOf(M),_=h[D];if(!_)continue;const{direction:L,speed:$}=Rr(M,_,v,t,g);for(const O of["x","y"])c[O][L[O]]||($[O]=0,L[O]=0);if($.x>0||$.y>0){y(),w.current=M,b(I,l),j.current=$,C.current=L;return}}j.current={x:0,y:0},C.current={x:0,y:0},y()},[t,I,r,y,i,l,JSON.stringify(v),JSON.stringify(c),b,p,E,h,JSON.stringify(g)])}const Lr={x:{[H.Backward]:!1,[H.Forward]:!1},y:{[H.Backward]:!1,[H.Forward]:!1}};function Nr(e){let{delta:t,disabled:n}=e;const r=Qt(t);return yt(o=>{if(n||!r||!o)return Lr;const i={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[H.Backward]:o.x[H.Backward]||i.x===-1,[H.Forward]:o.x[H.Forward]||i.x===1},y:{[H.Backward]:o.y[H.Backward]||i.y===-1,[H.Forward]:o.y[H.Forward]||i.y===1}}},[n,t,r])}function Br(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return yt(o=>{var i;return t==null?null:(i=r??o)!=null?i:null},[r,t])}function Fr(e,t){return a.useMemo(()=>e.reduce((n,r)=>{const{sensor:o}=r,i=o.activators.map(l=>({eventName:l.eventName,handler:t(l.handler,r)}));return[...n,...i]},[]),[e,t])}var mt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(mt||(mt={}));var nn;(function(e){e.Optimized="optimized"})(nn||(nn={}));const _n=new Map;function Hr(e,t){let{dragging:n,dependencies:r,config:o}=t;const[i,l]=a.useState(null),{frequency:u,measure:f,strategy:p}=o,h=a.useRef(e),d=j(),g=gt(d),c=a.useCallback(function(C){C===void 0&&(C=[]),!g.current&&l(v=>v===null?C:v.concat(C.filter(w=>!v.includes(w))))},[g]),b=a.useRef(null),y=yt(C=>{if(d&&!n)return _n;if(!C||C===_n||h.current!==e||i!=null){const v=new Map;for(let w of e){if(!w)continue;if(i&&i.length>0&&!i.includes(w.id)&&w.rect.current){v.set(w.id,w.rect.current);continue}const I=w.node.current,E=I?new ln(f(I),I):null;w.rect.current=E,E&&v.set(w.id,E)}return v}return C},[e,i,n,d,f]);return a.useEffect(()=>{h.current=e},[e]),a.useEffect(()=>{d||c()},[n,d]),a.useEffect(()=>{i&&i.length>0&&l(null)},[JSON.stringify(i)]),a.useEffect(()=>{d||typeof u!="number"||b.current!==null||(b.current=setTimeout(()=>{c(),b.current=null},u))},[u,d,c,...r]),{droppableRects:y,measureDroppableContainers:c,measuringScheduled:i!=null};function j(){switch(p){case mt.Always:return!1;case mt.BeforeDragging:return n;default:return!n}}}function as(e,t){return yt(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Ur(e,t){return as(e,t)}function Wr(e){let{callback:t,disabled:n}=e;const r=on(t),o=a.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(r)},[r,n]);return a.useEffect(()=>()=>o?.disconnect(),[o]),o}function Lt(e){let{callback:t,disabled:n}=e;const r=on(t),o=a.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(r)},[n]);return a.useEffect(()=>()=>o?.disconnect(),[o]),o}function Gr(e){return new ln(nt(e),e)}function En(e,t,n){t===void 0&&(t=Gr);const[r,o]=a.useState(null);function i(){o(f=>{if(!e)return null;if(e.isConnected===!1){var p;return(p=f??n)!=null?p:null}const h=t(e);return JSON.stringify(f)===JSON.stringify(h)?f:h})}const l=Wr({callback(f){if(e)for(const p of f){const{type:h,target:d}=p;if(h==="childList"&&d instanceof HTMLElement&&d.contains(e)){i();break}}}}),u=Lt({callback:i});return De(()=>{i(),e?(u?.observe(e),l?.observe(document.body,{childList:!0,subtree:!0})):(u?.disconnect(),l?.disconnect())},[e]),r}function Vr(e){const t=as(e);return Zn(e,t)}const Mn=[];function Xr(e){const t=a.useRef(e),n=yt(r=>e?r&&r!==Mn&&e&&t.current&&e.parentNode===t.current.parentNode?r:$t(e):Mn,[e]);return a.useEffect(()=>{t.current=e},[e]),n}function Yr(e){const[t,n]=a.useState(null),r=a.useRef(e),o=a.useCallback(i=>{const l=Gt(i.target);l&&n(u=>u?(u.set(l,en(l)),new Map(u)):null)},[]);return a.useEffect(()=>{const i=r.current;if(e!==i){l(i);const u=e.map(f=>{const p=Gt(f);return p?(p.addEventListener("scroll",o,{passive:!0}),[p,en(p)]):null}).filter(f=>f!=null);n(u.length?new Map(u):null),r.current=e}return()=>{l(e),l(i)};function l(u){u.forEach(f=>{const p=Gt(f);p?.removeEventListener("scroll",o)})}},[o,e]),a.useMemo(()=>e.length?t?Array.from(t.values()).reduce((i,l)=>Ze(i,l),je):os(e):je,[e,t])}function Tn(e,t){t===void 0&&(t=[]);const n=a.useRef(null);return a.useEffect(()=>{n.current=null},t),a.useEffect(()=>{const r=e!==je;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?ht(e,n.current):je}function Kr(e){a.useEffect(()=>{if(!Ot)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n?.()}},e.map(t=>{let{sensor:n}=t;return n}))}function Jr(e,t){return a.useMemo(()=>e.reduce((n,r)=>{let{eventName:o,handler:i}=r;return n[o]=l=>{i(l,t)},n},{}),[e,t])}function ls(e){return a.useMemo(()=>e?br(e):null,[e])}const An=[];function qr(e,t){t===void 0&&(t=nt);const[n]=e,r=ls(n?se(n):null),[o,i]=a.useState(An);function l(){i(()=>e.length?e.map(f=>ss(f)?r:new ln(t(f),f)):An)}const u=Lt({callback:l});return De(()=>{u?.disconnect(),l(),e.forEach(f=>u?.observe(f))},[e]),o}function Qr(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return vt(t)?t:e}function Zr(e){let{measure:t}=e;const[n,r]=a.useState(null),o=a.useCallback(p=>{for(const{target:h}of p)if(vt(h)){r(d=>{const g=t(h);return d?{...d,width:g.width,height:g.height}:g});break}},[t]),i=Lt({callback:o}),l=a.useCallback(p=>{const h=Qr(p);i?.disconnect(),h&&i?.observe(h),r(h?t(h):null)},[t,i]),[u,f]=Mt(l);return a.useMemo(()=>({nodeRef:u,rect:n,setRef:f}),[n,u,f])}const eo=[{sensor:un,options:{}},{sensor:cn,options:{}}],to={current:{}},Et={draggable:{measure:Cn},droppable:{measure:Cn,strategy:mt.WhileDragging,frequency:nn.Optimized},dragOverlay:{measure:nt}};class ft extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const no={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new ft,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Tt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Et,measureDroppableContainers:Tt,windowRect:null,measuringScheduled:!1},so={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Tt,draggableNodes:new Map,over:null,measureDroppableContainers:Tt},Nt=a.createContext(so),cs=a.createContext(no);function ro(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new ft}}}function oo(e,t){switch(t.type){case B.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case B.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case B.DragEnd:case B.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case B.RegisterDroppable:{const{element:n}=t,{id:r}=n,o=new ft(e.droppable.containers);return o.set(r,n),{...e,droppable:{...e.droppable,containers:o}}}case B.SetDroppableDisabled:{const{id:n,key:r,disabled:o}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const l=new ft(e.droppable.containers);return l.set(n,{...i,disabled:o}),{...e,droppable:{...e.droppable,containers:l}}}case B.UnregisterDroppable:{const{id:n,key:r}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const i=new ft(e.droppable.containers);return i.delete(n),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function io(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:o}=a.useContext(Nt),i=Qt(r),l=Qt(n?.id);return a.useEffect(()=>{if(!t&&!r&&i&&l!=null){if(!an(i)||document.activeElement===i.target)return;const u=o.get(l);if(!u)return;const{activatorNode:f,node:p}=u;if(!f.current&&!p.current)return;requestAnimationFrame(()=>{for(const h of[f.current,p.current]){if(!h)continue;const d=Qs(h);if(d){d.focus();break}}})}},[r,t,o,l,i]),null}function ao(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((o,i)=>i({transform:o,...r}),n):n}function lo(e){return a.useMemo(()=>({draggable:{...Et.draggable,...e?.draggable},droppable:{...Et.droppable,...e?.droppable},dragOverlay:{...Et.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function co(e){let{activeNode:t,measure:n,initialRect:r,config:o=!0}=e;const i=a.useRef(!1),{x:l,y:u}=typeof o=="boolean"?{x:o,y:o}:o;De(()=>{if(!l&&!u||!t){i.current=!1;return}if(i.current||!r)return;const p=t?.node.current;if(!p||p.isConnected===!1)return;const h=n(p),d=Zn(h,r);if(l||(d.x=0),u||(d.y=0),i.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const g=es(p);g&&g.scrollBy({top:d.y,left:d.x})}},[t,l,u,r,n])}const ds=a.createContext({...je,scaleX:1,scaleY:1});var Fe;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Fe||(Fe={}));const uo=a.memo(function(t){var n,r,o,i;let{id:l,accessibility:u,autoScroll:f=!0,children:p,sensors:h=eo,collisionDetection:d=gr,measuring:g,modifiers:c,...b}=t;const y=a.useReducer(oo,void 0,ro),[j,C]=y,[v,w]=rr(),[I,E]=a.useState(Fe.Uninitialized),M=I===Fe.Initialized,{draggable:{active:D,nodes:_,translate:L},droppable:{containers:$}}=j,O=D!=null?_.get(D):null,q=a.useRef({initial:null,translated:null}),re=a.useMemo(()=>{var X;return D!=null?{id:D,data:(X=O?.data)!=null?X:to,rect:q}:null},[D,O]),ce=a.useRef(null),[Me,Je]=a.useState(null),[Y,He]=a.useState(null),Q=gt(b,Object.values(b)),Te=bt("DndDescribedBy",l),Ue=a.useMemo(()=>$.getEnabled(),[$]),W=lo(g),{droppableRects:de,measureDroppableContainers:ve,measuringScheduled:We}=Hr(Ue,{dragging:M,dependencies:[L.x,L.y],config:W.droppable}),Z=Br(_,D),qe=a.useMemo(()=>Y?Zt(Y):null,[Y]),Se=ws(),ye=Ur(Z,W.draggable.measure);co({activeNode:D!=null?_.get(D):null,config:Se.layoutShiftCompensation,initialRect:ye,measure:W.draggable.measure});const z=En(Z,W.draggable.measure,ye),Ge=En(Z?Z.parentElement:null),ue=a.useRef({activatorEvent:null,active:null,activeNode:Z,collisionRect:null,collisions:null,droppableRects:de,draggableNodes:_,draggingNode:null,draggingNodeRect:null,droppableContainers:$,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ae=$.getNodeFor((n=ue.current.over)==null?void 0:n.id),be=Zr({measure:W.dragOverlay.measure}),ze=(r=be.nodeRef.current)!=null?r:Z,Pe=M?(o=be.rect)!=null?o:z:null,wt=!!(be.nodeRef.current&&be.rect),jt=Vr(wt?null:z),st=ls(ze?se(ze):null),Re=Xr(M?Ae??Z:null),x=qr(Re),m=ao(c,{transform:{x:L.x-jt.x,y:L.y-jt.y,scaleX:1,scaleY:1},activatorEvent:Y,active:re,activeNodeRect:z,containerNodeRect:Ge,draggingNodeRect:Pe,over:ue.current.over,overlayNodeRect:be.rect,scrollableAncestors:Re,scrollableAncestorRects:x,windowRect:st}),R=qe?Ze(qe,L):null,S=Yr(Re),T=Tn(S),G=Tn(S,[z]),fe=Ze(m,T),Oe=Pe?mr(Pe,m):null,Ve=re&&Oe?d({active:re,collisionRect:Oe,droppableRects:de,droppableContainers:Ue,pointerCoordinates:R}):null,V=Qn(Ve,"id"),[ee,gn]=a.useState(null),ms=wt?m:Ze(m,G),xs=hr(ms,(i=ee?.rect)!=null?i:null,z),Bt=a.useRef(null),hn=a.useCallback((X,oe)=>{let{sensor:ie,options:$e}=oe;if(ce.current==null)return;const ge=_.get(ce.current);if(!ge)return;const ae=X.nativeEvent,Ce=new ie({active:ce.current,activeNode:ge,event:ae,options:$e,context:ue,onAbort(U){if(!_.get(U))return;const{onDragAbort:ke}=Q.current,_e={id:U};ke?.(_e),v({type:"onDragAbort",event:_e})},onPending(U,Le,ke,_e){if(!_.get(U))return;const{onDragPending:ot}=Q.current,Ne={id:U,constraint:Le,initialCoordinates:ke,offset:_e};ot?.(Ne),v({type:"onDragPending",event:Ne})},onStart(U){const Le=ce.current;if(Le==null)return;const ke=_.get(Le);if(!ke)return;const{onDragStart:_e}=Q.current,rt={activatorEvent:ae,active:{id:Le,data:ke.data,rect:q}};lt.unstable_batchedUpdates(()=>{_e?.(rt),E(Fe.Initializing),C({type:B.DragStart,initialCoordinates:U,active:Le}),v({type:"onDragStart",event:rt}),Je(Bt.current),He(ae)})},onMove(U){C({type:B.DragMove,coordinates:U})},onEnd:Qe(B.DragEnd),onCancel:Qe(B.DragCancel)});Bt.current=Ce;function Qe(U){return async function(){const{active:ke,collisions:_e,over:rt,scrollAdjustedTranslate:ot}=ue.current;let Ne=null;if(ke&&ot){const{cancelDrop:it}=Q.current;Ne={activatorEvent:ae,active:ke,collisions:_e,delta:ot,over:rt},U===B.DragEnd&&typeof it=="function"&&await Promise.resolve(it(Ne))&&(U=B.DragCancel)}ce.current=null,lt.unstable_batchedUpdates(()=>{C({type:U}),E(Fe.Uninitialized),gn(null),Je(null),He(null),Bt.current=null;const it=U===B.DragEnd?"onDragEnd":"onDragCancel";if(Ne){const Ft=Q.current[it];Ft?.(Ne),v({type:it,event:Ne})}})}}},[_]),vs=a.useCallback((X,oe)=>(ie,$e)=>{const ge=ie.nativeEvent,ae=_.get($e);if(ce.current!==null||!ae||ge.dndKit||ge.defaultPrevented)return;const Ce={active:ae};X(ie,oe.options,Ce)===!0&&(ge.dndKit={capturedBy:oe.sensor},ce.current=$e,hn(ie,oe))},[_,hn]),pn=Fr(h,vs);Kr(h),De(()=>{z&&I===Fe.Initializing&&E(Fe.Initialized)},[z,I]),a.useEffect(()=>{const{onDragMove:X}=Q.current,{active:oe,activatorEvent:ie,collisions:$e,over:ge}=ue.current;if(!oe||!ie)return;const ae={active:oe,activatorEvent:ie,collisions:$e,delta:{x:fe.x,y:fe.y},over:ge};lt.unstable_batchedUpdates(()=>{X?.(ae),v({type:"onDragMove",event:ae})})},[fe.x,fe.y]),a.useEffect(()=>{const{active:X,activatorEvent:oe,collisions:ie,droppableContainers:$e,scrollAdjustedTranslate:ge}=ue.current;if(!X||ce.current==null||!oe||!ge)return;const{onDragOver:ae}=Q.current,Ce=$e.get(V),Qe=Ce&&Ce.rect.current?{id:Ce.id,rect:Ce.rect.current,data:Ce.data,disabled:Ce.disabled}:null,U={active:X,activatorEvent:oe,collisions:ie,delta:{x:ge.x,y:ge.y},over:Qe};lt.unstable_batchedUpdates(()=>{gn(Qe),ae?.(U),v({type:"onDragOver",event:U})})},[V]),De(()=>{ue.current={activatorEvent:Y,active:re,activeNode:Z,collisionRect:Oe,collisions:Ve,droppableRects:de,draggableNodes:_,draggingNode:ze,draggingNodeRect:Pe,droppableContainers:$,over:ee,scrollableAncestors:Re,scrollAdjustedTranslate:fe},q.current={initial:Pe,translated:Oe}},[re,Z,Ve,Oe,_,ze,Pe,de,$,ee,Re,fe]),$r({...Se,delta:L,draggingRect:Oe,pointerCoordinates:R,scrollableAncestors:Re,scrollableAncestorRects:x});const ys=a.useMemo(()=>({active:re,activeNode:Z,activeNodeRect:z,activatorEvent:Y,collisions:Ve,containerNodeRect:Ge,dragOverlay:be,draggableNodes:_,droppableContainers:$,droppableRects:de,over:ee,measureDroppableContainers:ve,scrollableAncestors:Re,scrollableAncestorRects:x,measuringConfiguration:W,measuringScheduled:We,windowRect:st}),[re,Z,z,Y,Ve,Ge,be,_,$,de,ee,ve,Re,x,W,We,st]),bs=a.useMemo(()=>({activatorEvent:Y,activators:pn,active:re,activeNodeRect:z,ariaDescribedById:{draggable:Te},dispatch:C,draggableNodes:_,over:ee,measureDroppableContainers:ve}),[Y,pn,re,z,C,Te,_,ee,ve]);return ne.createElement(Kn.Provider,{value:w},ne.createElement(Nt.Provider,{value:bs},ne.createElement(cs.Provider,{value:ys},ne.createElement(ds.Provider,{value:xs},p)),ne.createElement(io,{disabled:u?.restoreFocus===!1})),ne.createElement(ar,{...u,hiddenTextDescribedById:Te}));function ws(){const X=Me?.autoScrollEnabled===!1,oe=typeof f=="object"?f.enabled===!1:f===!1,ie=M&&!X&&!oe;return typeof f=="object"?{...f,enabled:ie}:{enabled:ie}}}),fo=a.createContext(null),zn="button",go="Draggable";function ho(e){let{id:t,data:n,disabled:r=!1,attributes:o}=e;const i=bt(go),{activators:l,activatorEvent:u,active:f,activeNodeRect:p,ariaDescribedById:h,draggableNodes:d,over:g}=a.useContext(Nt),{role:c=zn,roleDescription:b="draggable",tabIndex:y=0}=o??{},j=f?.id===t,C=a.useContext(j?ds:fo),[v,w]=Mt(),[I,E]=Mt(),M=Jr(l,t),D=gt(n);De(()=>(d.set(t,{id:t,key:i,node:v,activatorNode:I,data:D}),()=>{const L=d.get(t);L&&L.key===i&&d.delete(t)}),[d,t]);const _=a.useMemo(()=>({role:c,tabIndex:y,"aria-disabled":r,"aria-pressed":j&&c===zn?!0:void 0,"aria-roledescription":b,"aria-describedby":h.draggable}),[r,c,y,j,b,h.draggable]);return{active:f,activatorEvent:u,activeNodeRect:p,attributes:_,isDragging:j,listeners:r?void 0:M,node:v,over:g,setNodeRef:w,setActivatorNodeRef:E,transform:C}}function po(){return a.useContext(cs)}const mo="Droppable",xo={timeout:25};function vo(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:o}=e;const i=bt(mo),{active:l,dispatch:u,over:f,measureDroppableContainers:p}=a.useContext(Nt),h=a.useRef({disabled:n}),d=a.useRef(!1),g=a.useRef(null),c=a.useRef(null),{disabled:b,updateMeasurementsFor:y,timeout:j}={...xo,...o},C=gt(y??r),v=a.useCallback(()=>{if(!d.current){d.current=!0;return}c.current!=null&&clearTimeout(c.current),c.current=setTimeout(()=>{p(Array.isArray(C.current)?C.current:[C.current]),c.current=null},j)},[j]),w=Lt({callback:v,disabled:b||!l}),I=a.useCallback((_,L)=>{w&&(L&&(w.unobserve(L),d.current=!1),_&&w.observe(_))},[w]),[E,M]=Mt(I),D=gt(t);return a.useEffect(()=>{!w||!E.current||(w.disconnect(),d.current=!1,w.observe(E.current))},[E,w]),a.useEffect(()=>(u({type:B.RegisterDroppable,element:{id:r,key:i,disabled:n,node:E,rect:g,data:D}}),()=>u({type:B.UnregisterDroppable,key:i,id:r})),[r]),a.useEffect(()=>{n!==h.current.disabled&&(u({type:B.SetDroppableDisabled,id:r,key:i,disabled:n}),h.current.disabled=n)},[r,i,n,u]),{active:l,rect:g,isOver:f?.id===r,node:E,over:f,setNodeRef:M}}function fn(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function yo(e,t){return e.reduce((n,r,o)=>{const i=t.get(r);return i&&(n[o]=i),n},Array(e.length))}function Ct(e){return e!==null&&e>=0}function bo(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function wo(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const us=e=>{let{rects:t,activeIndex:n,overIndex:r,index:o}=e;const i=fn(t,r,n),l=t[o],u=i[o];return!u||!l?null:{x:u.left-l.left,y:u.top-l.top,scaleX:u.width/l.width,scaleY:u.height/l.height}},kt={scaleX:1,scaleY:1},jo=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:o,rects:i,overIndex:l}=e;const u=(t=i[n])!=null?t:r;if(!u)return null;if(o===n){const p=i[l];return p?{x:0,y:n<l?p.top+p.height-(u.top+u.height):p.top-u.top,...kt}:null}const f=So(i,o,n);return o>n&&o<=l?{x:0,y:-u.height-f,...kt}:o<n&&o>=l?{x:0,y:u.height+f,...kt}:{x:0,y:0,...kt}};function So(e,t,n){const r=e[t],o=e[t-1],i=e[t+1];return r?n<t?o?r.top-(o.top+o.height):i?i.top-(r.top+r.height):0:i?i.top-(r.top+r.height):o?r.top-(o.top+o.height):0:0}const fs="Sortable",gs=ne.createContext({activeIndex:-1,containerId:fs,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:us,disabled:{draggable:!1,droppable:!1}});function Ro(e){let{children:t,id:n,items:r,strategy:o=us,disabled:i=!1}=e;const{active:l,dragOverlay:u,droppableRects:f,over:p,measureDroppableContainers:h}=po(),d=bt(fs,n),g=u.rect!==null,c=a.useMemo(()=>r.map(M=>typeof M=="object"&&"id"in M?M.id:M),[r]),b=l!=null,y=l?c.indexOf(l.id):-1,j=p?c.indexOf(p.id):-1,C=a.useRef(c),v=!bo(c,C.current),w=j!==-1&&y===-1||v,I=wo(i);De(()=>{v&&b&&h(c)},[v,c,b,h]),a.useEffect(()=>{C.current=c},[c]);const E=a.useMemo(()=>({activeIndex:y,containerId:d,disabled:I,disableTransforms:w,items:c,overIndex:j,useDragOverlay:g,sortedRects:yo(c,f),strategy:o}),[y,d,I.draggable,I.droppable,w,c,j,f,g,o]);return ne.createElement(gs.Provider,{value:E},t)}const Co=e=>{let{id:t,items:n,activeIndex:r,overIndex:o}=e;return fn(n,r,o).indexOf(t)},ko=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:o,items:i,newIndex:l,previousItems:u,previousContainerId:f,transition:p}=e;return!p||!r||u!==i&&o===l?!1:n?!0:l!==o&&t===f},Io={duration:200,easing:"ease"},hs="transform",Do=pt.Transition.toString({property:hs,duration:0,easing:"linear"}),_o={roleDescription:"sortable"};function Eo(e){let{disabled:t,index:n,node:r,rect:o}=e;const[i,l]=a.useState(null),u=a.useRef(n);return De(()=>{if(!t&&n!==u.current&&r.current){const f=o.current;if(f){const p=nt(r.current,{ignoreTransform:!0}),h={x:f.left-p.left,y:f.top-p.top,scaleX:f.width/p.width,scaleY:f.height/p.height};(h.x||h.y)&&l(h)}}n!==u.current&&(u.current=n)},[t,n,r,o]),a.useEffect(()=>{i&&l(null)},[i]),i}function Mo(e){let{animateLayoutChanges:t=ko,attributes:n,disabled:r,data:o,getNewIndex:i=Co,id:l,strategy:u,resizeObserverConfig:f,transition:p=Io}=e;const{items:h,containerId:d,activeIndex:g,disabled:c,disableTransforms:b,sortedRects:y,overIndex:j,useDragOverlay:C,strategy:v}=a.useContext(gs),w=To(r,c),I=h.indexOf(l),E=a.useMemo(()=>({sortable:{containerId:d,index:I,items:h},...o}),[d,o,I,h]),M=a.useMemo(()=>h.slice(h.indexOf(l)),[h,l]),{rect:D,node:_,isOver:L,setNodeRef:$}=vo({id:l,data:E,disabled:w.droppable,resizeObserverConfig:{updateMeasurementsFor:M,...f}}),{active:O,activatorEvent:q,activeNodeRect:re,attributes:ce,setNodeRef:Me,listeners:Je,isDragging:Y,over:He,setActivatorNodeRef:Q,transform:Te}=ho({id:l,data:E,attributes:{..._o,...n},disabled:w.draggable}),Ue=Ys($,Me),W=!!O,de=W&&!b&&Ct(g)&&Ct(j),ve=!C&&Y,We=ve&&de?Te:null,qe=de?We??(u??v)({rects:y,activeNodeRect:re,activeIndex:g,overIndex:j,index:I}):null,Se=Ct(g)&&Ct(j)?i({id:l,items:h,activeIndex:g,overIndex:j}):I,ye=O?.id,z=a.useRef({activeId:ye,items:h,newIndex:Se,containerId:d}),Ge=h!==z.current.items,ue=t({active:O,containerId:d,isDragging:Y,isSorting:W,id:l,index:I,items:h,newIndex:z.current.newIndex,previousItems:z.current.items,previousContainerId:z.current.containerId,transition:p,wasDragging:z.current.activeId!=null}),Ae=Eo({disabled:!ue,index:I,node:_,rect:D});return a.useEffect(()=>{W&&z.current.newIndex!==Se&&(z.current.newIndex=Se),d!==z.current.containerId&&(z.current.containerId=d),h!==z.current.items&&(z.current.items=h)},[W,Se,d,h]),a.useEffect(()=>{if(ye===z.current.activeId)return;if(ye&&!z.current.activeId){z.current.activeId=ye;return}const ze=setTimeout(()=>{z.current.activeId=ye},50);return()=>clearTimeout(ze)},[ye]),{active:O,activeIndex:g,attributes:ce,data:E,rect:D,index:I,newIndex:Se,items:h,isOver:L,isSorting:W,isDragging:Y,listeners:Je,node:_,overIndex:j,over:He,setNodeRef:Ue,setActivatorNodeRef:Q,setDroppableNodeRef:$,setDraggableNodeRef:Me,transform:Ae??qe,transition:be()};function be(){if(Ae||Ge&&z.current.newIndex===I)return Do;if(!(ve&&!an(q)||!p)&&(W||ue))return pt.Transition.toString({...p,property:hs})}}function To(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:t.draggable,droppable:(r=e?.droppable)!=null?r:t.droppable}}function zt(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const Ao=[A.Down,A.Right,A.Up,A.Left],zo=(e,t)=>{let{context:{active:n,collisionRect:r,droppableRects:o,droppableContainers:i,over:l,scrollableAncestors:u}}=t;if(Ao.includes(e.code)){if(e.preventDefault(),!n||!r)return;const f=[];i.getEnabled().forEach(d=>{if(!d||d!=null&&d.disabled)return;const g=o.get(d.id);if(g)switch(e.code){case A.Down:r.top<g.top&&f.push(d);break;case A.Up:r.top>g.top&&f.push(d);break;case A.Left:r.left>g.left&&f.push(d);break;case A.Right:r.left<g.left&&f.push(d);break}});const p=ur({collisionRect:r,droppableRects:o,droppableContainers:f});let h=Qn(p,"id");if(h===l?.id&&p.length>1&&(h=p[1].id),h!=null){const d=i.get(n.id),g=i.get(h),c=g?o.get(g.id):null,b=g?.node.current;if(b&&c&&d&&g){const j=$t(b).some((M,D)=>u[D]!==M),C=ps(d,g),v=Po(d,g),w=j||!C?{x:0,y:0}:{x:v?r.width-c.width:0,y:v?r.height-c.height:0},I={x:c.left,y:c.top};return w.x&&w.y?I:ht(I,w)}}}};function ps(e,t){return!zt(e)||!zt(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function Po(e,t){return!zt(e)||!zt(t)||!ps(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}const{Text:Yt}=xt,Oo={equity_risk:{label:"ËÇ°ÊùÉÈ£éÈô©",color:"blue",icon:"üè¢"},investment_risk:{label:"ÊäïËµÑÈ£éÈô©",color:"gold",icon:"üíº"},governance_risk:{label:"Ê≤ªÁêÜÈ£éÈô©",color:"purple",icon:"‚öñÔ∏è"},contract_risk:{label:"ÂêàÂêåÈ£éÈô©",color:"orange",icon:"üìÑ"},tax_risk:{label:"Á®éÂä°È£éÈô©",color:"green",icon:"üßæ"},litigation_risk:{label:"ËØâËÆºÈ£éÈô©",color:"red",icon:"‚öñÔ∏è"}},$o=({value:e=[],onChange:t,categoryFilter:n,disabled:r=!1,packages:o,onPackagesLoad:i})=>{const[l,u]=a.useState([]),[f,p]=a.useState(!1),h=o||l;console.log("[RiskPackageSelector] Ê∏≤Êüì‰∏≠...",{externalPackages:o?.length,internalPackages:l.length,totalPackages:h.length,loading:f}),a.useEffect(()=>{o||d()},[n]);const d=async()=>{p(!0);try{console.log("[RiskPackageSelector] ÂºÄÂßãÂä†ËΩΩËßÑÂàôÂåÖ..."),console.log("[RiskPackageSelector] ÂΩìÂâç token:",localStorage.getItem("accessToken")?.substring(0,20)+"...");const c=await js.listPackages(n);console.log("[RiskPackageSelector] Âä†ËΩΩÊàêÂäü:",c.packages?.length||0,"‰∏™ËßÑÂàôÂåÖ"),console.log("[RiskPackageSelector] ËßÑÂàôÂåÖÂàóË°®:",c.packages),u(c.packages||[]),i?.(c.packages||[])}catch(c){console.error("[RiskPackageSelector] Âä†ËΩΩÂ§±Ë¥•:",c),console.error("[RiskPackageSelector] ÈîôËØØËØ¶ÊÉÖ:",{message:c.message,response:c.response?.data,status:c.response?.status}),c.response?.status===401?(console.error("[RiskPackageSelector] ËÆ§ËØÅÂ§±Ë¥•ÔºåËØ∑ÂÖàÁôªÂΩï"),F.error("Âä†ËΩΩËßÑÂàôÂåÖÂ§±Ë¥•ÔºöËØ∑ÂÖàÁôªÂΩï")):F.error(`Âä†ËΩΩËßÑÂàôÂåÖÂ§±Ë¥•: ${c.message||"Êú™Áü•ÈîôËØØ"}`)}finally{p(!1)}},g=c=>{console.log("[RiskPackageSelector] ÈÄâÊã©ÂèòÊõ¥:",c),t&&t(c)};return s.jsx("div",{children:s.jsxs(k,{direction:"vertical",style:{width:"100%"},size:"small",children:[s.jsx("div",{children:s.jsxs(k,{children:[s.jsx(Yt,{strong:!0,style:{fontSize:13},children:"ÈÄâÊã©ËßÑÂàôÂåÖÔºö"}),s.jsx(Fn,{title:"ÂèØ‰ª•ÈÄâÊã©Â§ö‰∏™ËßÑÂàôÂåÖÔºåÈÄâ‰∏≠ÁöÑËßÑÂàôÂåÖÂèØ‰ª•ÊãñÊãΩË∞ÉÊï¥‰ºòÂÖàÁ∫ßÈ°∫Â∫è",children:s.jsx(Es,{style:{color:"#1890ff"}})})]})}),f?s.jsx(xe,{message:s.jsxs(k,{children:[s.jsx(Ye,{})," Ê≠£Âú®Âä†ËΩΩËßÑÂàôÂåÖ..."]}),type:"info"}):h.length===0?s.jsx(xe,{message:"ÊöÇÊó†ÂèØÁî®ÁöÑËßÑÂàôÂåÖ",description:"ËØ∑ÂÖàÂú®ÁÆ°ÁêÜÂêéÂè∞ÂàõÂª∫ËßÑÂàôÂåÖ",type:"warning",showIcon:!0}):s.jsx(mn,{mode:"multiple",style:{width:"100%"},placeholder:"ËØ∑ÈÄâÊã©‰∏Ä‰∏™ÊàñÂ§ö‰∏™ËßÑÂàôÂåÖ",value:e,onChange:g,disabled:r,filterOption:(c,b)=>{const y=h.find(C=>C.package_id===b?.value);return y?`${y.package_name} ${y.description}`.toLowerCase().includes(c.toLowerCase()):!1},optionLabelProp:"label",maxTagCount:"responsive",size:"large",listHeight:400,showSearch:!0,allowClear:!0,children:h.map(c=>{const b=Oo[c.package_category]||{label:c.package_category,color:"default",icon:"üì¶"},y=e.includes(c.package_id);return s.jsx(mn.Option,{value:c.package_id,label:c.package_name,disabled:!c.is_active,children:s.jsxs("div",{style:{padding:"8px 4px",backgroundColor:y?"#e6f7ff":"transparent",borderRadius:4},children:[s.jsx("div",{style:{marginBottom:4},children:s.jsxs(k,{children:[s.jsx("span",{style:{fontSize:16},children:b.icon}),s.jsx(Yt,{strong:!0,style:{fontSize:14},children:c.package_name}),y&&s.jsx(Ie,{style:{color:"#52c41a",marginLeft:8}})]})}),s.jsx("div",{style:{marginBottom:4},children:s.jsxs(k,{wrap:!0,size:"small",children:[s.jsx(N,{color:b.color,children:b.label}),c.version&&s.jsxs(N,{color:"cyan",children:["v",c.version]}),c.is_system&&s.jsx(N,{color:"blue",children:"ÂÆòÊñπ"}),c.rules&&s.jsxs(N,{children:[c.rules.length," Êù°ËßÑÂàô"]}),!c.is_active&&s.jsx(N,{color:"default",children:"Â∑≤Á¶ÅÁî®"})]})}),c.description&&s.jsx("div",{children:s.jsx(Yt,{type:"secondary",style:{fontSize:12},children:c.description.length>100?c.description.substring(0,100)+"...":c.description})})]})},c.package_id)})}),e.length>0&&s.jsx(xe,{message:s.jsxs(k,{children:[s.jsx(Ie,{style:{color:"#52c41a"}}),s.jsxs("span",{children:["Â∑≤ÈÄâÊã© ",e.length," ‰∏™ËßÑÂàôÂåÖÔºåÂèØ‰ª•Âú®‰∏ãÊñπÊãñÊãΩË∞ÉÊï¥‰ºòÂÖàÁ∫ß"]})]}),type:"success",showIcon:!1,style:{fontSize:12}})]})})},{Text:he,Paragraph:Lo,Title:No}=xt,{Panel:Bo}=Pt,Be={deepseek:{name:"DeepSeek",color:"#1890ff",icon:"üî¨"},qwen:{name:"Qwen",color:"#52c41a",icon:"üåü"},chatgpt:{name:"ChatGPT",color:"#fa8c16",icon:"ü§ñ"}},Pn=({data:e,selectedResult:t,onSelectResult:n})=>{const[r,o]=a.useState([]),i=()=>{if(!e)return 0;const g=Object.values(e.models),c=g.reduce((b,y)=>b+y.progress,0);return Math.round(c/g.length)},l=()=>{if(!e)return"pending";const g=Object.values(e.models),c=g.every(y=>y.status==="completed"||y.status==="failed"),b=g.some(y=>y.status==="analyzing");return c?"completed":b?"analyzing":"pending"},u=g=>g?g<1e3?`${g}ms`:`${(g/1e3).toFixed(2)}s`:"-",f=(g,c)=>{const b=Be[g],y=c.status==="analyzing",j=c.status==="completed",C=c.status==="failed",v=t===g,w=e?.comparison&&(e.comparison.fastest===g||e.comparison.most_comprehensive===g||e.comparison.highest_confidence===g);return s.jsx(Hn.Ribbon,{text:w?s.jsxs(k,{children:[s.jsx(bn,{}),"ÊúÄ‰ºò"]}):v?s.jsxs(k,{children:[s.jsx(Ie,{}),"Â∑≤ÈÄâ‰∏≠"]}):void 0,color:v?"gold":w?"cyan":void 0,children:s.jsxs(P,{style:{marginBottom:16,border:v?"2px solid #faad14":void 0,position:"relative",overflow:"hidden"},extra:n&&j?s.jsx(me,{type:v?"primary":"default",size:"small",icon:v?s.jsx(Ie,{}):s.jsx(Un,{}),onClick:()=>n(g),children:v?"Â∑≤ÈÄâ":"ÈÄâÊã©Ê≠§ÁªìÊûú"}):void 0,children:[s.jsx("div",{style:{position:"absolute",top:16,right:16,opacity:.1,fontSize:48},children:b.icon}),s.jsxs(k,{direction:"vertical",size:"small",style:{width:"100%"},children:[s.jsxs(k,{children:[s.jsxs(he,{strong:!0,style:{fontSize:16},children:[b.icon," ",b.name]}),y&&s.jsx(xn,{spin:!0,style:{color:b.color}}),j&&s.jsx(Ie,{style:{color:"#52c41a"}}),C&&s.jsx(he,{type:"danger",children:"‚úó"}),s.jsxs(N,{color:j?"success":y?"processing":C?"error":"default",children:[c.status==="pending"&&"Á≠âÂæÖ‰∏≠",c.status==="analyzing"&&"ÂàÜÊûê‰∏≠",c.status==="completed"&&"Â∑≤ÂÆåÊàê",c.status==="failed"&&"Â§±Ë¥•"]})]}),y&&s.jsx(Ee,{percent:c.progress,status:"active",strokeColor:b.color}),j&&c.result&&s.jsxs(s.Fragment,{children:[s.jsxs(ct,{gutter:16,children:[s.jsx(le,{span:8,children:s.jsx(we,{title:"ÊÄªÈ£éÈô©ÁÇπ",value:c.result.risk_items,valueStyle:{fontSize:18,color:"#cf1322"}})}),s.jsx(le,{span:8,children:s.jsx(we,{title:"ÁΩÆ‰ø°Â∫¶",value:c.result.confidence*100,suffix:"%",valueStyle:{fontSize:18,color:"#52c41a"},precision:1})}),s.jsx(le,{span:8,children:s.jsx(we,{title:"Áî®Êó∂",value:u(c.duration),valueStyle:{fontSize:16}})})]}),s.jsx("div",{style:{marginTop:8},children:s.jsxs(k,{split:s.jsx(Ke,{type:"vertical"}),children:[s.jsxs(he,{type:"danger",children:["È´òÈ£éÈô©Ôºö",c.result.high_risks]}),s.jsxs(he,{type:"warning",children:["‰∏≠È£éÈô©Ôºö",c.result.medium_risks]}),s.jsxs(he,{type:"success",children:["‰ΩéÈ£éÈô©Ôºö",c.result.low_risks]})]})}),s.jsxs(k,{split:s.jsx(Ke,{type:"vertical"}),children:[s.jsxs(he,{children:["Á≠ñÁï•Ôºö",c.result.strategies]}),s.jsxs(he,{children:["Âª∫ËÆÆÔºö",c.result.recommendations]})]})]}),C&&c.error&&s.jsx(xe,{message:"ÂàÜÊûêÂ§±Ë¥•",description:c.error,type:"error",showIcon:!0})]}),j&&c.result&&s.jsx(Pt,{ghost:!0,size:"small",style:{marginTop:12},activeKey:r.includes(g)?g:void 0,onChange:I=>{const E=r.includes(g)?r.filter(M=>M!==g):[...r,g];o(E)},children:s.jsx(Bo,{header:s.jsx(he,{type:"secondary",children:"Êü•ÁúãËØ¶ÁªÜÁªìÊûú"}),children:s.jsxs("div",{children:[s.jsx(he,{strong:!0,children:"ÊëòË¶ÅÔºö"}),s.jsx(Lo,{children:c.result.summary})]})},g)})]})},g)},p=()=>{if(!e||!e.comparison)return null;const{comparison:g,selected:c}=e;return s.jsxs(P,{title:s.jsx(No,{level:5,children:"üèÜ ÂØπÊØîÁªìÊûú"}),style:{marginBottom:16},children:[s.jsxs(ct,{gutter:16,children:[s.jsx(le,{span:6,children:s.jsx(P,{size:"small",children:s.jsx(we,{title:"ÊúÄÂø´ÂÆåÊàê",value:Be[g.fastest].name,valueStyle:{fontSize:14,color:Be[g.fastest].color},prefix:s.jsx(_t,{})})})}),s.jsx(le,{span:6,children:s.jsx(P,{size:"small",children:s.jsx(we,{title:"ÊúÄÂÖ®Èù¢",value:Be[g.most_comprehensive].name,valueStyle:{fontSize:14,color:Be[g.most_comprehensive].color},prefix:s.jsx(Ss,{})})})}),s.jsx(le,{span:6,children:s.jsx(P,{size:"small",children:s.jsx(we,{title:"ÊúÄÈ´òÁΩÆ‰ø°Â∫¶",value:Be[g.highest_confidence].name,valueStyle:{fontSize:14,color:Be[g.highest_confidence].color},prefix:s.jsx(bn,{})})})}),s.jsx(le,{span:6,children:s.jsx(P,{size:"small",children:s.jsx(we,{title:"Ê®°Âûã‰∏ÄËá¥ÊÄß",value:g.consensus,suffix:"%",valueStyle:{fontSize:14},precision:0})})})]}),c&&s.jsx(xe,{message:s.jsxs(k,{children:[s.jsx(he,{children:"Â∑≤ÈÄâÊã©"}),s.jsx(N,{color:"blue",children:Be[c].name}),s.jsx(he,{children:"ÁöÑÂàÜÊûêÁªìÊûú‰Ωú‰∏∫ÊúÄÁªàËæìÂá∫"})]}),type:"info",showIcon:!0,style:{marginTop:12}})]})},h=l(),d=i();return s.jsxs("div",{children:[s.jsx(P,{style:{marginBottom:16},children:s.jsxs(k,{direction:"vertical",size:"small",style:{width:"100%"},children:[s.jsxs(k,{children:[s.jsx(he,{strong:!0,children:"Â§öÊ®°ÂûãÂπ∂Ë°åÂàÜÊûê"}),h==="analyzing"&&s.jsx(xn,{spin:!0}),h==="completed"&&s.jsx(Ie,{style:{color:"#52c41a"}}),s.jsxs(N,{color:h==="completed"?"success":h==="analyzing"?"processing":"default",children:[h==="pending"&&"Á≠âÂæÖ‰∏≠",h==="analyzing"&&"ÂàÜÊûê‰∏≠",h==="completed"&&"Â∑≤ÂÆåÊàê"]})]}),h==="analyzing"&&s.jsx(Ee,{percent:d,status:"active"})]})}),p(),e&&s.jsx(ct,{gutter:16,children:s.jsx(le,{span:24,children:Object.entries(e.models).map(([g,c])=>f(g,c))})})]})},{Text:te,Paragraph:It,Title:On}=xt,{Panel:Fo}=Pt,{TabPane:$n}=Wn,Ho=({report:e,showMetadata:t=!0,onDownload:n})=>{const[r,o]=a.useState([]),i=d=>({high:{color:"error",icon:s.jsx(qt,{}),label:"È´òÈ£éÈô©",progressColor:"#ff4d4f"},medium:{color:"warning",icon:s.jsx(vn,{}),label:"‰∏≠È£éÈô©",progressColor:"#faad14"},low:{color:"success",icon:s.jsx(Ie,{}),label:"‰ΩéÈ£éÈô©",progressColor:"#52c41a"}})[d],l=()=>{const d={high:10,medium:5,low:1},g=e.risk_distribution.high*d.high+e.risk_distribution.medium*d.medium+e.risk_distribution.low*d.low,c=e.risk_distribution.high+e.risk_distribution.medium+e.risk_distribution.low;if(c===0)return 0;const b=g/c;return Math.round(b/10*100)},u=()=>{const d=e.risk_distribution.high+e.risk_distribution.medium+e.risk_distribution.low;if(d===0)return s.jsx(xe,{message:"Êú™ÂèëÁé∞È£éÈô©",type:"success",showIcon:!0});const g=e.risk_distribution.high/d*100,c=e.risk_distribution.medium/d*100,b=e.risk_distribution.low/d*100;return s.jsxs(ct,{gutter:16,children:[s.jsx(le,{span:8,children:s.jsxs(P,{size:"small",children:[s.jsx(we,{title:s.jsx(te,{type:"danger",children:"È´òÈ£éÈô©"}),value:e.risk_distribution.high,suffix:`/ ${d}`,valueStyle:{color:"#cf1322"}}),s.jsx(Ee,{percent:g,strokeColor:"#ff4d4f",showInfo:!1,size:"small"})]})}),s.jsx(le,{span:8,children:s.jsxs(P,{size:"small",children:[s.jsx(we,{title:s.jsx(te,{type:"warning",children:"‰∏≠È£éÈô©"}),value:e.risk_distribution.medium,suffix:`/ ${d}`,valueStyle:{color:"#fa8c16"}}),s.jsx(Ee,{percent:c,strokeColor:"#faad14",showInfo:!1,size:"small"})]})}),s.jsx(le,{span:8,children:s.jsxs(P,{size:"small",children:[s.jsx(we,{title:s.jsx(te,{type:"success",children:"‰ΩéÈ£éÈô©"}),value:e.risk_distribution.low,suffix:`/ ${d}`,valueStyle:{color:"#52c41a"}}),s.jsx(Ee,{percent:b,strokeColor:"#52c41a",showInfo:!1,size:"small"})]})})]})},f=()=>e.risk_items.length===0?s.jsx(xe,{message:"Êú™ÂèëÁé∞È£éÈô©È°π",type:"success",showIcon:!0}):s.jsx(Pt,{activeKey:r,onChange:d=>o(d),accordion:!0,children:e.risk_items.map(d=>{const g=i(d.risk_level);return s.jsx(Fo,{header:s.jsxs(k,{children:[g.icon,s.jsx(te,{strong:!0,children:d.risk_title}),s.jsx(N,{color:g.color,children:g.label}),s.jsxs(N,{children:["ÁΩÆ‰ø°Â∫¶: ",(d.confidence*100).toFixed(0),"%"]}),d.sources&&d.sources.length>0&&s.jsx(Fn,{title:`ÂèëÁé∞Ê®°Âûã: ${d.sources.join(", ")}`,children:s.jsxs(N,{color:"blue",children:[d.sources.length," ‰∏™Ê®°Âûã"]})})]}),extra:s.jsx(me,{type:"text",size:"small",icon:s.jsx(Un,{}),onClick:c=>{c.stopPropagation()},children:"ËØ¶ÊÉÖ"}),children:s.jsxs(k,{direction:"vertical",size:"small",style:{width:"100%"},children:[s.jsxs("div",{children:[s.jsx(te,{strong:!0,children:"È£éÈô©ÊèèËø∞Ôºö"}),s.jsx(It,{children:d.description})]}),d.details&&s.jsxs("div",{children:[s.jsx(te,{strong:!0,children:"ËØ¶ÁªÜËØ¥ÊòéÔºö"}),s.jsx(It,{children:d.details})]}),d.suggestions&&s.jsxs("div",{children:[s.jsx(te,{strong:!0,children:"Â∫îÂØπÁ≠ñÁï•/Âª∫ËÆÆÔºö"}),s.jsx(It,{children:d.suggestions})]}),s.jsx("div",{children:s.jsxs(k,{children:[s.jsx(te,{type:"secondary",children:"ÁΩÆ‰ø°Â∫¶Ôºö"}),s.jsx(Ee,{percent:d.confidence*100,size:"small",strokeColor:g.progressColor,style:{width:100}})]})})]})},d.risk_id)})}),p=()=>{if(!t||!e.analysis_metadata)return null;const d=e.analysis_metadata;return s.jsx(P,{size:"small",style:{background:"#f5f5f5"},children:s.jsx(k,{direction:"vertical",size:"small",style:{width:"100%"},children:s.jsxs(k,{split:s.jsx(Ke,{type:"vertical"}),children:[d.package_used&&s.jsxs(te,{children:["ËßÑÂàôÂåÖÔºö",s.jsx(N,{children:d.package_used})]}),d.models_used&&s.jsxs(te,{children:["Ê®°ÂûãÔºö",d.models_used.map(g=>s.jsx(N,{color:"blue",children:g},g))]}),d.selected_model&&s.jsxs(te,{children:["ÊúÄÁªàÈÄâÊã©Ôºö",s.jsx(N,{color:"gold",children:d.selected_model})]}),d.analysis_duration&&s.jsxs(te,{children:["ËÄóÊó∂Ôºö",s.jsxs(N,{children:[(d.analysis_duration/1e3).toFixed(2),"s"]})]}),d.document_count&&s.jsxs(te,{children:["ÊñáÊ°£Êï∞Ôºö",s.jsx(N,{children:d.document_count})]})]})})})},h=l();return s.jsxs("div",{children:[s.jsxs(P,{title:s.jsxs(k,{children:[s.jsx(Kt,{}),s.jsx(On,{level:4,style:{margin:0},children:"È£éÈô©ËØÑ‰º∞Êä•Âëä"})]}),extra:n&&s.jsx(me,{type:"primary",icon:s.jsx(Jt,{}),onClick:n,children:"‰∏ãËΩΩÊä•Âëä"}),style:{marginBottom:16},children:[p(),s.jsx(Ke,{}),s.jsxs(ct,{gutter:16,style:{marginBottom:16},children:[s.jsx(le,{span:6,children:s.jsx(P,{children:s.jsx(we,{title:"ÊÄª‰ΩìÈ£éÈô©ÂàÜÊï∞",value:h,suffix:"/ 100",valueStyle:{color:h>=70?"#cf1322":h>=40?"#fa8c16":"#52c41a"}})})}),s.jsx(le,{span:18,children:s.jsxs("div",{children:[s.jsx(te,{strong:!0,children:"ÊâßË°åÊëòË¶ÅÔºö"}),s.jsx(It,{children:e.executive_summary})]})})]}),s.jsxs("div",{children:[s.jsx(On,{level:5,children:"È£éÈô©ÂàÜÂ∏É"}),u()]})]}),s.jsx(P,{children:s.jsxs(Wn,{defaultActiveKey:"risks",children:[s.jsx($n,{tab:s.jsxs(k,{children:[s.jsx(vn,{}),"È£éÈô©ÂèäÂ∫îÂØπ (",e.risk_items.length,")"]}),children:f()},"risks"),s.jsx($n,{tab:s.jsxs(k,{children:[s.jsx(Kt,{}),"ÂÆåÊï¥Êä•Âëä"]}),children:s.jsx("div",{style:{padding:16,background:"#f5f5f5",borderRadius:4},children:s.jsx(Ms,{children:e.executive_summary})})},"full")]})})]})},at="risk_analysis_history_",Dt="risk_analysis_history_index",Ln="risk_analysis_unread_count",Uo=300*1e3;class Wo{lastSyncTime=0;async syncHistoryList(){try{const t=Date.now();if(t-this.lastSyncTime<Uo){const o=this.getFromCache();if(o&&o.length>0)return o}const n=await J.get("/risk-analysis/sessions"),r=n.data.sessions.map(o=>({session_id:o.session_id,title:o.title,timestamp:new Date(o.created_at).getTime(),status:o.status,scene_type:o.scene_type,document_count:o.document_count,is_completed:o.is_completed}));return this.saveToCache(r),this.updateIncompleteCount(n.data.incomplete_count),this.lastSyncTime=t,r}catch(t){return console.error("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] ÂêåÊ≠•Â§±Ë¥•:",t),this.getFromCache()||[]}}async getIncompleteTasks(){return(await this.syncHistoryList()).filter(n=>n.status==="pending"||n.status==="parsing"||n.status==="analyzing")}async getCompletedTasks(){return(await this.syncHistoryList()).filter(n=>n.status==="completed"||n.status==="failed")}getIncompleteCount(){try{const t=localStorage.getItem(Ln);return t?parseInt(t,10):0}catch{return 0}}async loadSession(t){try{const n=await J.get(`/risk-analysis/result/${t}`);return await this.markAsCompleted(t),{session_id:n.data.session_id,title:n.data.title||"È£éÈô©ËØÑ‰º∞",timestamp:new Date(n.data.created_at).getTime(),status:n.data.status,summary:n.data.summary,risk_distribution:n.data.risk_distribution,scene_type:n.data.scene_type,document_count:n.data.document_count||0,is_completed:n.data.status==="completed"}}catch(n){return console.error("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] Âä†ËΩΩ‰ºöËØùÂ§±Ë¥•:",n),null}}async deleteSession(t){try{console.log("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] ÂºÄÂßãÂà†Èô§‰ºöËØù:",t);const n=await J.delete(`/risk-analysis/sessions/${t}`);return console.log("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] Âà†Èô§‰ºöËØùÂìçÂ∫î:",n.data),this.removeFromCache(t),console.log("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] ‰ºöËØùÂà†Èô§ÊàêÂäü:",t),!0}catch(n){return console.error("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] Âà†Èô§‰ºöËØùÂ§±Ë¥•:",n),console.error("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] ÈîôËØØËØ¶ÊÉÖ:",{status:n.response?.status,data:n.response?.data,message:n.message}),!1}}async saveCurrentSession(t,n,r){try{await J.patch(`/risk-analysis/sessions/${t}/status`,{status:r,title:n}),this.updateCacheItem(t,{status:r,title:n})}catch(o){console.error("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] ‰øùÂ≠ò‰ºöËØùÂ§±Ë¥•:",o)}}formatTimestamp(t){const n=new Date(t),o=new Date().getTime()-n.getTime(),i=Math.floor(o/(1e3*60*60*24));return i===0?`‰ªäÂ§© ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`:i===1?`Êò®Â§© ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`:i<7?`${["Âë®Êó•","Âë®‰∏Ä","Âë®‰∫å","Âë®‰∏â","Âë®Âõõ","Âë®‰∫î","Âë®ÂÖ≠"][n.getDay()]} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`:`${n.getMonth()+1}Êúà${n.getDate()}Êó•`}saveToCache(t){try{const n=t.map(r=>r.session_id);localStorage.setItem(Dt,JSON.stringify(n)),t.forEach(r=>{localStorage.setItem(`${at}${r.session_id}`,JSON.stringify(r))})}catch(n){console.error("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] ‰øùÂ≠òÁºìÂ≠òÂ§±Ë¥•:",n)}}getFromCache(){try{const t=localStorage.getItem(Dt);if(!t)return null;const n=JSON.parse(t),r=[];for(const o of n){const i=localStorage.getItem(`${at}${o}`);i&&r.push(JSON.parse(i))}return r}catch{return null}}updateCacheItem(t,n){try{const r=localStorage.getItem(`${at}${t}`);if(r){const i={...JSON.parse(r),...n};localStorage.setItem(`${at}${t}`,JSON.stringify(i))}}catch(r){console.error("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] Êõ¥Êñ∞ÁºìÂ≠òÂ§±Ë¥•:",r)}}removeFromCache(t){try{localStorage.removeItem(`${at}${t}`);const n=localStorage.getItem(Dt);if(n){const o=JSON.parse(n).filter(i=>i!==t);localStorage.setItem(Dt,JSON.stringify(o))}}catch(n){console.error("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] ÁßªÈô§ÁºìÂ≠òÂ§±Ë¥•:",n)}}updateIncompleteCount(t){try{localStorage.setItem(Ln,t.toString())}catch(n){console.error("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] Êõ¥Êñ∞Êú™ÂÆåÊàê‰ªªÂä°ËÆ°Êï∞Â§±Ë¥•:",n)}}async markAsCompleted(t){try{await J.patch(`/risk-analysis/sessions/${t}/status`,{is_unread:!1}),this.updateCacheItem(t,{is_completed:!0});const n=this.getIncompleteCount();n>0&&this.updateIncompleteCount(n-1)}catch(n){console.error("[ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜÂô®] Ê†áËÆ∞Â∑≤ÂÆåÊàêÂ§±Ë¥•:",n)}}}const Xe=new Wo,{Text:Go}=xt,Vo=({visible:e,onClose:t,onLoadSession:n})=>{const[r,o]=a.useState(!1),[i,l]=a.useState([]),[u,f]=a.useState([]),p=async()=>{o(!0);try{await Xe.syncHistoryList(),l(await Xe.getIncompleteTasks()),f(await Xe.getCompletedTasks())}catch{F.error("ÂêåÊ≠•ÂéÜÂè≤ËÆ∞ÂΩïÂ§±Ë¥•")}finally{o(!1)}};a.useEffect(()=>{e&&p()},[e]);const h=b=>({pending:{icon:s.jsx(_t,{}),color:"default",text:"ÂæÖÂ§ÑÁêÜ"},parsing:{icon:s.jsx(Ye,{}),color:"processing",text:"Ëß£Êûê‰∏≠"},analyzing:{icon:s.jsx(Ye,{}),color:"processing",text:"ÂàÜÊûê‰∏≠"},completed:{icon:s.jsx(Ie,{}),color:"success",text:"Â∑≤ÂÆåÊàê"},failed:{icon:s.jsx(_t,{}),color:"error",text:"Â§±Ë¥•"}})[b]||{icon:s.jsx(_t,{}),color:"default",text:"Êú™Áü•"},d=b=>{const y=h(b.status);return s.jsx(St.Item,{style:{cursor:"pointer"},onClick:()=>g(b.session_id),actions:[s.jsx(me,{type:"text",danger:!0,icon:s.jsx(Ns,{}),onClick:j=>{j.stopPropagation(),c(b.session_id)}})],children:s.jsx(St.Item.Meta,{avatar:y.icon,title:s.jsxs(k,{children:[s.jsx("span",{children:b.title}),b.is_unread&&s.jsx(N,{color:"red",children:"Êñ∞"})]}),description:s.jsxs(k,{direction:"vertical",size:0,children:[s.jsx(N,{color:y.color,children:y.text}),s.jsx(Go,{type:"secondary",style:{fontSize:12},children:Xe.formatTimestamp(b.timestamp)})]})})},b.session_id)},g=async b=>{n(b),t()},c=async b=>{await Xe.deleteSession(b)?(F.success("Âà†Èô§ÊàêÂäü"),p()):F.error("Âà†Èô§Â§±Ë¥•")};return s.jsx(Ts,{title:s.jsxs(k,{children:[s.jsx("span",{children:"ÂéÜÂè≤‰ªªÂä°"}),s.jsx(me,{type:"text",icon:s.jsx(Ls,{}),onClick:p,size:"small",children:"Âà∑Êñ∞"})]}),placement:"right",width:400,open:e,onClose:t,children:r?s.jsx("div",{style:{textAlign:"center",padding:"50px 0"},children:s.jsx(Rs,{tip:"Âä†ËΩΩ‰∏≠..."})}):s.jsxs(s.Fragment,{children:[s.jsxs(Ke,{orientation:"left",children:["Êú™ÂÆåÊàê‰ªªÂä° (",i.length,")"]}),i.length>0?s.jsx(St,{dataSource:i,renderItem:d}):s.jsx(Rt,{description:"ÊöÇÊó†Êú™ÂÆåÊàê‰ªªÂä°",image:Rt.PRESENTED_IMAGE_SIMPLE}),s.jsx(Ke,{orientation:"left",children:"Â∑≤ÂÆåÊàê‰ªªÂä°"}),u.length>0?s.jsx(St,{dataSource:u.slice(0,10),renderItem:d}):s.jsx(Rt,{description:"ÊöÇÊó†Â∑≤ÂÆåÊàê‰ªªÂä°",image:Rt.PRESENTED_IMAGE_SIMPLE})]})})},Xo=({count:e,onClick:t})=>s.jsx(Hn,{count:e,size:"small",offset:[-5,5],children:s.jsx(me,{type:"text",icon:s.jsx(Cs,{}),onClick:t,style:{color:"#1890ff",backgroundColor:"rgba(24, 144, 255, 0.1)",border:"1px solid rgba(24, 144, 255, 0.3)",borderRadius:"4px",padding:"4px 12px",fontWeight:500},children:"ÂéÜÂè≤‰ªªÂä°"})}),{Content:Yo}=Gn,{TextArea:Ko}=Vn,{Title:Jo,Text:K,Paragraph:Ti}=xt,qo=({id:e,pkg:t,index:n})=>{const{attributes:r,listeners:o,setNodeRef:i,transform:l,transition:u,isDragging:f}=Mo({id:e}),p={transform:pt.Transform.toString(l),transition:u,opacity:f?.5:1,cursor:"grab"},h=Zo(t.package_category);return s.jsx("div",{ref:i,style:p,...r,children:s.jsx(P,{size:"small",style:{marginBottom:8,borderLeft:`3px solid ${ei(h.color)}`,backgroundColor:f?"#e6f7ff":"#f9f9f9",cursor:"grab"},children:s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs(k,{children:[s.jsxs(N,{color:"blue",style:{margin:0,fontSize:11},children:["#",n+1]}),s.jsxs(K,{style:{fontSize:13},children:[h.icon," ",t.package_name]})]}),s.jsx("span",{...o,style:{cursor:"grab",padding:"4px"},children:s.jsx(Gs,{style:{fontSize:14}})})]})})})},Qo={equity_risk:{label:"ËÇ°ÊùÉÈ£éÈô©",color:"blue",icon:"üè¢"},investment_risk:{label:"ÊäïËµÑÈ£éÈô©",color:"gold",icon:"üíº"},governance_risk:{label:"Ê≤ªÁêÜÈ£éÈô©",color:"purple",icon:"‚öñÔ∏è"},contract_risk:{label:"ÂêàÂêåÈ£éÈô©",color:"orange",icon:"üìÑ"},tax_risk:{label:"Á®éÂä°È£éÈô©",color:"green",icon:"üßæ"},litigation_risk:{label:"ËØâËÆºÈ£éÈô©",color:"red",icon:"‚öñÔ∏è"}};function Zo(e){return Qo[e]||{label:e,color:"default",icon:"üì¶"}}function ei(e){return{blue:"#1890ff",gold:"#faad14",purple:"#722ed1",orange:"#fa8c16",green:"#52c41a",red:"#ff4d4f",default:"#d9d9d9"}[e]||e}const Ai=()=>{const e=ks(),t=Is(),[n]=Ds(),r=a.useRef(null),[o,i]=a.useState(0),[l,u]=a.useState([]),[f,p]=a.useState([]),[h,d]=a.useState(""),[g,c]=a.useState([]),[b,y]=a.useState([]),[j,C]=a.useState([]),[v,w]=a.useState({status:"idle",sessionId:"",progress:0,message:"",nodeProgress:{documentPreorganization:"pending",multiModelAnalysis:"pending",reportGeneration:"pending"}}),[I,E]=a.useState(null),[M,D]=a.useState(null),[_,L]=a.useState(!1),[$,O]=a.useState(null),[q,re]=a.useState(""),[ce,Me]=a.useState(!1),[Je,Y]=a.useState(0),[He,Q]=a.useState(!1),[Te,Ue]=a.useState(!1),W=lr(jn(un),jn(cn,{coordinateGetter:zo})),de=l.map(x=>f.find(m=>m.package_id===x)).filter(Boolean),ve=async(x=0,m)=>{const R=m||v.sessionId;try{const T=(await J.get(`/risk-analysis/result/${R}`)).data,G=T.risk_distribution||{high:0,medium:0,low:0,critical:0},fe={high:(G.high||0)+(G.critical||0),medium:G.medium||0,low:G.low||0},Oe=(T.risk_items||[]).map(V=>{let ee=V.risk_level?.toLowerCase();return ee==="critical"&&(ee="high"),["high","medium","low"].includes(ee)||(ee="low"),{risk_id:V.id.toString(),risk_title:V.title,risk_level:ee,description:V.description,confidence:V.confidence,details:V.reasons?V.reasons.join(`
`):"",suggestions:Array.isArray(V.suggestions)?V.suggestions.join(`
`):V.suggestions}}),Ve={executive_summary:T.summary||"",risk_items:Oe,risk_distribution:fe,strategies:[],recommendations:[],analysis_metadata:{analysis_duration:T.completed_at&&T.created_at?new Date(T.completed_at).getTime()-new Date(T.created_at).getTime():void 0}};w(V=>({...V,status:"completed",report:Ve,comparison:T.comparison,diagrams:T.diagrams,nodeProgress:{...V.nodeProgress,multiModelAnalysis:"completed",reportGeneration:"completed"}})),i(4),F.success("È£éÈô©ËØÑ‰º∞ÂÆåÊàêÔºÅ")}catch(S){S.response?.status===400&&x<3?setTimeout(()=>ve(x+1,R),1e3*(x+1)):F.error(`Ëé∑ÂèñÁªìÊûúÂ§±Ë¥•: ${S.message}`)}},We=x=>{switch((x.type==="node_progress"||x.type==="progress")&&Math.round(x.progress*100)===100&&console.log("Progress 100%, waiting for complete signal"),x.type){case"node_progress":w(m=>({...m,progress:Math.round(x.progress*100),message:x.message,nodeProgress:{...m.nodeProgress,[x.node]:x.status}}));break;case"preorganization_completed":console.log("[WS] È¢ÑÊï¥ÁêÜÂÆåÊàê"),E({basic:x.preorganized_data||{},enhanced:x.enhanced_data||{}}),D(x.enhanced_analysis||null),i(2),w(m=>({...m,progress:100,message:"ÊñáÊ°£È¢ÑÊï¥ÁêÜÂÆåÊàê",nodeProgress:{...m.nodeProgress,documentPreorganization:"completed"}}));break;case"complete":ve();break;case"error":w(m=>({...m,status:"failed",message:x.message})),F.error(x.message);break;case"comparison":w(m=>({...m,comparison:x.comparison}));break;case"diagram":w(m=>({...m,diagrams:[...m.diagrams||[],x.diagram]}));break}},Z=async x=>{w(m=>({...m,sessionId:x})),await ve(0,x)};a.useEffect(()=>{(async()=>{const m=n.get("session_id");if(!(!m||He||Te)&&!(v.sessionId===m&&["analyzing","processing","uploading"].includes(v.status)))try{L(!0);const S=(await J.get(`/risk-analysis/${m}/restore-state`)).data;switch(S.current_stage){case"input":w(G=>({...G,sessionId:m,status:"idle"})),i(0);break;case"preorganization_in_progress":w({status:"analyzing",sessionId:m,progress:30,message:"Ê≠£Âú®ÁªßÁª≠ÊñáÊ°£È¢ÑÊï¥ÁêÜ...",nodeProgress:{documentPreorganization:"processing",multiModelAnalysis:"pending",reportGeneration:"pending"}}),i(1);break;case"preorganization_completed":const T=S.data.preorganization;E({basic:T,enhanced:T.enhanced_analysis||{}}),D(T.enhanced_analysis||null),w(G=>({...G,sessionId:m,status:"idle",progress:100,message:"ÊñáÊ°£È¢ÑÊï¥ÁêÜÂÆåÊàê",nodeProgress:{documentPreorganization:"completed",multiModelAnalysis:"pending",reportGeneration:"pending"}})),i(2),T.analysis_mode&&O(T.analysis_mode);break;case"analysis_in_progress":w({status:"analyzing",sessionId:m,progress:60,message:"Ê≠£Âú®ÁªßÁª≠ÂàÜÊûê...",nodeProgress:{documentPreorganization:"completed",multiModelAnalysis:"processing",reportGeneration:"pending"}}),i(3);break;case"analysis_completed":w({status:"completed",sessionId:m,progress:100,message:"ÂàÜÊûêÂ∑≤ÂÆåÊàê",nodeProgress:{documentPreorganization:"completed",multiModelAnalysis:"completed",reportGeneration:"completed"}}),i(4),await Z(m);break}Ue(!0),F.success("Â∑≤ÊÅ¢Â§ç‰πãÂâçÁöÑÂàÜÊûêÁä∂ÊÄÅ")}catch(R){if(R.response?.status===404){const S=new URLSearchParams(n);S.delete("session_id"),window.history.replaceState({},"",`${window.location.pathname}?${S.toString()}`)}}finally{L(!1)}})()},[n,He,v.sessionId,Te]),a.useEffect(()=>{const x=async()=>{try{await Xe.syncHistoryList(),Y(Xe.getIncompleteCount())}catch(R){console.error("ÂêåÊ≠•Â§±Ë¥•",R)}};x();const m=setInterval(x,3e4);return()=>clearInterval(m)},[]),a.useEffect(()=>{const x=t.state;x?.description&&(d(x.description),F.success("Â∑≤Ê†πÊçÆÊÇ®ÁöÑÊèèËø∞Ëá™Âä®Â°´ÂÖÖÂÜÖÂÆπ"))},[t.state]),a.useEffect(()=>{if(!v.sessionId||v.status==="idle")return;const x=async()=>{try{await J.post(`/risk-analysis/${v.sessionId}/heartbeat`,{ws_connected:!0})}catch(R){console.error("ÂøÉË∑≥Â§±Ë¥•",R)}};x();const m=setInterval(x,3e4);return()=>clearInterval(m)},[v.sessionId,v.status]),a.useEffect(()=>{const x=async()=>{v.sessionId&&["analyzing","uploading"].includes(v.status)&&await J.post(`/risk-analysis-v2/${v.sessionId}/heartbeat`,{ws_connected:!1})};return window.addEventListener("beforeunload",x),()=>window.removeEventListener("beforeunload",x)},[v.sessionId,v.status]),a.useEffect(()=>{if(_||!v.sessionId)return;const x=`${_s()}/api/v1/risk-analysis/ws/${v.sessionId}`;if(r.current&&r.current.url===x&&r.current.readyState===WebSocket.OPEN)return;r.current&&r.current.close();const m=new WebSocket(x);r.current=m;let R;return m.onopen=()=>{console.log("WS Connected"),R=setInterval(()=>{m.readyState===WebSocket.OPEN&&m.send("ping")},1e4)},m.onmessage=S=>{try{const T=JSON.parse(S.data);We(T)}catch(T){console.error("WS Parse Error",T)}},m.onclose=()=>{R&&clearInterval(R)},()=>{R&&clearInterval(R),m.close()}},[v.sessionId,_]);const qe=async x=>{try{Ue(!1),Q(!1),window.location.href=`/risk-analysis?session_id=${x}`}catch(m){console.error("Âä†ËΩΩÂéÜÂè≤‰ªªÂä°Â§±Ë¥•:",m),F.error("Âä†ËΩΩÂéÜÂè≤‰ªªÂä°Â§±Ë¥•")}},Se=async()=>{if(Q(!0),!h.trim()&&g.length===0){F.warning("ËØ∑ËæìÂÖ•ÊèèËø∞Êàñ‰∏ä‰º†Êñá‰ª∂"),Q(!1);return}w(x=>({...x,status:"uploading"}));try{const m=(await J.post("/risk-analysis/create-session",{upload_ids:b.length>0?b:void 0,package_id:void 0,user_input:h})).data.session_id;w(R=>({...R,status:"analyzing",sessionId:m,progress:0,message:"Ê≠£Âú®ËøõË°åÊñáÊ°£È¢ÑÊï¥ÁêÜ...",nodeProgress:{documentPreorganization:"processing",multiModelAnalysis:"pending",reportGeneration:"pending"}})),i(1),await new Promise(R=>setTimeout(R,500)),await J.post(`/risk-analysis/start/${m}`,{stop_after_preorganization:!0}),F.success("ÂºÄÂßãÊñáÊ°£È¢ÑÊï¥ÁêÜ...")}catch{F.error("ÂêØÂä®Â§±Ë¥•"),w(m=>({...m,status:"idle"}))}finally{setTimeout(()=>Q(!1),1e3)}},ye=async x=>{try{O(x),i(3),w(m=>({...m,status:"analyzing",analysisMode:x,message:x==="multi"?"Â§öÊ®°ÂûãÂàÜÊûê‰∏≠...":"ÂçïÊ®°ÂûãÂàÜÊûê‰∏≠...",nodeProgress:{...m.nodeProgress,multiModelAnalysis:"processing"}})),await J.post(`/risk-analysis/continue/${v.sessionId}`,{analysis_mode:x,selected_model:x==="single"?"Qwen3-235B-A22B-Thinking-2507":void 0,package_id:l[0],evaluation_stance:q||void 0}),F.success("Â∑≤ÂêØÂä®ÂàÜÊûê")}catch{i(2),F.error("ÂêØÂä®ÂàÜÊûêÂ§±Ë¥•")}},z=async x=>{const m=`${Date.now()}-${Math.random()}`;C(R=>[...R,{uid:m,name:x.name,status:"uploading"}]);try{const R=new FormData;R.append("files",x);const S=await J.post("/risk-analysis/upload",R);return C(T=>T.map(G=>G.uid===m?{...G,status:"done",response:S.data}:G)),S.data.upload_id&&y(T=>[...T,S.data.upload_id]),S.data.file_paths&&c(T=>[...T,...S.data.file_paths]),!1}catch{return C(S=>S.map(T=>T.uid===m?{...T,status:"error"}:T)),!1}},Ge=x=>{C(m=>m.filter(R=>R.uid!==x.uid)),x.response?.upload_id&&y(m=>m.filter(R=>R!==x.response.upload_id)),x.response?.file_paths&&c(m=>m.filter(R=>!x.response.file_paths.includes(R)))},ue=x=>{const{active:m,over:R}=x;R&&m.id!==R.id&&u(S=>{const T=S.findIndex(fe=>fe===m.id),G=S.findIndex(fe=>fe===R.id);return fn(S,T,G)})},Ae=async()=>{try{const x=await J.get(`/risk-analysis/preorganization-report/${v.sessionId}`,{responseType:"blob"}),m=new Blob([x.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),R=window.URL.createObjectURL(m),S=document.createElement("a");S.href=R,S.download="È¢ÑÊï¥ÁêÜÊä•Âëä.docx",document.body.appendChild(S),S.click(),document.body.removeChild(S)}catch{F.error("‰∏ãËΩΩÂ§±Ë¥•")}},be=async()=>{try{const x=await J.get(`/risk-analysis/report/${v.sessionId}`,{responseType:"blob"}),m=new Blob([x.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),R=window.URL.createObjectURL(m),S=document.createElement("a");S.href=R,S.download="È£éÈô©ÂàÜÊûêÊä•Âëä.docx",document.body.appendChild(S),S.click(),document.body.removeChild(S)}catch{F.error("‰∏ãËΩΩÂ§±Ë¥•")}},ze=()=>{const x=v.nodeProgress,m=S=>{switch(S){case"pending":return s.jsx(qt,{style:{color:"#d9d9d9"}});case"processing":return s.jsx(Ye,{style:{color:"#1890ff"}});case"completed":return s.jsx(Ie,{style:{color:"#52c41a"}});case"failed":return s.jsx(qt,{style:{color:"#ff4d4f"}})}},R=[{key:"documentPreorganization",label:"ÊñáÊ°£È¢ÑÊï¥ÁêÜ",description:"ÂàÜÁ±ª„ÄÅË¥®ÈáèËØÑ‰º∞„ÄÅÊëòË¶ÅÁîüÊàê"},{key:"multiModelAnalysis",label:"Â§öÊ®°ÂûãÂàÜÊûê",description:"Âπ∂Ë°åÂàÜÊûê + ÁªºÂêàÊï¥Âêà"},{key:"reportGeneration",label:"ËæìÂá∫È£éÈô©Êä•Âëä",description:"ÁîüÊàêÊúÄÁªàËØÑ‰º∞Êä•Âëä"}];return s.jsx(P,{title:"ÂàÜÊûêËøõÂ∫¶",style:{marginTop:16},children:s.jsxs(k,{direction:"vertical",style:{width:"100%"},size:"middle",children:[R.map(S=>s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[m(x[S.key]),s.jsx(K,{strong:!0,style:{marginLeft:8},children:S.label})]}),s.jsx(K,{type:"secondary",style:{marginLeft:32,fontSize:12},children:S.description})]},S.key)),s.jsx(Ke,{}),s.jsx(Ee,{percent:Math.round(v.progress),status:v.status==="failed"?"exception":"active"}),s.jsx(K,{type:"secondary",children:v.message})]})})},Pe=()=>s.jsx("div",{style:{maxWidth:900,margin:"0 auto"},children:s.jsxs(k,{direction:"vertical",style:{width:"100%"},size:"large",children:[s.jsx($s,{moduleName:"risk_analysis",moduleLabel:"È£éÈô©ËØÑ‰º∞"}),s.jsx(P,{title:"ËØÑ‰º∞Ë¶ÅÊ±Ç/ËÉåÊôØÊÉÖÂÜµËØ¥Êòé",children:s.jsxs(k,{direction:"vertical",style:{width:"100%"},size:"middle",children:[s.jsx(Ko,{rows:6,placeholder:"ËØ∑ÊèèËø∞ËØÑ‰º∞ÁöÑÂÖ∑‰ΩìË¶ÅÊ±Ç„ÄÅÁõ∏ÂÖ≥ËÉåÊôØÊÉÖÂÜµËØ¥ÊòéÊàñÈúÄË¶ÅÁâπÂà´ÂÖ≥Ê≥®ÁöÑÈ£éÈô©ÁÇπ...",value:h,onChange:x=>d(x.target.value)}),s.jsxs("div",{children:[s.jsx(Fs,{multiple:!0,fileList:j,beforeUpload:z,onRemove:Ge,disabled:v.status==="uploading",children:s.jsx(me,{icon:s.jsx(Hs,{}),disabled:v.status==="uploading",children:"ÁÇπÂáª‰∏ä‰º†Êñá‰ª∂ÔºàÊîØÊåÅÊãñÊãΩÔºâ"})}),j.length>0&&s.jsx(xe,{message:s.jsxs(k,{children:[s.jsx(Ie,{style:{color:"#52c41a"}}),s.jsxs("span",{children:["Â∑≤‰∏ä‰º† ",j.filter(x=>x.status==="done").length," / ",j.length," ‰∏™Êñá‰ª∂"]})]}),type:"success",style:{marginTop:12}})]})]})}),s.jsx(P,{style:{textAlign:"center",background:"#fafafa"},children:s.jsxs(k,{direction:"vertical",style:{width:"100%"},size:"middle",children:[s.jsx(me,{type:"primary",size:"large",icon:s.jsx(yn,{}),onClick:Se,loading:v.status==="uploading",disabled:!h.trim()&&g.length===0,style:{width:"100%",height:50,fontSize:16},children:"ÂºÄÂßãËµÑÊñôÈ¢ÑÊï¥ÁêÜ"}),s.jsx(xe,{message:"È¢ÑÊï¥ÁêÜËØ¥Êòé",description:"Á≥ªÁªüÂ∞ÜÂØπÊÇ®‰∏ä‰º†ÁöÑÊñáÊ°£ËøõË°åÊô∫ËÉΩÈ¢ÑÊï¥ÁêÜÔºåÂåÖÊã¨ÂàÜÁ±ª„ÄÅÊëòË¶ÅÁîüÊàê„ÄÅÂÖ≥ÈîÆ‰ø°ÊÅØÊèêÂèñÁ≠â„ÄÇ",type:"info",showIcon:!0,style:{fontSize:12}})]})})]})}),wt=()=>s.jsx("div",{style:{maxWidth:800,margin:"0 auto"},children:s.jsx(P,{title:"ÊñáÊ°£È¢ÑÊï¥ÁêÜ‰∏≠",children:s.jsxs(k,{direction:"vertical",size:"large",style:{width:"100%"},children:[s.jsx("div",{children:s.jsxs(k,{children:[v.status==="analyzing"&&s.jsx(Ye,{spin:!0}),s.jsx(K,{strong:!0,style:{fontSize:16},children:v.message||"Ê≠£Âú®È¢ÑÊï¥ÁêÜÊñáÊ°£..."})]})}),s.jsx(Ee,{percent:v.progress,status:v.status==="analyzing"?"active":"success",strokeColor:{"0%":"#108ee9","100%":"#87d068"}}),s.jsx(xe,{message:"È¢ÑÊï¥ÁêÜÂÜÖÂÆπ",description:s.jsxs("ul",{style:{margin:0,paddingLeft:20},children:[s.jsx("li",{children:"ÂàÜÁ±ª‰∏éË¥®ÈáèËØÑ‰º∞"}),s.jsx("li",{children:"ÂÖ≥ÈîÆ‰ø°ÊÅØÊèêÂèñ"}),s.jsx("li",{children:"Ë∑®ÊñáÊ°£Êï¥Âêà"})]}),type:"info",showIcon:!0})]})})}),jt=()=>s.jsxs("div",{style:{maxWidth:1200,margin:"0 auto"},children:[s.jsxs(k,{direction:"vertical",style:{width:"100%",marginBottom:16},children:[s.jsx(xe,{message:"ÊñáÊ°£È¢ÑÊï¥ÁêÜÂÆåÊàê",description:"ËØ∑Á°ÆËÆ§‰ª•‰∏ã‰ø°ÊÅØÊòØÂê¶ÂáÜÁ°ÆÔºåÂèØ‰ª•ÈÄâÊã©‰øÆÊîπÂêéÈÄâÊã©ÂàÜÊûêÊ®°ÂºèÁªßÁª≠",type:"info",showIcon:!0}),s.jsx("div",{style:{textAlign:"right"},children:s.jsx(me,{type:"primary",icon:s.jsx(Jt,{}),onClick:Ae,children:"‰∏ãËΩΩÈ¢ÑÊï¥ÁêÜÊä•Âëä"})})]}),M&&s.jsx(P,{title:s.jsxs(k,{children:[s.jsx(Kt,{}),s.jsx("span",{children:"Â¢ûÂº∫ÂàÜÊûêÁªìÊûú"}),s.jsx(N,{color:"purple",children:"‰∫§ÊòìÂÖ®ÊôØÂõæ"})]}),style:{marginBottom:16},children:s.jsx(As,{enhancedAnalysis:M})}),I?.basic&&s.jsx(P,{title:"ÊñáÊ°£‰ø°ÊÅØÊï¥ÁêÜ",style:{marginBottom:16},children:I.basic.document_summaries&&Object.keys(I.basic.document_summaries).length>0?s.jsx("div",{children:Object.entries(I.basic.document_summaries).map(([x,m],R)=>s.jsxs(P,{type:"inner",size:"small",style:{marginBottom:16},title:s.jsxs(k,{children:[s.jsxs(K,{strong:!0,style:{fontSize:14},children:["ÊñáÊ°£ ",R+1,"Ôºö",m.document_title||m.file_name||x.split("/").pop()]}),m.document_subtype&&s.jsx(N,{color:"purple",children:m.document_subtype})]}),children:[s.jsxs(Ht,{column:1,size:"small",children:[m.document_purpose&&s.jsx(Ht.Item,{label:"ÊñáÊ°£ÁõÆÁöÑ",children:m.document_purpose}),s.jsx(Ht.Item,{label:"Ê†∏ÂøÉÂÜÖÂÆπ",children:m.summary})]}),s.jsxs("div",{style:{marginTop:12},children:[m.key_parties&&m.key_parties.length>0&&s.jsxs("div",{style:{marginBottom:4},children:[s.jsx(K,{type:"secondary",children:"‰∏ª‰ΩìÔºö"}),s.jsx(K,{children:m.key_parties.join("„ÄÅ")})]}),m.key_dates&&m.key_dates.length>0&&s.jsxs("div",{style:{marginBottom:4},children:[s.jsx(K,{type:"secondary",children:"Êó•ÊúüÔºö"}),s.jsx(K,{children:m.key_dates.join("Ôºõ ")})]}),m.key_amounts&&m.key_amounts.length>0&&s.jsxs("div",{style:{marginBottom:4},children:[s.jsx(K,{type:"secondary",children:"ÈáëÈ¢ùÔºö"}),s.jsx(K,{children:m.key_amounts.join("Ôºõ ")})]})]}),m.risk_signals&&m.risk_signals.length>0&&s.jsxs("div",{style:{marginTop:8},children:[s.jsx(K,{type:"secondary",strong:!0,children:"È£éÈô©‰ø°Âè∑Ôºö"}),s.jsx("div",{style:{marginTop:4},children:m.risk_signals.map((S,T)=>s.jsx(N,{color:"orange",style:{marginBottom:4},children:S},T))})]})]},x))}):s.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#999"},children:"ÊöÇÊó†ËØ¶ÁªÜÊñáÊ°£ÊëòË¶Å"})}),s.jsxs(P,{title:"ÈÄâÊã©ËßÑÂàôÂåÖÔºàÂèØÈÄâÔºâ",style:{marginBottom:16},children:[s.jsx($o,{value:l,onChange:u,onPackagesLoad:p}),de.length>0&&s.jsxs("div",{style:{marginTop:20},children:[s.jsx("div",{style:{marginBottom:12},children:s.jsx(K,{strong:!0,children:"Â∑≤ÈÄâËßÑÂàôÂåÖÊéíÂ∫è"})}),s.jsx(uo,{sensors:W,collisionDetection:dr,onDragEnd:ue,children:s.jsx(Ro,{items:l,strategy:jo,children:de.map((x,m)=>s.jsx(qo,{id:x.package_id,pkg:x,index:m},x.package_id))})})]})]}),s.jsx(P,{title:"ÈÄâÊã©ÂàÜÊûêÊ®°Âºè",children:s.jsxs(k,{direction:"vertical",size:"middle",style:{width:"100%"},children:[s.jsxs(Ut.Group,{value:$,onChange:x=>O(x.target.value),defaultValue:"multi",children:[s.jsx(Ut,{value:"multi",children:"Â§öÊ®°ÂûãÂπ∂Ë°åÂàÜÊûê (Êé®Ëçê)"}),s.jsx(Ut,{value:"single",children:"ÂçïÊ®°ÂûãÂø´ÈÄüÂàÜÊûê"})]}),s.jsx(xe,{message:$==="multi"?"DeepSeek + GPT + Qwen Â§öËßÜËßíËÅîÂêàËØÑ‰º∞":"Âø´ÈÄüÂìçÂ∫îÔºåÈÄÇÂêàÁÆÄÂçïÂêàËßÑÊ£ÄÊü•",type:"info",showIcon:!0,style:{marginTop:8}}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:500},children:"È£éÈô©ËØÑ‰º∞Á´ãÂú∫ÔºàÂèØÈÄâÔºâ"}),s.jsx(Vn.TextArea,{placeholder:"ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÁ´ãÂú∫...",value:q,onChange:x=>re(x.target.value),rows:2})]}),s.jsx("div",{style:{textAlign:"right",marginTop:16},children:s.jsx(me,{type:"primary",size:"large",icon:s.jsx(yn,{}),onClick:()=>ye($||"multi"),disabled:!$,children:"ÂêØÂä®ÂàÜÊûê"})})]})})]}),st=()=>{const x=(v.analysisMode||$)==="multi";return s.jsx("div",{style:{maxWidth:800,margin:"0 auto"},children:s.jsx(P,{title:x?"Â§öÊ®°ÂûãÂπ∂Ë°åÂàÜÊûê‰∏≠":"ÂçïÊ®°ÂûãÂàÜÊûê‰∏≠",children:s.jsxs(k,{direction:"vertical",size:"large",style:{width:"100%"},children:[s.jsx("div",{children:s.jsxs(k,{children:[v.status==="analyzing"&&s.jsx(Ye,{spin:!0}),s.jsx(K,{strong:!0,style:{fontSize:16},children:v.message})]})}),s.jsx(Ee,{percent:v.progress,status:"active",strokeColor:{"0%":"#108ee9","100%":"#87d068"}}),ze(),v.comparison&&x&&s.jsx(P,{title:"Â§öÊ®°ÂûãÂÆûÊó∂ÂØπÊØî",style:{marginTop:16},children:s.jsx(Pn,{data:v.comparison})})]})})})},Re=()=>s.jsxs("div",{children:[s.jsx(P,{title:"È£éÈô©ËØÑ‰º∞Êä•Âëä",extra:s.jsxs(k,{children:[s.jsx(me,{type:"primary",icon:s.jsx(Jt,{}),onClick:be,children:"‰∏ãËΩΩÊä•Âëä"}),s.jsx(me,{onClick:()=>e("/"),children:"ËøîÂõûÈ¶ñÈ°µ"})]}),children:v.report&&s.jsx(Ho,{report:v.report})}),v.diagrams&&v.diagrams.length>0&&s.jsx(P,{title:"Áõ∏ÂÖ≥ÂõæË°®",style:{marginTop:16},children:s.jsx(zs,{diagrams:v.diagrams})}),v.comparison&&s.jsx(P,{title:"Â§öÊ®°ÂûãÂàÜÊûêÂØπÊØî",style:{marginTop:16},children:s.jsx(Pn,{data:v.comparison})})]});return s.jsxs(Gn,{style:{minHeight:"100vh",background:"#f0f2f5"},children:[s.jsx(Ps,{currentModuleKey:"risk-analysis",title:"È£éÈô©ËØÑ‰º∞",icon:s.jsx(Os,{}),extra:s.jsx(Xo,{count:Je,onClick:()=>Me(!0)})}),s.jsx(Yo,{style:{padding:"24px"},children:s.jsxs("div",{style:{maxWidth:1400,margin:"0 auto"},children:[s.jsx(P,{style:{marginBottom:16},children:s.jsx(Bs,{current:o,items:[{title:"ËæìÂÖ•‰ø°ÊÅØ"},{title:"ÊñáÊ°£È¢ÑÊï¥ÁêÜ"},{title:"Á°ÆËÆ§‰ø°ÊÅØ"},{title:"AI ÂàÜÊûê"},{title:"Êü•ÁúãÁªìÊûú"}]})}),s.jsx("div",{style:{background:"#fff",padding:24,borderRadius:8,minHeight:600},children:_?s.jsxs("div",{style:{textAlign:"center",padding:"100px 0"},children:[s.jsx(Ye,{style:{fontSize:48,color:"#1890ff",marginBottom:16}}),s.jsx(Jo,{level:3,children:"Ê≠£Âú®ÊÅ¢Â§ç‰ºöËØù..."})]}):s.jsxs(s.Fragment,{children:[o===0&&Pe(),o===1&&wt(),o===2&&jt(),o===3&&st(),o===4&&Re()]})})]})}),s.jsx(Vo,{visible:ce,onClose:()=>Me(!1),onLoadSession:qe})]})};export{Ai as default};
