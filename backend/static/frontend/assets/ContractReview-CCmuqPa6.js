import{r as o,z as ke,_ as Re,o as m,j as e,d as R,c as et,C as te,i as p,u as Mt,aB as Pt,ba as Ot,F as N,B as w,D as Ge,t as qe,aA as Ft,h as ye,I as W,A as Ke,S as je,e as Lt,b as Dt,az as Wt,n as Xe,bb as ve,bc as Je,l as Ht,bd as O,be as Nt,G as Ut,aw as Qe}from"./index-7T25hRnl.js";import{o as Vt}from"./index-C56rNddX.js";import{E as Gt}from"./EnhancedModuleNavBar-CEW55FzO.js";import{M as qt}from"./ModuleKnowledgeToggle-BFbpYerz.js";import{A as $,R as we}from"./DownloadOutlined-3LjHRHuZ.js";import{S as Ye}from"./index-C60phfr4.js";import{P as Kt}from"./progress-BFvY0J03.js";import{R as be}from"./WarningOutlined-CEayjfuK.js";import{R as Xt}from"./ExclamationCircleOutlined-DT83bNdu.js";import{R as Jt}from"./CheckCircleOutlined-DhhXUuLD.js";/* empty css                       */import{C as ee}from"./FileOutlined-B8Qj5hup.js";import{R as Ze}from"./DeleteOutlined-Bc5d-nRr.js";import{M as _e}from"./index-CNC-4PM3.js";import{F as Qt}from"./Table-D0ZRbJRv.js";import{R as Yt}from"./CloseCircleOutlined-CMvayiUb.js";import{P as Zt}from"./index-BhHARTUp.js";import{C as tt}from"./Collapse-Blo7bVTY.js";import"./ArrowLeftOutlined-C0dkYYT0.js";import"./DiffOutlined-BWhhxZJu.js";import"./DatabaseOutlined-C7q3oXD2.js";import"./index-DnL1ugtd.js";import"./InfoCircleOutlined-DoY051zu.js";import"./useBubbleLock-rdPKXBE_.js";import"./index-CeAS_E37.js";import"./FolderOpenOutlined-BZWbWWbj.js";var es={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM472 744a40 40 0 1080 0 40 40 0 10-80 0zm16-104h48c4.4 0 8-3.6 8-8V448c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v184c0 4.4 3.6 8 8 8z"}}]},name:"file-exclamation",theme:"outlined"},ts=function(i,r){return o.createElement(ke,Re({},i,{ref:r,icon:es}))},ss=o.forwardRef(ts),ns={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 305H624V192c0-17.7-14.3-32-32-32H184v-40c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v784c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V640h248v113c0 17.7 14.3 32 32 32h416c17.7 0 32-14.3 32-32V337c0-17.7-14.3-32-32-32zM184 568V232h368v336H184zm656 145H504v-73h112c4.4 0 8-3.6 8-8V377h216v336z"}}]},name:"flag",theme:"outlined"},rs=function(i,r){return o.createElement(ke,Re({},i,{ref:r,icon:ns}))},os=o.forwardRef(rs),is={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M923 283.6a260.04 260.04 0 00-56.9-82.8 264.4 264.4 0 00-84-55.5A265.34 265.34 0 00679.7 125c-49.3 0-97.4 13.5-139.2 39-10 6.1-19.5 12.8-28.5 20.1-9-7.3-18.5-14-28.5-20.1-41.8-25.5-89.9-39-139.2-39-35.5 0-69.9 6.8-102.4 20.3-31.4 13-59.7 31.7-84 55.5a258.44 258.44 0 00-56.9 82.8c-13.9 32.3-21 66.6-21 101.9 0 33.3 6.8 68 20.3 103.3 11.3 29.5 27.5 60.1 48.2 91 32.8 48.9 77.9 99.9 133.9 151.6 92.8 85.7 184.7 144.9 188.6 147.3l23.7 15.2c10.5 6.7 24 6.7 34.5 0l23.7-15.2c3.9-2.5 95.7-61.6 188.6-147.3 56-51.7 101.1-102.7 133.9-151.6 20.7-30.9 37-61.5 48.2-91 13.5-35.3 20.3-70 20.3-103.3.1-35.3-7-69.6-20.9-101.9zM512 814.8S156 586.7 156 385.5C156 283.6 240.3 201 344.3 201c73.1 0 136.5 40.8 167.7 100.4C543.2 241.8 606.6 201 679.7 201c104 0 188.3 82.6 188.3 184.5 0 201.2-356 429.3-356 429.3z"}}]},name:"heart",theme:"outlined"},ls=function(i,r){return o.createElement(ke,Re({},i,{ref:r,icon:is}))},as=o.forwardRef(ls);const cs=({contractId:S})=>{const[i,r]=o.useState(null),[M,C]=o.useState(!1),[b,q]=o.useState(null);o.useEffect(()=>{se()},[S]);const se=async()=>{C(!0),q(null);try{const l=await m.getHealthAssessment(S);r(l.data)}catch(l){console.error("è·å–å¥åº·åº¦è¯„ä¼°å¤±è´¥",l),q(l.response?.data?.detail||"è·å–å¥åº·åº¦è¯„ä¼°å¤±è´¥")}finally{C(!1)}},T=l=>{switch(l){case"å¥åº·":return"#52c41a";case"è‰¯å¥½":return"#1890ff";case"ä¸­ç­‰é£é™©":return"#faad14";case"é«˜é£é™©":return"#ff4d4f";case"æé«˜é£é™©":return"#cf1322";default:return"#8c8c8c"}},H=l=>{switch(l){case"å¥åº·":case"è‰¯å¥½":return e.jsx(Jt,{});case"ä¸­ç­‰é£é™©":return e.jsx(Xt,{});case"é«˜é£é™©":case"æé«˜é£é™©":return e.jsx(be,{});default:return null}},z=l=>{switch(l){case"å¥åº·":case"è‰¯å¥½":return"success";case"ä¸­ç­‰é£é™©":return"warning";case"é«˜é£é™©":case"æé«˜é£é™©":return"error";default:return"info"}};return M?e.jsx(R,{loading:!0}):b?e.jsx(R,{className:"health-assessment-card",style:{marginBottom:20},children:e.jsx($,{message:"å¥åº·åº¦è¯„ä¼°åŠ è½½å¤±è´¥",description:b,type:"error",showIcon:!0})}):i?e.jsxs(R,{className:"health-assessment-card",style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[e.jsx(as,{style:{fontSize:24,color:T(i.level)}}),e.jsx("h2",{style:{margin:0,fontSize:18},children:"åˆåŒå¥åº·åº¦ç»¼åˆè¯„ä¼°"})]}),e.jsxs(et,{gutter:24,children:[e.jsx(te,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(Ye,{title:"å¥åº·åº¦è¯„åˆ†",value:i.score,suffix:"/ 100",valueStyle:{color:T(i.level),fontSize:28}}),e.jsx(Kt,{percent:i.score,strokeColor:T(i.level),showInfo:!1,style:{marginTop:12},strokeWidth:12})]})}),e.jsx(te,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(Ye,{title:"é£é™©ç­‰çº§",value:i.level,prefix:H(i.level),valueStyle:{color:T(i.level),fontSize:18}}),e.jsxs("div",{style:{marginTop:12,color:"#8c8c8c",fontSize:13},children:["å…±å‘ç° ",i.total_risks," ä¸ªé£é™©ç‚¹"]})]})}),e.jsx(te,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:14,color:"#8c8c8c",marginBottom:12},children:"é£é™©åˆ†å¸ƒ"}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",flexWrap:"wrap",gap:6},children:[i.risk_distribution.Critical>0&&e.jsxs(p,{color:"red",children:["æä¸¥é‡: ",i.risk_distribution.Critical]}),i.risk_distribution.High>0&&e.jsxs(p,{color:"orange",children:["é«˜é£é™©: ",i.risk_distribution.High]}),i.risk_distribution.Medium>0&&e.jsxs(p,{color:"gold",children:["ä¸­ç­‰: ",i.risk_distribution.Medium]}),i.risk_distribution.Low>0&&e.jsxs(p,{color:"blue",children:["è½»å¾®: ",i.risk_distribution.Low]}),i.total_risks===0&&e.jsx(p,{color:"green",children:"æ— é£é™©ç‚¹"})]})]})})]}),e.jsx($,{message:"ç»¼åˆè¯„ä¼°",description:i.summary,type:z(i.level),showIcon:!0,style:{marginTop:20}}),i.recommendations&&i.recommendations.length>0&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8,fontSize:14},children:"æ”¹è¿›å»ºè®®ï¼š"}),e.jsx("ul",{style:{paddingLeft:20,margin:0},children:i.recommendations.map((l,A)=>e.jsx("li",{style:{marginBottom:4},children:l},A))})]})]}):null},{TextArea:Se}=W,{Panel:ds}=tt,U=S=>{if(Array.isArray(S))return S;if(!S)return[];const i=[],r=S.split(/[ï¼›;]/);for(const M of r){const C=M.trim();C&&i.push(C)}return i.length>0?i:[S]},Ls=()=>{const S=Mt(),{contractId:i}=Pt(),{message:r}=Ot.useApp(),[M,C]=o.useState(null),[b,q]=o.useState(null),[se,T]=o.useState(!1),[H,z]=o.useState("upload"),[l,A]=o.useState({}),[Ce,Ie]=o.useState("ç”²æ–¹"),[y,le]=o.useState([]),[ae,K]=o.useState(!1),[ne,ce]=o.useState(!1),[gs,st]=o.useState(!1),[us,nt]=o.useState(""),[X,P]=o.useState(!1);o.useEffect(()=>{console.log("ğŸ“Š showUploadProgress çŠ¶æ€å˜åŒ–:",X,"uploadProgressRef.current:",k.current)},[X]);const[Te,rt]=o.useState(!1),[Be,ot]=o.useState(0),[it,$e]=o.useState(!1),[lt,de]=o.useState(!1),[at,ct]=o.useState([]),[ge]=N.useForm(),[re,dt]=o.useState([]),[gt,ue]=o.useState(!1),[F,ut]=o.useState(null),[pe,ze]=o.useState(""),[xe,Ae]=o.useState(""),[B,oe]=o.useState([]),[J,Ee]=o.useState(!1),[pt,Me]=o.useState("suggestions"),[Pe,L]=o.useState(""),D=o.useRef(null),k=o.useRef(!1),ie=o.useRef(0),Q=async()=>{try{const s=(await m.get("/admin/rules",{params:{category:"custom"}})).data.filter(n=>!n.is_system);ct(s),ot(s.length)}catch(t){console.error("è·å–è‡ªå®šä¹‰è§„åˆ™å¤±è´¥",t)}};o.useEffect(()=>{Q()},[]),o.useEffect(()=>{b&&localStorage.setItem("contractReview_contractId",b.toString())},[b]),o.useEffect(()=>{(async()=>{if(!i)return;const s=parseInt(i);if(isNaN(s)){r.error("æ— æ•ˆçš„åˆåŒ ID"),S("/contract/review");return}console.log("ğŸ“Œ ä» URL åŠ è½½åˆåŒ:",s),T(!0);try{q(s);const n=await m.get(`/contract-review/${s}/processing-status`),{processing_status:a,can_load_editor:j,has_metadata:d,metadata:c}=n.data;if(console.log("ğŸ“Œ URL åŠ è½½åˆåŒçŠ¶æ€:",a,"can_load_editor:",j),j){const f=await m.get(`/contract-review/${s}/onlyoffice-config`),_=f.data.config,h=f.data.token;C({..._,token:h})}d&&c&&(A(f=>({...f,contract_name:c.contract_name||f.contract_name||"",parties:U(c.parties),amount:c.amount||f.amount||"",contract_type:c.contract_type||f.contract_type||"",core_terms:c.core_terms||f.core_terms||"",legal_features:c.legal_features||f.legal_features})),K(!1),ce(!0));const x=await m.get(`/contract-review/${s}/review-results`),{status:g,review_items:u}=x.data;g==="waiting_human"||g==="approved"?(le(u||[]),Ie(x.data.stance||"ç”²æ–¹"),z("results"),r.success(`å®¡æŸ¥å·²å®Œæˆï¼Œå‘ç° ${u?.length||0} ä¸ªé£é™©ç‚¹`)):g==="reviewing"||g==="processing"?(z("reviewing"),L("æ­£åœ¨å®¡æŸ¥ä¸­..."),Fe()):z("metadata")}catch(n){console.error("åŠ è½½åˆåŒå¤±è´¥",n),r.error(n.response?.data?.detail||"åŠ è½½åˆåŒå¤±è´¥"),S("/contract/review")}finally{T(!1)}})()},[i]),o.useEffect(()=>{localStorage.setItem("contractReview_step",H)},[H]);const xt=async t=>{try{await m.post("/admin/rules",{...t,rule_category:"custom",is_system:!1}),r.success("è‡ªå®šä¹‰è§„åˆ™åˆ›å»ºæˆåŠŸ"),Q(),de(!1)}catch(s){r.error(s.response?.data?.detail||"åˆ›å»ºå¤±è´¥")}},ft=async t=>{try{await m.delete(`/admin/rules/${t}`),r.success("åˆ é™¤æˆåŠŸ"),Q()}catch(s){r.error(s.response?.data?.detail||"åˆ é™¤å¤±è´¥")}},ht=async t=>{try{await m.put(`/admin/rules/${t}/toggle`),r.success("çŠ¶æ€æ›´æ–°æˆåŠŸ"),Q()}catch(s){r.error(s.response?.data?.detail||"æ›´æ–°å¤±è´¥")}},mt=async t=>{const s=t.target.files?.[0];if(!s)return;const n=s.name.toLowerCase();if(![".doc",".docx",".pdf",".txt",".rtf",".odt",".jpg",".jpeg",".png",".bmp",".tiff",".gif"].some(c=>n.endsWith(c))){r.error("æ”¯æŒçš„æ ¼å¼ï¼šæ–‡æ¡£ (.doc/.docx/.pdf/.txt/.rtf/.odt) æˆ–å›¾ç‰‡ (.jpg/.png/.bmp)");return}[".jpg",".jpeg",".png",".bmp",".tiff",".gif"].some(c=>n.endsWith(c))?r.info("æ­£åœ¨ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼Œç³»ç»Ÿå°†ä½¿ç”¨ OCR è¯†åˆ«æ–‡å­—å†…å®¹..."):(n.endsWith(".doc")||n.endsWith(".pdf")||n.endsWith(".txt")||n.endsWith(".rtf")||n.endsWith(".odt"))&&r.info(`æ­£åœ¨ä¸Šä¼  ${n.split(".").pop()} æ–‡ä»¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è½¬æ¢ä¸º .docx æ ¼å¼...`),T(!0);try{console.log("ğŸ”µ å¼€å§‹ä¸Šä¼ æ–‡ä»¶ï¼Œè®¾ç½®ä¸Šä¼ è¿›åº¦çŠ¶æ€"),ie.current=Date.now(),k.current=!0,O.flushSync(()=>{P(!0),st(!0)}),console.log("ğŸ”µ ä¸Šä¼ è¿›åº¦çŠ¶æ€å·²åŒæ­¥è®¾ç½®ï¼ŒshowUploadProgress:",X,"uploadProgressRef.current:",k.current);const c=await m.uploadContract(s),x=c.data.contract_id;if(console.log("ä¸Šä¼ æˆåŠŸï¼Œcontract_id:",x,"å“åº”æ•°æ®:",c.data),q(x),c.data.preprocess_info){const{original_format:g}=c.data.preprocess_info;g&&g!=="docx"?r.success(`æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼æ­£åœ¨è½¬æ¢ ${g.toUpperCase()} æ ¼å¼...`):r.success("æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼æ­£åœ¨åå°å¤„ç†...")}else r.success("æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼æ­£åœ¨åå°å¤„ç†...");if(c.data.config&&c.data.token){C({...c.data.config,token:c.data.token}),console.log("OnlyOffice é…ç½®å·²è®¾ç½® (æ¥è‡ªä¸Šä¼ å“åº”)");const g=3e3,u=Date.now()-ie.current;if(u<g){const f=g-u;console.log(`â³ ä¸Šä¼ å“åº”åŒ…å« configï¼Œä½†ç­‰å¾… ${f}ms åéšè—ä¸Šä¼ è¿›åº¦ç•Œé¢`),setTimeout(()=>{k.current=!1,O.flushSync(()=>{P(!1)}),console.log("âœ… ä¸Šä¼ è¿›åº¦ç•Œé¢å·²éšè—ï¼ˆæœ€å°æ˜¾ç¤ºæ—¶é—´å·²è¿‡ï¼‰")},f)}else k.current=!1,O.flushSync(()=>{P(!1)})}else{r.info("æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨åå°å¤„ç†æ ¼å¼å’Œé¢„è§ˆ...");const g=async(u=0)=>{if(u>=30){console.warn("åå°å¤„ç†è½®è¯¢è¶…æ—¶ï¼Œå°è¯•è·å–é…ç½®");try{const _=await m.get(`/contract-review/${x}/onlyoffice-config`),h=_.data.config,v=_.data.token;C({...h,token:v}),console.log("OnlyOffice é…ç½®å·²è®¾ç½® (è¶…æ—¶åè·å–)")}catch(_){console.warn("è¶…æ—¶åä»æ— æ³•è·å– OnlyOffice é…ç½®",_)}return}try{const _=await m.get(`/contract-review/${x}/processing-status`),{processing_status:h,can_load_editor:v}=_.data;if(nt(h),console.log(`åå°å¤„ç†çŠ¶æ€ (ç¬¬${u+1}æ¬¡):`,h,"can_load_editor:",v),v){const V=await m.get(`/contract-review/${x}/onlyoffice-config`),Y=V.data.config,E=V.data.token;C({...Y,token:E});const Z=3e3,I=Date.now()-ie.current;if(I<Z){const G=Z-I;console.log(`â³ pollProcessingComplete: ç­‰å¾… ${G}ms åéšè—ä¸Šä¼ è¿›åº¦ç•Œé¢`),setTimeout(()=>{k.current=!1,O.flushSync(()=>{P(!1)}),console.log("âœ… ä¸Šä¼ è¿›åº¦ç•Œé¢å·²éšè—ï¼ˆpollProcessingComplete æœ€å°æ˜¾ç¤ºæ—¶é—´å·²è¿‡ï¼‰")},G)}else k.current=!1,O.flushSync(()=>{P(!1)});console.log("OnlyOffice é…ç½®å·²è®¾ç½® (docxè½¬æ¢å®Œæˆå³å¯åŠ è½½)"),h==="completed"?r.success("æ–‡ä»¶å¤„ç†å®Œæˆï¼Œå¯ä»¥å¼€å§‹ç¼–è¾‘"):h==="metadata_extraction"?r.info("ç¼–è¾‘å™¨å·²å°±ç»ªï¼Œæ­£åœ¨æå–åˆåŒå…ƒæ•°æ®..."):h==="pdf_generation"&&r.info("ç¼–è¾‘å™¨å·²å°±ç»ªï¼Œæ­£åœ¨ç”ŸæˆPDFé¢„è§ˆ...");return}else setTimeout(()=>g(u+1),2e3)}catch(_){console.warn("æŸ¥è¯¢å¤„ç†çŠ¶æ€å¤±è´¥ï¼Œ2ç§’åé‡è¯•",_),setTimeout(()=>g(u+1),2e3)}};g()}if(z("metadata"),K(!0),ce(!1),x){const g=async(u=0)=>{const _=(h,v)=>v<5?"æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨å¤„ç†...":h==="format_conversion"?"æ­£åœ¨è½¬æ¢æ–‡ä»¶æ ¼å¼ï¼ˆ.doc â†’ .docxï¼‰...":h==="pdf_generation"?"æ­£åœ¨ç”ŸæˆPDFé¢„è§ˆ...":h==="metadata_extraction"?"æ­£åœ¨æå–åˆåŒå…ƒæ•°æ®...":v<15?"åˆåŒä¿¡æ¯æå–ä¸­ï¼Œè¯·ç¨å€™...":v<30?"æ­£åœ¨åˆ†æåˆåŒæ¡æ¬¾ï¼ˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰...":"ä»åœ¨å¤„ç†ä¸­ï¼Œæ„Ÿè°¢æ‚¨çš„è€å¿ƒç­‰å¾…...";if(u>45){console.warn("å¤„ç†çŠ¶æ€è½®è¯¢è¶…æ—¶"),K(!1),k.current=!1,O.flushSync(()=>{P(!1)}),r.warning({content:"æ–‡ä»¶å¤„ç†è€—æ—¶è¾ƒé•¿ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶æ ¼å¼è¾ƒå¤æ‚ã€‚æ‚¨å¯ä»¥ç¨ååˆ·æ–°é¡µé¢æˆ–ç»§ç»­å¡«å†™åˆåŒä¿¡æ¯ã€‚",duration:6});return}try{const h=await m.get(`/contract-review/${x}/processing-status`);console.log(`è½®è¯¢å¤„ç†çŠ¶æ€ (ç¬¬${u+1}æ¬¡):`,h.data);const{processing_status:v,can_load_editor:V,has_metadata:Y,metadata:E,error_message:Z}=h.data;if(V&&!M){console.log("âœ… æ£€æµ‹åˆ°å¯ä»¥åŠ è½½ç¼–è¾‘å™¨");const I=await m.get(`/contract-review/${x}/onlyoffice-config`),G=I.data.config,Ue=I.data.token;C({...G,token:Ue}),console.log("âœ… OnlyOffice é…ç½®å·²è®¾ç½®ï¼ŒeditorConfig:",{...G,token:Ue});const he=3e3,me=Date.now()-ie.current;if(console.log(`â±ï¸ å·²æ˜¾ç¤º ${me}msï¼Œæœ€å°æ˜¾ç¤ºæ—¶é—´ ${he}ms`),me<he){const Ve=he-me;console.log(`â³ ç­‰å¾… ${Ve}ms åéšè—ä¸Šä¼ è¿›åº¦ç•Œé¢`),setTimeout(()=>{k.current=!1,O.flushSync(()=>{P(!1)}),console.log("âœ… ä¸Šä¼ è¿›åº¦ç•Œé¢å·²éšè—ï¼ˆæœ€å°æ˜¾ç¤ºæ—¶é—´å·²è¿‡ï¼‰")},Ve)}else console.log("âœ… å·²è¶…è¿‡æœ€å°æ˜¾ç¤ºæ—¶é—´ï¼Œç«‹å³éšè—ä¸Šä¼ è¿›åº¦ç•Œé¢"),k.current=!1,O.flushSync(()=>{P(!1)});v==="completed"?r.success("æ–‡ä»¶å¤„ç†å®Œæˆï¼Œå¯ä»¥å¼€å§‹ç¼–è¾‘"):v==="metadata_extraction"?r.info("ç¼–è¾‘å™¨å·²å°±ç»ªï¼Œæ­£åœ¨æå–åˆåŒå…ƒæ•°æ®..."):v==="pdf_generation"&&r.info("ç¼–è¾‘å™¨å·²å°±ç»ªï¼Œæ­£åœ¨ç”ŸæˆPDFé¢„è§ˆ...")}if(u>0&&u%10===0&&r.info(_(v,u),2),v==="error"){console.error("åå°å¤„ç†å¤±è´¥:",Z),K(!1),k.current=!1,O.flushSync(()=>{P(!1)}),r.error(`æ–‡ä»¶å¤„ç†å¤±è´¥: ${Z}`);return}if(Y&&E){console.log("âœ… å…ƒæ•°æ®å·²å°±ç»ª:",E),A(I=>({...I,contract_name:E.contract_name||I.contract_name||"",parties:U(E.parties),amount:E.amount||I.amount||"",contract_type:E.contract_type||I.contract_type||"",core_terms:E.core_terms||I.core_terms||"",legal_features:E.legal_features||I.legal_features})),K(!1),ce(!0),r.success("åˆåŒä¿¡æ¯æå–æˆåŠŸï¼Œå¯ä¿®æ”¹åç¡®è®¤");return}else console.log(`â³ å¤„ç†ä¸­ (${v})ï¼Œ2ç§’åé‡è¯•...`),setTimeout(()=>g(u+1),2e3)}catch(h){console.error("æ£€æŸ¥å¤„ç†çŠ¶æ€å¤±è´¥",h),setTimeout(()=>g(u+1),2e3)}};g()}}catch(c){console.error("ä¸Šä¼ å¤±è´¥",c),r.error(c.response?.data?.detail||"æ–‡ä»¶ä¸Šä¼ å¤±è´¥")}finally{T(!1)}},Oe=async()=>{if(b){T(!0),z("reviewing"),L("ğŸ“‹ æ­£åœ¨å¯åŠ¨å®¡æŸ¥ä»»åŠ¡..."),r.info({content:"æ­£åœ¨å¯åŠ¨åˆåŒæ·±åº¦å®¡æŸ¥...",duration:3});try{const t={...l};Array.isArray(l.parties)&&(t.parties=l.parties.join("; "));const s=new FormData;s.append("stance",Ce),s.append("enable_custom_rules",Te.toString()),s.append("use_langgraph","true"),s.append("use_celery","true"),re.length>0&&(s.append("transaction_structures",JSON.stringify(re)),console.log("ğŸ“¤ å‘é€äº¤æ˜“ç»“æ„:",JSON.stringify(re))),s.append("updated_metadata",JSON.stringify(t)),console.log("ğŸ“¤ å‘é€å…ƒæ•°æ®:",t),(await m.post(`/contract-review/${b}/deep-review`,s,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&r.success("æ·±åº¦å®¡æŸ¥ä»»åŠ¡å·²æäº¤ï¼Œæ­£åœ¨åå°åŠ è½½å®¡æŸ¥è§„åˆ™å¹¶åˆ†æåˆåŒ..."),Fe()}catch(t){console.error("å®¡æŸ¥å¯åŠ¨å¤±è´¥",t),console.error("é”™è¯¯è¯¦æƒ…:",t.response?.data),L(""),r.error(t.response?.data?.detail||"å®¡æŸ¥å¯åŠ¨å¤±è´¥"),z("metadata")}finally{T(!1)}}},Fe=async()=>{if(!b)return;let t=0;const s=150;let n=0;const a=[{message:"ğŸ“‹ æ­£åœ¨åŠ è½½å®¡æŸ¥è§„åˆ™...",threshold:0},{message:"ğŸ” æ­£åœ¨åˆ†æåˆåŒæ¡æ¬¾...",threshold:10},{message:"âš ï¸ æ­£åœ¨è¯†åˆ«é£é™©ç‚¹...",threshold:30},{message:"ğŸ“ æ­£åœ¨ç”Ÿæˆå®¡æŸ¥æŠ¥å‘Š...",threshold:60},{message:"ğŸ¯ æ­£åœ¨ä¼˜åŒ–å®¡æŸ¥ç»“æœ...",threshold:90}],j=async()=>{try{t++;const d=a.find((u,f)=>t>=u.threshold&&(f===a.length-1||t<a[f+1].threshold));d&&n!==a.indexOf(d)&&(n=a.indexOf(d),L(d.message),r.loading({content:d.message,duration:4,key:"review-progress"}),console.log(`[å®¡æŸ¥è¿›åº¦] ${d.message} (ç¬¬${t}æ¬¡è½®è¯¢)`));const c=await m.getReviewResults(b),{status:x,review_items:g}=c.data;if(console.log(`[å®¡æŸ¥è½®è¯¢] ç¬¬${t}æ¬¡: status=${x}, items=${g?.length||0}`),x==="waiting_human"||x==="approved"){le(g),z("results"),L(""),r.success({content:`âœ… å®¡æŸ¥å®Œæˆï¼å‘ç° ${g.length} ä¸ªé£é™©ç‚¹`,duration:5});return}else x==="processing"||x==="pending"||x==="reviewing"||x==="draft"?t<s?setTimeout(j,3e3):(L(""),r.error("å®¡æŸ¥è¶…æ—¶ï¼Œè¯·ç¨ååˆ·æ–°æŸ¥çœ‹ç»“æœ")):(L(""),r.warning(`æœªçŸ¥çŠ¶æ€: ${x}ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•`))}catch(d){console.error("è·å–ç»“æœå¤±è´¥",d),t<s?setTimeout(j,5e3):(L(""),r.error("è·å–å®¡æŸ¥ç»“æœè¶…æ—¶"))}};j()},yt=t=>{ut(t),ze(t.explanation),Ae(t.suggestion),ue(!0)},jt=async()=>{if(F)try{await m.updateReviewItem(F.id,{explanation:pe,suggestion:xe}),le(y.map(t=>t.id===F.id?{...t,explanation:pe,suggestion:xe}:t)),r.success("å®¡æŸ¥æ„è§å·²æ›´æ–°"),ue(!1)}catch(t){console.error("æ›´æ–°å®¡æŸ¥æ„è§å¤±è´¥",t),r.error(t.response?.data?.detail||"æ›´æ–°å¤±è´¥")}},fe=async t=>{if(!b)return;const s=t||B;if(s.length===0){r.warning("è¯·å…ˆé€‰æ‹©è¦åº”ç”¨çš„ä¿®æ”¹æ„è§");return}Ee(!0);try{const n=await m.applyRevisions(b,s,!1);if(n.data.config&&n.data.token){C({...n.data.config,token:n.data.token});const a=n.data.converted?` (åŸæ–‡ä»¶æ ¼å¼: ${n.data.original_format?.toUpperCase()||"PDF"}ï¼Œå·²è‡ªåŠ¨è½¬æ¢ä¸º Word æ ¼å¼)`:"";r.success(`å·²åº”ç”¨ ${n.data.applied_count} æ¡ä¿®è®¢å»ºè®®${a}`+(n.data.not_found_count>0?`ï¼Œ${n.data.not_found_count} æ¡æœªæ‰¾åˆ°åŸæ–‡`:"")),r.info("ä¿®è®¢æ ·å¼ï¼šçº¢è‰²åˆ é™¤çº¿ = åŸæ–‡ï¼Œé»„è‰²é«˜äº®ä¸‹åˆ’çº¿ = ä¿®è®¢å†…å®¹")}else r.error("ç”Ÿæˆä¿®è®¢æ–‡æ¡£å¤±è´¥")}catch(n){console.error("åº”ç”¨ä¿®è®¢å¤±è´¥",n),r.error(n.response?.data?.detail||"åº”ç”¨ä¿®è®¢å¤±è´¥")}finally{Ee(!1)}},vt=t=>{oe(t?y.map(s=>s.id):[])},wt=(t,s)=>{oe(s?[...B,t]:B.filter(n=>n!==t))},Le=t=>{console.log("[é«˜äº®å®šä½] å°è¯•å®šä½:",t);const s=t.trim();if(!s){r.warning("å®¡æŸ¥æ„è§åŸæ–‡ä¸ºç©º");return}const n=s.replace(/[ï¼Œã€‚ï¼›ï¼šï¼ï¼Ÿã€""''ï¼ˆï¼‰ã€ã€‘ã€Šã€‹\s]/g," ").split(" ").filter(d=>d.length>1).slice(0,3),a=n.length>0?n[0]:s;if(D.current&&typeof D.current.executeMethod=="function"){console.log("[é«˜äº®å®šä½] ä½¿ç”¨ executeMethod æ–¹æ³•");try{D.current.executeMethod("SearchAndReplace",{searchString:a,replaceString:a,matchCase:!1}).then(()=>{r.success(`å·²å®šä½åˆ°å…³é”®è¯: "${a}"${n.length>1?` (å…¶ä»–: ${n.slice(1).join(", ")})`:""}`)}).catch(d=>{console.warn("[é«˜äº®å®šä½] executeMethod å¤±è´¥:",d),j()});return}catch(d){console.warn("[é«˜äº®å®šä½] executeMethod å¼‚å¸¸:",d)}}const j=()=>{if(D.current&&typeof D.current.callCommand=="function"){console.log("[é«˜äº®å®šä½] ä½¿ç”¨ callCommand æ–¹æ³•");try{D.current.callCommand(function(){if(typeof Api>"u"||!Api.GetDocument)return console.warn("[é«˜äº®å®šä½] Builder API ä¸å¯ç”¨"),-1;const d=Api.GetDocument();let c=0;const x=d.GetElementsCount(),g=n.length>0?n:[s];for(let u=0;u<x;u++){const f=d.GetElement(u),_=f.GetText?f.GetText():"";if(_){for(const h of g)if(_.indexOf(h)!==-1){const v=_.indexOf(h),V=v+h.length;if(f.GetRange){const Y=f.GetRange(v,V);c===0&&d.SetCurrentRange&&d.SetCurrentRange(Y),c++;break}}}}return c},d=>{const c=typeof d=="number"?d:0;c>0?r.success(`å·²å®šä½åˆ° ${c} å¤„ç›¸å…³å†…å®¹ï¼Œå…³é”®è¯: ${n.join(", ")}`):r.info(`æœªåœ¨æ–‡æ¡£ä¸­æ‰¾åˆ°ç²¾ç¡®åŒ¹é…ï¼Œå»ºè®®å…³é”®è¯: ${n.join(", ")}`)});return}catch(d){console.error("[é«˜äº®å®šä½] callCommand å¼‚å¸¸:",d)}}};j(),setTimeout(()=>{r.info(`ğŸ’¡ æç¤ºï¼šè¯·æŒ‰ Ctrl+F åœ¨æ–‡æ¡£ä¸­æœç´¢ï¼Œå»ºè®®å…³é”®è¯: ${n.join(", ")}`)},800)},De=async t=>{if(b)try{const s=await m.downloadContract(b,t),n=window.URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download=t==="revised"?"ä¿®è®¢ç‰ˆåˆåŒ.docx":"åŸå§‹åˆåŒ.docx",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(n),document.body.removeChild(a),r.success(t==="revised"?"ä¿®è®¢ç‰ˆæ–‡ä»¶ä¸‹è½½æˆåŠŸ":"åŸå§‹æ–‡ä»¶ä¸‹è½½æˆåŠŸ")}catch(s){console.error("ä¸‹è½½å¤±è´¥",s),r.error(s.response?.data?.detail||"ä¸‹è½½å¤±è´¥")}},_t=[{key:"original",label:"ä¸‹è½½åŸå§‹æ–‡ä»¶",icon:e.jsx(we,{}),onClick:()=>De("original")},{key:"revised",label:"ä¸‹è½½ä¿®è®¢ç‰ˆæ–‡ä»¶",icon:e.jsx(we,{}),onClick:()=>De("revised")}],St=t=>{Ht.office?.("ONLYOFFICE Ready!");try{const s=t?.docEditor?.createConnector?.();D.current=s??null}catch(s){console.error("åˆ›å»º connector å¤±è´¥",s),D.current=null}},We=()=>y.filter(t=>t.entity_risk),bt=()=>({Critical:y.filter(t=>t.severity==="Critical").length,High:y.filter(t=>t.severity==="High").length,Medium:y.filter(t=>t.severity==="Medium").length,Low:y.filter(t=>t.severity==="Low").length}),kt=()=>{const t={};return y.forEach(s=>{const n=s.issue_type;t[n]=(t[n]||0)+1}),Object.entries(t).sort((s,n)=>n[1]-s[1])},He=()=>y.filter(t=>t.severity==="Critical"||t.severity==="High"),Ne=()=>y.filter(t=>t.action_type==="Alert"),Rt=()=>{const t=U(l.parties);t.push(""),A({...l,parties:t})},Ct=(t,s)=>{const n=U(l.parties);n[t]=s,A({...l,parties:n})},It=t=>{const s=U(l.parties);s.splice(t,1),A({...l,parties:s})},Tt=()=>{const t=bt(),s=kt();return e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsxs(et,{gutter:24,style:{marginBottom:24},children:[e.jsx(te,{span:12,children:e.jsx(R,{title:"é£é™©ç­‰çº§åˆ†å¸ƒ",bordered:!1,children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",marginTop:16},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:32,fontWeight:"bold",color:"#ff4d4f"},children:t.Critical}),e.jsx("div",{style:{color:"#666"},children:"æä¸¥é‡"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:32,fontWeight:"bold",color:"#faad14"},children:t.High}),e.jsx("div",{style:{color:"#666"},children:"é«˜é£é™©"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:32,fontWeight:"bold",color:"#1890ff"},children:t.Medium}),e.jsx("div",{style:{color:"#666"},children:"ä¸­ç­‰"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:32,fontWeight:"bold",color:"#52c41a"},children:t.Low}),e.jsx("div",{style:{color:"#666"},children:"è½»å¾®"})]})]})})}),e.jsx(te,{span:12,children:e.jsx(R,{title:"é—®é¢˜ç±»å‹åˆ†å¸ƒ",bordered:!1,children:e.jsx("div",{style:{marginTop:16},children:s.slice(0,5).map(([n,a])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8,padding:"8px 12px",background:"#f5f5f5",borderRadius:"4px"},children:[e.jsx("span",{children:n}),e.jsx(p,{color:"blue",children:a})]},n))})})})]}),e.jsx($,{message:"æ“ä½œå»ºè®®",description:e.jsxs("div",{children:[e.jsx("p",{children:"1. ä¼˜å…ˆå¤„ç†æä¸¥é‡å’Œé«˜é£é™©é—®é¢˜"}),e.jsx("p",{children:'2. æŸ¥çœ‹"ä¿®æ”¹æ„è§"æ ‡ç­¾é¡µåº”ç”¨å…·ä½“ä¿®è®¢å»ºè®®'}),e.jsx("p",{children:'3. å…³æ³¨"ä¸»ä½“é£é™©"æ ‡ç­¾é¡µä¸­çš„äº¤æ˜“æ–¹é£é™©ä¿¡æ¯'}),e.jsx("p",{children:"4. å¯¹äºç¼ºå¤±æ¡æ¬¾ï¼Œè€ƒè™‘ä¸å¯¹æ–¹åå•†è¡¥å……"})]}),type:"info",showIcon:!0})]})},Bt=()=>e.jsxs("div",{children:[e.jsx($,{message:`å…±å‘ç° ${y.length} ä¸ªé£é™©ç‚¹ï¼Œå·²é€‰ ${B.length} æ¡`,type:y.some(t=>t.action_type==="Alert")?"warning":"info",style:{marginBottom:16}}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},children:[e.jsx(ee,{checked:B.length===y.length&&y.length>0,indeterminate:B.length>0&&B.length<y.length,onChange:t=>vt(t.target.checked),children:"å…¨é€‰"}),e.jsxs(w,{type:"primary",onClick:()=>fe(),disabled:B.length===0||J,loading:J,icon:e.jsx(Je,{}),children:["åº”ç”¨é€‰å®šä¿®è®¢ (",B.length,")"]}),e.jsx(w,{onClick:()=>fe(y.map(t=>t.id)),disabled:J,loading:J,children:"å…¨éƒ¨åº”ç”¨"}),e.jsx(Nt,{menu:{items:_t},trigger:["click"],children:e.jsx(w,{icon:e.jsx(we,{}),children:"ä¸‹è½½æ–‡ä»¶"})})]}),y.map(t=>e.jsx(R,{style:{marginBottom:12,border:B.includes(t.id)?"2px solid #1890ff":void 0},className:"risk-card",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx(ee,{checked:B.includes(t.id),onChange:s=>wt(t.id,s.target.checked)}),e.jsxs("div",{style:{flex:1,marginLeft:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("strong",{children:t.issue_type}),e.jsx(p,{color:t.severity==="Critical"?"red":t.severity==="High"?"orange":"blue",children:t.severity}),t.action_type==="Alert"&&e.jsx(p,{color:"red",children:"ä¸¥é‡è­¦å‘Š"}),t.entity_risk&&e.jsxs(p,{color:t.entity_risk.risk_level==="High"?"red":t.entity_risk.risk_level==="Medium"?"orange":"default",icon:e.jsx(be,{}),children:["ä¸»ä½“é£é™©: ",t.entity_risk.risk_level]}),t.related_entities&&t.related_entities.length>0&&e.jsxs(p,{color:"cyan",icon:e.jsx(ve,{}),children:["æ¶‰åŠ: ",t.related_entities.join(", ")]})]}),e.jsxs("div",{style:{background:"#f5f5f5",padding:"8px",borderRadius:"4px",margin:"8px 0",cursor:"pointer",fontSize:"13px",border:"1px dashed #d9d9d9"},onClick:()=>Le(t.quote),title:"ç‚¹å‡»åœ¨åŸæ–‡ä¸­å®šä½",children:[e.jsx(Ut,{style:{marginRight:4}}),e.jsx("strong",{children:"åŸæ–‡ï¼š"}),t.quote]}),e.jsxs("div",{style:{fontSize:"13px",marginBottom:4},children:[e.jsx("strong",{children:"é£é™©è¯´æ˜ï¼š"}),t.explanation]}),e.jsxs("div",{style:{fontSize:"13px",marginBottom:8},children:[e.jsx("strong",{children:"ä¿®æ”¹å»ºè®®ï¼š"}),t.suggestion]}),t.legal_basis&&e.jsxs("div",{style:{fontSize:"13px",marginBottom:8,background:"#f0f5ff",padding:"6px 8px",borderRadius:"4px"},children:[e.jsx("strong",{style:{color:"#1890ff"},children:"å®¡æŸ¥ä¾æ®ï¼š"}),e.jsx("span",{style:{color:"#666"},children:t.legal_basis})]}),t.entity_risk&&e.jsx(tt,{ghost:!0,style:{marginBottom:8},children:e.jsx(ds,{header:e.jsxs("span",{style:{color:"#ff4d4f",fontWeight:"bold"},children:[e.jsx(be,{style:{marginRight:4}}),"ä¸»ä½“é£é™©è¯¦æƒ… (",t.entity_risk.entity_name,")"]}),children:e.jsxs("div",{style:{padding:"8px 0",fontSize:"13px"},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"é£é™©ç­‰çº§ï¼š"}),e.jsx(Qe,{status:t.entity_risk.risk_level==="High"?"error":t.entity_risk.risk_level==="Medium"?"warning":"default",text:t.entity_risk.risk_level})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"ä¸»ä½“ç±»å‹ï¼š"}),e.jsx("span",{children:t.entity_risk.entity_type})]}),t.entity_risk.risk_items&&t.entity_risk.risk_items.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"é£é™©è¯¦æƒ…ï¼š"}),e.jsx("ul",{style:{margin:"8px 0",paddingLeft:20},children:t.entity_risk.risk_items.map((s,n)=>e.jsxs("li",{children:[e.jsx(p,{color:"red",style:{marginBottom:4},children:s.type}),e.jsx("div",{children:s.description}),e.jsx("div",{style:{color:"#999",fontSize:"12px"},children:s.detail})]},n))})]})]})},"entity-risk")}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(w,{size:"small",type:"primary",onClick:()=>fe([t.id]),disabled:J,children:"é‡‡çº³å¹¶åº”ç”¨"}),e.jsx(w,{size:"small",icon:e.jsx(Xe,{}),onClick:()=>yt(t),children:"ç¼–è¾‘"})]})]})]})},t.id))]}),$t=()=>{const t=He();return t.length===0?e.jsx($,{message:"æš‚æ— äº‰è®®ç„¦ç‚¹",description:"æœªå‘ç°æä¸¥é‡æˆ–é«˜é£é™©çš„äº‰è®®ç‚¹",type:"success",showIcon:!0}):e.jsxs("div",{children:[e.jsx($,{message:`å‘ç° ${t.length} å¤„äº‰è®®ç„¦ç‚¹ï¼ˆæä¸¥é‡æˆ–é«˜é£é™©ï¼‰`,type:"error",showIcon:!0,style:{marginBottom:16}}),t.map(s=>e.jsxs(R,{style:{marginBottom:12,borderLeft:"4px solid #ff4d4f"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[e.jsx(p,{color:s.severity==="Critical"?"red":"orange",children:s.severity}),e.jsx("strong",{children:s.issue_type})]}),e.jsx("div",{style:{background:"#fff1f0",padding:"8px",borderRadius:"4px",marginBottom:8},children:e.jsxs("div",{style:{fontSize:"13px"},children:[e.jsx("strong",{children:"åŸæ–‡ï¼š"}),s.quote]})}),e.jsxs("div",{style:{fontSize:"13px",marginBottom:4},children:[e.jsx("strong",{children:"é£é™©è¯´æ˜ï¼š"}),s.explanation]}),e.jsxs("div",{style:{fontSize:"13px",color:"#666"},children:[e.jsx("strong",{children:"ä¿®æ”¹å»ºè®®ï¼š"}),s.suggestion]})]},s.id))]})},zt=()=>{const t=Ne();return t.length===0?e.jsx($,{message:"åˆåŒæ¡æ¬¾å®Œå¤‡",description:"æœªå‘ç°ç¼ºå¤±çš„é‡è¦æ¡æ¬¾",type:"success",showIcon:!0}):e.jsxs("div",{children:[e.jsx($,{message:`å‘ç° ${t.length} å¤„ç¼ºå¤±æˆ–éœ€è¦è¡¥å……çš„æ¡æ¬¾`,type:"warning",showIcon:!0,style:{marginBottom:16}}),t.map(s=>e.jsxs(R,{style:{marginBottom:12,borderLeft:"4px solid #faad14"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[e.jsx(p,{color:"orange",children:"ç¼ºå¤±æ¡æ¬¾"}),e.jsx("strong",{children:s.issue_type})]}),e.jsxs("div",{style:{fontSize:"13px",marginBottom:8},children:[e.jsx("strong",{children:"é£é™©è¯´æ˜ï¼š"}),s.explanation]}),e.jsxs("div",{style:{fontSize:"13px",color:"#666"},children:[e.jsx("strong",{children:"å»ºè®®è¡¥å……ï¼š"}),s.suggestion]})]},s.id))]})},At=()=>{const t=We();if(t.length===0)return e.jsx($,{message:"æœªå‘ç°ä¸»ä½“é£é™©",description:"å®¡æŸ¥ç»“æœä¸­æœªæ¶‰åŠä¸»ä½“é£é™©ä¿¡æ¯",type:"success",showIcon:!0});const s={};return t.forEach(n=>{if(n.entity_risk){const a=n.entity_risk.entity_name;s[a]||(s[a]=[]),s[a].push(n)}}),e.jsxs("div",{children:[e.jsx($,{message:`å‘ç° ${Object.keys(s).length} ä¸ªä¸»ä½“å­˜åœ¨é£é™©`,type:"warning",showIcon:!0,style:{marginBottom:16}}),Object.entries(s).map(([n,a])=>e.jsxs(R,{style:{marginBottom:16},title:e.jsxs("span",{style:{color:"#ff4d4f"},children:[e.jsx(ve,{style:{marginRight:8}}),n]}),children:[a[0].entity_risk&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{children:"ä¸»ä½“ç±»å‹ï¼š"}),e.jsx(p,{children:a[0].entity_risk.entity_type})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"é£é™©ç­‰çº§ï¼š"}),e.jsx(Qe,{status:a[0].entity_risk.risk_level==="High"?"error":"warning",text:a[0].entity_risk.risk_level})]})]}),e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:"ç›¸å…³é£é™©ç‚¹ï¼š"}),a.map(j=>e.jsxs("div",{style:{padding:"8px 12px",background:"#f5f5f5",borderRadius:"4px",marginBottom:8,cursor:"pointer"},onClick:()=>{Me("suggestions"),setTimeout(()=>Le(j.quote),100)},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(p,{color:j.severity==="Critical"?"red":j.severity==="High"?"orange":"blue",children:j.severity}),e.jsx("span",{children:j.issue_type})]}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:j.explanation})]},j.id))]},n))]})},Et=()=>e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ğŸ”„"}),e.jsx("h3",{children:"é‡æ–°å®¡æŸ¥"}),e.jsx("p",{style:{color:"#666",marginBottom:"24px"},children:"å¦‚æœä¿®æ”¹äº†åˆåŒå†…å®¹æˆ–è°ƒæ•´äº†å®¡æŸ¥å‚æ•°ï¼Œå¯ä»¥é‡æ–°å¯åŠ¨å®¡æŸ¥"}),e.jsxs(je,{children:[e.jsx(w,{type:"primary",onClick:Oe,children:"é‡æ–°å®¡æŸ¥"}),e.jsx(w,{onClick:()=>{z("metadata")},children:"è°ƒæ•´å®¡æŸ¥å‚æ•°"})]})]});return e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(Gt,{currentModuleKey:"contract-review"}),e.jsxs("div",{className:"review-container",children:[e.jsx("div",{className:"editor-area",children:(function(){return console.log("ğŸ” æ¸²æŸ“æ£€æŸ¥ - showUploadProgress:",X,"uploadProgressRef.current:",k.current,"editorConfig:",!!M,"metadataExtracted:",ne),X||k.current})()?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:"40px",textAlign:"center",background:"#f5f5f5"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"20px"},children:"ğŸ“¤"}),e.jsx("h3",{style:{marginBottom:"16px"},children:"æ–‡ä»¶å·²ä¸Šä¼ ï¼"}),e.jsx("p",{style:{color:"#666",marginBottom:"24px"},children:"æ­£åœ¨è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œè¯·ç¨å€™..."}),e.jsxs("div",{style:{padding:"16px 24px",background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",maxWidth:"400px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[e.jsx("div",{className:"ant-spin ant-spin-spinning",style:{display:"inline-block"},children:e.jsxs("span",{className:"ant-spin-dot ant-spin-dot-spin",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})}),e.jsx("strong",{children:"æ­£åœ¨åå°å¤„ç†ï¼š"})]}),e.jsxs("div",{style:{textAlign:"left",fontSize:"14px",marginLeft:"24px"},children:[e.jsx("div",{children:"âœ“ æ–‡ä»¶å·²ä¸Šä¼ "}),e.jsx("div",{style:{opacity:.7},children:"âŸ³ æ ¼å¼è½¬æ¢ä¸­..."}),e.jsx("div",{style:{opacity:.5},children:"â—‹ ç”Ÿæˆé¢„è§ˆ..."})]})]}),e.jsx("div",{style:{marginTop:"20px",fontSize:"12px",color:"#999"},children:"é¢„è®¡å¤„ç†æ—¶é—´ï¼š10-30ç§’ï¼ˆæ ¹æ®æ–‡ä»¶å¤§å°ï¼‰"})]}):M&&ne?e.jsx(Vt,{id:"docxEditor",documentServerUrl:"http://localhost:9000",config:M,events_onDocumentReady:St,height:"100%",width:"100%"}):M?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:"40px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"20px"},children:"ğŸ“„"}),e.jsx("h3",{style:{marginBottom:"16px"},children:"æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼"}),e.jsx("p",{style:{color:"#666",marginBottom:"24px"},children:"æ­£åœ¨æå–åˆåŒå…ƒæ•°æ®ï¼Œè¯·ç¨å€™..."}),e.jsxs("div",{style:{padding:"16px 24px",background:"#e6f7ff",border:"1px solid #91d5ff",borderRadius:"4px",color:"#1890ff",maxWidth:"400px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("div",{className:"ant-spin ant-spin-spinning",style:{display:"inline-block"},children:e.jsxs("span",{className:"ant-spin-dot ant-spin-dot-spin",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})}),e.jsx("strong",{children:"æ­£åœ¨åå°å¤„ç†ï¼š"})]}),e.jsxs("div",{style:{textAlign:"left",fontSize:"14px",marginLeft:"24px"},children:[e.jsx("div",{children:"âœ“ æ–‡ä»¶å·²ä¸Šä¼ "}),e.jsx("div",{style:{opacity:.7},children:"âŸ³ æ ¼å¼è½¬æ¢ä¸­..."}),e.jsx("div",{style:{opacity:.5},children:"â—‹ ç”Ÿæˆé¢„è§ˆ..."})]})]}),e.jsx("p",{style:{fontSize:"12px",color:"#999",marginTop:"16px"},children:"é¢„è®¡éœ€è¦ 10-30 ç§’ï¼Œå¤„ç†å®Œæˆåå°†è‡ªåŠ¨æ˜¾ç¤ºç¼–è¾‘å™¨"})]}):e.jsxs("div",{className:"upload-placeholder",children:[e.jsxs("label",{style:{cursor:"pointer",color:"#1890ff",fontSize:"18px"},children:["ç‚¹å‡»ä¸Šä¼ åˆåŒæ–‡ä»¶",e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"14px",color:"#999"},children:["æ”¯æŒæ ¼å¼ï¼šæ–‡æ¡£ (.doc/.docx/.pdf/.txt/.rtf/.odt)",e.jsx("br",{}),"æ”¯æŒæ ¼å¼ï¼šå›¾ç‰‡ (.jpg/.png/.bmp/.tiff/.gif) - OCR è¯†åˆ«",e.jsx("br",{}),"é .docx æ ¼å¼å°†è‡ªåŠ¨è½¬æ¢ä¸º Word æ ¼å¼"]}),e.jsx("input",{type:"file",accept:".doc,.docx,.pdf,.txt,.rtf,.odt,.jpg,.jpeg,.png,.bmp,.tiff,.gif",onChange:mt,style:{display:"none"}})]}),se&&e.jsx("div",{className:"spin",children:"ä¸Šä¼ å¤„ç†ä¸­..."})]})}),e.jsxs("div",{className:"ai-sidebar",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h3",{style:{margin:0},children:"âš–ï¸ æ™ºèƒ½åˆåŒå®¡æŸ¥ï¼ˆå‡çº§ç‰ˆï¼‰"}),e.jsx(w,{type:"link",icon:e.jsx(Ge,{}),onClick:()=>S("/contract/review-history"),style:{padding:0},children:"å†å²ä»»åŠ¡"})]}),e.jsx(qt,{moduleName:"contract_review",moduleLabel:"åˆåŒå®¡æŸ¥"}),e.jsx(R,{title:e.jsxs("span",{children:[e.jsx(Ft,{style:{marginRight:8}}),"è‡ªå®šä¹‰å®¡æŸ¥è§„åˆ™"]}),size:"small",style:{marginBottom:16},extra:e.jsx(w,{size:"small",icon:e.jsx(qe,{}),onClick:()=>$e(!0),children:"ç®¡ç†è§„åˆ™"}),children:e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:[e.jsxs("div",{children:["å·²åˆ›å»º ",Be," æ¡è‡ªå®šä¹‰è§„åˆ™"]}),Be>0&&e.jsx("div",{style:{marginTop:4},children:e.jsx(ee,{checked:Te,onChange:t=>rt(t.target.checked),children:"æœ¬æ¬¡å®¡æŸ¥å¯ç”¨"})})]})}),H==="metadata"&&e.jsxs(R,{title:"è¯·ç¡®è®¤åˆåŒåŸºæœ¬ä¿¡æ¯",style:{marginBottom:16},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{children:"å®¡æŸ¥ç«‹åœºï¼š"}),e.jsxs(ye,{value:Ce,onChange:t=>Ie(t),style:{width:120},children:[e.jsx(ye.Option,{value:"ç”²æ–¹",children:"ç”²æ–¹"}),e.jsx(ye.Option,{value:"ä¹™æ–¹",children:"ä¹™æ–¹"})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{children:"åˆåŒç±»å‹ï¼š"}),e.jsx(W,{value:l.contract_type||"",onChange:t=>A({...l,contract_type:t.target.value}),placeholder:"å¦‚ï¼šæœåŠ¡åˆåŒ",disabled:!0})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{children:"åˆåŒåç§°ï¼š"}),e.jsx(W,{value:l.contract_name||"",onChange:t=>A({...l,contract_name:t.target.value}),placeholder:"å¦‚ï¼šæŠ€æœ¯æœåŠ¡åˆåŒ"})]}),e.jsxs("div",{style:{margin:"8px 0"},children:[e.jsx("strong",{children:"å½“äº‹äººï¼š"}),U(l.parties).map((t,s)=>e.jsxs("div",{className:"party-row",style:{display:"flex",gap:8,marginTop:8},children:[e.jsx(W,{value:t,onChange:n=>Ct(s,n.target.value),placeholder:`å½“äº‹äºº ${s+1}`,style:{flex:1}}),U(l.parties).length>1&&e.jsx(w,{danger:!0,type:"text",onClick:()=>It(s),icon:e.jsx(Ze,{}),children:"åˆ é™¤"})]},s)),e.jsx("div",{style:{marginTop:8},children:e.jsx(w,{type:"dashed",onClick:Rt,icon:e.jsx(Ke,{}),children:"æ·»åŠ å½“äº‹äºº"})})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("strong",{children:"åˆåŒé‡‘é¢ï¼š"}),e.jsx(W,{value:l.amount||"",onChange:t=>A({...l,amount:t.target.value})})]}),l.legal_features?.transaction_structures&&l.legal_features.transaction_structures.length>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{marginBottom:8,display:"flex",alignItems:"center",gap:8},children:[e.jsxs("strong",{children:[e.jsx(qe,{style:{marginRight:4}}),"ç¡®è®¤æœ¬æ¬¡äº¤æ˜“ç»“æ„ (å¯å¤šé€‰)"]}),e.jsx(p,{color:"blue",children:"AIå»ºè®®"})]}),e.jsx(ee.Group,{style:{width:"100%"},value:re,onChange:t=>dt(t),children:e.jsx(je,{direction:"vertical",style:{width:"100%"},children:l.legal_features.transaction_structures.map(t=>e.jsx(ee,{value:t,children:t},t))})}),e.jsx("div",{style:{marginTop:8,fontSize:"12px",color:"#999"},children:"ğŸ’¡ æç¤ºï¼šé€‰æ‹©äº¤æ˜“ç»“æ„åï¼Œç³»ç»Ÿå°†åŠ è½½å¯¹åº”çš„ä¸“é¡¹å®¡æŸ¥è§„åˆ™"})]}),ae&&e.jsx($,{message:"æ­£åœ¨æå–åˆåŒä¿¡æ¯...",description:"AI æ­£åœ¨åˆ†æåˆåŒå†…å®¹ï¼Œæå–å½“äº‹äººã€é‡‘é¢ã€ç±»å‹ç­‰å…³é”®ä¿¡æ¯ï¼Œè¯·ç¨å€™...",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(w,{type:"primary",onClick:Oe,loading:se,disabled:ae||!ne,style:{width:"100%"},children:ae?"æ­£åœ¨æå–åˆåŒä¿¡æ¯...":ne?"å¼€å§‹æ·±åº¦å®¡æŸ¥":"ç­‰å¾…åˆåŒä¿¡æ¯æå–..."})]}),H==="reviewing"&&e.jsx(R,{children:e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px"},children:[e.jsx(Lt,{size:"large"}),e.jsxs("div",{style:{marginTop:"24px"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"AI æ­£åœ¨æ·±åº¦åˆ†æåˆåŒ..."}),Pe?e.jsx("div",{style:{padding:"16px 24px",background:"#e6f7ff",border:"1px solid #91d5ff",borderRadius:"8px",color:"#1890ff",fontSize:"16px",fontWeight:500,maxWidth:"500px",margin:"0 auto"},children:Pe}):e.jsx("p",{style:{color:"#666"},children:"è¯·è€å¿ƒç­‰å¾…ï¼ˆé€šå¸¸éœ€è¦ 10-30 ç§’ï¼‰"})]}),e.jsx("div",{style:{marginTop:"24px",fontSize:"14px",color:"#999"},children:"æ­£åœ¨æ‰§è¡Œï¼šè§„åˆ™åŠ è½½ â†’ æ¡æ¬¾åˆ†æ â†’ é£é™©è¯†åˆ« â†’ æŠ¥å‘Šç”Ÿæˆ"})]})}),H==="results"&&e.jsxs("div",{className:"review-results-container",children:[e.jsx(cs,{contractId:b}),e.jsx(R,{style:{marginTop:16},children:e.jsx(Dt,{activeKey:pt,onChange:Me,type:"card",size:"large",items:[{key:"overview",label:e.jsxs("span",{children:[e.jsx(Wt,{}),"ç»¼åˆè¯„ä¼°"]}),children:Tt()},{key:"suggestions",label:e.jsxs("span",{children:[e.jsx(Xe,{}),"ä¿®æ”¹æ„è§",e.jsx(p,{color:"blue",style:{marginLeft:4},children:y.length})]}),children:Bt()},{key:"controversy",label:e.jsxs("span",{children:[e.jsx(os,{}),"äº‰è®®ç„¦ç‚¹",e.jsx(p,{color:"red",style:{marginLeft:4},children:He().length})]}),children:$t()},{key:"missing",label:e.jsxs("span",{children:[e.jsx(ss,{}),"ç¼ºå¤±æ¡æ¬¾",e.jsx(p,{color:"orange",style:{marginLeft:4},children:Ne().length})]}),children:zt()},{key:"entity",label:e.jsxs("span",{children:[e.jsx(ve,{}),"ä¸»ä½“é£é™©",e.jsx(p,{color:"cyan",style:{marginLeft:4},children:We().length})]}),children:At()},{key:"re-review",label:e.jsxs("span",{children:[e.jsx(Ge,{}),"é‡å®¡"]}),children:Et()}]})})]})]}),e.jsx(_e,{title:"ç¼–è¾‘å®¡æŸ¥æ„è§",open:gt,onOk:jt,onCancel:()=>ue(!1),width:600,okText:"ä¿å­˜",cancelText:"å–æ¶ˆ",children:F&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("strong",{children:"é—®é¢˜ç±»å‹ï¼š"}),e.jsx(p,{color:F.severity==="Critical"?"red":F.severity==="High"?"orange":"blue",children:F.issue_type})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("strong",{children:"åŸæ–‡ï¼š"}),e.jsx("div",{style:{background:"#f5f5f5",padding:"8px",borderRadius:"4px",marginTop:4},children:F.quote})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("strong",{children:"é£é™©è¯´æ˜ï¼š"}),e.jsx(Se,{value:pe,onChange:t=>ze(t.target.value),rows:3,placeholder:"è¯·è¾“å…¥é£é™©è¯´æ˜"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("strong",{children:"ä¿®æ”¹å»ºè®®ï¼š"}),e.jsx(Se,{value:xe,onChange:t=>Ae(t.target.value),rows:3,placeholder:"è¯·è¾“å…¥ä¿®æ”¹å»ºè®®"})]})]})}),e.jsxs(_e,{title:"è‡ªå®šä¹‰å®¡æŸ¥è§„åˆ™ç®¡ç†",open:it,onCancel:()=>$e(!1),footer:null,width:800,children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(w,{type:"primary",icon:e.jsx(Ke,{}),onClick:()=>{ge.resetFields(),ge.setFieldsValue({is_active:!0,priority:0}),de(!0)},style:{marginRight:8},children:"æ–°å»ºè§„åˆ™"}),e.jsx(w,{onClick:Q,children:"åˆ·æ–°"})]}),e.jsx(Qt,{dataSource:at,rowKey:"id",pagination:!1,size:"small",columns:[{title:"åç§°",dataIndex:"name",key:"name",ellipsis:!0},{title:"æè¿°",dataIndex:"description",key:"description",ellipsis:!0},{title:"ä¼˜å…ˆçº§",dataIndex:"priority",key:"priority",width:70},{title:"çŠ¶æ€",dataIndex:"is_active",key:"is_active",width:70,render:t=>t?e.jsx(p,{color:"success",icon:e.jsx(Je,{}),children:"å¯ç”¨"}):e.jsx(p,{color:"default",icon:e.jsx(Yt,{}),children:"ç¦ç”¨"})},{title:"æ“ä½œ",key:"actions",width:150,render:(t,s)=>e.jsxs(je,{size:"small",children:[e.jsx(w,{type:"text",size:"small",onClick:()=>ht(s.id),children:s.is_active?"ç¦ç”¨":"å¯ç”¨"}),e.jsx(Zt,{title:"ç¡®å®šåˆ é™¤æ­¤è§„åˆ™å—ï¼Ÿ",onConfirm:()=>ft(s.id),okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",children:e.jsx(w,{type:"text",size:"small",danger:!0,icon:e.jsx(Ze,{}),children:"åˆ é™¤"})})]})}]})]}),e.jsx(_e,{title:"åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™",open:lt,onCancel:()=>de(!1),footer:null,width:600,children:e.jsxs(N,{form:ge,layout:"vertical",onFinish:xt,children:[e.jsx(N.Item,{label:"è§„åˆ™åç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥è§„åˆ™åç§°"}],children:e.jsx(W,{placeholder:"å¦‚ï¼šä»·æ ¼åˆç†æ€§å®¡æŸ¥"})}),e.jsx(N.Item,{label:"è§„åˆ™æè¿°",name:"description",children:e.jsx(W,{placeholder:"ç®€è¦æè¿°æ­¤è§„åˆ™çš„ç”¨é€”"})}),e.jsx(N.Item,{label:"è§„åˆ™å†…å®¹",name:"content",rules:[{required:!0,message:"è¯·è¾“å…¥è§„åˆ™å†…å®¹"}],tooltip:"è¯¦ç»†çš„å®¡æŸ¥è§„åˆ™è¯´æ˜ï¼Œå°†ç”¨äº AI å®¡æŸ¥æç¤º",children:e.jsx(Se,{rows:6,placeholder:"è¯·è¾“å…¥è¯¦ç»†çš„å®¡æŸ¥è§„åˆ™å†…å®¹ï¼ŒåŒ…æ‹¬å®¡æŸ¥è¦ç‚¹ã€åˆ¤æ–­æ ‡å‡†ç­‰..."})}),e.jsx(N.Item,{label:"ä¼˜å…ˆçº§",name:"priority",tooltip:"æ•°å­—è¶Šå°è¶Šä¼˜å…ˆ",children:e.jsx(W,{type:"number",min:0,max:100,style:{width:"100%"}})}),e.jsx(N.Item,{children:e.jsx(w,{type:"primary",htmlType:"submit",block:!0,children:"åˆ›å»ºè§„åˆ™"})})]})})]})]})};export{Ls as default};
