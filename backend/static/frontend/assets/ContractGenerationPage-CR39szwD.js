import{u as Jt,w as Qt,F as b,r as a,s as l,o as I,j as e,S as m,B as u,b as Xt,A as Yt,D as st,d as g,T as Zt,e as ce,I as N,n as we,i as f,G as Ie,k as de,h as fe,p as me,H as es}from"./index-roHVKWBY.js";import{r as ts}from"./index-xiFjLCgG.js";import{E as ss}from"./EnhancedModuleNavBar-BaLc5GU_.js";import{u as ns}from"./useSessionPersistence-MS_hwzFH.js";import{g as rs,t as Te}from"./websocketService-DBwcnghZ.js";import{A as R,R as os}from"./DownloadOutlined-rr9bHkiC.js";import{S as mt}from"./index-DpzQQA4h.js";import{U as Re}from"./index-CTgI8CvL.js";import{R as is}from"./UploadOutlined-CykSJ8pV.js";import{R as as}from"./SendOutlined-KN9mdme5.js";import{R as ls}from"./react-markdown-laHtMECc.js";import{R as M}from"./CheckCircleOutlined-CAL-yran.js";import{R as cs,C as ds}from"./FileOutlined-CO0RL_5l.js";import{F as nt}from"./Table-C60CrNhX.js";import{R as rt}from"./SyncOutlined-DS1_hfBq.js";import{M as ot}from"./index-C3tIkboq.js";import{D as it}from"./index-DDLkHvOg.js";import{R as at}from"./InfoCircleOutlined-BY0eFwme.js";import{P as lt}from"./progress-tAVtoyWK.js";import{D as Z}from"./index-Dqc-jEZd.js";import{R as ct}from"./index-64Mw5-Gk.js";import{R as dt}from"./CloseCircleOutlined-DkwqTiEK.js";import{R as ms}from"./ClockCircleOutlined-C2t8-iE_.js";import"./ArrowLeftOutlined-BgXNOdqB.js";import"./DiffOutlined-DzrLoxq_.js";import"./PaperClipOutlined-8mdHwa14.js";import"./DeleteOutlined-BTxcvY44.js";import"./useBubbleLock-DlAGXlXo.js";import"./FolderOpenOutlined-6bEiJPwz.js";const{Title:z,Text:d,Paragraph:$}=Zt,{Step:Fe}=mt,{TextArea:pe}=N,{Dragger:ps}=Re,{Option:ue}=fe,Ks=()=>{Jt();const ze=Qt(),[Ne]=b.useForm(),j=a.useRef(!1),D=a.useRef(!1),B=a.useRef(!1),{hasSession:Oe,saveSession:pt,clearSession:Pe,isLoading:ut}=ns("contract_generation_session",{expirationTime:7200*1e3,autoRestore:!1,onRestore:(s,t)=>{if(console.log("[合同生成] 恢复会话:",t),D.current=!0,x(t.step),G(t.userInput||""),E(t.clarificationFormResponse),ee(t.clarificationFormData||{}),U(t.planningModeSelectionVisible||!1),te(t.planningModeOptions),se(t.selectedPlanningMode),O(t.generatedContracts||[]),S(t.editableContent||""),t.selectedContractFilename&&t.generatedContracts&&t.generatedContracts.length>0){const n=t.generatedContracts.find(r=>r.filename===t.selectedContractFilename);n&&C(n)}setTimeout(()=>{j.current=!0,D.current=!1},0)}}),ft=()=>{if(D.current){console.log("[合同生成] 正在恢复会话，跳过保存");return}pt(Date.now().toString(),{step:k,userInput:_,uploadedFiles:W.map(s=>typeof s=="string"?s:s.name?s.name:s.originFileObj?.name?s.originFileObj.name:s.uid||String(s)),clarificationFormResponse:c,clarificationFormData:Q,planningModeSelectionVisible:je,planningModeOptions:_e,selectedPlanningMode:bt,generatedContracts:h,editableContent:q,selectedContractFilename:K?.filename||null})},[k,x]=a.useState(0),[_,G]=a.useState(""),[W,ge]=a.useState([]),[he,Ae]=a.useState(!1),[gt,ht]=a.useState(null),[H,V]=a.useState(!1),[h,O]=a.useState([]),[Me,us]=a.useState(""),[xe,xt]=a.useState("docx"),[c,E]=a.useState(null),[Q,ee]=a.useState({}),[fs,yt]=a.useState(!0),[jt,ye]=a.useState(!1),[T,_t]=a.useState(null),[De,We]=a.useState(!1),[je,U]=a.useState(!1),[_e,te]=a.useState(null),[bt,se]=a.useState(null),[vt,Ee]=a.useState(!1),[gs,kt]=a.useState({}),[be]=b.useForm(),[ve,Le]=a.useState({}),[q,S]=a.useState(""),[K,C]=a.useState(null),[hs,$e]=a.useState(null),[xs,Be]=a.useState(!1),[ne,X]=a.useState(null),[P,ke]=a.useState(null),[w,F]=a.useState("pending"),[Ge,Y]=a.useState(!1),[A,He]=a.useState(null),[Ve,Se]=a.useState(!1),[St,Ue]=a.useState(!1),[y,L]=a.useState(null),[re,qe]=a.useState("new"),[Ke,Ct]=a.useState([]),[Je,Qe]=a.useState(!1),[wt,It]=a.useState(0),oe=a.useMemo(()=>{if(!c?.clarification_form)return null;const s=c.clarification_form;return s.sections&&s.sections.length>0?s:s.questions&&s.questions.length>0?{...s,sections:[{section_id:"main",section_title:"需求澄清",fields:s.questions.map(t=>({field_id:t.id,field_type:t.type,label:t.question,required:t.required,placeholder:t.placeholder||`请输入${t.question}`,default_value:t.default,options:t.options,validation_rules:{}}))}]}:s},[c]);a.useEffect(()=>{if(h.length>0&&!K){const s=h[0];C(s),S(s.content||"")}},[h]),a.useEffect(()=>{if(!(j.current||D.current))if(Oe){console.log("[合同生成] 检测到会话，准备恢复"),D.current=!0;const s=localStorage.getItem("contract_generation_session");if(s)try{const t=JSON.parse(s);if(t.data){if(x(t.data.step||0),G(t.data.userInput||""),E(t.data.clarificationFormResponse),ee(t.data.clarificationFormData||{}),U(t.data.planningModeSelectionVisible||!1),te(t.data.planningModeOptions),se(t.data.selectedPlanningMode),O(t.data.generatedContracts||[]),S(t.data.editableContent||""),t.data.selectedContractFilename&&t.data.generatedContracts&&t.data.generatedContracts.length>0){const n=t.data.generatedContracts.find(r=>r.filename===t.data.selectedContractFilename);n&&C(n)}l.success("已恢复之前的合同生成会话"),setTimeout(()=>{j.current=!0,D.current=!1},100)}}catch(t){console.error("[合同生成] 恢复会话失败:",t),j.current=!0,D.current=!1}else j.current=!0}else j.current=!0},[]),a.useEffect(()=>{const s=ze.state;s?.user_requirement&&(G(s.user_requirement),l.success("已根据您的需求自动填充内容"))},[ze.state]),a.useEffect(()=>{const s=c?.processing_type;if(console.log("[Step 2 Extraction Effect] 触发检查:",{currentStep:k,hasClarificationFormResponse:!!c,processingType:s,hasExtractedInfo:!!y,extractionStarted:B.current}),k!==1||!c){console.log("[Step 2 Extraction Effect] 跳过：不满足触发条件"),k!==1&&(B.current=!1);return}if(s!=="contract_modification"&&s!=="contract_termination"){console.log("[Step 2 Extraction Effect] 跳过：不是变更/解除场景");return}if(B.current&&y){console.log("[Step 2 Extraction Effect] 跳过：已经提取过");return}(async()=>{console.log("[Step 2] 检测到合同变更/解除场景，开始 LLM 提取信息"),B.current=!0,Ue(!0);try{const n=await I.extractModificationTerminationInfo({user_input:_,analysis_result:c});n.data&&n.data.success?(console.log("[Step 2] LLM 提取成功:",n.data.extracted_info),L(n.data.extracted_info),E({...c,extracted_modification_termination_info:n.data.extracted_info}),l.success("AI 已提取相关信息，请确认")):(console.error("[Step 2] LLM 提取失败:",n.data),l.error("信息提取失败，请刷新重试"),B.current=!1)}catch(n){console.error("[Step 2] LLM 提取异常:",n),l.error("信息提取异常，请刷新重试"),B.current=!1}finally{Ue(!1)}})()},[k,c,_]),a.useEffect(()=>{j.current&&!D.current&&!ut&&(k>0||_.trim()||c||h.length>0)&&ft()},[k,_,c,Q,h,q,K]),a.useEffect(()=>{if(ne&&w!=="pending"){const s={taskId:ne,taskStatus:w,taskProgress:P,generatedContracts:h,clarificationFormResponse:c,userInput:_,timestamp:Date.now()};sessionStorage.setItem("contract_gen_task",JSON.stringify(s))}},[ne,w,P,h]),a.useEffect(()=>{const s=sessionStorage.getItem("contract_gen_task");if(s&&!j.current)try{const t=JSON.parse(s),n=7200*1e3;Date.now()-t.timestamp<n?t.taskStatus==="processing"?(X(t.taskId),F(t.taskStatus),ke(t.taskProgress),E(t.clarificationFormResponse),G(t.userInput),x(1),ie(t.taskId),l.info("检测到进行中的任务，正在恢复..."),j.current=!0):t.taskStatus==="completed"?(console.log("[SessionRestore] 检测到已完成的任务，保留作为历史记录:",t.taskId),j.current=!0,X(null),F("pending"),ke(void 0),O([]),E(null),C(null),S("")):(console.log("[SessionRestore] 清除失败/取消的任务缓存:",t.taskStatus),sessionStorage.removeItem("contract_gen_task")):sessionStorage.removeItem("contract_gen_task")}catch(t){console.error("恢复 Celery 任务会话失败:",t),sessionStorage.removeItem("contract_gen_task")}},[]),a.useEffect(()=>{if(w==="failed"||w==="cancelled"){const s=setTimeout(()=>{sessionStorage.removeItem("contract_gen_task"),console.log("[SessionRestore] 已清除失败/取消任务的缓存")},5e3);return()=>clearTimeout(s)}},[w]),a.useEffect(()=>{re==="history"&&Ye()},[re]);const Tt=s=>{const t=h.find(n=>n.filename===s);t&&(C(t),S(t.content||""),$e(null),t.file_generated&&Xe(t.filename))},Xe=async s=>{Be(!0);try{const n=`${s.replace(/\.(docx|pdf)$/i,"")}.docx`,o=(await I.getDocumentPreviewConfig(n)).data;o.config&&o.token?$e({...o.config,token:o.token}):l.warning("无法加载文档预览配置")}catch(t){console.error("加载 OnlyOffice 配置失败:",t),l.error("加载文档预览失败")}finally{Be(!1)}},Ft={name:"files",multiple:!0,fileList:W,accept:".docx,.doc,.pdf,.png,.jpg,.jpeg",beforeUpload:s=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/png","image/jpeg"].includes(s.type)?s.size<=50*1024*1024?!1:(l.error("文件大小不能超过 50MB"),Re.LIST_IGNORE):(l.error("只支持上传 Word、PDF、图片文件"),Re.LIST_IGNORE),onChange:s=>{ge(s.fileList)},onRemove:s=>{const t=W.indexOf(s),n=W.slice();n.splice(t,1),ge(n)}},Ye=async()=>{Qe(!0);try{const s=await I.getContractGenerationTasks({skip:0,limit:20});Ct(s.data.tasks||[]),It(s.data.total||0)}catch(s){console.error("获取历史任务失败:",s),l.error("获取历史任务失败")}finally{Qe(!1)}},Rt=async s=>{if(!_.trim()){l.warning("请输入您的需求描述");return}Ae(!0);try{const t=[];if(W&&Array.isArray(W))for(const i of W){if(!i)continue;let p=null;typeof i=="string"?p=i:typeof i=="object"&&(i.name&&typeof i.name=="string"?p=i.name:i.originFileObj&&i.originFileObj.name&&typeof i.originFileObj.name=="string"?p=i.originFileObj.name:i.response&&i.response.filename&&typeof i.response.filename=="string"&&(p=i.response.filename)),p&&p!=="undefined"&&p!=="[object Object]"&&t.push(p)}const n={user_input:_};t.length>0&&(n.uploaded_files=t);const o=(await I.analyzeAndGetClarificationForm(n)).data;o.success?o.requires_user_choice&&o.user_choice_options?(E(o),te(o.user_choice_options),U(!0),x(1),l.info("检测到您的需求属于合同规划场景，请选择生成模式")):(E(o),U(!1),x(1),l.success("需求分析完成")):l.error(o.error||"需求分析失败")}catch(t){console.error("需求分析失败:",t),l.error(t.response?.data?.detail||"需求分析失败，请重试")}finally{Ae(!1)}},zt=async()=>{try{const s=be.getFieldsValue();kt(s),Ee(!1)}catch(s){console.error("处理失败:",s)}},ie=async s=>{const t=localStorage.getItem("accessToken")||localStorage.getItem("token")||"";if(!t){console.error("[WebSocket] 未找到用户 token"),l.error("未找到登录凭证，请重新登录");return}const n=rs();if(n.isConnected&&n.taskId===s){console.log("[WebSocket] 已连接到任务，无需重连:",s);return}n.isConnected&&(console.log("[WebSocket] 断开旧连接，连接到新任务:",s),Te.disconnect());const r=o=>{console.log("[WebSocket] 进度更新:",o.progress,"%"),ke(o),F(o.status);const i=o.status!=="completed"&&o.status!=="failed"&&o.status!=="cancelled";Y(i)};try{await Te.connect(s,t,{onConnected:()=>{console.log("[WebSocket] 连接成功"),Y(!0),F("processing")},onProgress:r,onCompleted:o=>{if(console.log("[WebSocket] ===== onCompleted 回调被调用 ====="),console.log("[WebSocket] result 参数:",o),console.log("[WebSocket] result.contracts:",o?.contracts),console.log("[WebSocket] result.contracts 是数组?:",Array.isArray(o?.contracts)),Y(!1),F("completed"),o?.contracts&&Array.isArray(o.contracts)){if(console.log("[WebSocket] ✅ contracts 存在且是数组，长度:",o.contracts.length),console.log("[WebSocket] 第一个合同:",o.contracts[0]),O(o.contracts),o.contracts.length>0){const i=o.contracts[0];C(i),S(i.content||""),console.log("[WebSocket] 已设置 editableContent:",i.content?.substring(0,100))}x(2),console.log("[WebSocket] 已设置 currentStep = 2"),l.success(`成功生成 ${o.contracts.length} 份合同`)}else console.error("[WebSocket] ❌ result.contracts 不存在或不是数组"),l.error("任务完成但未返回有效结果")},onError:o=>{console.error("[WebSocket] 错误:",o),Y(!1),F("failed"),l.error(o||"任务执行失败")},onDisconnected:()=>{Y(!1),console.log("[WebSocket] 连接已断开")}})}catch(o){console.error("[WebSocket] 连接失败:",o),F("failed"),l.error("WebSocket 连接失败，请刷新页面重试")}},ae=async(s=!0)=>{if(!c){l.error("缺少分析结果");return}sessionStorage.removeItem("contract_gen_task"),V(!0);try{let t;s?t=await I.generateContractWithFormData({user_input:_,form_data:Q,analysis_result:c.analysis_result,template_match_result:c.template_match_result,knowledge_graph_features:c.knowledge_graph_features,planning_mode:"single_model"}):t=await I.generateContractWithFormData({user_input:_,form_data:Q,analysis_result:c.analysis_result,template_match_result:c.template_match_result,knowledge_graph_features:c.knowledge_graph_features,planning_mode:"multi_model",skip_template:!0});const n=t.data;if(n.task_system==="celery"&&n.task_id){const r=n;X(r.task_id),F("processing"),l.info(r.message||"合同生成任务已提交后台处理，请稍候..."),await ie(r.task_id)}else if(n.task_system==="sync"||!n.task_system){const r=n;if(r.success){if(O(r.contracts||[]),r.contracts&&r.contracts.length>0){const o=r.contracts[0];C(o),S(o.content||"")}x(2),l.success(`成功生成 ${r.contracts?.length||0} 份合同`)}else l.error(r.error||"生成失败")}}catch(t){console.error("生成合同失败:",t),l.error(t.response?.data?.detail||"生成合同失败，请重试")}finally{V(!1)}},Ze=async s=>{se(s),U(!1),Se(!0);try{const t=W.filter(o=>o.originFileObj).map(o=>o.originFileObj),r=(await I.generateContractPlanOnly({user_input:_,planning_mode:s,uploaded_files:t.length>0?t:void 0,session_id:Me||void 0})).data;r.success?(He(r),x(1),l.success("合同规划生成成功")):l.error(r.error||"规划生成失败")}catch(t){console.error("规划生成失败:",t),l.error(t.response?.data?.detail||"规划生成失败，请重试")}finally{Se(!1)}},Nt=async()=>{if(!A){l.error("缺少规划结果");return}V(!0);try{const s=`plan_${Date.now()}`,n=(await I.generateContractsFromPlan({plan_id:s,session_id:Me||void 0})).data;if(n.success)if(n.contracts&&Array.isArray(n.contracts)){if(O(n.contracts),n.contracts.length>0){const r=n.contracts[0];C(r),S(r.content||"")}x(2),l.success(`成功生成 ${n.contracts.length} 份合同`)}else n.task_id&&(X(n.task_id),F("pending"),l.info("合同生成任务已提交后台处理，请稍候..."),await ie(n.task_id));else l.error(n.error||"基于规划生成合同失败")}catch(s){console.error("基于规划生成合同失败:",s),l.error(s.response?.data?.detail||"基于规划生成合同失败，请重试")}finally{V(!1)}},Ot=async()=>{if(!y){l.error("缺少确认信息，请等待信息提取完成");return}sessionStorage.removeItem("contract_gen_task"),V(!0);try{const t=(await I.generateContractWithFormData({user_input:_,form_data:{},analysis_result:c.analysis_result,template_match_result:c.template_match_result,knowledge_graph_features:c.knowledge_graph_features,planning_mode:"single_model",skip_template:!0,confirmed_modification_termination_info:y})).data;if(t.task_system==="celery"&&t.task_id){const n=t;X(n.task_id),F("pending"),l.info("变更/解除协议生成任务已提交后台处理，请稍候..."),await ie(n.task_id)}else{const n=t;if(n.contracts&&Array.isArray(n.contracts)){if(O(n.contracts),n.contracts.length>0){const r=n.contracts[0];C(r),S(r.content||"")}x(2),l.success("变更/解除协议生成成功")}}}catch(s){console.error("生成变更/解除协议失败:",s),l.error(s.response?.data?.detail||"生成失败，请重试")}finally{V(!1)}},Pt=async s=>{We(!0);try{const n=(await I.getTemplatePreview(s)).data;n.success?(_t(n.template),ye(!0)):l.error(n.message||"加载模板失败")}catch(t){console.error("加载模板预览失败:",t),l.error(t.response?.data?.detail||"加载模板预览失败，请重试")}finally{We(!1)}},At=async(s,t)=>{const n=K?.filename===s.filename?q:s.content;if(!n){l.error("没有可用的文本内容");return}Le({...ve,[t]:!0});try{const r=new FormData;r.append("content",n),r.append("filename",s.filename),r.append("doc_type","contract"),r.append("output_format",xe);const i=(await I.generateContractFiles(r)).data;if(i.success){const p=[...h];p[t]={...s,content:n,docx_path:i.docx_path,pdf_path:i.pdf_path,preview_url:i.preview_url,download_docx_url:i.download_docx_url,download_pdf_url:i.download_pdf_url,file_generated:!0},O(p),K?.filename===s.filename&&C(p[t]),l.success("文件生成成功"),await Xe(s.filename)}else l.error(i.message||"文件生成失败")}catch(r){console.error("文件生成失败:",r),l.error(r.response?.data?.detail||"文件生成失败，请重试")}finally{Le({...ve,[t]:!1})}},Mt=async s=>{try{const n=window.location.protocol+"//"+window.location.hostname+":8000"+s.download_docx_url;window.open(n,"_blank"),l.success("开始下载")}catch{l.error("下载失败")}},Dt=()=>{x(0),G(""),ge([]),ht(null),O([]),E(null),ee({}),yt(!0),S(""),C(null),U(!1),te(null),se(null),He(null),Se(!1),be.resetFields(),Ne.resetFields(),Pe()},Wt=()=>e.jsxs(g,{className:"step-card",children:[e.jsx(z,{level:4,children:"1. 描述您的需求"}),e.jsx($,{type:"secondary",children:"请详细描述您需要生成的合同内容，AI 将根据您的需求智能生成合同文档。"}),he&&e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(ce,{tip:"AI 正在分析您的需求，请稍候...",size:"large"}),e.jsx("div",{style:{marginTop:16,color:"#999"},children:"这可能需要几秒钟时间"})]}),e.jsxs(b,{layout:"vertical",style:{display:he?"none":"block"},children:[e.jsx(b.Item,{label:"需求描述",required:!0,children:e.jsx(pe,{value:_,onChange:s=>G(s.target.value),placeholder:"例如：我与另一自然人合资设立一家公司，双方合计出资100万元，我出资75万元持有75%股权，对方出资25万元持有25%股权，请帮我草拟一份股权投资合作协议。",rows:6,showCount:!0,maxLength:2e3})}),e.jsx(b.Item,{label:"上传相关文件（可选）",children:e.jsxs(ps,{...Ft,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(is,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此处"}),e.jsx("p",{className:"ant-upload-hint",children:"支持上传 Word、PDF、图片文件，用于合同变更、解除等场景"})]})}),e.jsx(b.Item,{children:e.jsx(u,{type:"primary",size:"large",icon:e.jsx(as,{}),onClick:()=>Rt(),loading:he,block:!0,children:"分析需求"})})]})]}),Et=()=>c?St?e.jsx(g,{className:"step-card",children:e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px"},children:[e.jsx(ce,{tip:"AI 正在从您的输入中提取关键信息...",size:"large"}),e.jsxs("div",{style:{marginTop:24,color:"#666"},children:[e.jsx("p",{children:"正在分析原合同内容和变更/解除需求"}),e.jsx("p",{style:{fontSize:12,color:"#999"},children:"这可能需要几秒钟时间"})]})]})}):ne&&(w==="processing"||w==="completed"&&h.length===0)?e.jsxs("div",{style:{position:"relative",minHeight:400},children:[e.jsx("div",{style:{filter:"blur(2px)",pointerEvents:"none",opacity:.6},children:et()}),e.jsx("div",{className:"progress-overlay",children:Bt()})]}):et():null,Lt=()=>{if(!y)return null;const s=y,{processing_type:t,original_contract_info:n,confidence:r}=s,o=t==="contract_termination";return e.jsxs("div",{className:"step-card",style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsx(z,{level:4,children:o?"2. 确认解除信息":"2. 确认变更信息"}),r!==void 0&&e.jsx(R,{message:r>=.8?"信息提取准确度高":"请仔细核对以下信息",description:r>=.8?`系统已从您提供的信息中提取出关键内容，准确度 ${(r*100).toFixed(0)}%。请确认无误后点击生成。`:`系统提取的信息准确度 ${(r*100).toFixed(0)}%，建议您仔细核对并修正以下信息。`,type:r>=.8?"success":"warning",showIcon:!0,style:{marginBottom:16}}),e.jsx(g,{title:e.jsxs(e.Fragment,{children:[e.jsx(de,{})," 原合同信息"]}),bordered:!0,style:{background:"#f6ffed"},children:e.jsxs(Z,{bordered:!0,size:"small",column:1,children:[e.jsx(Z.Item,{label:"合同名称",children:n.contract_name||"未识别"}),e.jsx(Z.Item,{label:"签订日期",children:n.signing_date||"未识别"}),e.jsx(Z.Item,{label:"合同期限",children:n.contract_term||"未识别"}),e.jsx(Z.Item,{label:"当事人",children:n.parties?.length>0?n.parties.join("、"):"未识别"})]})}),o?e.jsx(g,{title:e.jsxs(e.Fragment,{children:[e.jsx(we,{})," 解除详情"]}),bordered:!0,style:{background:"#fff7e6"},children:e.jsxs(b,{layout:"vertical",children:[e.jsx(b.Item,{label:"解除原因",children:e.jsx(N.TextArea,{defaultValue:s.termination_reason||"",onChange:i=>{L({...y,termination_reason:i.target.value})},placeholder:"请输入或修改解除原因",rows:3})}),e.jsx(b.Item,{label:e.jsx(d,{strong:!0,children:"解除后安排"}),children:e.jsx(nt,{dataSource:s.post_termination_arrangements&&Object.keys(s.post_termination_arrangements).length>0?Object.entries(s.post_termination_arrangements).map(([i,p])=>({key:i,item:i,detail:p})):[{key:"empty",item:"",detail:""}],columns:[{title:"项目",dataIndex:"item",key:"item",width:"30%",render:(i,p,J)=>e.jsx(N,{defaultValue:i,placeholder:"例如：费用结算",onChange:v=>{const le={...s.post_termination_arrangements||{}};if(p.key==="empty"&&v.target.value)le[`项目${Object.keys(le).length+1}`]=v.target.value,L({...y,post_termination_arrangements:le});else if(p.key!=="empty"){const qt=p.key,Kt=Object.entries(le).map(([Ce,tt])=>Ce===qt?[v.target.value||Ce,tt]:[Ce,tt]);L({...y,post_termination_arrangements:Object.fromEntries(Kt)})}}})},{title:"详情",dataIndex:"detail",key:"detail",render:(i,p)=>e.jsx(N.TextArea,{defaultValue:i,placeholder:"请输入详情",rows:2,onChange:J=>{const v={...s.post_termination_arrangements||{}};p.key==="empty"&&J.target.value?(v[`项目${Object.keys(v).length+1}`]=J.target.value,L({...y,post_termination_arrangements:v})):p.key!=="empty"&&(v[p.key]=J.target.value,L({...y,post_termination_arrangements:v}))}})}],pagination:!1,size:"small",bordered:!0})})]})}):e.jsx(g,{title:e.jsxs(e.Fragment,{children:[e.jsx(we,{})," 变更详情"]}),bordered:!0,style:{background:"#e6f7ff"},children:s.modification_points&&s.modification_points.length>0?e.jsx(m,{direction:"vertical",style:{width:"100%"},size:"middle",children:s.modification_points.map((i,p)=>e.jsx(g,{size:"small",hoverable:!0,children:e.jsxs(m,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsxs(f,{color:"blue",children:["变更点 ",p+1]}),i.clause_number&&e.jsxs(f,{color:"geekblue",children:["条款 ",i.clause_number]})]}),e.jsxs("div",{children:[e.jsx(d,{type:"secondary",children:"原条款："}),e.jsx("div",{style:{padding:8,background:"#f5f5f5",borderRadius:4,marginTop:4,fontFamily:"monospace"},children:i.original_content})]}),e.jsxs("div",{children:[e.jsx(d,{type:"secondary",children:"变更为："}),e.jsx(N.TextArea,{defaultValue:i.modified_content,onChange:J=>{const v=[...y.modification_points];v[p].modified_content=J.target.value,L({...y,modification_points:v})},style:{marginTop:4},rows:3})]}),i.reason&&e.jsx("div",{children:e.jsxs(d,{type:"secondary",children:["变更原因：",i.reason]})})]})},p))}):e.jsx(R,{message:"未检测到具体变更点",description:"系统未能在您的需求中识别出明确的变更条款。您可以继续生成，系统将根据您的整体需求进行推断。",type:"info",showIcon:!0})}),e.jsx(g,{bordered:!1,style:{background:"#fafafa"},children:e.jsxs(m,{children:[e.jsx(u,{onClick:()=>x(0),children:"返回修改需求"}),e.jsxs(u,{type:"primary",size:"large",icon:e.jsx(M,{}),onClick:()=>Ot(),loading:H,children:["确认并生成",o?"解除协议":"变更协议"]})]})})]})},et=()=>{if(!c)return null;const s=c.processing_type;if(console.log("[renderOriginalConfirmContent] 当前场景:",s,{hasExtractedInfo:!!y,hasPlanningModeSelection:je,hasClarificationForm:!!c.clarification_form}),y)return console.log("[renderOriginalConfirmContent] 检测到变更/解除信息，使用专用确认界面"),Lt();if(je&&_e){const{multi_model:n,single_model:r}=_e;return e.jsxs("div",{className:"step-card",style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsx(z,{level:4,children:"2. 选择合同规划生成模式"}),e.jsx(R,{message:"检测到合同规划场景",description:"系统检测到您的需求属于复杂的合同规划场景，可能需要多份合同协同。请选择生成模式：",type:"info",showIcon:!0,style:{marginBottom:24}}),e.jsxs(m,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsx(g,{hoverable:!0,style:{border:n.recommended?"2px solid #1890ff":"1px solid #d9d9d9",background:n.recommended?"#f0f5ff":"#fff"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs(m,{style:{marginBottom:12},children:[e.jsx(z,{level:5,style:{margin:0},children:n.name}),n.recommended&&e.jsx(f,{color:"blue",children:"推荐"}),!n.available&&e.jsx(f,{color:"red",children:"不可用"})]}),e.jsx($,{type:"secondary",style:{marginBottom:16},children:n.description}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(d,{strong:!0,children:"特点："}),e.jsx("ul",{style:{marginTop:8,paddingLeft:20},children:n.features?.map((o,i)=>e.jsx("li",{children:o},i))})]}),e.jsxs(m,{children:[e.jsxs(f,{color:"green",children:["预期质量：",n.expected_quality]}),e.jsxs(f,{color:"orange",children:["处理时间：",n.processing_time]})]})]}),e.jsx(u,{type:n.recommended?"primary":"default",size:"large",disabled:!n.available,onClick:()=>Ze("multi_model"),loading:Ve,children:"选择此模式"})]})}),e.jsx(g,{hoverable:!0,style:{border:r.recommended?"2px solid #1890ff":"1px solid #d9d9d9",background:r.recommended?"#f0f5ff":"#fff"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs(m,{style:{marginBottom:12},children:[e.jsx(z,{level:5,style:{margin:0},children:r.name}),r.recommended&&e.jsx(f,{color:"blue",children:"推荐"})]}),e.jsx($,{type:"secondary",style:{marginBottom:16},children:r.description}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(d,{strong:!0,children:"特点："}),e.jsx("ul",{style:{marginTop:8,paddingLeft:20},children:r.features?.map((o,i)=>e.jsx("li",{children:o},i))})]}),e.jsxs(m,{children:[e.jsxs(f,{color:"green",children:["预期质量：",r.expected_quality]}),e.jsxs(f,{color:"orange",children:["处理时间：",r.processing_time]})]})]}),e.jsx(u,{type:r.recommended?"primary":"default",size:"large",onClick:()=>Ze("single_model"),loading:Ve,children:"选择此模式"})]})})]}),e.jsx(g,{bordered:!1,style:{background:"#fafafa"},children:e.jsx(u,{onClick:()=>x(0),children:"返回修改需求"})})]})}if(A&&c?.processing_type==="contract_planning")return e.jsxs("div",{className:"step-card",style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsx(z,{level:4,children:"2. 查看规划结果"}),e.jsx(R,{message:"规划生成成功",description:"系统已根据您的需求生成合同规划，请查看以下结果。确认后可开始生成具体合同。",type:"success",showIcon:!0,style:{marginBottom:24}}),e.jsx(g,{title:"合同规划清单",extra:e.jsx(f,{color:A.planning_mode==="multi_model"?"gold":"blue",children:A.planning_mode==="multi_model"?"多模型融合":"单模型生成"}),children:e.jsx(m,{direction:"vertical",style:{width:"100%"},size:"middle",children:A.contract_plan?.map((n,r)=>e.jsx(g,{size:"small",hoverable:!0,children:e.jsxs(m,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsxs(m,{children:[e.jsx(f,{color:"blue",children:r+1}),e.jsx(d,{strong:!0,children:n.title}),n.contract_type&&e.jsx(f,{children:n.contract_type}),n.priority&&e.jsxs(f,{color:"geekblue",children:["优先级：",n.priority]})]}),n.purpose&&e.jsx($,{type:"secondary",style:{margin:0},children:n.purpose}),n.parties&&n.parties.length>0&&e.jsxs("div",{children:[e.jsx(d,{type:"secondary",children:"当事人："}),e.jsx(d,{children:n.parties.join("、")})]})]})},n.id||r))})}),A.synthesis_report&&e.jsxs(g,{title:"多模型融合分析",bordered:!1,style:{background:"#f6ffed"},children:[e.jsx($,{type:"secondary",children:A.synthesis_report.fusion_summary}),A.synthesis_report.extracted_strengths?.length>0&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx(d,{strong:!0,children:"优势："}),e.jsx("ul",{style:{marginTop:8,paddingLeft:20},children:A.synthesis_report.extracted_strengths.map((n,r)=>e.jsx("li",{children:n},r))})]})]}),e.jsx(g,{bordered:!1,style:{background:"#fafafa"},children:e.jsxs(m,{children:[e.jsx(u,{onClick:()=>x(0),children:"返回修改需求"}),e.jsx(u,{type:"primary",size:"large",icon:e.jsx(M,{}),onClick:Nt,loading:H,children:"确认并开始生成合同"})]})})]});const{template_match_result:t}=c;return e.jsxs("div",{className:"step-card",style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsx(z,{level:4,children:"2. 确认处理方案并补充信息"}),t&&e.jsxs(g,{className:"template-match-card",bordered:!0,style:{background:t.match_level==="HIGH"?"#f6ffed":"#fffbe6",borderColor:t.match_level==="HIGH"?"#b7eb8f":"#ffe58f"},children:[e.jsxs("div",{className:"match-card-header",children:[e.jsxs(m,{children:[e.jsx(de,{style:{fontSize:20,color:t.match_level==="HIGH"?"#52c41a":"#faad14"}}),e.jsxs("div",{children:[e.jsx(d,{strong:!0,style:{fontSize:16},children:"模板匹配结果"}),e.jsx("br",{}),e.jsx(d,{type:"secondary",style:{fontSize:13},children:t.match_level==="HIGH"?"高度匹配":t.match_level==="STRUCTURAL"?"结构参考":"未找到匹配模板"})]})]}),e.jsxs(m,{children:[e.jsx(f,{color:t.match_level==="HIGH"?"success":"warning",children:t.match_level}),t.template_id&&e.jsx(u,{size:"small",icon:e.jsx(Ie,{}),onClick:()=>Pt(t.template_id),loading:De,children:"预览模板"})]})]}),t.template_name&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx(d,{strong:!0,children:"匹配模板："}),e.jsx(d,{style:{marginLeft:8},children:t.template_name}),t.match_score!==void 0&&e.jsxs(f,{color:"blue",style:{marginLeft:8},children:["相似度: ",(t.match_score*100).toFixed(1),"%"]})]}),t.match_reason&&e.jsx("div",{style:{marginTop:12},children:e.jsxs(d,{type:"secondary",style:{fontSize:13},children:["匹配原因：",t.match_reason]})})]}),(console.log("[renderOriginalConfirmContent] 渲染澄清表单，场景:",s),null),e.jsxs(g,{className:"clarification-form-card",bordered:!0,title:"需求澄清表单",children:[e.jsx(R,{message:"请补充以下信息以生成更准确的合同",description:"标记为红色的字段为必填项，其他为选填项。填写完整信息后，选择是否使用模板生成合同。",type:"info",showIcon:!0,style:{marginBottom:16}}),oe?.sections?Array.isArray(oe.sections)?e.jsx(b,{form:Ne,layout:"vertical",onValuesChange:n=>{ee({...Q,...n})},children:oe?.sections?.map(n=>e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(z,{level:5,style:{marginBottom:16},children:n.section_title}),e.jsx(m,{direction:"vertical",style:{width:"100%"},size:"middle",children:n.fields.map(r=>e.jsx(b.Item,{name:r.field_id,label:e.jsxs(m,{children:[e.jsx(d,{children:r.label}),r.required&&e.jsx(d,{type:"danger",children:" *"}),oe?.summary?.missing_info?.includes(r.label)&&e.jsx(f,{color:"red",children:"缺失"})]}),initialValue:r.default_value,rules:r.required?[{required:!0,message:`请填写${r.label}`}]:[],children:$t(r)},r.field_id))})]},n.section_id))}):e.jsx(R,{message:"数据格式错误",description:"表单数据格式异常，请重新尝试",type:"error"}):e.jsx(R,{message:"表单数据加载中",description:"正在分析您的需求，请稍候...",type:"info"})]}),e.jsx(g,{className:"action-buttons-card",bordered:!1,style:{background:"#fafafa"},children:e.jsxs(m,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx(u,{onClick:()=>x(0),children:"返回修改"}),e.jsx(m,{children:c.processing_type==="contract_planning"?e.jsx(u,{type:"primary",size:"large",icon:e.jsx(M,{}),onClick:()=>ae(!1),loading:H,children:"开始生成合同规划"}):c.processing_type==="contract_modification"||c.processing_type==="contract_termination"?e.jsx(u,{type:"primary",size:"large",icon:e.jsx(M,{}),onClick:()=>ae(!1),loading:H,children:c.processing_type==="contract_modification"?"开始生成变更协议":"开始生成解除协议"}):e.jsxs(e.Fragment,{children:[e.jsx(u,{size:"large",onClick:()=>ae(!1),loading:H,children:"不采用模板生成"}),e.jsx(u,{type:"primary",size:"large",icon:e.jsx(M,{}),onClick:()=>ae(!0),loading:H,disabled:t?.match_level==="NONE",children:"采用模板生成"})]})})]})})]})},$t=s=>{switch(s.field_type){case"text":return e.jsx(N,{placeholder:s.placeholder,maxLength:200});case"textarea":return e.jsx(pe,{placeholder:s.placeholder,rows:4,showCount:!0,maxLength:2e3});case"number":return e.jsx(N,{type:"number",placeholder:s.placeholder});case"date":return e.jsx(N,{type:"date"});case"money":return e.jsx(N,{type:"number",placeholder:s.placeholder||"请输入金额",prefix:"¥",addonAfter:"元"});case"select":return e.jsx(fe,{placeholder:s.placeholder,children:s.options?.map((t,n)=>e.jsx(ue,{value:t.value,children:t.label},t.value??`option-${n}`))});case"radio":return e.jsx(ct.Group,{children:s.options?.map(t=>e.jsx(ct,{value:t.value,children:t.label},t.value))});case"checkbox":return e.jsx(ds.Group,{options:s.options?.map(t=>({label:t.label,value:t.value}))});default:return e.jsx(N,{placeholder:s.placeholder})}},Bt=()=>e.jsx(g,{className:"step-card progress-card",children:e.jsxs("div",{className:"progress-container",children:[e.jsx(z,{level:4,children:"AI 正在生成合同"}),e.jsx("div",{className:"connection-status",children:e.jsx("span",{className:`status-indicator ${Ge?"connected":"disconnected"}`,children:Ge?e.jsxs(e.Fragment,{children:[e.jsx(M,{})," WebSocket 连接正常"]}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{spin:!0})," 连接中..."]})})}),e.jsx(lt,{percent:Math.round(P?.progress||0),status:w==="failed"?"exception":w==="completed"?"success":"active",size:12,strokeColor:{"0%":"#108ee9","100%":"#87d068"}}),P?.currentNode&&e.jsx(R,{message:P.currentNode,description:P.nodeProgress?.[P.currentNode]?.message,type:"info",showIcon:!0,style:{marginTop:16,textAlign:"left"}}),P?.estimatedTimeRemaining&&e.jsxs(d,{type:"secondary",style:{marginTop:16,display:"block"},children:["预计剩余时间: ",Math.ceil(P.estimatedTimeRemaining/60)," 分钟"]}),w==="processing"&&e.jsx($,{type:"secondary",style:{marginTop:16},children:"AI 正在深度分析您的需求并起草合同，这可能需要 1-3 分钟，请耐心等待..."})]})}),Gt=()=>{const s=K||(h.length>0?h[0]:null);return e.jsxs("div",{className:"step-card result-container",children:[e.jsxs("div",{className:"result-split-view",children:[e.jsxs("div",{className:"split-pane edit-pane-container",children:[e.jsxs("div",{className:"pane-header",children:[e.jsxs(m,{children:[e.jsx(we,{}),e.jsx("span",{children:"编辑原始内容"})]}),e.jsx(f,{color:"default",children:"Markdown"})]}),e.jsx("div",{className:"pane-scroll-content",children:e.jsx(pe,{className:"contract-editor-textarea",value:q,onChange:t=>{S(t.target.value),s&&(s.content=t.target.value)},placeholder:"在此处编辑合同内容，右侧将实时预览...",spellCheck:!1})})]}),e.jsxs("div",{className:"split-pane preview-pane-container",children:[e.jsxs("div",{className:"pane-header",children:[e.jsxs(m,{children:[e.jsx(Ie,{}),e.jsx("span",{children:"格式预览"})]}),e.jsx(f,{color:"blue",children:"Markdown 预览"})]}),e.jsx("div",{className:"pane-scroll-content",children:s?e.jsx("div",{className:"markdown-body",children:e.jsx(ls,{remarkPlugins:[ts],children:q||s.content||""})}):e.jsxs("div",{className:"pane-placeholder",children:[e.jsx(de,{style:{fontSize:48,marginBottom:16}}),e.jsx(d,{type:"secondary",children:"暂无预览内容"})]})})]})]}),e.jsxs("div",{className:"result-toolbar",children:[e.jsxs("div",{className:"toolbar-left",children:[e.jsxs("div",{className:"status-capsule",children:[e.jsx(M,{style:{marginRight:6}}),e.jsxs("span",{children:["已生成 ",h.length," 份文档"]})]}),e.jsxs(m,{children:[e.jsx(d,{strong:!0,style:{fontSize:13},children:"输出格式："}),e.jsxs(fe,{value:xe,onChange:xt,style:{width:140},size:"middle",children:[e.jsx(ue,{value:"docx",children:"Word 文档"}),e.jsx(ue,{value:"pdf",children:"PDF 文档"})]})]}),h.length>1&&e.jsxs(m,{children:[e.jsx(d,{strong:!0,style:{fontSize:13},children:"当前文档："}),e.jsx(fe,{value:s?.filename,onChange:Tt,style:{width:240},size:"middle",children:h.map((t,n)=>e.jsx(ue,{value:t.filename,children:t.filename},n))})]}),s?.template_info&&e.jsxs("div",{className:"template-info-text",children:["基于模板：",e.jsx(f,{children:s.template_info.name})]})]}),e.jsxs("div",{className:"toolbar-right",children:[e.jsx(u,{onClick:Dt,children:"放弃并重新开始"}),s?.file_generated&&e.jsxs(u,{icon:e.jsx(os,{}),onClick:()=>Mt(s),children:["下载 ",xe==="pdf"?"PDF":"Word"]}),e.jsx(u,{type:"primary",icon:s?.file_generated?e.jsx(M,{}):e.jsx(cs,{}),onClick:()=>{if(s){const t={...s,content:q},n=h.findIndex(r=>r.filename===s.filename);At(t,n)}},loading:s?ve[h.findIndex(t=>t.filename===s.filename)]:!1,style:{minWidth:120},children:s?.file_generated?"重新生成文件":"确认并生成文件"})]})]})]})},Ht=()=>e.jsx(ot,{title:"模板预览",open:jt,onCancel:()=>ye(!1),footer:[e.jsx(u,{onClick:()=>ye(!1),children:"关闭"},"close")],width:900,children:e.jsx("div",{style:{padding:"16px 0"},children:De?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(ce,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(d,{type:"secondary",children:"正在加载模板内容..."})})]}):T?e.jsxs(e.Fragment,{children:[e.jsx(z,{level:4,children:T.name}),e.jsxs(m,{style:{marginBottom:16},children:[T.category&&e.jsx(f,{color:"blue",children:T.category}),T.subcategory&&e.jsx(f,{color:"cyan",children:T.subcategory})]}),T.description&&e.jsx($,{style:{marginBottom:16},children:T.description}),T.preview_content&&e.jsxs(e.Fragment,{children:[e.jsx(it,{children:"模板内容预览"}),e.jsx("div",{style:{background:"#f5f5f5",padding:16,borderRadius:8,maxHeight:400,overflow:"auto",fontFamily:"monospace",fontSize:13,lineHeight:1.6,whiteSpace:"pre-wrap"},children:T.preview_content}),e.jsx(d,{type:"secondary",style:{fontSize:12,marginTop:8,display:"block"},children:"注：此为模板内容预览（前 2000 字符），生成时将根据您的需求进行调整。"})]})]}):e.jsx("div",{style:{background:"#f5f5f5",padding:16,borderRadius:8,textAlign:"center"},children:e.jsx(d,{type:"secondary",children:"无法加载模板内容"})})})}),Vt=()=>e.jsxs(ot,{title:"补充信息（可选）",open:vt,onOk:zt,onCancel:()=>{Ee(!1),x(1)},width:600,okText:"确认继续",cancelText:"跳过",children:[e.jsx(R,{message:"补充如下信息，生成的合同更准确",description:"如您不补充，AI也可基于当前信息生成合同，但需要您进一步完善合同。以下问题均为选填项。",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(b,{form:be,layout:"vertical",children:gt?.clarification_questions.map((s,t)=>e.jsx(b.Item,{name:`answer_${t}`,label:e.jsxs(m,{children:[e.jsx(d,{children:s}),e.jsx(f,{color:"blue",children:"选填"})]}),tooltip:"此问题为选填，如不填写系统将使用默认处理",children:e.jsx(pe,{rows:3,placeholder:"选填，如不填写将使用默认处理...",style:{backgroundColor:"#fafafa"}})},t))}),e.jsx(it,{}),e.jsx(m,{direction:"vertical",style:{width:"100%"},children:e.jsxs(d,{type:"secondary",style:{fontSize:12},children:[e.jsx(at,{style:{marginRight:4}}),"提示：您可以选择性填写以上问题。未填写的信息将在生成的合同中以占位符或默认条款形式呈现，您可以根据实际情况进行后续修改和完善。"]})})]}),Ut=()=>{const s={completed:{color:"success",icon:e.jsx(M,{}),text:"已完成"},processing:{color:"processing",icon:e.jsx(es,{}),text:"处理中"},pending:{color:"default",icon:e.jsx(ms,{}),text:"待处理"},failed:{color:"error",icon:e.jsx(dt,{}),text:"失败"},cancelled:{color:"warning",icon:e.jsx(dt,{}),text:"已取消"}},t=r=>r?new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",n=[{title:"任务ID",dataIndex:"id",key:"id",width:100,ellipsis:!0,render:r=>e.jsx(me,{title:r,children:e.jsxs(d,{copyable:{text:r},style:{fontSize:12},children:[r.slice(0,8),"..."]})})},{title:"状态",dataIndex:"status",key:"status",width:100,render:r=>{const o=s[r]||s.pending;return e.jsx(f,{color:o.color,icon:o.icon,children:o.text})}},{title:"进度",dataIndex:"progress",key:"progress",width:120,render:r=>e.jsx(lt,{percent:Math.round(r),size:"small",status:r===100?"success":"active"})},{title:"用户需求",dataIndex:"user_input",key:"user_input",ellipsis:!0,render:r=>e.jsx(me,{title:r,children:e.jsx(d,{ellipsis:!0,style:{maxWidth:300},children:r})})},{title:"规划模式",dataIndex:"planning_mode",key:"planning_mode",width:120,render:r=>{if(!r)return"-";const i={single_model:{text:"单模型",color:"blue"},multi_model:{text:"多模型",color:"gold"}}[r];return i?e.jsx(f,{color:i.color,children:i.text}):r}},{title:"创建时间",dataIndex:"created_at",key:"created_at",width:160,render:r=>t(r)},{title:"完成时间",dataIndex:"completed_at",key:"completed_at",width:160,render:r=>t(r)},{title:"操作",key:"action",width:120,fixed:"right",render:(r,o)=>e.jsxs(m,{size:"small",children:[o.status==="completed"&&e.jsx(me,{title:"查看详情",children:e.jsx(u,{type:"link",size:"small",icon:e.jsx(Ie,{}),onClick:()=>{l.info("详情查看功能开发中")}})}),o.status==="failed"&&o.error_message&&e.jsx(me,{title:o.error_message,children:e.jsx(u,{type:"link",size:"small",danger:!0,icon:e.jsx(at,{})})})]})}];return e.jsx("div",{className:"history-tasks-container",children:e.jsx(g,{title:e.jsxs(m,{children:[e.jsx(st,{}),e.jsx("span",{children:"历史任务记录"})]}),extra:e.jsxs(m,{children:[e.jsxs(d,{type:"secondary",children:["共 ",wt," 条记录"]}),e.jsx(u,{icon:e.jsx(rt,{}),onClick:Ye,loading:Je,children:"刷新"})]}),children:Je?e.jsx("div",{style:{textAlign:"center",padding:"60px 0"},children:e.jsx(ce,{tip:"加载中...",size:"large"})}):Ke.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px"},children:[e.jsx(de,{style:{fontSize:64,color:"#d9d9d9",marginBottom:16}}),e.jsx(d,{type:"secondary",style:{fontSize:16},children:"暂无历史任务记录"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(u,{type:"primary",onClick:()=>qe("new"),children:"开始创建合同"})})]}):e.jsx(nt,{columns:n,dataSource:Ke,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:r=>`共 ${r} 条记录`},scroll:{x:1200}})})})};return a.useEffect(()=>()=>{Te.disconnect(),console.log("[WebSocket] 组件卸载，已断开连接")},[]),e.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"#f0f2f5"},children:[e.jsx(ss,{currentModuleKey:"contract-generation"}),e.jsxs("div",{style:{flex:1,padding:"24px",maxWidth:1400,margin:"0 auto",width:"100%"},children:[re==="new"&&Oe&&!j.current&&e.jsx(R,{message:"检测到之前的会话",description:"系统检测到您之前有一个未完成的合同生成任务。您可以继续之前的工作，或者点击下方按钮重新开始。",type:"info",showIcon:!0,closable:!0,style:{marginBottom:24},action:e.jsxs(m,{children:[e.jsx(u,{size:"small",onClick:()=>{Pe(),j.current=!0},children:"重新开始"}),e.jsx(u,{type:"primary",size:"small",onClick:()=>{j.current=!1},children:"恢复会话"})]})}),e.jsx(Xt,{activeKey:re,onChange:qe,style:{marginBottom:24},items:[{key:"new",label:e.jsxs("span",{children:[e.jsx(Yt,{}),"新建合同"]}),children:e.jsxs(e.Fragment,{children:[e.jsxs(mt,{current:k,style:{marginBottom:32,maxWidth:800,margin:"0 auto 32px"},children:[e.jsx(Fe,{title:"输入需求",description:"描述您的合同需求"}),e.jsx(Fe,{title:"确认方案",description:"查看匹配并补充信息"}),e.jsx(Fe,{title:"生成完成",description:"获取合同文档"})]}),k===0&&Wt(),k===1&&Et(),k===2&&Gt()]})},{key:"history",label:e.jsxs("span",{children:[e.jsx(st,{}),"历史记录"]}),children:Ut()}]}),Ht(),Vt()]})]})};export{Ks as default};
