import{r as o,z as Ye,_ as Ee,R as I,P as Ne,ah as me,aa as et,ac as pe,ab as Ae,ad as Ve,aN as tt,J as rt,K as at,L as nt,M as st,U as ot,ak as lt,p as H,x as it,u as ct,w as dt,F as X,s as $,j as e,S as N,B as R,b as Ze,I as Oe,q as ut,t as Ke,h as ge,aD as He,bv as ft,d as xe,k as Ie,T as ht,c as pt,C as Ue,e as xt,i as A,o as yt,G as Me,n as Le,av as mt}from"./index-roHVKWBY.js";import{E as gt}from"./EnhancedModuleNavBar-BaLc5GU_.js";import{c as le}from"./contractTemplates-BSuzG2PW.js";import{u as qe}from"./useSessionPersistence-MS_hwzFH.js";import{R as vt}from"./CloudUploadOutlined-CFdQwEX_.js";import{A as We,R as ye}from"./DownloadOutlined-rr9bHkiC.js";import{M as Ge}from"./index-C3tIkboq.js";import{U as jt}from"./index-CTgI8CvL.js";import{R as wt}from"./InboxOutlined-C_zOUenq.js";import{S as bt}from"./index-C4rn-wAu.js";import{F as St}from"./Table-C60CrNhX.js";import"./ArrowLeftOutlined-BgXNOdqB.js";import"./DiffOutlined-DzrLoxq_.js";import"./PaperClipOutlined-8mdHwa14.js";import"./DeleteOutlined-BTxcvY44.js";import"./progress-tAVtoyWK.js";import"./FileOutlined-CO0RL_5l.js";import"./useBubbleLock-DlAGXlXo.js";import"./index-64Mw5-Gk.js";import"./FolderOpenOutlined-6bEiJPwz.js";var Ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"},Rt=function(s,l){return o.createElement(Ye,Ee({},s,{ref:l,icon:Ct}))},It=o.forwardRef(Rt);function _t(t,s){var l=t.disabled,n=t.prefixCls,c=t.character,u=t.characterRender,f=t.index,V=t.count,p=t.value,K=t.allowHalf,b=t.focused,M=t.onHover,B=t.onClick,y=function(h){M(h,f)},U=function(h){B(h,f)},q=function(h){h.keyCode===me.ENTER&&B(h,f)},L=f+1,g=new Set([n]);p===0&&f===0&&b?g.add("".concat(n,"-focused")):K&&p+.5>=L&&p<L?(g.add("".concat(n,"-half")),g.add("".concat(n,"-active")),b&&g.add("".concat(n,"-focused"))):(L<=p?g.add("".concat(n,"-full")):g.add("".concat(n,"-zero")),L===p&&b&&g.add("".concat(n,"-focused")));var x=typeof c=="function"?c(t):c,v=I.createElement("li",{className:Ne(Array.from(g)),ref:s},I.createElement("div",{onClick:l?null:U,onKeyDown:l?null:q,onMouseMove:l?null:y,role:"radio","aria-checked":p>f?"true":"false","aria-posinset":f+1,"aria-setsize":V,tabIndex:l?-1:0},I.createElement("div",{className:"".concat(n,"-first")},x),I.createElement("div",{className:"".concat(n,"-second")},x)));return u&&(v=u(v,t)),v}const kt=I.forwardRef(_t);function Tt(){var t=o.useRef({});function s(n){return t.current[n]}function l(n){return function(c){t.current[n]=c}}return[s,l]}function zt(t){var s=t.pageXOffset,l="scrollLeft";if(typeof s!="number"){var n=t.document;s=n.documentElement[l],typeof s!="number"&&(s=n.body[l])}return s}function $t(t){var s,l,n=t.ownerDocument,c=n.body,u=n&&n.documentElement,f=t.getBoundingClientRect();return s=f.left,l=f.top,s-=u.clientLeft||c.clientLeft||0,l-=u.clientTop||c.clientTop||0,{left:s,top:l}}function Ht(t){var s=$t(t),l=t.ownerDocument,n=l.defaultView||l.parentWindow;return s.left+=zt(n),s.left}var Mt=["prefixCls","className","defaultValue","value","count","allowHalf","allowClear","keyboard","character","characterRender","disabled","direction","tabIndex","autoFocus","onHoverChange","onChange","onFocus","onBlur","onKeyDown","onMouseLeave"];function Lt(t,s){var l=t.prefixCls,n=l===void 0?"rc-rate":l,c=t.className,u=t.defaultValue,f=t.value,V=t.count,p=V===void 0?5:V,K=t.allowHalf,b=K===void 0?!1:K,M=t.allowClear,B=M===void 0?!0:M,y=t.keyboard,U=y===void 0?!0:y,q=t.character,L=q===void 0?"★":q,g=t.characterRender,x=t.disabled,v=t.direction,S=v===void 0?"ltr":v,h=t.tabIndex,Y=h===void 0?0:h,te=t.autoFocus,F=t.onHoverChange,W=t.onChange,Z=t.onFocus,re=t.onBlur,ie=t.onKeyDown,ae=t.onMouseLeave,_e=et(t,Mt),ve=Tt(),ne=pe(ve,2),ee=ne[0],O=ne[1],D=I.useRef(null),k=function(){if(!x){var i;(i=D.current)===null||i===void 0||i.focus()}};I.useImperativeHandle(s,function(){return{focus:k,blur:function(){if(!x){var i;(i=D.current)===null||i===void 0||i.blur()}}}});var G=Ae(u||0,{value:f}),je=pe(G,2),j=je[0],ke=je[1],we=Ae(null),se=pe(we,2),Te=se[0],Q=se[1],E=function(i,z){var m=S==="rtl",_=i+1;if(b){var Be=ee(i),De=Ht(Be),Pe=Be.clientWidth;(m&&z-De>Pe/2||!m&&z-De<Pe/2)&&(_-=.5)}return _},P=function(i){ke(i),W?.(i)},ze=I.useState(!1),ce=pe(ze,2),$e=ce[0],oe=ce[1],de=function(){oe(!0),Z?.()},ue=function(){oe(!1),re?.()},fe=I.useState(null),be=pe(fe,2),Se=be[0],he=be[1],Ce=function(i,z){var m=E(z,i.pageX);m!==Te&&(he(m),Q(null)),F?.(m)},Re=function(i){x||(he(null),Q(null),F?.(void 0)),i&&ae?.(i)},r=function(i,z){var m=E(z,i.pageX),_=!1;B&&(_=m===j),Re(),P(_?0:m),Q(_?m:null)},a=function(i){var z=i.keyCode,m=S==="rtl",_=b?.5:1;U&&(z===me.RIGHT&&j<p&&!m?(P(j+_),i.preventDefault()):z===me.LEFT&&j>0&&!m||z===me.RIGHT&&j>0&&m?(P(j-_),i.preventDefault()):z===me.LEFT&&j<p&&m&&(P(j+_),i.preventDefault())),ie?.(i)};I.useEffect(function(){te&&!x&&k()},[]);var d=new Array(p).fill(0).map(function(C,i){return I.createElement(kt,{ref:O(i),index:i,count:p,disabled:x,prefixCls:"".concat(n,"-star"),allowHalf:b,value:Se===null?j:Se,onClick:r,onHover:Ce,key:C||i,character:L,characterRender:g,focused:$e})}),T=Ne(n,c,Ve(Ve({},"".concat(n,"-disabled"),x),"".concat(n,"-rtl"),S==="rtl"));return I.createElement("ul",Ee({className:T,onMouseLeave:Re,tabIndex:x?-1:Y,onFocus:x?null:de,onBlur:x?null:ue,onKeyDown:x?null:a,ref:D},tt(_e,{aria:!0,data:!0,attr:!0})),d)}const Ft=I.forwardRef(Lt),Ot=t=>{const{componentCls:s}=t;return{[`${s}-star`]:{position:"relative",display:"inline-block",color:"inherit",cursor:"pointer","&:not(:last-child)":{marginInlineEnd:t.marginXS},"> div":{transition:`all ${t.motionDurationMid}, outline 0s`,"&:hover":{transform:t.starHoverScale},"&:focus":{outline:0},"&:focus-visible":{outline:`${st(t.lineWidth)} dashed ${t.starColor}`,transform:t.starHoverScale}},"&-first, &-second":{color:t.starBg,transition:`all ${t.motionDurationMid}`,userSelect:"none"},"&-first":{position:"absolute",top:0,insetInlineStart:0,width:"50%",height:"100%",overflow:"hidden",opacity:0},[`&-half ${s}-star-first, &-half ${s}-star-second`]:{opacity:1},[`&-half ${s}-star-first, &-full ${s}-star-second`]:{color:"inherit"}}}},Et=t=>({[`&-rtl${t.componentCls}`]:{direction:"rtl"}}),Nt=t=>{const{componentCls:s}=t;return{[s]:Object.assign(Object.assign(Object.assign(Object.assign({},nt(t)),{display:"inline-block",margin:0,padding:0,color:t.starColor,fontSize:t.starSize,lineHeight:1,listStyle:"none",outline:"none",[`&-disabled${s} ${s}-star`]:{cursor:"default","> div:hover":{transform:"scale(1)"}}}),Ot(t)),Et(t))}},Bt=t=>({starColor:t.yellow6,starSize:t.controlHeightLG*.5,starHoverScale:"scale(1.1)",starBg:t.colorFillContent}),Dt=rt("Rate",t=>{const s=at(t,{});return Nt(s)},Bt);var Pt=function(t,s){var l={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&s.indexOf(n)<0&&(l[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(t);c<n.length;c++)s.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(t,n[c])&&(l[n[c]]=t[n[c]]);return l};const Qe=o.forwardRef((t,s)=>{const{prefixCls:l,className:n,rootClassName:c,style:u,tooltips:f,character:V=o.createElement(It,null),disabled:p}=t,K=Pt(t,["prefixCls","className","rootClassName","style","tooltips","character","disabled"]),b=(h,{index:Y})=>f?o.createElement(H,{title:f[Y]},h):h,{getPrefixCls:M,direction:B,rate:y}=o.useContext(ot),U=M("rate",l),[q,L,g]=Dt(U),x=Object.assign(Object.assign({},y?.style),u),v=o.useContext(lt),S=p??v;return q(o.createElement(Ft,Object.assign({ref:s,character:V,characterRender:b,disabled:S},K,{className:Ne(n,c,L,g,y?.className),style:x,prefixCls:U,direction:B})))});var At={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},Vt=function(s,l){return o.createElement(Ye,Ee({},s,{ref:l,icon:At}))},Xe=o.forwardRef(Vt);const{Header:hr,Content:pr}=mt,{Title:Je,Text:w,Paragraph:Kt}=ht,{TabPane:Fe}=Ze,{Search:Ut}=Oe,{Option:J}=ge,{Dragger:qt}=jt,xr=()=>{const{user:t,logout:s}=it(),l=ct(),n=dt(),c=o.useRef(!1),u=o.useRef(!1),{hasSession:f,saveSession:V,clearSession:p,isLoading:K}=qe("contract_page_session",{expirationTime:7200*1e3,autoRestore:!1,onRestore:(r,a)=>{console.log("[合同模板页] 恢复会话:",a),u.current=!0,D(a.activeTab||"query"),F(a.selectedCategory),Z(a.sortBy||"created_at"),S(a.currentPage||1),Y(a.pageSize||12),G(a.viewMode||"card"),a.searchQuery&&(ee(a.hasSearched),a.hasSearched&&de(a.searchQuery)),setTimeout(()=>{c.current=!0,u.current=!1},0)}}),b=r=>{if(u.current){console.log("[合同模板页] 正在恢复会话，跳过保存");return}V(Date.now().toString(),{activeTab:O,selectedCategory:te,sortBy:W,currentPage:v,pageSize:h,viewMode:k,searchQuery:r||"",hasSearched:ne})},[M,B]=o.useState(!1),[y,U]=o.useState([]),[q,L]=o.useState([]),[g,x]=o.useState(0),[v,S]=o.useState(1),[h,Y]=o.useState(12),[te,F]=o.useState(),[W,Z]=o.useState("created_at"),[re]=o.useState("desc"),[ie,ae]=o.useState(!1),[_e,ve]=o.useState([]),[ne,ee]=o.useState(!1),[O,D]=o.useState("query"),[k,G]=o.useState("card"),[je,j]=o.useState(!1),[ke,we]=o.useState(!1),[se]=X.useForm(),[Te,Q]=o.useState(!1),[E,P]=o.useState(null),[ze,ce]=o.useState(!1);o.useEffect(()=>{(n.state||{}).action==="generate"&&D("generate"),$e()},[n.state]),o.useEffect(()=>{if(!(c.current||u.current))if(f){console.log("[合同模板页] 检测到会话，准备恢复"),u.current=!0;const r=localStorage.getItem("contract_page_session");if(r)try{const a=JSON.parse(r),{onRestore:d}=qe.restore?.cache?.get("contract_page_session")||{};a.data&&(D(a.data.activeTab||"query"),F(a.data.selectedCategory),Z(a.data.sortBy||"created_at"),S(a.data.currentPage||1),Y(a.data.pageSize||12),G(a.data.viewMode||"card"),a.data.searchQuery&&(ee(a.data.hasSearched),a.data.hasSearched&&de(a.data.searchQuery)),$.success("已恢复之前的浏览状态"),setTimeout(()=>{c.current=!0,u.current=!1},100))}catch(a){console.error("[合同模板页] 恢复会话失败:",a),c.current=!0,u.current=!1}else c.current=!0}else c.current=!0},[]),o.useEffect(()=>{(O==="query"||O==="my-templates")&&oe()},[v,h,te,W,re,O]),o.useEffect(()=>{c.current&&!u.current&&!K&&b()},[O,te,W,v,h,k,ne]);const $e=async()=>{try{const r=await le.getCategoryTree(!0),a=new Map;r.forEach(T=>{T.name&&a.set(T.name,(a.get(T.name)||0)+1)});const d=Array.from(a.entries()).map(([T,C])=>({category:T,count:C}));L(d)}catch(r){console.error("加载分类失败:",r)}},oe=async()=>{B(!0);try{const a={page:v,page_size:h,category:te,sort_by:W,sort_order:re,scope:O==="my-templates"?"my":"public"},d=await le.getTemplates(a);U(d.templates),x(d.total_count)}catch(r){console.error("加载模板失败:",r),$.error("加载列表失败")}finally{B(!1)}},de=async r=>{if(!r.trim()){ee(!1),ve([]),b("");return}ae(!0),ee(!0);try{const a=await le.searchTemplates({query:r.trim()});ve(a.templates),b(r),a.templates.length===0&&$.info("未找到相关模板")}catch(a){console.error("搜索失败:",a),$.error("搜索服务暂时不可用")}finally{ae(!1)}},ue=async r=>{try{await le.downloadTemplate(r.id),$.success(`开始下载: ${r.name}`)}catch(a){console.error("下载失败:",a),$.error("下载失败")}},fe=async r=>{ce(!0),Q(!0),P(null);try{const a=await le.getTemplatePreview(r.id);P({name:r.name,content:a.content,file_type:a.file_type})}catch(a){console.error("预览失败:",a),a.response?.data?.detail?P({name:r.name,content:a.response.data.detail,file_type:"unknown"}):($.error("预览失败"),Q(!1))}finally{ce(!1)}},be=async(r,a)=>{try{await le.rateTemplate(r,a),$.success("评分成功"),oe()}catch{$.error("评分失败")}},Se=async()=>{try{const r=await se.validateFields();we(!0);const a=new FormData;a.append("name",r.name),a.append("category",r.category),a.append("description",r.description||""),a.append("is_public",r.is_public?"true":"false"),r.keywords&&a.append("keywords",r.keywords.join(",")),r.file&&r.file.length>0&&a.append("file",r.file[0].originFileObj),await yt.uploadTemplate(a),$.success("上传成功！"),j(!1),se.resetFields(),O!=="my-templates"?D("my-templates"):oe()}catch(r){console.error(r),$.error("上传失败")}finally{we(!1)}},he=r=>{const a=t?.is_admin||!1,d=[e.jsx(H,{title:"下载",children:e.jsx(ye,{onClick:()=>ue(r)},"download")},"download-tip"),e.jsx(H,{title:"预览",children:e.jsx(Me,{onClick:()=>fe(r)},"view")},"view-tip")];return a&&d.push(e.jsx(H,{title:"编辑",children:e.jsx(Le,{onClick:()=>l(`/contract/${r.id}/edit`)},"edit")},"edit-tip")),d.push(e.jsx(Qe,{disabled:r.rating_count>0,defaultValue:r.rating,style:{fontSize:12},onChange:T=>be(r.id,T)},"rate")),e.jsx(xe,{hoverable:!0,className:"template-card",cover:e.jsx("div",{className:"template-preview-placeholder",style:{height:160,background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ie,{style:{fontSize:48,color:"#1890ff"}})}),actions:d,children:e.jsx(xe.Meta,{title:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.name}),r.is_public?e.jsx(A,{color:"green",children:"公开"}):e.jsx(A,{color:"orange",children:"私有"})]}),description:e.jsxs("div",{children:[e.jsx(w,{type:"secondary",style:{fontSize:12},ellipsis:!0,children:r.description||"暂无描述"}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(A,{color:"blue",children:r.category}),e.jsxs("span",{style:{fontSize:12,color:"#999",marginLeft:8},children:[e.jsx(ye,{})," ",r.download_count]})]})]})})},r.id)},Ce=()=>{const r=[{title:"模板名称",dataIndex:"name",key:"name",width:"25%",render:(a,d)=>e.jsxs(N,{children:[e.jsx(w,{strong:!0,ellipsis:{tooltip:a},style:{maxWidth:200},children:a}),d.is_public?e.jsx(A,{color:"green",children:"公开"}):e.jsx(A,{color:"orange",children:"私有"})]})},{title:"分类",dataIndex:"category",key:"category",width:"10%",render:a=>e.jsx(A,{color:"blue",children:a})},{title:"描述",dataIndex:"description",key:"description",width:"25%",render:a=>e.jsx(w,{type:"secondary",ellipsis:{tooltip:a||"暂无描述"},children:a||"暂无描述"})},{title:"评分",dataIndex:"rating",key:"rating",width:"10%",render:(a,d)=>e.jsxs(N,{children:[e.jsx(Qe,{disabled:!0,defaultValue:a,style:{fontSize:12}}),e.jsxs(w,{type:"secondary",style:{fontSize:12},children:["(",d.rating_count||0,")"]})]})},{title:"下载次数",dataIndex:"download_count",key:"download_count",width:"10%",render:a=>e.jsxs(w,{children:[e.jsx(ye,{})," ",a]})},{title:"操作",key:"action",width:"20%",render:(a,d)=>{const T=t?.is_admin||!1;return e.jsxs(N,{size:"small",children:[e.jsx(H,{title:"下载",children:e.jsx(R,{type:"text",icon:e.jsx(ye,{}),onClick:()=>ue(d)})}),e.jsx(H,{title:"预览",children:e.jsx(R,{type:"text",icon:e.jsx(Me,{}),onClick:()=>fe(d)})}),T&&e.jsx(H,{title:"编辑",children:e.jsx(R,{type:"text",icon:e.jsx(Le,{}),onClick:()=>l(`/contract/${d.id}/edit`)})})]})}}];return e.jsx(St,{columns:r,dataSource:y,loading:M,rowKey:"id",pagination:!1,size:"middle"})},Re=r=>{const a=t?.is_admin||!1,d=[e.jsx(H,{title:"下载",children:e.jsx(ye,{onClick:()=>ue(r)},"download")},"download-tip"),e.jsx(H,{title:"预览",children:e.jsx(Me,{onClick:()=>fe(r)},"view")},"view-tip")];return a&&d.push(e.jsx(H,{title:"编辑",children:e.jsx(Le,{onClick:()=>l(`/contract/${r.id}/edit`)},"edit")},"edit-tip")),d.push(e.jsx(H,{title:"匹配度",children:e.jsxs("span",{style:{fontSize:12,color:"#52c41a"},children:[(r.final_score*100).toFixed(0),"%"]})},"score")),e.jsx(xe,{hoverable:!0,className:"template-card",cover:e.jsx("div",{className:"template-preview-placeholder",style:{height:160,background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ie,{style:{fontSize:48,color:"#1890ff"}})}),actions:d,children:e.jsx(xe.Meta,{title:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.name}),e.jsx(A,{color:"purple",children:"智能"})]}),description:e.jsxs("div",{children:[e.jsx(w,{type:"secondary",style:{fontSize:12},ellipsis:!0,children:r.description||"暂无描述"}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(A,{color:"blue",children:r.category}),r.subcategory&&e.jsx(A,{color:"cyan",children:r.subcategory}),r.match_reason&&e.jsx("div",{style:{marginTop:4,fontSize:11,color:"#52c41a"},children:r.match_reason})]})]})})},r.id)};return e.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"#f0f2f5"},children:[e.jsx(gt,{currentModuleKey:"template-search",extra:e.jsxs(N,{children:[e.jsx(R,{type:"primary",icon:e.jsx(vt,{}),onClick:()=>j(!0),children:"上传模板"}),e.jsx(R,{onClick:s,children:"退出"})]})}),e.jsxs("div",{style:{flex:1,padding:"24px",maxWidth:1400,margin:"0 auto",width:"100%"},children:[f&&!c.current&&e.jsx(We,{message:"发现未完成的浏览会话",description:"您上次浏览的模板状态已保存，是否恢复？",type:"info",showIcon:!0,closable:!0,action:e.jsxs(N,{children:[e.jsx(R,{size:"small",onClick:()=>{p(),c.current=!0},children:"忽略"}),e.jsx(R,{type:"primary",size:"small",onClick:()=>{c.current=!1},children:"恢复会话"})]}),style:{marginBottom:16}}),e.jsxs(Ze,{activeKey:O,onChange:D,type:"card",children:[e.jsxs(Fe,{tab:"模板广场",children:[e.jsxs("div",{style:{marginBottom:24,background:"#fff",padding:24,borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(Ut,{placeholder:"输入关键词，AI 智能匹配...",enterButton:e.jsx(ut,{}),size:"large",loading:ie,onSearch:de,onChange:r=>!r.target.value&&ee(!1),style:{maxWidth:600,marginBottom:0}}),e.jsxs(N,{children:[e.jsx(R,{type:k==="card"?"primary":"default",icon:e.jsx(Ke,{}),onClick:()=>G("card"),children:"卡片"}),e.jsx(R,{type:k==="list"?"primary":"default",icon:e.jsx(Xe,{}),onClick:()=>G("list"),children:"列表"})]})]}),e.jsxs(N,{wrap:!0,children:[e.jsx(ge,{placeholder:"选择分类",allowClear:!0,onChange:r=>{F(r),S(1)},style:{width:150},children:q.map(r=>e.jsxs(J,{value:r.category,children:[r.category," (",r.count,")"]},r.category))}),e.jsxs(ge,{defaultValue:"created_at",onChange:r=>Z(r),style:{width:120},children:[e.jsx(J,{value:"created_at",children:"最新上传"}),e.jsx(J,{value:"download_count",children:"下载最多"}),e.jsx(J,{value:"rating",children:"评分最高"})]})]})]}),ne?e.jsx(He,{grid:{gutter:16,xs:1,sm:2,md:3,lg:4},dataSource:_e,renderItem:Re}):e.jsxs(e.Fragment,{children:[k==="card"?e.jsx(He,{grid:{gutter:16,xs:1,sm:2,md:3,lg:4},dataSource:y,loading:M,renderItem:he}):Ce(),e.jsx("div",{style:{textAlign:"center",marginTop:24},children:e.jsx(ft,{current:v,total:g,pageSize:h,onChange:(r,a)=>{S(r),a&&Y(a)}})})]})]},"query"),e.jsx(Fe,{tab:"智能生成",children:e.jsx("div",{style:{padding:"20px 0"},children:e.jsxs(xe,{hoverable:!0,onClick:()=>l("/contract-generation"),style:{textAlign:"center",padding:40,cursor:"pointer",transition:"all 0.3s ease",border:"2px solid #1890ff"},styles:{body:{padding:40}},children:[e.jsx(Ie,{style:{fontSize:64,color:"#1890ff",marginBottom:20,display:"block"}}),e.jsx(Je,{level:3,style:{color:"#1890ff",marginBottom:12},children:"智能合同生成"}),e.jsx(Kt,{type:"secondary",style:{fontSize:16,marginBottom:24},children:"AI 驱动的智能合同生成工具，支持单一合同、合同变更、合同解除等多种场景"}),e.jsxs(N,{direction:"vertical",size:"small",style:{width:"100%",maxWidth:400,margin:"0 auto"},children:[e.jsxs("div",{style:{textAlign:"left",background:"#f5f5f5",padding:"12px 16px",borderRadius:8},children:[e.jsx(w,{strong:!0,children:"✓ 智能需求分析"}),e.jsx("br",{}),e.jsx(w,{type:"secondary",style:{fontSize:12},children:"AI 自动理解您的合同需求"})]}),e.jsxs("div",{style:{textAlign:"left",background:"#f5f5f5",padding:"12px 16px",borderRadius:8},children:[e.jsx(w,{strong:!0,children:"✓ 多种合同类型"}),e.jsx("br",{}),e.jsx(w,{type:"secondary",style:{fontSize:12},children:"支持单一合同、合同变更、解除、规划等"})]}),e.jsxs("div",{style:{textAlign:"left",background:"#f5f5f5",padding:"12px 16px",borderRadius:8},children:[e.jsx(w,{strong:!0,children:"✓ 基于 RAG 模板库"}),e.jsx("br",{}),e.jsx(w,{type:"secondary",style:{fontSize:12},children:"从 450+ 专业合同模板中智能检索"})]})]}),e.jsx(R,{type:"primary",size:"large",icon:e.jsx(Ie,{}),style:{marginTop:24},onClick:r=>{r.stopPropagation(),l("/contract-generation")},children:"开始生成合同"})]})})},"generate"),e.jsxs(Fe,{tab:"我的模板",children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(w,{type:"secondary",children:"这里显示您上传的所有模板（包含公开和私有）。"}),e.jsxs(N,{children:[e.jsx(R,{type:k==="card"?"primary":"default",icon:e.jsx(Ke,{}),onClick:()=>G("card"),size:"small",children:"卡片"}),e.jsx(R,{type:k==="list"?"primary":"default",icon:e.jsx(Xe,{}),onClick:()=>G("list"),size:"small",children:"列表"})]})]}),k==="card"?e.jsx(He,{grid:{gutter:16,xs:1,sm:2,md:3,lg:4},dataSource:y,loading:M,renderItem:he}):Ce()]},"my-templates")]})]}),e.jsx(Ge,{title:"上传合同模板",open:je,onCancel:()=>j(!1),onOk:Se,confirmLoading:ke,children:e.jsxs(X,{form:se,layout:"vertical",children:[e.jsx(X.Item,{name:"file",label:"文件",rules:[{required:!0}],valuePropName:"fileList",getValueFromEvent:r=>Array.isArray(r)?r:r?.fileList,children:e.jsxs(qt,{maxCount:1,accept:".docx,.doc,.pdf",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(wt,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此处"})]})}),e.jsxs(pt,{gutter:16,children:[e.jsx(Ue,{span:12,children:e.jsx(X.Item,{name:"name",label:"名称",rules:[{required:!0}],children:e.jsx(Oe,{})})}),e.jsx(Ue,{span:12,children:e.jsx(X.Item,{name:"category",label:"分类",rules:[{required:!0}],children:e.jsxs(ge,{children:[e.jsx(J,{value:"劳动人事",children:"劳动人事"}),e.jsx(J,{value:"房屋租赁",children:"房屋租赁"}),e.jsx(J,{value:"商务合作",children:"商务合作"}),e.jsx(J,{value:"其他",children:"其他"})]})})})]}),e.jsx(X.Item,{name:"keywords",label:"关键词",children:e.jsx(ge,{mode:"tags",placeholder:"输入关键词按回车"})}),e.jsx(X.Item,{name:"description",label:"描述",children:e.jsx(Oe.TextArea,{rows:2})}),t?.is_admin&&e.jsx(X.Item,{name:"is_public",label:"公开设置",valuePropName:"checked",children:e.jsx(bt,{checkedChildren:"公开",unCheckedChildren:"私有"})})]})}),e.jsx(Ge,{title:e.jsx(Je,{level:4,style:{margin:0},children:E?.name||"模板预览"}),open:Te,onCancel:()=>Q(!1),footer:[e.jsx(R,{onClick:()=>Q(!1),children:"关闭"},"close")],width:800,style:{top:20},children:ze?e.jsx("div",{style:{textAlign:"center",padding:"40px"},children:e.jsx(xt,{size:"large",tip:"加载预览内容..."})}):E?e.jsxs("div",{children:[e.jsx(N,{direction:"vertical",style:{width:"100%",marginBottom:16},children:e.jsxs(w,{type:"secondary",children:["文件类型: ",E.file_type?.toUpperCase(),E.preview_type==="unsupported"&&" (不支持在线预览)"]})}),e.jsx("div",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"4px",maxHeight:"500px",overflow:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:E.preview_type==="error"?"inherit":"monospace",fontSize:"13px",lineHeight:"1.6"},children:E.content}),E.preview_type==="unsupported"&&e.jsx(We,{message:"提示",description:"此文件格式不支持在线预览，请点击下载按钮下载文件后使用相应软件打开。",type:"info",showIcon:!0})]}):null})]})};export{xr as default};
