import{r as l,j as e,d as T,S as i,T as C,h as v,p as P,s as f}from"./index-DsSH7ar9.js";import{R,k as p}from"./DatabaseOutlined-D6EghLgp.js";import{S as z}from"./index-sybAN3w3.js";import{R as u}from"./InfoCircleOutlined-BhtMjM5p.js";const{Text:c}=C,A=({moduleName:r,moduleLabel:y,availableStores:o,style:j,onChange:g})=>{const[x,a]=l.useState(!1),[n,d]=l.useState({module_name:r,knowledge_base_enabled:!1,enabled_stores:[]}),[_,h]=l.useState([]),[b,w]=l.useState(!1),k=async()=>{a(!0);try{const s=(await p.getModulePreferences(r)).data.data;d(s),!o&&s.enabled_stores?h(s.enabled_stores):o&&h(o),w(!0)}catch(t){console.error("加载偏好设置失败:",t)}finally{a(!1)}};l.useEffect(()=>{k(),o&&h(o)},[r]);const m=async t=>{a(!0);try{const s={...n,knowledge_base_enabled:t,enabled_stores:t&&(!n.enabled_stores||n.enabled_stores.length===0)?_:n.enabled_stores};await p.saveModulePreferences(r,s),d(s),f.success(`知识库已${t?"启用":"禁用"}`),g?.(t,s.enabled_stores)}catch(s){f.error(`操作失败: ${s.response?.data?.detail||s.message}`),d(n)}finally{a(!1)}},M=async t=>{a(!0);try{const s={...n,enabled_stores:t};await p.saveModulePreferences(r,s),d(s),f.success("知识源设置已保存"),g?.(n.knowledge_base_enabled,t)}catch(s){f.error(`保存失败: ${s.response?.data?.detail||s.message}`)}finally{a(!1)}},S=()=>y||{consultation:"智能咨询",contract_review:"合同审查",risk_analysis:"风险评估",litigation_analysis:"案件分析"}[r]||r;return b?e.jsx(T,{size:"small",style:j,title:e.jsxs(i,{children:[e.jsx(R,{}),e.jsx(c,{children:"知识库增强"}),e.jsx(P,{title:"启用知识库后，系统将基于本地和外部知识库提供更准确的法律依据",children:e.jsx(u,{style:{color:"#999"}})})]}),children:e.jsxs(i,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(i,{children:[e.jsx(c,{children:"启用知识库增强："}),e.jsxs(c,{type:"secondary",style:{fontSize:12},children:["(",S(),")"]})]}),e.jsx(z,{checked:n.knowledge_base_enabled,onChange:m,loading:x,checkedChildren:"开启",unCheckedChildren:"关闭"})]}),n.knowledge_base_enabled&&e.jsx("div",{style:{marginTop:8},children:e.jsxs(i,{direction:"vertical",style:{width:"100%"},children:[e.jsx(c,{type:"secondary",style:{fontSize:12},children:"选择知识源："}),e.jsx(v,{mode:"multiple",placeholder:"选择要使用的知识源",value:n.enabled_stores,onChange:M,loading:x,style:{width:"100%"},maxTagCount:"responsive",options:_.map(t=>({label:t,value:t}))})]})}),!n.knowledge_base_enabled&&e.jsx("div",{style:{marginTop:8,padding:"8px 12px",background:"#f0f5ff",borderRadius:4,border:"1px solid #adc6ff"},children:e.jsxs(c,{type:"secondary",style:{fontSize:12},children:[e.jsx(u,{})," 开启知识库增强后，系统将引用现行法律法规和案例，提供更准确的法律依据"]})})]})}):null};export{A as M};
