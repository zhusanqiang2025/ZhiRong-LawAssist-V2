import{r as i,z as I,_ as T,u as O,j as t,B as c,d as E,S as m,aw as f,D as F,aC as p,s as l,i as j,p as C,G as L,H}from"./index-BYD9hiRj.js";/* empty css                       */import{R as N}from"./ArrowLeftOutlined-CVuXMn9O.js";import{F as V}from"./Table-DpDQvp7h.js";import{R}from"./ReloadOutlined-Da_vttcL.js";import{P as g}from"./index-CT2wc5AE.js";import{R as A}from"./DeleteOutlined-CiqcE3-2.js";import{R as G}from"./CloseCircleOutlined-hZnCNamp.js";import{R as K}from"./CheckCircleOutlined-DuTTSUmS.js";import{R as Z}from"./ClockCircleOutlined-CMxpn9px.js";import"./FileOutlined-Ci6ONDw-.js";import"./useBubbleLock-_0sC_zTy.js";import"./index-BRQJlRky.js";import"./FolderOpenOutlined-D1krmWtw.js";var q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"},J=function(a,u){return i.createElement(I,T({},a,{ref:u,icon:q}))},_=i.forwardRef(J),Q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"},U=function(a,u){return i.createElement(I,T({},a,{ref:u,icon:Q}))},W=i.forwardRef(U);const he=()=>{const x=O(),[a,u]=i.useState([]),[y,k]=i.useState(!1),[r,S]=i.useState({current:1,pageSize:20,total:0}),[w,X]=i.useState(),d=async(e=1,s=20)=>{k(!0);try{const n=await p.getReviewTasks({page:e,skip:(e-1)*s,limit:s,status:w});u(n.data),S(o=>({...o,current:e,pageSize:s}))}catch(n){console.error("获取任务列表失败",n),l.error(n.response?.data?.detail||"获取任务列表失败")}finally{k(!1)}};i.useEffect(()=>{d(1,r.pageSize)},[w]);const z=()=>{d(r.current,r.pageSize)},b=async e=>{try{await p.pauseTask(String(e)),l.success("任务已暂停"),d(r.current,r.pageSize)}catch(s){console.error("暂停任务失败",s),l.error(s.response?.data?.detail||"暂停任务失败")}},v=async e=>{try{await p.resumeTask(String(e)),l.success("任务已恢复"),d(r.current,r.pageSize)}catch(s){console.error("恢复任务失败",s),l.error(s.response?.data?.detail||"恢复任务失败")}},$=async e=>{try{await p.deleteTask(String(e)),l.success("任务已删除"),d(r.current,r.pageSize)}catch(s){console.error("删除任务失败",s),l.error(s.response?.data?.detail||"删除任务失败")}},P=(e,s)=>{x(`/contract/review?contract_id=${s}`)},D=e=>{const s={pending:{color:"default",text:"等待中",icon:t.jsx(Z,{})},running:{color:"processing",text:"执行中",icon:t.jsx(H,{})},paused:{color:"warning",text:"已暂停",icon:t.jsx(_,{})},completed:{color:"success",text:"已完成",icon:t.jsx(K,{})},failed:{color:"error",text:"失败",icon:t.jsx(G,{})}},{color:n,text:o,icon:h}=s[e]||{color:"default",text:e,icon:null};return t.jsx(j,{color:n,icon:h,children:o})},B=e=>{if(!e)return"-";const s={Critical:{color:"red",text:"严重"},High:{color:"orange",text:"高"},Medium:{color:"blue",text:"中"},Low:{color:"default",text:"低"}},n=[];for(const[o,h]of Object.entries(e.by_severity))h>0&&s[o]&&n.push(t.jsxs(j,{color:s[o].color,children:[s[o].text,": ",h]},o));return n.length>0?t.jsx(m,{size:4,children:n}):"-"},M=[{title:"ID",dataIndex:"id",key:"id",width:80,sorter:(e,s)=>e.id-s.id},{title:"合同ID",dataIndex:"contract_id",key:"contract_id",width:100},{title:"状态",dataIndex:"status",key:"status",width:120,render:e=>D(e),filters:[{text:"等待中",value:"pending"},{text:"执行中",value:"running"},{text:"已暂停",value:"paused"},{text:"已完成",value:"completed"},{text:"失败",value:"failed"}],onFilter:(e,s)=>s.status===e},{title:"立场",dataIndex:"stance",key:"stance",width:80},{title:"系统",dataIndex:"use_langgraph",key:"use_langgraph",width:100,render:e=>t.jsx(j,{color:e?"blue":"green",children:e?"LangGraph":"传统法"})},{title:"交易结构",dataIndex:"transaction_structures",key:"transaction_structures",width:150,ellipsis:!0,render:e=>!e||e.length===0?"-":t.jsx(C,{title:e.join(", "),children:t.jsx("span",{children:e.join(", ")})})},{title:"审查项数",key:"item_count",width:120,render:(e,s)=>s.result_summary?t.jsx(f,{count:s.result_summary.total_items,showZero:!0,style:{backgroundColor:"#52c41a"}}):"-"},{title:"风险分布",key:"severity_dist",width:180,render:(e,s)=>B(s.result_summary)},{title:"创建时间",dataIndex:"created_at",key:"created_at",width:180,render:e=>new Date(e).toLocaleString("zh-CN"),sorter:(e,s)=>new Date(e.created_at).getTime()-new Date(s.created_at).getTime()},{title:"完成时间",dataIndex:"completed_at",key:"completed_at",width:180,render:e=>e?new Date(e).toLocaleString("zh-CN"):"-"},{title:"操作",key:"actions",width:200,fixed:"right",render:(e,s)=>t.jsxs(m,{size:"small",children:[s.status==="completed"&&t.jsx(C,{title:"查看审查结果",children:t.jsx(c,{type:"link",icon:t.jsx(L,{}),onClick:()=>P(s.id,s.contract_id),children:"查看结果"})}),s.status==="running"&&t.jsx(g,{title:"确定暂停此任务?",onConfirm:()=>b(s.id),okText:"确定",cancelText:"取消",children:t.jsx(c,{type:"link",icon:t.jsx(_,{}),children:"暂停"})}),s.status==="paused"&&t.jsx(g,{title:"确定恢复此任务?",onConfirm:()=>v(s.id),okText:"确定",cancelText:"取消",children:t.jsx(c,{type:"link",icon:t.jsx(W,{}),children:"恢复"})}),s.status==="failed"&&t.jsx(g,{title:"确定重新执行此任务?",onConfirm:()=>v(s.id),okText:"确定",cancelText:"取消",children:t.jsx(c,{type:"link",icon:t.jsx(R,{}),children:"重试"})}),s.status!=="running"&&t.jsx(g,{title:"确定删除此任务?",description:"删除后将无法恢复",onConfirm:()=>$(s.id),okText:"确定",cancelText:"取消",children:t.jsx(c,{type:"link",danger:!0,icon:t.jsx(A,{}),children:"删除"})})]})}];return t.jsxs("div",{style:{padding:"24px",minHeight:"100vh",background:"#f0f2f5"},children:[t.jsx("div",{style:{marginBottom:24},children:t.jsx(c,{icon:t.jsx(N,{}),onClick:()=>x("/contract/review"),children:"返回审查页面"})}),t.jsxs(E,{title:t.jsxs("span",{children:[t.jsx(F,{style:{marginRight:8}}),"合同审查任务历史"]}),extra:t.jsx(c,{icon:t.jsx(R,{}),onClick:z,loading:y,children:"刷新"}),children:[t.jsx("div",{style:{marginBottom:16,display:"flex",gap:24},children:t.jsxs(m,{size:"large",children:[t.jsxs("div",{children:[t.jsx("span",{style:{color:"#666"},children:"总任务数："}),t.jsx("strong",{children:a.length})]}),t.jsxs("div",{children:[t.jsx("span",{style:{color:"#666"},children:"运行中："}),t.jsx(f,{count:a.filter(e=>e.status==="running").length})]}),t.jsxs("div",{children:[t.jsx("span",{style:{color:"#666"},children:"已完成："}),t.jsx(f,{count:a.filter(e=>e.status==="completed").length,style:{backgroundColor:"#52c41a"}})]}),t.jsxs("div",{children:[t.jsx("span",{style:{color:"#666"},children:"失败："}),t.jsx(f,{count:a.filter(e=>e.status==="failed").length,style:{backgroundColor:"#ff4d4f"}})]})]})}),t.jsx(V,{columns:M,dataSource:a,loading:y,rowKey:"id",scroll:{x:1600},pagination:{...r,showSizeChanger:!0,showTotal:e=>`共 ${e} 条记录`,onChange:(e,s)=>{d(e,s)}},rowClassName:e=>e.status==="failed"?"task-row-failed":e.status==="completed"?"task-row-completed":e.status==="running"?"task-row-running":""})]}),t.jsx("style",{children:`
        .task-row-running {
          background-color: #e6f7ff;
        }
        .task-row-completed {
          background-color: #f6ffed;
        }
        .task-row-failed {
          background-color: #fff1f0;
        }
      `})]})};export{he as default};
