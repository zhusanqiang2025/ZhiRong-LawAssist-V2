import{r as n,s as R}from"./index-sxRqSD8J.js";function E(e,k={}){const{autoRestore:I=!0,onRestore:t,expirationTime:m=1440*60*1e3,showMessage:P=!0}=k,[c,a]=n.useState(""),[S,u]=n.useState(null),[b,l]=n.useState(!1),[w,p]=n.useState(!1),f=n.useRef(t);n.useEffect(()=>{f.current=t},[t]);const r=n.useCallback(()=>{try{const s=localStorage.getItem(e);if(!s)return null;const o=JSON.parse(s);return Date.now()-o.timestamp>m?(console.log(`[useSessionPersistence] 会话已过期，清理: ${e}`),h(),null):o}catch(s){return console.error("[useSessionPersistence] 读取会话失败:",s),null}},[e,m]),d=n.useCallback((s,o)=>{try{const i={sessionId:s,data:o,timestamp:Date.now()};localStorage.setItem(e,JSON.stringify(i)),a(s),u(o),l(!0),console.log(`[useSessionPersistence] 会话已保存: ${e}`,i)}catch(i){console.error("[useSessionPersistence] 保存会话失败:",i),P&&R.error("保存会话失败")}},[e,P]),C=n.useCallback(s=>{if(!c){console.warn("[useSessionPersistence] 没有活动会话，无法更新数据");return}const o={...S,...s};d(c,o)},[c,S,d]),D=n.useCallback(()=>{const s=r();return s?(console.log(`[useSessionPersistence] 恢复会话: ${e}`,s),a(s.sessionId),u(s.data),l(!0),t&&t(s.sessionId,s.data),{sessionId:s.sessionId,data:s.data}):(console.log(`[useSessionPersistence] 没有找到可恢复的会话: ${e}`),null)},[e,r,t]),h=n.useCallback(()=>{try{localStorage.removeItem(e),a(""),u(null),l(!1),console.log(`[useSessionPersistence] 会话已清除: ${e}`)}catch(s){console.error("[useSessionPersistence] 清除会话失败:",s)}},[e]),$=n.useCallback(()=>r()!==null,[r]);return n.useEffect(()=>{if(I){p(!0);const s=r();s&&(console.log(`[useSessionPersistence] 自动恢复会话: ${e}`),a(s.sessionId),u(s.data),l(!0),f.current&&f.current(s.sessionId,s.data)),p(!1)}},[I,e]),{sessionId:c,sessionData:S,hasSession:b,isLoading:w,saveSession:d,updateSessionData:C,restoreSession:D,clearSession:h,checkSessionExists:$,getStoredSession:r}}export{E as u};
