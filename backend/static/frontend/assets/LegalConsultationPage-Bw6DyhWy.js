import{r as o,z as Ce,_ as Ie,j as e,D as be,T as Re,B as x,A as Me,E as me,aD as pe,o as H,s as j,u as Be,w as He,x as Oe,bj as ge,av as ie,bk as ne,ax as he,y as ye,i as xe,S as G,I as ke,bl as Le,p as Se,d as Ue,aA as Ae,t as Ge,n as Qe,k as oe,f as Pe,bm as Je,bn as qe}from"./index-Dlmv2mUC.js";import{E as Ve,R as Ke}from"./EnhancedModuleNavBar--btqpF-j.js";import{M as We}from"./ModuleKnowledgeToggle-CSTWU5I7.js";import{R as Xe}from"./ClockCircleOutlined-z2Y6L6yR.js";import{P as je}from"./index-CthY0re9.js";import{R as Ye}from"./DeleteOutlined-BqMyp8QF.js";import{r as Ze}from"./index-EysGvGsI.js";import{a as _e,R as es}from"./DiffOutlined-DRRiROnT.js";import{D as ve}from"./index-CId9-BzK.js";import{C as we,R as ss}from"./FileOutlined-DuiiGJqM.js";import{R as ts}from"./CheckCircleOutlined-D0Kzh88V.js";import{R as ns}from"./react-markdown-BUYh_VyP.js";import{R as os}from"./PaperClipOutlined-Dgm_4sM5.js";import{R as is}from"./SendOutlined-BwqBElz6.js";import"./ArrowLeftOutlined-DfrPQzYr.js";import"./DatabaseOutlined-BO6DFX2h.js";import"./index-ieWl_TaY.js";import"./InfoCircleOutlined-DI6Sv-S2.js";import"./useBubbleLock-BKOiJ7Kk.js";var as={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},rs=function(i,n){return o.createElement(Ce,Ie({},i,{ref:n,icon:as}))},ls=o.forwardRef(rs),cs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M899.6 276.5L705 396.4 518.4 147.5a8.06 8.06 0 00-12.9 0L319 396.4 124.3 276.5c-5.7-3.5-13.1 1.2-12.2 7.9L188.5 865c1.1 7.9 7.9 14 16 14h615.1c8 0 14.9-6 15.9-14l76.4-580.6c.8-6.7-6.5-11.4-12.3-7.9zm-126 534.1H250.3l-53.8-409.4 139.8 86.1L512 252.9l175.7 234.4 139.8-86.1-53.9 409.4zM512 509c-62.1 0-112.6 50.5-112.6 112.6S449.9 734.2 512 734.2s112.6-50.5 112.6-112.6S574.1 509 512 509zm0 160.9c-26.6 0-48.2-21.6-48.2-48.3 0-26.6 21.6-48.3 48.2-48.3s48.2 21.6 48.2 48.3c0 26.6-21.6 48.3-48.2 48.3z"}}]},name:"crown",theme:"outlined"},ds=function(i,n){return o.createElement(Ce,Ie({},i,{ref:n,icon:cs}))},us=o.forwardRef(ds);const O="legal_consult_history_",F="legal_consult_history_index";class fs{getHistoryList(){try{const i=localStorage.getItem(F);if(!i)return[];const n=JSON.parse(i),l=[];for(const p of n){const h=localStorage.getItem(`${O}${p}`);if(h){const g=JSON.parse(h);l.push({id:g.id,title:g.title,timestamp:g.timestamp,messageCount:g.messages.length})}}return l.sort((p,h)=>h.timestamp-p.timestamp)}catch(i){return console.error("[å†å²è®°å½•ç®¡ç†å™¨] è·å–å†å²åˆ—è¡¨å¤±è´¥:",i),[]}}saveConsultation(i,n,l){try{const p=i.find(m=>m.role==="user"),h=p?p.content.substring(0,50)+(p.content.length>50?"...":""):"æ™ºèƒ½å’¨è¯¢ä¼šè¯",g=l||`${Date.now()}_${Math.random().toString(36).substring(2,9)}`,N=Date.now(),D={id:g,title:h,timestamp:N,messages:JSON.parse(JSON.stringify(i)),currentExpertType:n};return localStorage.setItem(`${O}${g}`,JSON.stringify(D)),this.updateIndex(g),console.log("[å†å²è®°å½•ç®¡ç†å™¨] ä¼šè¯å·²ä¿å­˜:",g,h),g}catch(p){return console.error("[å†å²è®°å½•ç®¡ç†å™¨] ä¿å­˜ä¼šè¯å¤±è´¥:",p),l||""}}loadConsultation(i){try{const n=localStorage.getItem(`${O}${i}`);if(!n)return console.warn("[å†å²è®°å½•ç®¡ç†å™¨] ä¼šè¯ä¸å­˜åœ¨:",i),null;const l=JSON.parse(n);return console.log("[å†å²è®°å½•ç®¡ç†å™¨] ä¼šè¯å·²åŠ è½½:",i,l.title),l}catch(n){return console.error("[å†å²è®°å½•ç®¡ç†å™¨] åŠ è½½ä¼šè¯å¤±è´¥:",n),null}}deleteConsultation(i){try{return localStorage.removeItem(`${O}${i}`),this.removeFromIndex(i),console.log("[å†å²è®°å½•ç®¡ç†å™¨] ä¼šè¯å·²åˆ é™¤:",i),!0}catch(n){return console.error("[å†å²è®°å½•ç®¡ç†å™¨] åˆ é™¤ä¼šè¯å¤±è´¥:",n),!1}}clearAllHistory(){try{const i=localStorage.getItem(F);if(!i)return!0;const n=JSON.parse(i);for(const l of n)localStorage.removeItem(`${O}${l}`);return localStorage.removeItem(F),console.log("[å†å²è®°å½•ç®¡ç†å™¨] æ‰€æœ‰å†å²è®°å½•å·²æ¸…ç©º"),!0}catch(i){return console.error("[å†å²è®°å½•ç®¡ç†å™¨] æ¸…ç©ºå†å²è®°å½•å¤±è´¥:",i),!1}}updateIndex(i){try{const n=localStorage.getItem(F);let l=n?JSON.parse(n):[];l=l.filter(p=>p!==i),l.push(i),localStorage.setItem(F,JSON.stringify(l))}catch(n){console.error("[å†å²è®°å½•ç®¡ç†å™¨] æ›´æ–°ç´¢å¼•å¤±è´¥:",n)}}removeFromIndex(i){try{const n=localStorage.getItem(F);if(!n)return;let l=JSON.parse(n);l=l.filter(p=>p!==i),localStorage.setItem(F,JSON.stringify(l))}catch(n){console.error("[å†å²è®°å½•ç®¡ç†å™¨] ä»ç´¢å¼•ç§»é™¤å¤±è´¥:",n)}}formatTimestamp(i){const n=new Date(i),p=new Date().getTime()-n.getTime(),h=Math.floor(p/(1e3*60*60*24));return h===0?`ä»Šå¤© ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`:h===1?`æ˜¨å¤© ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`:h<7?`${["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][n.getDay()]} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`:`${n.getMonth()+1}æœˆ${n.getDate()}æ—¥`}}const Q=new fs,{Text:P}=Re,ms=({visible:d,onClose:i,onLoadHistory:n,onNewChat:l})=>{const[p,h]=o.useState([]),g=()=>{const m=Q.getHistoryList();h(m)};o.useEffect(()=>{d&&g()},[d]);const N=(m,y)=>{y.stopPropagation(),Q.deleteConsultation(m),g()},D=m=>{n(m),i()};return d?e.jsxs("div",{className:"consultation-history-sidebar",children:[e.jsxs("div",{className:"history-sidebar-header",children:[e.jsxs("div",{className:"history-sidebar-title",children:[e.jsx(be,{style:{marginRight:8}}),e.jsx(P,{strong:!0,children:"å†å²è®°å½•"})]}),e.jsx(x,{type:"text",icon:e.jsx(Me,{}),onClick:l,size:"small",children:"æ–°å»ºä¼šè¯"})]}),e.jsx("div",{className:"history-sidebar-content",children:p.length===0?e.jsx(me,{image:me.PRESENTED_IMAGE_SIMPLE,description:"æš‚æ— å†å²è®°å½•",style:{marginTop:40}}):e.jsx(pe,{dataSource:p,renderItem:m=>e.jsxs(pe.Item,{className:"history-item",onClick:()=>D(m.id),children:[e.jsxs("div",{className:"history-item-content",children:[e.jsx("div",{className:"history-item-title",children:e.jsx(P,{ellipsis:{tooltip:m.title},children:m.title})}),e.jsxs("div",{className:"history-item-meta",children:[e.jsx(Xe,{style:{fontSize:12,marginRight:4}}),e.jsx(P,{type:"secondary",style:{fontSize:12},children:Q.formatTimestamp(m.timestamp)}),e.jsxs(P,{type:"secondary",style:{fontSize:12,marginLeft:8},children:[m.messageCount," æ¡æ¶ˆæ¯"]})]})]}),e.jsx(je,{title:"ç¡®è®¤åˆ é™¤æ­¤ä¼šè¯ï¼Ÿ",onConfirm:y=>N(m.id,y),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",children:e.jsx(x,{type:"text",icon:e.jsx(Ye,{}),size:"small",danger:!0,onClick:y=>y.stopPropagation()})})]})})}),p.length>0&&e.jsx("div",{className:"history-sidebar-footer",children:e.jsx(je,{title:"ç¡®è®¤æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•ï¼Ÿ",onConfirm:()=>{Q.clearAllHistory(),g()},okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",children:e.jsx(x,{type:"text",danger:!0,size:"small",children:"æ¸…ç©ºå†å²"})})})]}):null};function ps(){const[d,i]=o.useState(null),[n,l]=o.useState([]),[p,h]=o.useState(!1),g=o.useCallback(async()=>{try{const a=await H.post("/consultation/new-session");if(a.data&&a.data.session_id){const u={sessionId:a.data.session_id,title:"æ–°å¯¹è¯",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),messageCount:0,messages:[],status:"active"};return i(u),sessionStorage.setItem("consultation_session_id",a.data.session_id),sessionStorage.removeItem("consultation_session_temp"),console.log("[ä¼šè¯ç®¡ç†] åˆ›å»ºæ–°ä¼šè¯:",a.data.session_id),u}else throw new Error("åˆ›å»ºä¼šè¯å¤±è´¥ï¼šæ— session_id")}catch(a){return console.error("[ä¼šè¯ç®¡ç†] åˆ›å»ºæ–°ä¼šè¯å¤±è´¥:",a),j.error("åˆ›å»ºæ–°ä¼šè¯å¤±è´¥"),null}},[]),N=o.useCallback(async a=>{try{const u=await H.post(`/consultation/history/${a}/continue`);if(u.data&&u.data.success&&u.data.session){const c=u.data.session,w=(c.messages||[]).map(C=>({...C,timestamp:new Date(C.timestamp)})),b={sessionId:c.session_id,title:c.title,createdAt:c.created_at,updatedAt:c.updated_at,messageCount:c.message_count||w.length,messages:w,status:"active",specialistType:c.specialist_type,classification:c.classification};return i(b),sessionStorage.setItem("consultation_session_id",c.session_id),h(!1),j.success("å·²åŠ è½½å†å²ä¼šè¯"),console.log("[ä¼šè¯ç®¡ç†] ç»§ç»­ä¼šè¯:",c.session_id),b}else throw new Error("åŠ è½½ä¼šè¯å¤±è´¥")}catch(u){return console.error("[ä¼šè¯ç®¡ç†] ç»§ç»­ä¼šè¯å¤±è´¥:",u),j.error("åŠ è½½å†å²ä¼šè¯å¤±è´¥"),null}},[]),D=o.useCallback(async(a,u)=>{if(!d||a.length===0)return console.warn("[ä¼šè¯ç®¡ç†] æ— æ³•ä¿å­˜ä¼šè¯ï¼šæ— ä¼šè¯æˆ–æ— æ¶ˆæ¯"),!1;try{const c=u||a.find(C=>C.role==="user")?.content?.substring(0,50)+"..."||"å¯¹è¯è®°å½•",w={session_id:d.sessionId,messages:a,title:c,specialist_type:d.specialistType,classification:d.classification},b=await H.post("/consultation/save-history",w);if(b.data&&b.data.success)return console.log("[ä¼šè¯ç®¡ç†] ä¼šè¯å·²ä¿å­˜åˆ°å†å²:",d.sessionId),await m(),!0;throw new Error("ä¿å­˜å¤±è´¥")}catch(c){return console.error("[ä¼šè¯ç®¡ç†] ä¿å­˜ä¼šè¯å¤±è´¥:",c),!1}},[d]),m=o.useCallback(async()=>{try{const a=await H.get("/consultation/history",{params:{limit:50}});if(a.data&&a.data.sessions){const u=a.data.sessions.map(c=>({sessionId:c.session_id,title:c.title,createdAt:c.created_at,updatedAt:c.updated_at,messageCount:c.message_count,messages:(c.messages||[]).map(w=>({...w,timestamp:new Date(w.timestamp)})),status:c.status,specialistType:c.specialist_type,classification:c.classification}));return l(u),console.log("[ä¼šè¯ç®¡ç†] åŠ è½½å†å²åˆ—è¡¨:",u.length),u}}catch(a){return console.error("[ä¼šè¯ç®¡ç†] åŠ è½½å†å²åˆ—è¡¨å¤±è´¥:",a),[]}},[]),y=o.useCallback(async a=>{try{const u=await H.delete(`/consultation/history/${a}`);if(u.data&&u.data.success)return l(c=>c.filter(w=>w.sessionId!==a)),d?.sessionId===a&&(i(null),sessionStorage.removeItem("consultation_session_id")),j.success("ä¼šè¯å·²åˆ é™¤"),console.log("[ä¼šè¯ç®¡ç†] åˆ é™¤ä¼šè¯:",a),!0;throw new Error("åˆ é™¤å¤±è´¥")}catch(u){return console.error("[ä¼šè¯ç®¡ç†] åˆ é™¤ä¼šè¯å¤±è´¥:",u),j.error("åˆ é™¤ä¼šè¯å¤±è´¥"),!1}},[d]),_=o.useCallback(()=>{h(a=>{const u=!a;return u&&n.length===0&&m(),u})},[n.length,m]),L=o.useCallback(async()=>{const a=sessionStorage.getItem("consultation_session_id");a?(i({sessionId:a,title:"ç»§ç»­å¯¹è¯",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),messageCount:0,messages:[],status:"active"}),console.log("[ä¼šè¯ç®¡ç†] æ£€æµ‹åˆ°ç°æœ‰ä¼šè¯:",a)):await g(),await m()},[g,m]);return{currentSession:d,historySessions:n,isHistorySidebarOpen:p,createNewSession:g,continueSession:N,saveCurrentSession:D,loadHistorySessions:m,deleteSession:y,toggleHistorySidebar:_,initializeSession:L,isFollowUp:d?.messageCount>0}}const{Content:gs,Sider:hs}=ie,{TextArea:ys}=ke,{Title:J,Text:q,Paragraph:xs}=Re,Us=()=>{const d=Be(),i=He(),{user:n}=Oe(),{currentSession:l,isHistorySidebarOpen:p,createNewSession:h,continueSession:g,saveCurrentSession:N,toggleHistorySidebar:D,initializeSession:m}=ps(),[y,_]=o.useState([]),[L,a]=o.useState(""),[u,c]=o.useState(!1),[w,b]=o.useState(!1),[C,V]=o.useState("assistant"),[$,z]=o.useState([]),[Ss,ae]=o.useState(!1),[K,W]=o.useState({}),[T,M]=o.useState({}),[U,re]=o.useState({}),[De,X]=o.useState(()=>sessionStorage.getItem("consultation_session_id")),[js,le]=o.useState(null),ce=o.useRef(null),A=o.useRef(null),Y=o.useRef(""),Z=o.useRef({}),ee=o.useRef({}),de=o.useRef([]);o.useEffect(()=>{m()},[m]),o.useEffect(()=>{const s=()=>{if(y.length>0&&l){const t=JSON.stringify({session_id:l.sessionId,messages:y,title:y.find(r=>r.role==="user")?.content?.substring(0,50)+"..."||"å¯¹è¯è®°å½•",specialist_type:C==="specialist"?"å¾‹å¸ˆ":void 0});navigator.sendBeacon("/consultation/save-history",t)}};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[y,l,C]),o.useEffect(()=>{const s=i.state;s?.initial_input&&(a(s.initial_input),b(!0),setTimeout(()=>se(s.initial_input),500),j.success("å·²è‡ªåŠ¨å¸¦å…¥æ‚¨çš„å’¨è¯¢éœ€æ±‚"),window.history.replaceState({},document.title))},[i.state]),o.useEffect(()=>{ce.current?.scrollIntoView({behavior:"smooth"})},[y,u]),o.useEffect(()=>{y.length===0&&_([{id:"welcome",content:`æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½å¾‹å¸ˆåŠ©ç†ã€‚

æˆ‘å¯ä»¥å¸®æ‚¨åˆ†ææ³•å¾‹é—®é¢˜ï¼Œè¯†åˆ«ä¸“ä¸šé¢†åŸŸï¼Œå¹¶ä¸ºæ‚¨åŒ¹é…æœ€åˆé€‚çš„ä¸“ä¸šå¾‹å¸ˆè¿›è¡Œæ·±åº¦è§£ç­”ã€‚

è¯·æè¿°æ‚¨é‡åˆ°çš„æ³•å¾‹å›°æ‰°ï¼Œæˆ–è€…ä¸Šä¼ ç›¸å…³æ–‡ä»¶ï¼ˆæ”¯æŒ PDF/Wordï¼‰ã€‚`,role:"assistant",timestamp:new Date,confidence:1}])},[]),o.useEffect(()=>{Z.current=K},[K]),o.useEffect(()=>{ee.current=T},[T]),o.useEffect(()=>{de.current=$},[$]);const B={assistant:{name:"å¾‹å¸ˆåŠ©ç†",title:"æ™ºèƒ½åˆè¯Š",experience:"AI",specializations:["é—®é¢˜åˆ†æ","é¢†åŸŸè¯†åˆ«"],cases:0,success_rate:"-",avatar:"assistant"},specialist:{name:"ä¸“ä¸šå¾‹å¸ˆå›¢é˜Ÿ",title:"æ·±åº¦å’¨è¯¢",experience:"15å¹´+",specializations:["åˆåŒ","åŠ³åŠ¨","å…¬å¸","æ°‘å•†äº‹"],cases:500,success_rate:"92%",avatar:"expert"}}[C],ue=async()=>{if(y.length>1&&await N(y),_([]),b(!1),V("assistant"),z([]),W({}),M({}),le(null),re({}),sessionStorage.removeItem("consultation_session_id"),X(null),l?.sessionId)try{await Je(l.sessionId)}catch(s){console.error("é‡ç½®ä¼šè¯å¤±è´¥:",s)}await h(),j.success("å·²å¼€å¯æ–°å’¨è¯¢")},$e=async s=>{const t=await g(s);if(!t){j.error("åŠ è½½å†å²è®°å½•å¤±è´¥");return}_(JSON.parse(JSON.stringify(t.messages))),b(!0);const r=t.messages.some(v=>v.role==="assistant_specialist");V(r?"specialist":"assistant"),W({}),M({}),z([]),sessionStorage.setItem("consultation_session_id",s),X(s),j.success("å†å²è®°å½•å·²åŠ è½½")},se=async s=>{const t=s||L;if(!t.trim()&&$.length===0)return;Y.current=t,w||b(!0);let r=t;if($.length>0){const f=$.map(S=>S.filename).join("ã€");r=t?`${t}

ğŸ“ å·²ä¸Šä¼ ï¼š${f}`:`è¯·åˆ†æä»¥ä¸‹æ–‡ä»¶ï¼š${f}`}const v={id:`user-${Date.now()}`,content:r,role:"user",timestamp:new Date};_(f=>[...f,v]),a(""),c(!0);try{const f=$.filter(I=>I.status==="done").map(I=>I.file_id),S=sessionStorage.getItem("consultation_session_id"),k=y.length<=1,E={question:t||"è¯·åˆ†ææˆ‘ä¸Šä¼ çš„æ–‡ä»¶",uploaded_files:f.length>0?f:void 0,session_id:S||null,reset_session:k},R=await ge(E);R.session_id&&(sessionStorage.setItem("consultation_session_id",R.session_id),X(R.session_id)),z([]),R.need_confirmation?Ne(R,f):Ee(R)}catch(f){console.error("å‘é€å¤±è´¥:",f),j.error("æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•"),_(S=>[...S,{id:`error-${Date.now()}`,content:"æŠ±æ­‰ï¼Œè¿æ¥å‡ºç°é—®é¢˜ã€‚è¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•ã€‚",role:"assistant",timestamp:new Date}])}finally{c(!1)}},Ee=s=>{const t={id:`assistant-${Date.now()}`,content:s.response||s.answer,role:s.final_report?"assistant_specialist":"assistant",timestamp:new Date,suggestions:s.suggestions,actionButtons:s.action_buttons?.map(r=>({id:r.key,title:r.label,action:r.key,route:r.key==="risk_analysis"?"/risk-analysis":void 0})),confidence:s.confidence};_(r=>[...r,t]),s.final_report&&le(r=>({sessionId:s.session_id,specialistOutput:s,isInSpecialistMode:!0}))},Ne=(s,t=[])=>{(s.specialist_role||s.primary_type)&&re({role:s.specialist_role,domain:s.primary_type});const r=`confirm-${Date.now()}`,v={id:r,content:`åˆæ­¥åˆ†æå®Œæˆã€‚æ‚¨çš„é—®é¢˜å±äºã€${s.primary_type}ã€‘é¢†åŸŸã€‚

å»ºè®®è½¬äº¤ä¸“ä¸šå¾‹å¸ˆè¿›è¡Œæ·±åº¦åˆ†æã€‚`,role:"assistant",timestamp:new Date,isConfirmation:!0,suggestedQuestions:s.suggested_questions||[],directQuestions:s.direct_questions||[],onConfirm:async()=>{console.log("[DEBUG Frontend] onConfirm ä½¿ç”¨ä¼ å…¥çš„ fileIds:",t);const f=t,S=Z.current[r]||[],k=ee.current[r],E=[...S,...k?[k]:[]];console.log("[DEBUG Frontend] ===== ç”¨æˆ·ç¡®è®¤æ—¶çš„è°ƒè¯•ä¿¡æ¯ ====="),console.log("[DEBUG Frontend] confirmId:",r),console.log("[DEBUG Frontend] selectedQuestionsRef.current:",Z.current),console.log("[DEBUG Frontend] customQuestionsRef.current:",ee.current),console.log("[DEBUG Frontend] uploadedFilesRef.current (å¯èƒ½ä¸ºç©º):",de.current),console.log("[DEBUG Frontend] fileIds (ä¼ å…¥å‚æ•°):",t),console.log("[DEBUG Frontend] uploadedFileIds (æœ€ç»ˆä½¿ç”¨):",f),console.log("[DEBUG Frontend] selected (ç”¨æˆ·é€‰æ‹©çš„è¡¥å……é—®é¢˜):",S),console.log("[DEBUG Frontend] custom (ç”¨æˆ·è‡ªå®šä¹‰é—®é¢˜):",k),console.log("[DEBUG Frontend] allQuestions (æœ€ç»ˆé—®é¢˜åˆ—è¡¨):",E),console.log("[DEBUG Frontend] allQuestions.length:",E.length),console.log("[DEBUG Frontend] lastUserQuestionRef.current:",Y.current),console.log("[DEBUG Frontend] response.direct_questions:",s.direct_questions),console.log("[DEBUG Frontend] response.suggested_questions:",s.suggested_questions),console.log("[DEBUG Frontend] å°†å‘é€çš„ selected_suggested_questions:",E.length>0?E:void 0),console.log("[DEBUG Frontend] å°†å‘é€çš„ uploaded_files:",f.length>0?f:void 0),console.log("[DEBUG Frontend] ===== è°ƒè¯•ä¿¡æ¯ç»“æŸ =====");const R=`proc-${Date.now()}`;_(I=>[...I,{id:R,content:`å·²è½¬äº¤ã€${s.primary_type}ã€‘ä¸“å®¶å¾‹å¸ˆï¼Œæ­£åœ¨è¿›è¡Œæ·±åº¦æ€è€ƒä¸åˆ†æ...`,role:"assistant_specialist",timestamp:new Date}]),V("specialist");try{const I=await ge({question:Y.current,user_confirmed:!0,selected_suggested_questions:E.length>0?E:void 0,uploaded_files:f.length>0?f:void 0,session_id:sessionStorage.getItem("consultation_session_id")});_(te=>[...te.filter(Te=>Te.id!==R),{id:`specialist-${Date.now()}`,content:I.response||I.answer,role:"assistant_specialist",timestamp:new Date,suggestions:I.suggestions,actionButtons:I.action_buttons}])}catch{j.error("ä¸“ä¸šåˆ†æè¯·æ±‚å¤±è´¥"),_(te=>te.filter(fe=>fe.id!==R))}},onReject:()=>{_(f=>[...f,{id:`sys-${Date.now()}`,content:"å·²å–æ¶ˆè½¬äº¤ã€‚æ‚¨å¯ä»¥ç»§ç»­å‘æˆ‘æé—®ï¼Œæˆ–é‡æ–°æè¿°é—®é¢˜ã€‚",role:"assistant",timestamp:new Date}])}};_(f=>[...f,v])},ze=async s=>{if(!s.target.files?.length)return;const t=s.target.files[0];if(t.size>50*1024*1024){j.error("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 50MB");return}const r=`temp-${Date.now()}`;z(v=>[...v,{file_id:r,filename:t.name,file_type:t.name.split(".").pop()||"",content_preview:"",status:"uploading"}]),ae(!0);try{const v=await qe(t);z(f=>f.map(S=>S.file_id===r?{...S,file_id:v.file_id,status:"done",content_preview:v.content_preview}:S)),j.success("ä¸Šä¼ æˆåŠŸ")}catch{j.error("ä¸Šä¼ å¤±è´¥"),z(f=>f.filter(S=>S.file_id!==r))}finally{ae(!1),A.current&&(A.current.value="")}},Fe=s=>{const t=s.toLowerCase();return t.includes("pdf")?e.jsx(oe,{style:{color:"#ff4d4f"}}):t.includes("doc")?e.jsx(oe,{style:{color:"#1890ff"}}):e.jsx(ss,{})};return e.jsxs(ie,{className:"legal-consultation-layout",style:{height:"100vh",background:"#f0f2f5"},children:[e.jsx(Ve,{currentModuleKey:"consultation",title:"æ™ºèƒ½å’¨è¯¢",icon:e.jsx(_e,{}),showQuickNav:!1,extra:e.jsx(x,{type:"text",icon:e.jsx(be,{}),onClick:D,children:"å†å²è®°å½•"})}),e.jsxs(ie,{style:{overflow:"hidden"},children:[e.jsx(ms,{visible:p,onClose:()=>D(),onLoadHistory:$e,onNewChat:ue}),e.jsxs(gs,{style:{display:"flex",flexDirection:"column",height:"100%",padding:0},children:[e.jsxs("div",{className:"messages-container",style:{flex:1,overflowY:"auto",padding:"20px 10%"},children:[y.map(s=>e.jsxs("div",{className:`message-row ${s.role==="user"?"user-row":"bot-row"}`,children:[e.jsx("div",{className:"message-avatar",children:e.jsx(ne,{icon:s.role==="user"?e.jsx(he,{}):s.role==="assistant_specialist"?e.jsx(us,{}):e.jsx(ye,{}),style:{backgroundColor:s.role==="user"?"#1890ff":s.role==="assistant_specialist"?"#722ed1":"#52c41a"}})}),e.jsxs("div",{className:"message-bubble-container",children:[s.role!=="user"&&e.jsxs("div",{className:"message-sender-name",children:[s.role==="assistant_specialist"?"ä¸“ä¸šå¾‹å¸ˆ":"å¾‹å¸ˆåŠ©ç†",s.confidence&&e.jsxs(xe,{color:"green",style:{marginLeft:8,fontSize:10},children:["ç½®ä¿¡åº¦ ",Math.round(s.confidence*100),"%"]})]}),e.jsx("div",{className:`message-bubble ${s.role}`,children:s.isConfirmation?e.jsxs("div",{className:"confirmation-card",children:[e.jsx(q,{strong:!0,style:{fontSize:16},children:"ğŸ” åˆæ­¥è¯Šæ–­å®Œæˆ"}),e.jsx(xs,{style:{margin:"12px 0"},children:s.content.split(`

`)[0]}),s.suggestedQuestions&&s.suggestedQuestions.length>0&&e.jsxs("div",{className:"suggestion-selection",children:[e.jsx(ve,{plain:!0,style:{margin:"12px 0"},children:"æ‚¨å¯ä»¥å‹¾é€‰è¡¥å……é—®é¢˜"}),e.jsxs(G,{direction:"vertical",style:{width:"100%"},children:[s.suggestedQuestions.map((t,r)=>e.jsx(we,{onChange:v=>{const f=K[s.id]||[],S=v.target.checked?[...f,t]:f.filter(k=>k!==t);W(k=>({...k,[s.id]:S}))},children:t},r)),e.jsx(we,{onChange:t=>{if(t.target.checked)M(r=>({...r,[s.id]:""}));else{const r={...T};delete r[s.id],M(r)}},children:"å…¶ä»–é—®é¢˜"}),T[s.id]!==void 0&&e.jsx(ke,{placeholder:"è¯·è¾“å…¥æ‚¨çš„å…·ä½“é—®é¢˜",value:T[s.id],onChange:t=>M(r=>({...r,[s.id]:t.target.value})),style:{marginLeft:24,width:"90%"}})]})]}),e.jsxs("div",{className:"confirmation-actions",style:{marginTop:16,display:"flex",gap:12},children:[e.jsx(x,{type:"primary",icon:e.jsx(ts,{}),onClick:()=>s.onConfirm&&s.onConfirm(),children:"è½¬äº¤ä¸“å®¶å¾‹å¸ˆ"}),e.jsx(x,{onClick:s.onReject,children:"å–æ¶ˆ"})]})]}):e.jsx("div",{className:"markdown-body",children:e.jsx(ns,{remarkPlugins:[Ze],components:{h1:({...t})=>e.jsx(J,{level:3,...t}),h2:({...t})=>e.jsx(J,{level:4,...t}),h3:({...t})=>e.jsx(J,{level:5,...t}),li:({...t})=>e.jsx("li",{style:{marginLeft:20},...t})},children:s.content})})}),s.actionButtons&&e.jsx("div",{className:"message-footer-actions",children:e.jsx(G,{wrap:!0,size:[8,8],children:s.actionButtons.map(t=>e.jsx(x,{size:"small",type:"dashed",onClick:()=>t.route?d(t.route):j.info("åŠŸèƒ½å¼€å‘ä¸­"),children:t.title},t.id))})})]})]},s.id)),u&&e.jsxs("div",{className:"message-row bot-row",children:[e.jsx(ne,{icon:e.jsx(ye,{}),style:{backgroundColor:"#ccc"}}),e.jsxs("div",{className:"message-bubble assistant typing",children:[e.jsx("span",{children:"â—"}),e.jsx("span",{children:"â—"}),e.jsx("span",{children:"â—"})]})]}),e.jsx("div",{ref:ce})]}),e.jsxs("div",{className:"input-area-wrapper",style:{padding:"16px 10%",background:"#fff",borderTop:"1px solid #e8e8e8"},children:[$.length>0&&e.jsx("div",{className:"upload-preview-bar",children:e.jsx(G,{children:$.map(s=>e.jsxs(xe,{closable:!0,onClose:()=>Le(s.file_id).then(()=>z(t=>t.filter(r=>r.file_id!==s.file_id))),icon:Fe(s.file_type),color:s.status==="error"?"red":"blue",children:[s.filename," ",s.status==="uploading"&&"(ä¸Šä¼ ä¸­)"]},s.file_id))})}),e.jsxs("div",{className:"input-box-container",style:{display:"flex",gap:12},children:[e.jsxs("div",{style:{flex:1,position:"relative"},children:[e.jsx(ys,{value:L,onChange:s=>a(s.target.value),onKeyPress:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),se())},placeholder:"è¯·è¾“å…¥æ‚¨çš„æ³•å¾‹é—®é¢˜ï¼Œæˆ–ä¸Šä¼ åˆåŒ/æ–‡ä¹¦...",autoSize:{minRows:2,maxRows:6},style:{borderRadius:8,paddingRight:40}}),e.jsx(Se,{title:"ä¸Šä¼ æ–‡ä»¶ (PDF/Word)",children:e.jsx(x,{type:"text",icon:e.jsx(os,{}),style:{position:"absolute",right:8,bottom:8,color:"#666"},onClick:()=>A.current?.click()})}),e.jsx("input",{ref:A,type:"file",style:{display:"none"},onChange:ze,accept:".pdf,.doc,.docx,.txt"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx(x,{type:"primary",icon:e.jsx(is,{}),onClick:()=>se(),loading:u,style:{height:"100%"},children:"å‘é€"}),De&&e.jsx(Se,{title:"ç»“æŸå½“å‰å¯¹è¯ï¼Œå¼€å¯æ–°è¯é¢˜",children:e.jsx(x,{icon:e.jsx(ls,{}),size:"small",onClick:ue})})]})]}),e.jsx(q,{type:"secondary",style:{fontSize:12,marginTop:8,display:"block",textAlign:"center"},children:"AI å»ºè®®ä»…ä¾›å‚è€ƒï¼Œé‡å¤§æ³•å¾‹äº‹åŠ¡è¯·å’¨è¯¢çº¿ä¸‹å¾‹å¸ˆã€‚"})]})]}),e.jsx(hs,{width:280,theme:"light",style:{borderLeft:"1px solid #f0f0f0",padding:16},children:e.jsxs(G,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(Ue,{size:"small",bordered:!1,className:"expert-card-right",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(ne,{size:64,src:B.avatar,icon:e.jsx(he,{}),style:{marginBottom:12,backgroundColor:C==="assistant"?"#52c41a":"#722ed1"}}),e.jsx(J,{level:5,style:{margin:0},children:C==="specialist"&&U.role?U.role:B.name}),e.jsx(q,{type:"secondary",style:{fontSize:12},children:C==="specialist"&&U.domain?`ä¸“ä¸šé¢†åŸŸï¼š${U.domain}`:B.title}),e.jsxs("div",{style:{marginTop:12,display:"flex",justifyContent:"space-around",background:"#f9f9f9",padding:8,borderRadius:4},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:B.cases}),e.jsx("div",{style:{fontSize:10,color:"#999"},children:"æœåŠ¡æ¡ˆä¾‹"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:B.success_rate}),e.jsx("div",{style:{fontSize:10,color:"#999"},children:"å¥½è¯„ç‡"})]})]})]})}),e.jsx(We,{moduleName:"consultation",moduleLabel:"æ™ºèƒ½å’¨è¯¢"}),e.jsxs("div",{className:"quick-tools",children:[e.jsx(ve,{orientation:"left",style:{margin:"12px 0"},children:e.jsx(q,{type:"secondary",style:{fontSize:12},children:"å¿«æ·å·¥å…·"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(x,{block:!0,size:"small",icon:e.jsx(Ke,{}),onClick:()=>d("/risk-analysis"),children:"é£é™©è¯„ä¼°"}),e.jsx(x,{block:!0,size:"small",icon:e.jsx(_e,{}),onClick:()=>d("/litigation-analysis"),children:"æ¡ˆä»¶åˆ†æ"}),e.jsx(x,{block:!0,size:"small",icon:e.jsx(Ae,{}),onClick:()=>d("/contract/generate"),children:"åˆåŒç”Ÿæˆ"}),e.jsx(x,{block:!0,size:"small",icon:e.jsx(es,{}),onClick:()=>d("/contract/review"),children:"åˆåŒå®¡æŸ¥"}),e.jsx(x,{block:!0,size:"small",icon:e.jsx(Ge,{}),onClick:()=>d("/contract"),children:"æ¨¡æ¿æŸ¥è¯¢"}),e.jsx(x,{block:!0,size:"small",icon:e.jsx(Qe,{}),onClick:()=>d("/document-processing"),children:"æ–‡æ¡£å¤„ç†"}),e.jsx(x,{block:!0,size:"small",icon:e.jsx(oe,{}),onClick:()=>d("/document-drafting"),children:"æ–‡ä¹¦èµ·è‰"}),e.jsx(x,{block:!0,size:"small",icon:e.jsx(Pe,{}),onClick:()=>d("/cost-calculation"),children:"è´¹ç”¨æµ‹ç®—"})]})]})]})})]})]})};export{Us as default};
