import{r as g,j as e,T as z,S as i,d as u,i as R,B as v,ag as X,k as Y,u as Z,e as ee,I as se,s as w,o as B}from"./index-roHVKWBY.js";import{R as D}from"./index-64Mw5-Gk.js";import{R as le}from"./StarOutlined-DB1r71SV.js";import{R as E}from"./ClockCircleOutlined-C2t8-iE_.js";import{R as U}from"./CheckCircleOutlined-CAL-yran.js";import{R as ie}from"./ThunderboltOutlined-ZTNTzZa_.js";import{A as C}from"./DownloadOutlined-rr9bHkiC.js";import{R as re}from"./InfoCircleOutlined-BY0eFwme.js";import{S as ne}from"./index-DpzQQA4h.js";import{R as te}from"./LinkOutlined-BexgUSzY.js";import{R as ae}from"./WarningOutlined-DRn33097.js";import{u as ce}from"./useSessionPersistence-MS_hwzFH.js";import{R as F}from"./ArrowLeftOutlined-BgXNOdqB.js";import{U as oe}from"./index-CTgI8CvL.js";import{R as de}from"./InboxOutlined-C_zOUenq.js";import{R as me}from"./SendOutlined-KN9mdme5.js";import{R as he}from"./ReloadOutlined-BbVeIh-b.js";import"./useBubbleLock-DlAGXlXo.js";import"./progress-tAVtoyWK.js";import"./PaperClipOutlined-8mdHwa14.js";import"./DeleteOutlined-BTxcvY44.js";const{Text:_,Paragraph:M}=z,xe=({options:s,defaultChoice:N,onConfirm:p,loading:t=!1})=>{const[r,a]=g.useState(N),d=s[r],f=c=>{a(c.target.value)},y=()=>{p(r)};return e.jsxs("div",{className:"planning-mode-selector",children:[e.jsxs("div",{className:"selector-header",children:[e.jsx(z.Title,{level:3,children:"请选择规划模式"}),e.jsx(M,{type:"secondary",children:'系统已识别您的需求为"合同规划"场景，请选择您偏好的规划模式：'})]}),e.jsx(D.Group,{value:r,onChange:f,className:"mode-radio-group",disabled:t,children:e.jsxs(i,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsx(D,{value:"multi_model",disabled:!s.multi_model.available||t,className:r==="multi_model"?"radio-card-selected":"",children:e.jsxs(u,{className:`mode-card ${r==="multi_model"?"selected":""} ${s.multi_model.recommended?"recommended":""}`,hoverable:!0,onClick:()=>{s.multi_model.available&&!t&&a("multi_model")},children:[e.jsxs("div",{className:"mode-card-header",children:[e.jsxs(i,{children:[e.jsx(le,{className:"recommend-icon"}),e.jsx(_,{strong:!0,children:s.multi_model.name}),s.multi_model.recommended&&e.jsx(R,{color:"gold",children:"推荐"}),s.multi_model.expected_quality==="高质量"&&e.jsx(R,{color:"success",children:"高质量"})]}),!s.multi_model.available&&e.jsx(R,{color:"error",children:"暂不可用"})]}),e.jsx(M,{className:"mode-description",children:s.multi_model.description}),e.jsxs("div",{className:"mode-features",children:[e.jsx(_,{type:"secondary",children:"特点："}),e.jsx("ul",{children:s.multi_model.features.map((c,m)=>e.jsx("li",{children:c},m))})]}),e.jsx("div",{className:"mode-info",children:e.jsxs(i,{size:"large",children:[e.jsxs(_,{children:[e.jsx(E,{})," 预计时间：",s.multi_model.processing_time]}),e.jsxs(_,{children:[e.jsx(U,{})," 质量预期：",s.multi_model.expected_quality]})]})})]})}),e.jsx(D,{value:"single_model",disabled:!s.single_model.available||t,className:r==="single_model"?"radio-card-selected":"",children:e.jsxs(u,{className:`mode-card ${r==="single_model"?"selected":""}`,hoverable:!0,onClick:()=>{s.single_model.available&&!t&&a("single_model")},children:[e.jsx("div",{className:"mode-card-header",children:e.jsxs(i,{children:[e.jsx(ie,{}),e.jsx(_,{strong:!0,children:s.single_model.name}),s.single_model.expected_quality==="标准质量"&&e.jsx(R,{color:"blue",children:"标准质量"})]})}),e.jsx(M,{className:"mode-description",children:s.single_model.description}),e.jsxs("div",{className:"mode-features",children:[e.jsx(_,{type:"secondary",children:"特点："}),e.jsx("ul",{children:s.single_model.features.map((c,m)=>e.jsx("li",{children:c},m))})]}),e.jsx("div",{className:"mode-info",children:e.jsxs(i,{size:"large",children:[e.jsxs(_,{children:[e.jsx(E,{})," 预计时间：",s.single_model.processing_time]}),e.jsxs(_,{children:[e.jsx(U,{})," 质量预期：",s.single_model.expected_quality]})]})})]})})]})}),e.jsx(C,{message:`您选择了：${d.name}`,description:e.jsxs("div",{children:[e.jsxs("div",{children:["• ",d.description]}),e.jsxs("div",{children:["• 预计耗时：",d.processing_time]}),e.jsxs("div",{children:["• 质量预期：",d.expected_quality]})]}),type:"info",showIcon:!0,icon:e.jsx(re,{}),style:{marginTop:16}}),e.jsx(v,{type:"primary",size:"large",block:!0,onClick:y,loading:t,disabled:!d.available,style:{marginTop:24},children:"确认选择并开始规划"})]})},{Text:T,Paragraph:G,Title:ue}=z,pe=({result:s,onContinue:N})=>{const{analysis_result:p}=s,{contracts:t,signing_order:r,relationships:a,risk_notes:d,overall_description:f,planning_mode:y}=p,c=()=>y==="multi_model"?"gold":"blue",m=()=>y==="multi_model"?"多模型综合融合":"单模型快速生成";return e.jsxs("div",{className:"planning-result-display",children:[e.jsx(u,{className:"result-header",children:e.jsxs(i,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsxs(i,{children:[e.jsx(X,{style:{fontSize:24,color:"#1890ff"}}),e.jsx(ue,{level:3,style:{margin:0},children:"合同规划完成"}),e.jsx(R,{color:c(),children:m()})]}),e.jsx(G,{type:"secondary",children:f}),e.jsxs(i,{children:[e.jsx(T,{strong:!0,children:"合同数量："}),e.jsxs(T,{children:[p.total_estimated_contracts," 份"]})]})]})}),e.jsx(u,{title:"规划合同清单",className:"contracts-list",children:e.jsx(i,{direction:"vertical",size:"middle",style:{width:"100%"},children:t.map((l,h)=>e.jsx(u,{size:"small",className:"contract-item",hoverable:!0,children:e.jsxs(i,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsxs(i,{children:[e.jsx(R,{color:"blue",children:h+1}),e.jsx(T,{strong:!0,children:l.title}),e.jsx(R,{children:l.contract_type}),e.jsxs(R,{color:"geekblue",children:["优先级：",l.priority]})]}),e.jsx(G,{type:"secondary",style:{margin:0},children:l.purpose})]})},l.id))})}),e.jsx(u,{title:"建议签署顺序",className:"signing-order",children:e.jsx(ne,{direction:"vertical",current:-1,items:r.map((l,h)=>{const j=t.find(x=>x.id===l);return{title:j?.title||l,description:j?.purpose||"",icon:e.jsx(Y,{}),status:"finish"}})})}),Object.keys(a).length>0&&e.jsx(u,{title:"合同关联关系",className:"relationships",children:e.jsx(i,{direction:"vertical",size:"middle",style:{width:"100%"},children:Object.entries(a).map(([l,h])=>{const j=t.find(x=>x.id===l);return e.jsxs("div",{children:[e.jsxs(i,{children:[e.jsx(te,{}),e.jsx(T,{strong:!0,children:j?.title||l})]}),e.jsx("div",{style:{marginLeft:24,marginTop:8},children:h.map((x,k)=>e.jsxs("div",{style:{color:"#666"},children:["• ",x]},k))})]},l)})})}),d.length>0&&e.jsx(u,{children:e.jsxs(i,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsxs(i,{children:[e.jsx(ae,{style:{color:"#faad14"}}),e.jsx(T,{strong:!0,children:"风险提示"})]}),e.jsx(C,{message:"请特别注意以下风险点",description:e.jsx("ul",{style:{margin:0,paddingLeft:16},children:d.map((l,h)=>e.jsx("li",{children:l},h))}),type:"warning",showIcon:!0})]})}),e.jsx(C,{message:"下一步操作",description:"您可以查看规划结果，确认后可以继续生成具体合同内容，或调整需求重新规划。",type:"info",showIcon:!0,style:{marginTop:16}})]})},{TextArea:je}=se,{Dragger:ge}=oe,{Title:$,Paragraph:fe,Text:ye}=z,Ee=()=>{const s=Z(),[N,p]=g.useState(!1),[t,r]=g.useState(""),[a,d]=g.useState(""),[f,y]=g.useState([]),[c,m]=g.useState("input"),[l,h]=g.useState(null),[j,x]=g.useState(null),{hasSession:k,saveSession:H,clearSession:q,isLoading:L}=ce("contract_planning_session",{expirationTime:7200*1e3,onRestore:(o,n)=>{console.log("[合同规划] 恢复会话:",n),m(n.step),d(n.userInput||""),h(n.choiceResponse),x(n.planningResult),w.success("已恢复之前的合同规划会话")}}),J=()=>{H(Date.now().toString(),{step:c,userInput:a,fileList:f.map(o=>o.name||o.uid),choiceResponse:l,planningResult:j})};g.useEffect(()=>{(c!=="input"||a)&&J()},[c,a,l,j]);const K={name:"file",multiple:!0,fileList:f,beforeUpload:()=>!1,onChange:({fileList:o})=>{y(o.slice(-5))}},Q=async()=>{if(!a.trim()){w.error("请输入您的需求描述");return}p(!0),r("");try{const o=[];for(const I of f)I.originFileObj&&new FormData().append("file",I.originFileObj);const n={user_input:a,uploaded_files:o},b=(await B.analyzeAndGetClarificationForm(n)).data;if(b.processing_type==="contract_planning")"requires_user_choice"in b&&b.requires_user_choice?(h(b),m("select_mode")):(x(b),m("result"));else throw new Error("未识别为合同规划场景")}catch(o){console.error("分析失败:",o);const n=o.response?.data?.detail||o.message||"分析失败，请重试";r(n),w.error(n)}finally{p(!1)}},V=async o=>{p(!0),r("");try{const n=[];for(const P of f)P.originFileObj&&new FormData().append("file",P.originFileObj);const S={user_input:a,uploaded_files:n,planning_mode:o},I=(await B.analyzeAndGetClarificationForm(S)).data;x(I),m("result"),w.success("合同规划完成！")}catch(n){console.error("规划失败:",n);const S=n.response?.data?.detail||n.message||"规划失败，请重试";r(S),w.error(S)}finally{p(!1)}},A=()=>{q(),m("input"),d(""),y([]),h(null),x(null),r("")},O=()=>{s("/")},W=()=>{q(),m("input"),d(""),y([]),h(null),x(null),r("")};return e.jsxs("div",{className:"contract-planning-page",children:[e.jsx("div",{className:"page-header",children:e.jsxs(i,{children:[e.jsx(v,{icon:e.jsx(F,{}),onClick:O,children:"返回首页"}),e.jsx($,{level:2,style:{margin:0},children:"智能合同规划"})]})}),e.jsx(ee,{spinning:N||L,tip:L?"正在恢复会话...":"正在分析需求...",size:"large",children:e.jsxs("div",{className:"page-content",children:[k&&c==="input"&&e.jsx(C,{message:"检测到之前的会话",description:e.jsxs(i,{direction:"vertical",size:"small",children:[e.jsx(ye,{children:"系统检测到您之前有一个未完成的合同规划会话。您可以："}),e.jsxs(i,{children:[e.jsx(v,{size:"small",type:"primary",onClick:()=>{window.location.reload()},children:"继续之前的规划"}),e.jsx(v,{size:"small",onClick:W,children:"开始新规划"})]})]}),type:"info",showIcon:!0,closable:!0,style:{marginBottom:16}}),c==="input"&&e.jsxs(u,{className:"input-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx($,{level:3,children:"描述您的需求"}),e.jsx(fe,{type:"secondary",children:"请详细描述您的复杂交易需求，系统将为您规划所需的合同清单、签署顺序和关联关系。"})]}),e.jsxs("div",{className:"form-section",children:[e.jsx($,{level:5,children:"1. 上传相关材料（可选）"}),e.jsxs(ge,{...K,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(de,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),e.jsx("p",{className:"ant-upload-hint",children:"支持单个或多个文件，如现有合同、项目资料等"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx($,{level:5,children:"2. 描述您的需求"}),e.jsx(je,{rows:6,value:a,onChange:o=>d(o.target.value),placeholder:"例如：我要收购一家科技公司，需要设计完整的交易结构，包括股权转让、员工安置、知识产权转让等...",maxLength:3e3,showCount:!0})]}),e.jsx(v,{type:"primary",size:"large",block:!0,icon:e.jsx(me,{}),onClick:Q,disabled:N||!a.trim(),children:"开始分析需求"}),t&&e.jsx(C,{message:"操作失败",description:t,type:"error",showIcon:!0,closable:!0,style:{marginTop:16},onClose:()=>r("")})]}),c==="select_mode"&&l&&e.jsxs(u,{className:"select-mode-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs(v,{onClick:A,style:{marginBottom:16},children:[e.jsx(F,{})," 重新输入"]})}),e.jsx(xe,{options:l.user_choice_options,defaultChoice:l.default_choice,onConfirm:V,loading:N}),t&&e.jsx(C,{message:"操作失败",description:t,type:"error",showIcon:!0,closable:!0,style:{marginTop:16},onClose:()=>r("")})]}),c==="result"&&j&&e.jsxs(u,{className:"result-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs(i,{children:[e.jsxs(v,{onClick:A,children:[e.jsx(he,{})," 重新规划"]}),e.jsxs(v,{onClick:O,children:[e.jsx(F,{})," 返回首页"]})]})}),e.jsx(pe,{result:j})]})]})})]})};export{Ee as default};
