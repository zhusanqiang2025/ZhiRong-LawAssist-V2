import{r as o,j as e,d as p,e as V,S as v,T as x,h as q,B as k,q as H,t as Y,v as J,E as R,c as K,C as Q,p as F,i as r,u as X,w as Z,x as ee,y as se,k as te,I as ie,l as ne,s as M,o as re}from"./index-BYD9hiRj.js";import{c as A}from"./contractTemplates-OYCsczGX.js";import{A as W,R as G}from"./DownloadOutlined-B6G0t9cA.js";import{R as L}from"./index-BRQJlRky.js";import{R as O}from"./StarOutlined-BPIeKP4X.js";import{R as U}from"./InboxOutlined-ysIJY5gk.js";import{U as oe}from"./index-BUXSLazN.js";import{R as le}from"./SendOutlined-TS7DvRPn.js";import"./useBubbleLock-_0sC_zTy.js";import"./PaperClipOutlined-B0ZokrYc.js";import"./DeleteOutlined-CiqcE3-2.js";import"./progress-s1QZWrHJ.js";const{Option:ae}=q,{Text:u,Title:ce}=x,de=({onSelectTemplate:T,selectedTemplateId:h,showUserTemplates:d=!0})=>{const[z,C]=o.useState([]),[j,_]=o.useState([]),[y,N]=o.useState([]),[n,I]=o.useState(!1),[l,E]=o.useState(""),[m,f]=o.useState(""),[w,B]=o.useState("card");o.useEffect(()=>{i()},[]);const i=async()=>{I(!0),f("");try{const[t,a,s]=await Promise.all([A.getCategoryTree(!0),A.getTemplates({scope:"public",page_size:100}),d?A.getTemplates({scope:"my",page_size:100}):Promise.resolve({templates:[]})]);C(t),_(a.templates),N(s.templates)}catch(t){const a=t.response?.data?.detail||t.message||"加载模版数据失败";f(a)}finally{I(!1)}},c=t=>{E(t)},g=t=>{const a=[...j,...y].find(s=>s.id===t);a&&T&&T(a)},P=t=>l?t.filter(a=>a.category===l):t,$=(t,a)=>t.length===0?null:e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs(ce,{level:5,style:{marginBottom:12},children:[a," (",t.length,")"]}),e.jsx(K,{gutter:[16,16],children:t.map(s=>e.jsx(Q,{xs:24,sm:12,md:8,lg:6,children:e.jsxs(p,{hoverable:!0,onClick:()=>g(s.id),style:{height:"100%",border:h===s.id?"2px solid #1890ff":"1px solid #d9d9d9",position:"relative"},bodyStyle:{padding:16},children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx(F,{title:s.name,children:e.jsx(u,{strong:!0,ellipsis:!0,style:{fontSize:14},children:s.name})})}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(r,{color:"blue",style:{fontSize:11},children:s.category}),s.subcategory&&e.jsx(r,{color:"cyan",style:{fontSize:11},children:s.subcategory}),e.jsx(r,{color:s.is_public?"green":"orange",style:{fontSize:11},children:s.is_public?"公有":"私有"})]}),s.description&&e.jsx(F,{title:s.description,children:e.jsx(u,{type:"secondary",ellipsis:!0,style:{fontSize:12,display:"block",marginBottom:8,height:36},children:s.description})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:8},children:[e.jsxs(v,{size:4,children:[s.rating>0&&e.jsxs(r,{color:"gold",style:{fontSize:11,margin:0},children:[e.jsx(O,{style:{fontSize:10}})," ",s.rating.toFixed(1)]}),e.jsxs(r,{style:{fontSize:11,margin:0},children:[e.jsx(G,{style:{fontSize:10}})," ",s.download_count]})]}),h===s.id&&e.jsx(r,{color:"blue",style:{fontSize:11},children:"已选择"})]})]})},s.id))})]}),D=(t,a)=>t.length===0?null:e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:e.jsxs(u,{strong:!0,style:{fontSize:13},children:[a," (",t.length,")"]})}),e.jsx(v,{direction:"vertical",style:{width:"100%"},size:"small",children:t.map(s=>e.jsx(p,{size:"small",hoverable:!0,onClick:()=>g(s.id),style:{border:h===s.id?"2px solid #1890ff":"1px solid #d9d9d9"},bodyStyle:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx(u,{strong:!0,ellipsis:!0,style:{fontSize:13},children:s.name}),e.jsx(r,{color:"blue",style:{fontSize:11,margin:0,flexShrink:0},children:s.category}),s.subcategory&&e.jsx(r,{color:"cyan",style:{fontSize:11,margin:0,flexShrink:0},children:s.subcategory}),e.jsx(r,{color:s.is_public?"green":"orange",style:{fontSize:11,margin:0,flexShrink:0},children:s.is_public?"公有":"私有"}),h===s.id&&e.jsx(r,{color:"blue",style:{fontSize:11,margin:0,flexShrink:0},children:"已选择"})]}),s.description&&e.jsx(u,{type:"secondary",ellipsis:!0,style:{fontSize:12,display:"block"},children:s.description})]}),e.jsxs(v,{size:12,style:{flexShrink:0,marginLeft:16},children:[s.rating>0&&e.jsxs(r,{color:"gold",style:{fontSize:11,margin:0},children:[e.jsx(O,{style:{fontSize:10}})," ",s.rating.toFixed(1)]}),e.jsxs(r,{style:{fontSize:11,margin:0},children:[e.jsx(G,{style:{fontSize:10}})," ",s.download_count]})]})]})},s.id))})]});if(n)return e.jsx(p,{title:"选择合同模版",style:{marginBottom:16},children:e.jsx("div",{style:{textAlign:"center",padding:"20px"},children:e.jsx(V,{size:"large",tip:"正在加载模版..."})})});const S=P(j),b=P(y);return e.jsxs(p,{title:"选择合同模版",style:{marginBottom:16},children:[m&&e.jsx(W,{message:"加载失败",description:m,type:"error",showIcon:!0,closable:!0,style:{marginBottom:16},onClose:()=>f("")}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:12},children:[e.jsxs(v,{children:[e.jsx(u,{strong:!0,children:"合同类型："}),e.jsx(q,{style:{width:200},placeholder:"请选择合同类型",allowClear:!0,onChange:c,value:l,children:z.map(t=>e.jsx(ae,{value:t.name,children:t.name},t.id))}),e.jsx(k,{icon:e.jsx(H,{}),onClick:i,children:"刷新"})]}),e.jsxs(L.Group,{value:w,onChange:t=>B(t.target.value),buttonStyle:"solid",children:[e.jsxs(L.Button,{value:"card",children:[e.jsx(Y,{})," 卡片"]}),e.jsxs(L.Button,{value:"list",children:[e.jsx(J,{})," 列表"]})]})]}),e.jsx("div",{style:{marginBottom:16,fontSize:12,color:"#666"},children:e.jsxs(v,{children:[e.jsxs("span",{children:["公有模版: ",e.jsx(u,{strong:!0,children:S.length})," 个"]}),d&&e.jsxs("span",{children:["我的模版: ",e.jsx(u,{strong:!0,children:b.length})," 个"]})]})}),w==="card"?e.jsxs(e.Fragment,{children:[$(S,"公有模版"),d&&$(b,"我的模版"),S.length===0&&(!d||b.length===0)&&e.jsx(R,{description:"暂无模版",image:R.PRESENTED_IMAGE_SIMPLE,style:{marginTop:16}})]}):e.jsxs(e.Fragment,{children:[D(S,"公有模版"),d&&D(b,"我的模版"),S.length===0&&(!d||b.length===0)&&e.jsx(R,{description:"暂无模版",image:R.PRESENTED_IMAGE_SIMPLE,style:{marginTop:16}})]})]})},{TextArea:ge}=ie,{Dragger:ue}=oe,Ce=()=>{const T=X(),h=Z(),{logout:d}=ee(),[z,C]=o.useState(!1),[j,_]=o.useState(""),[y,N]=o.useState([]),[n,I]=o.useState(null),[l,E]=o.useState("文书生成"),[m,f]=o.useState("");o.useEffect(()=>{const c=new URLSearchParams(h.search).get("type");(c==="judicial_document"||c==="contract_drafting")&&E(c)},[h.search]);const w={name:"file",multiple:!0,fileList:y,beforeUpload:()=>!1,onChange:({fileList:i})=>{N(i.slice(-5))},onDrop:i=>{ne.debug("Dropped files",i.dataTransfer.files)}},B=async()=>{if(!m.trim()){M.error("请输入您的需求描述");return}C(!0),_("");try{const i=new FormData;i.append("query",m),i.append("demand_categories",l),y.forEach(g=>{g.originFileObj&&i.append("files",g.originFileObj,g.name)}),n&&n.id&&i.append("template_id",n.id);const c=await re.post("/workflow/start",i,{headers:{"Content-Type":"multipart/form-data"}});if(c.data.task_id){const g=l==="judicial_document"?"司法文书":n?.category||"文书生成";T(`/result?task_id=${c.data.task_id}&doc_type=${encodeURIComponent(g)}`)}else throw new Error("No task ID received")}catch(i){console.error("Submit error:",i);const c=i.response?.data?.detail||i.message||"提交失败，请重试";_(c),M.error(c)}finally{C(!1)}};return e.jsxs("div",{className:"home-layout",children:[e.jsxs("div",{className:"home-header",children:[e.jsxs("div",{className:"logo",children:[e.jsx(se,{}),e.jsx("span",{children:"法律文书生成助手"})]}),e.jsx(k,{type:"link",onClick:d,children:"退出登录"})]}),e.jsx("div",{className:"home-content",children:e.jsx(V,{spinning:z,tip:"正在提交分析任务...",size:"large",children:e.jsxs(p,{className:"form-card",bordered:!1,children:[e.jsxs("div",{className:"form-header",children:[e.jsx(x.Title,{level:2,children:l==="judicial_document"?"司法文书生成":"智能案情分析"}),e.jsx(x.Paragraph,{type:"secondary",children:l==="judicial_document"?"请详细说明您的司法文书需求，并上传相关证据材料，AI将基于您提供的信息为您生成专业的司法文书。":"选择合适的合同模版，说明您的需求，并上传相关材料，AI Agent 将基于您选择的模版进行分析，并生成最适合的法律文书。"}),l==="judicial_document"&&e.jsx(r,{color:"blue",style:{marginTop:8},children:"司法文书工作流已启动"})]}),l!=="judicial_document"&&e.jsxs("div",{className:"form-section",children:[e.jsx(x.Title,{level:5,className:"section-title",children:"1. 选择合同模版"}),e.jsx(de,{onSelectTemplate:I,selectedTemplateId:n?.id})]}),n&&l!=="judicial_document"&&e.jsx(p,{size:"small",style:{marginTop:12,backgroundColor:"#f6ffed"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs(x.Text,{strong:!0,children:["已选择模版: ",n.name]}),e.jsxs("div",{style:{marginTop:4},children:[e.jsx(r,{color:"blue",children:n.category}),e.jsx(r,{color:n.is_public?"green":"orange",children:n.is_public?"公有":"私有"}),n.rating>0&&e.jsxs(r,{color:"gold",children:["⭐ ",n.rating.toFixed(1)]})]}),n.description&&e.jsx(x.Text,{type:"secondary",style:{fontSize:12},children:n.description})]}),e.jsx(k,{icon:e.jsx(te,{}),size:"small",children:"下载模版"})]})}),e.jsxs("div",{className:"form-section",children:[e.jsxs(x.Title,{level:5,className:"section-title",children:[e.jsx(U,{})," ",l==="judicial_document"?"2. 上传证据材料":"2. 上传相关材料"," (可选)"]}),e.jsxs(ue,{...w,className:"upload-dragger",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(U,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),e.jsx("p",{className:"ant-upload-hint",children:l==="judicial_document"?"支持单个或多个文件，如证据材料、起诉状、答辩状、判决书等":"支持单个或多个文件，如合同、聊天记录、起诉状等"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs(x.Title,{level:5,className:"section-title",children:[e.jsx(le,{})," 3. 描述您的需求"]}),e.jsx(ge,{rows:4,value:m,onChange:i=>f(i.target.value),placeholder:l==="judicial_document"?"请详细描述您的司法文书需求，例如：起草答辩状、修改合同条款、生成起诉状等...":n?`请描述您对《${n.name}》的具体需求和修改要求...`:"请描述您的案情和法律需求...",maxLength:2e3,showCount:!0})]}),e.jsx(k,{type:"primary",size:"large",block:!0,className:"submit-button",onClick:B,disabled:z,children:"开始智能分析"}),j&&e.jsx(W,{message:"操作失败",description:j,type:"error",showIcon:!0,style:{marginTop:16}})]})})}),e.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"法律文书生成助手 ©2025 Created by YourTeam"})]})};export{Ce as default};
