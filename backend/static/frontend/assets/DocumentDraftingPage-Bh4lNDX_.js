import{u as W,w as $,r,s as a,j as e,S as v,T as G,B as n,d as u,c as O,C as J,k as b,e as K,H as Q,F as B,I as V,h as z,o as X}from"./index-7T25hRnl.js";import{E as Y}from"./EnhancedModuleNavBar-CEW55FzO.js";import{u as Z}from"./useSessionPersistence-ChNy_7iz.js";import{A as ee}from"./DownloadOutlined-3LjHRHuZ.js";import{S as A}from"./index-COI8aEhi.js";import{R as te}from"./CheckCircleOutlined-DhhXUuLD.js";import{U as se}from"./index-Cn333nvA.js";import{R as re}from"./UploadOutlined-CD3BBQem.js";import{D as ne}from"./index-CxNe3LSK.js";import"./ArrowLeftOutlined-C0dkYYT0.js";import"./DiffOutlined-BWhhxZJu.js";import"./progress-BFvY0J03.js";import"./PaperClipOutlined-DFi3U0Pa.js";import"./DeleteOutlined-Bc5d-nRr.js";const{Step:ve}=A,{TextArea:ie}=V,{Option:f}=z,{Title:I,Text:ae,Paragraph:m}=G,Ce=()=>{const D=W(),C=$(),[p,i]=r.useState(0),[l,h]=r.useState(""),[c,g]=r.useState(""),[x,E]=r.useState([]),[y,R]=r.useState(!1),[j,S]=r.useState(""),[T,N]=r.useState([]),[F,_]=r.useState(!0),d=r.useRef(!1),o=r.useRef(!1),{hasSession:k,saveSession:L,clearSession:U,isLoading:H}=Z("document_drafting_session",{expirationTime:7200*1e3,autoRestore:!1,onRestore:(t,s)=>{console.log("[文书起草] 恢复会话:",s),o.current=!0,i(s.step),h(s.selectedType||""),g(s.userInput||""),S(s.generatedContent||""),setTimeout(()=>{d.current=!0,o.current=!1},0)}}),P=()=>{if(o.current){console.log("[文书起草] 正在恢复会话，跳过保存");return}L(Date.now().toString(),{step:p,selectedType:l,userInput:c,uploadedFiles:x.map(t=>t.name||t.uid),generatedContent:j})};r.useEffect(()=>{if(!(d.current||o.current))if(k){console.log("[文书起草] 检测到会话，准备恢复"),o.current=!0;const t=localStorage.getItem("document_drafting_session");if(t)try{const s=JSON.parse(t);s.data&&(i(s.data.step||0),h(s.data.selectedType||""),g(s.data.userInput||""),S(s.data.generatedContent||""),a.success("已恢复之前的文书起草会话"),setTimeout(()=>{d.current=!0,o.current=!1},100))}catch(s){console.error("[文书起草] 恢复会话失败:",s),d.current=!0,o.current=!1}else d.current=!0}else d.current=!0},[]),r.useEffect(()=>{d.current&&!o.current&&!H&&(p>0||l||c)&&P()},[p,l,c,j]),r.useEffect(()=>{const t=C.state;t?.requirement&&(g(t.requirement),a.success("已根据您的需求自动填充内容"))},[C.state]),r.useEffect(()=>{(async()=>{try{_(!0),N([{id:"lawyer_letter",name:"律师函",description:"律师事务所函件，用于催告、通知等",category:"letter"},{id:"demand_letter",name:"催告函",description:"催告履行义务的函件",category:"letter"},{id:"notification_letter",name:"通知函",description:"各类通知告知函件",category:"letter"},{id:"civil_complaint",name:"民事起诉状",description:"民事诉讼起诉状",category:"judicial"},{id:"defense_statement",name:"答辩状",description:"被告答辩状",category:"judicial"},{id:"evidence_list",name:"证据清单",description:"诉讼证据清单",category:"judicial"},{id:"application",name:"申请书",description:"各类申请书（财产保全、先予执行等）",category:"judicial"},{id:"power_of_attorney",name:"授权委托书",description:"诉讼授权委托书",category:"judicial"}])}catch(s){console.error("获取文书类型失败:",s),a.error("获取文书类型失败")}finally{_(!1)}})()},[]);const q=async()=>{if(!l){a.warning("请选择文书类型");return}if(!c.trim()){a.warning("请描述您的需求");return}R(!0);try{const t=await X.post("/document-drafting/generate",{user_input:c,uploaded_files:x.map(s=>s.response?.file_path||s.url),document_type:l});if(t.data.status==="success"&&t.data.generated_documents.length>0){const s=t.data.generated_documents[0];S(s.content),i(3),a.success("文书生成成功！")}else a.error(t.data.message||"文书生成失败")}catch(t){console.error("生成失败:",t),a.error(t.response?.data?.detail||"生成失败，请重试")}finally{R(!1)}},w=()=>{D("/")},M=()=>{if(F)return e.jsx(u,{style:{textAlign:"center",padding:"48px"},children:e.jsx(K,{tip:"加载中..."})});switch(p){case 0:return e.jsxs(u,{title:"选择文书类型",className:"step-card",children:[e.jsx(m,{type:"secondary",children:"请选择您需要起草的文书类型，系统将根据您的选择使用相应的专业模板。"}),e.jsxs(z,{style:{width:"100%",marginBottom:24},placeholder:"请选择文书类型",value:l||void 0,onChange:h,size:"large",children:[e.jsx(f,{disabled:!0,style:{fontWeight:"bold",background:"#f5f5f5"},children:"── 函件类 ──"},"letter"),T.filter(t=>t.category==="letter").map(t=>e.jsxs(f,{value:t.id,children:[t.name," - ",t.description]},t.id)),e.jsx(f,{disabled:!0,style:{fontWeight:"bold",background:"#f5f5f5"},children:"── 司法文书类 ──"},"judicial"),T.filter(t=>t.category==="judicial").map(t=>e.jsxs(f,{value:t.id,children:[t.name," - ",t.description]},t.id))]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(n,{onClick:w,style:{marginRight:8},children:"返回"}),e.jsx(n,{type:"primary",size:"large",onClick:()=>i(1),disabled:!l,children:"下一步"})]})]});case 1:return e.jsxs(u,{title:"描述您的需求",className:"step-card",children:[e.jsx(m,{type:"secondary",children:"请详细描述您要起草的文书内容，包括当事人信息、事实经过、具体要求等。"}),e.jsx(B,{layout:"vertical",children:e.jsx(B.Item,{label:"需求描述",required:!0,children:e.jsx(ie,{rows:8,placeholder:`请详细描述您要起草的文书内容...

例如：
1. 当事人信息（原告/被告、收件人等）
2. 事实经过
3. 具体请求或要求
4. 其他需要说明的情况`,value:c,onChange:t=>g(t.target.value)})})}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(n,{onClick:()=>i(0),style:{marginRight:8},children:"上一步"}),e.jsx(n,{type:"primary",size:"large",onClick:()=>i(2),disabled:!c.trim(),children:"下一步"})]})]});case 2:return e.jsxs(u,{title:"上传相关资料（可选）",className:"step-card",children:[e.jsx(m,{type:"secondary",children:"您可以上传相关文件（如合同、证据材料等），系统将提取其中的信息作为参考。此步骤可选。"}),e.jsx(se,{fileList:x,onChange:({fileList:t})=>E(t),beforeUpload:()=>!1,multiple:!0,children:e.jsx(n,{icon:e.jsx(re,{}),size:"large",children:"点击上传文件"})}),e.jsx(m,{type:"secondary",style:{marginTop:16,marginBottom:24},children:"支持的文件格式：PDF、Word、图片等"}),e.jsx(ne,{}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(n,{onClick:()=>i(1),style:{marginRight:8},children:"上一步"}),e.jsx(n,{type:"primary",size:"large",onClick:q,loading:y,icon:y?e.jsx(Q,{}):e.jsx(b,{}),children:y?"生成中...":"生成文书"})]})]});case 3:return e.jsxs(u,{title:"生成的文书",className:"step-card",extra:e.jsx(n,{onClick:()=>i(0),children:"重新生成"}),children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[e.jsx(te,{style:{fontSize:48,color:"#52c41a"}}),e.jsx(I,{level:3,style:{marginTop:16,marginBottom:8},children:"文书生成成功！"}),e.jsx(m,{type:"secondary",children:"系统已根据您的需求和专业模板生成了以下文书"})]}),e.jsx("div",{className:"document-content",style:{background:"#f5f5f5",padding:24,borderRadius:8,marginBottom:24,maxHeight:600,overflow:"auto",whiteSpace:"pre-wrap",lineHeight:1.8},children:j}),e.jsx("div",{style:{textAlign:"center"},children:e.jsxs(v,{children:[e.jsx(n,{size:"large",onClick:()=>i(0),children:"重新生成"}),e.jsx(n,{type:"primary",size:"large",onClick:w,children:"返回工作台"})]})})]});default:return null}};return e.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"#f0f2f5"},children:[e.jsx(Y,{currentModuleKey:"document-drafting"}),e.jsxs("div",{style:{flex:1,padding:"24px"},children:[k&&p===0&&e.jsx(ee,{message:"检测到之前的会话",description:e.jsxs(v,{direction:"vertical",size:"small",children:[e.jsx(ae,{children:"系统检测到您之前有一个未完成的文书起草会话。您可以："}),e.jsxs(v,{children:[e.jsx(n,{size:"small",type:"primary",onClick:()=>{window.location.reload()},children:"继续之前的起草"}),e.jsx(n,{size:"small",onClick:()=>{U(),a.info("已清除之前的会话，可以开始新的起草")},children:"开始新起草"})]})]}),type:"info",showIcon:!0,closable:!0,style:{marginBottom:16}}),e.jsx(u,{style:{marginBottom:24},children:e.jsx(O,{gutter:24,align:"middle",children:e.jsxs(J,{flex:"1",children:[e.jsxs(I,{level:2,style:{marginBottom:8},children:[e.jsx(b,{})," 文书起草"]}),e.jsx(m,{type:"secondary",style:{marginBottom:0},children:"使用专业法律模板，智能起草各类司法文书和函件"})]})})}),e.jsx(u,{style:{marginBottom:24},children:e.jsx(A,{current:p,items:[{title:"选择类型",description:"选择文书类型"},{title:"描述需求",description:"填写文书信息"},{title:"上传资料",description:"上传参考文件（可选）"},{title:"生成文书",description:"查看生成结果"}]})}),M()]})]})};export{Ce as default};
