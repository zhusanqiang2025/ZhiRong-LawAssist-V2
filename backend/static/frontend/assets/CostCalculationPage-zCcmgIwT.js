import{u as he,F as i,r as n,j as e,S,T as je,B as d,s as l,b as fe,c as G,C as y,d as h,e as W,f as K,h as C,I as ge,i as te,k as ye,m as ve,n as be,o as E}from"./index-sxRqSD8J.js";import{E as Ie}from"./EnhancedModuleNavBar-xaUgBEAI.js";import{u as we}from"./useSessionPersistence-DWuzG2HT.js";import{A as j}from"./DownloadOutlined-BKh_Ur4T.js";import{F as ae}from"./Table-ChiYc0WU.js";import{D as L}from"./index-DnOyAFTj.js";import{T as X}from"./index-CaNT8ewE.js";import{R as _e}from"./SyncOutlined-Bei_p6LO.js";import{U as J}from"./index-CkY6lFAS.js";import{R as Se}from"./UploadOutlined-DUJj_suW.js";import{R as Fe}from"./CheckCircleOutlined-BuSk9l2b.js";import{R as F}from"./index-DZjgJgae.js";import{C as Ce}from"./FileOutlined-CumPvWME.js";import"./ArrowLeftOutlined-d8neHjqY.js";import"./DiffOutlined-Di0wPK4-.js";import"./FolderOpenOutlined-XH3t9r-N.js";import"./PaperClipOutlined-hmdMyaw1.js";import"./DeleteOutlined-ff3SkuHt.js";import"./progress-uN8Nwtl0.js";import"./useBubbleLock-DGqAWK6r.js";const{Title:M,Text:v,Paragraph:r}=je,{Option:le}=C,{TextArea:H}=ge,{Dragger:Te}=J,He=()=>{he();const[c]=i.useForm(),[b,T]=n.useState(!1),[o,I]=n.useState(null),[k,R]=n.useState(null),[N,Q]=n.useState("manual"),[u,z]=n.useState([]),[ie,A]=n.useState(!1),[ne,Y]=n.useState(!1),[m,B]=n.useState(null),[f,$]=n.useState("plaintiff"),[p,q]=n.useState(!0),[x,P]=n.useState(""),[g,U]=n.useState(),{sessionId:D,hasSession:re,saveSession:V,clearSession:Z}=we("cost_calculation_session",{expirationTime:7200*1e3,onRestore:(s,t)=>{console.log("[费用测算] 恢复会话:",s,t),Q(t.activeMode),$(t.stance),q(t.includeLawyerFee),P(t.lawyerFeeBasis||""),U(t.lawyerFeeRate),t.formValues&&c.setFieldsValue(t.formValues),t.result&&I(t.result),t.extractedInfo&&B(t.extractedInfo),l.success("已恢复之前的费用测算会话")}});n.useEffect(()=>{if(D){const s=c.getFieldsValue();V(D,{activeMode:N,formValues:s,result:o,stance:f,includeLawyerFee:p,lawyerFeeBasis:x,lawyerFeeRate:g,extractedInfo:m})}},[N,o,f,p,x,g,m,c,D,V]);const ee=[{value:"contract_dispute",label:"合同纠纷"},{value:"labor_dispute",label:"劳动争议"},{value:"intellectual_property",label:"知识产权"},{value:"marriage_family",label:"婚姻家庭"},{value:"traffic_accident",label:"交通事故"},{value:"criminal_case",label:"刑事案件"},{value:"administrative_litigation",label:"行政诉讼"},{value:"real_estate_dispute",label:"房产纠纷"},{value:"construction_project",label:"建设工程"},{value:"medical_dispute",label:"医疗纠纷"},{value:"company_law",label:"公司法务"},{value:"other",label:"其他类型"}],se=[{title:"费用项目",dataIndex:"name",key:"name"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"金额(元)",dataIndex:"amount",key:"amount",render:s=>s.toLocaleString("zh-CN",{minimumFractionDigits:2}),sorter:(s,t)=>s.amount-t.amount}],oe=async s=>{T(!0),R(null);try{const t=await E.calculateCost(s);I(t.data);const a=`cost_calc_${Date.now()}`;V(a,{activeMode:"manual",formValues:s,result:t.data,stance:f,includeLawyerFee:p,lawyerFeeBasis:x,lawyerFeeRate:g,extractedInfo:null}),l.success("费用计算完成")}catch(t){console.error("费用计算失败:",t),R("费用计算失败，请稍后重试或联系管理员"),l.error("费用计算失败")}finally{T(!1)}},ce=async()=>{if(u.length===0){l.warning("请先上传案件资料");return}A(!0);try{const s=new FormData;for(const w of u){const _=w.originFileObj;_&&s.append("files",_)}if(!(s.getAll("files").length>0)){l.error("未能获取文件，请重新选择文件"),A(!1);return}const a=await E.uploadCostCalcDocuments(s);if(a.data.success){l.success("资料上传成功，正在提取案件信息...");const w=a.data.files.map(_=>_.file_id);setTimeout(()=>de(a.data.upload_id,w),500)}}catch(s){console.error("上传失败:",s),l.error(s.response?.data?.detail||"上传失败，请重试")}finally{A(!1)}},de=async(s,t)=>{Y(!0);try{const a=await E.extractCostCalcCaseInfo({upload_id:s,file_names:t});a.data.success&&a.data.case_info?(B(a.data.case_info),c.setFieldsValue(a.data.case_info),l.success("案件信息提取成功"),a.data.warnings&&a.data.warnings.length>0&&l.warning(a.data.warnings.join("; "))):l.error(a.data.error||"信息提取失败")}catch(a){console.error("提取失败:",a),l.error(a.response?.data?.detail||"信息提取失败")}finally{Y(!1)}},ue=async()=>{if(!m){l.warning("请先提取或填写案件信息");return}T(!0);try{const s=await c.validateFields(),t=await E.calculateCostV2({case_info:{...s,parties:s.parties||[],litigation_requests:s.litigation_requests||[]},stance:f,include_lawyer_fee:p,lawyer_fee_basis:x||void 0,lawyer_fee_rate:g});if(t.data.success){I(t.data);const a=`cost_calc_${Date.now()}`;V(a,{activeMode:"smart",formValues:s,result:t.data,stance:f,includeLawyerFee:p,lawyerFeeBasis:x,lawyerFeeRate:g,extractedInfo:m}),l.success("费用计算完成")}}catch(s){console.error("计算失败:",s),l.error(s.response?.data?.detail||"费用计算失败")}finally{T(!1)}},me={name:"files",multiple:!0,fileList:[],accept:".docx,.doc,.pdf,.txt,.jpg,.jpeg,.png",beforeUpload:s=>{if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","image/jpeg","image/png"].includes(s.type)){const w=s.name.split(".").pop()?.toLowerCase();if(!["docx","doc","pdf","txt","jpg","jpeg","png"].includes(w||""))return l.error("只支持上传 Word、PDF、TXT、图片文件"),J.LIST_IGNORE}return s.size<=50*1024*1024?!1:(l.error("文件大小不能超过 50MB"),J.LIST_IGNORE)},onChange:s=>{z(s.fileList)},onRemove:s=>{z(u.filter(t=>t.uid!==s.uid))}},O=()=>{c.resetFields(),I(null),R(null),z([]),B(null),$("plaintiff"),q(!0),P(""),U(void 0),Z()},pe=()=>e.jsx(h,{title:"手动输入案件信息",style:{marginBottom:24},children:e.jsxs(i,{form:c,layout:"vertical",onFinish:oe,children:[e.jsx(i.Item,{label:"案件类型",name:"case_type",rules:[{required:!0,message:"请选择案件类型"}],children:e.jsx(C,{placeholder:"请选择案件类型",children:ee.map(s=>e.jsx(le,{value:s.value,children:s.label},s.value))})}),e.jsx(i.Item,{label:"案件描述",name:"case_description",rules:[{required:!0,message:"请输入案件描述"}],children:e.jsx(H,{rows:6,placeholder:"请简要描述案件情况，包括争议焦点、涉及金额等信息。例如：买卖合同纠纷，对方未按时交付货物，造成损失约10万元。"})}),e.jsx(i.Item,{label:"案件标的额（元）",name:"case_amount",children:e.jsx(X,{style:{width:"100%"},placeholder:"请输入案件标的额（可选）",min:0,step:1e3})}),e.jsx(i.Item,{children:e.jsxs(S,{children:[e.jsx(d,{type:"primary",htmlType:"submit",loading:b,icon:e.jsx(_e,{spin:b}),children:"计算费用"}),e.jsx(d,{onClick:O,children:"重置"})]})})]})}),xe=()=>e.jsxs(S,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsxs(h,{title:"1. 上传案件资料",extra:m&&e.jsxs(te,{color:"success",children:[e.jsx(Fe,{})," 已完成"]}),children:[e.jsx(j,{message:"请上传案件相关资料",description:"支持上传起诉状、答辩状、证据材料等文件。系统将自动提取案件类型、当事人信息、诉讼请求等关键信息。",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(Te,{...me,style:{marginBottom:16},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(Se,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此处上传"}),e.jsx("p",{className:"ant-upload-hint",children:"支持上传 Word、PDF、TXT、图片文件，单个文件不超过 50MB"})]}),u.length>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(v,{strong:!0,children:"已上传文件："}),e.jsx("div",{style:{marginTop:8},children:u.map(s=>e.jsxs(te,{closable:!0,onClose:()=>{z(u.filter(t=>t.uid!==s.uid))},style:{marginBottom:4},children:[e.jsx(ye,{style:{marginRight:4}}),s.name]},s.uid))})]}),e.jsx(d,{type:"primary",icon:e.jsx(ve,{}),onClick:ce,loading:ie,disabled:u.length===0,block:!0,children:"提取案件信息"})]}),ne?e.jsx(h,{title:"2. 确认案件信息",children:e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(W,{size:"large"}),e.jsx(r,{style:{marginTop:16},children:"正在分析案件资料，提取关键信息..."})]})}):m?e.jsx(h,{title:"2. 确认案件信息",extra:e.jsx(d,{type:"link",icon:e.jsx(be,{}),children:"编辑"}),children:e.jsxs(i,{form:c,layout:"vertical",initialValues:m,children:[e.jsxs(G,{gutter:16,children:[e.jsx(y,{span:12,children:e.jsx(i.Item,{label:"案件类型",name:"case_type",rules:[{required:!0,message:"请选择案件类型"}],children:e.jsx(C,{placeholder:"请选择案件类型",children:ee.map(s=>e.jsx(le,{value:s.value,children:s.label},s.value))})})}),e.jsx(y,{span:12,children:e.jsx(i.Item,{label:"标的额（元）",name:"case_amount",children:e.jsx(X,{style:{width:"100%"},placeholder:"请输入标的额（可选）",min:0,step:1e3})})})]}),e.jsx(i.Item,{label:"当事人",name:"parties",children:e.jsx(C,{mode:"tags",placeholder:"请输入当事人名称，按回车添加",tokenSeparators:[",","，",";","；"]})}),e.jsx(i.Item,{label:"诉讼请求",name:"litigation_requests",tooltip:"这是费用计算的核心依据，请务必填写准确",children:e.jsx(C,{mode:"tags",placeholder:"请输入诉讼请求，按回车添加",tokenSeparators:[",","，",";","；"]})}),e.jsx(i.Item,{label:"案件概况",name:"case_description",rules:[{required:!0,message:"请输入案件概况"}],children:e.jsx(H,{rows:4,placeholder:"请简要描述案件基本情况..."})}),e.jsx(L,{children:"诉讼立场"}),e.jsx(i.Item,{label:"您的立场",children:e.jsxs(F.Group,{value:f,onChange:s=>$(s.target.value),children:[e.jsx(F,{value:"plaintiff",children:"原告"}),e.jsx(F,{value:"defendant",children:"被告"}),e.jsx(F,{value:"applicant",children:"申请人"}),e.jsx(F,{value:"respondent",children:"被申请人"})]})}),e.jsx(L,{children:"律师费设置"}),e.jsx(i.Item,{children:e.jsx(Ce,{checked:p,onChange:s=>q(s.target.checked),children:"计算律师费"})}),p&&e.jsxs(e.Fragment,{children:[e.jsx(i.Item,{label:"律师费计费依据",children:e.jsx(H,{rows:3,placeholder:"例如：风险代理、按标的额比例、固定费用等。如果不填写，系统将按通用标准估算。",value:x,onChange:s=>P(s.target.value)})}),x&&e.jsx(i.Item,{label:"费率（%）",children:e.jsx(X,{style:{width:"100%"},placeholder:"例如：3-10，按标的额的百分比",min:0,max:100,value:g,onChange:s=>U(s)})})]}),e.jsx(i.Item,{style:{marginTop:24},children:e.jsxs(S,{children:[e.jsx(d,{onClick:()=>B(null),children:"重新上传"}),e.jsx(d,{type:"primary",size:"large",icon:e.jsx(K,{}),onClick:ue,loading:b,children:"计算费用"})]})})]})}):e.jsx(h,{title:"2. 确认案件信息",children:e.jsx(j,{message:"请先上传案件资料",description:"系统将自动提取案件信息，您也可以在提取后进行编辑。",type:"info",showIcon:!0})})]});return e.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"#f5f5f5"},children:[e.jsx(Ie,{currentModuleKey:"cost-calculation"}),e.jsxs("div",{style:{flex:1,padding:"24px",maxWidth:"1200px",margin:"0 auto",width:"100%"},children:[re&&e.jsx(j,{message:"检测到之前的会话",description:e.jsxs(S,{direction:"vertical",size:"small",children:[e.jsx(v,{children:"系统检测到您之前有一个未完成的费用测算会话。您可以："}),e.jsxs(S,{children:[e.jsx(d,{size:"small",type:"primary",onClick:()=>{l.info("会话已恢复")},children:"继续之前的计算"}),e.jsx(d,{size:"small",onClick:()=>{Z(),O(),l.info("已开始新的计算")},children:"重新开始"})]})]}),type:"info",showIcon:!0,closable:!0,style:{marginBottom:24}}),e.jsx(fe,{activeKey:N,onChange:s=>{Q(s),I(null),R(null),O()},items:[{key:"manual",label:"手动输入",children:e.jsxs(G,{gutter:24,children:[e.jsxs(y,{span:12,children:[pe(),k&&e.jsx(j,{message:"计算错误",description:k,type:"error",showIcon:!0,style:{marginTop:24}})]}),e.jsx(y,{span:12,children:e.jsx(h,{title:"计算结果",children:b?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(W,{size:"large"}),e.jsx(r,{style:{marginTop:16},children:"正在计算费用，请稍候..."})]}):o?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:24,padding:"16px",background:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:4},children:e.jsxs(v,{strong:!0,style:{fontSize:18},children:["总费用估算: ",e.jsxs(v,{type:"success",style:{fontSize:24},children:[o.total_cost.toLocaleString("zh-CN",{minimumFractionDigits:2})," 元"]})]})}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(M,{level:4,children:"费用明细"}),e.jsx(ae,{columns:se,dataSource:o.cost_breakdown.map((s,t)=>({...s,key:t})),pagination:!1,size:"small"})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(M,{level:4,children:"计算依据"}),e.jsx(r,{children:o.calculation_basis})]}),e.jsx(L,{}),e.jsx(j,{message:"重要提示",description:e.jsxs("div",{children:[e.jsx(r,{children:o.disclaimer}),e.jsx(r,{type:"secondary",italic:!0,children:"以上费用为估算值，实际费用可能因具体情况、地区差异、律师收费标准等因素而有所不同。 建议在实际委托前与律师详细沟通具体收费标准。"})]}),type:"info",showIcon:!0})]}):e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:"#bfbfbf"},children:[e.jsx(K,{style:{fontSize:48,marginBottom:16}}),e.jsx(r,{children:'请输入案件信息并点击"计算费用"按钮'}),e.jsx(r,{type:"secondary",children:"系统将根据《诉讼费用交纳办法》等相关法规， 为您提供诉讼费、保全费、执行费、律师费等费用的估算"})]})})})]})},{key:"smart",label:"智能提取",children:e.jsxs(G,{gutter:24,children:[e.jsxs(y,{span:12,children:[xe(),k&&e.jsx(j,{message:"计算错误",description:k,type:"error",showIcon:!0,style:{marginTop:24}})]}),e.jsx(y,{span:12,children:e.jsx(h,{title:"计算结果",children:b?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(W,{size:"large"}),e.jsx(r,{style:{marginTop:16},children:"正在计算费用，请稍候..."})]}):o?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:24,padding:"16px",background:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:4},children:e.jsxs(v,{strong:!0,style:{fontSize:18},children:["总费用估算: ",e.jsxs(v,{type:"success",style:{fontSize:24},children:[o.total_cost.toLocaleString("zh-CN",{minimumFractionDigits:2})," 元"]})]})}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(M,{level:4,children:"费用明细"}),e.jsx(ae,{columns:se,dataSource:o.cost_breakdown.map((s,t)=>({...s,key:t})),pagination:!1,size:"small"})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(M,{level:4,children:"计算依据"}),e.jsx(r,{children:o.calculation_basis})]}),e.jsx(L,{}),e.jsx(j,{message:"重要提示",description:e.jsxs("div",{children:[e.jsx(r,{children:o.disclaimer}),e.jsx(r,{type:"secondary",italic:!0,children:"以上费用为估算值，实际费用可能因具体情况、地区差异、律师收费标准等因素而有所不同。 建议在实际委托前与律师详细沟通具体收费标准。"})]}),type:"info",showIcon:!0})]}):e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:"#bfbfbf"},children:[e.jsx(K,{style:{fontSize:48,marginBottom:16}}),e.jsx(r,{children:'请上传案件资料并提取信息后点击"计算费用"'}),e.jsx(r,{type:"secondary",children:"系统将根据《诉讼费用交纳办法》等相关法规， 为您提供诉讼费、保全费、执行费、律师费等费用的估算"})]})})})]})}]})]})]})};export{He as default};
