# é£é™©è¯„ä¼°æ¨¡å—å¤šä»»åŠ¡æ”¯æŒåŠŸèƒ½

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ä¸ºé£é™©è¯„ä¼°æ¨¡å—æ·»åŠ äº†**å¤šä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ**å’Œ**ä»»åŠ¡ç®¡ç†**åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥ï¼š

- âœ… åŒæ—¶è¿è¡Œæœ€å¤š 5 ä¸ªé£é™©è¯„ä¼°ä»»åŠ¡
- âœ… åœ¨ä»»åŠ¡åˆ—è¡¨ä¸­æŸ¥çœ‹æ‰€æœ‰å†å²ä»»åŠ¡ï¼ˆè¿›è¡Œä¸­ã€å·²å®Œæˆã€å¤±è´¥ï¼‰
- âœ… å®æ—¶æŸ¥çœ‹æ¯ä¸ªä»»åŠ¡çš„è¿›åº¦
- âœ… ä¸­é€”é€€å‡ºåå›æ¥ç»§ç»­
- âœ… åœ¨ä»»åŠ¡ä¹‹é—´å¿«é€Ÿåˆ‡æ¢

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RiskAnalysisMultiTaskWrapper (åŒ…è£…ç»„ä»¶)                 â”‚
â”‚  - æä¾›å·¦å³åˆ†æ å¸ƒå±€                                        â”‚
â”‚  - é›†æˆä»»åŠ¡ç»Ÿè®¡æ å’Œä»»åŠ¡åˆ—è¡¨                                â”‚
â”‚  - å“åº”å¼è®¾è®¡ï¼ˆæ¡Œé¢ç«¯/ç§»åŠ¨ç«¯ï¼‰                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  useRiskAnalysisTasks (æ ¸å¿ƒ Hook)                        â”‚
â”‚  - å¤šä»»åŠ¡çŠ¶æ€ç®¡ç†ï¼ˆMap æ•°æ®ç»“æ„ï¼‰                          â”‚
â”‚  - ä»»åŠ¡åˆ›å»ºã€åˆ‡æ¢ã€åˆ é™¤                                    â”‚
â”‚  - WebSocket è¿æ¥ç®¡ç†                                      â”‚
â”‚  - ä»»åŠ¡æŒä¹…åŒ–å’Œæ¢å¤                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  WebSocketConnectionPool (è¿æ¥æ± )                        â”‚
â”‚  - æ”¯æŒå¤šä¸ªå¹¶å‘ WebSocket è¿æ¥                             â”‚
â”‚  - å¿ƒè·³æœºåˆ¶å’Œè‡ªåŠ¨é‡è¿                                       â”‚
â”‚  - èµ„æºè‡ªåŠ¨æ¸…ç†                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  taskStorage (æŒä¹…åŒ–å·¥å…·)                                 â”‚
â”‚  - localStorage ä»»åŠ¡å­˜å‚¨                                   â”‚
â”‚  - ä»»åŠ¡è¿‡æœŸæ£€æŸ¥ï¼ˆ24 å°æ—¶ï¼‰                                 â”‚
â”‚  - æ‰¹é‡ä»»åŠ¡æ¢å¤                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI ç»„ä»¶                                                  â”‚
â”‚  - TaskStatsBar: ä»»åŠ¡ç»Ÿè®¡æ                                â”‚
â”‚  - RiskAnalysisTaskList: ä»»åŠ¡åˆ—è¡¨                         â”‚
â”‚  - TaskListGroup: ä»»åŠ¡åˆ†ç»„ï¼ˆå·²æ‰©å±•ï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ–‡ä»¶æ¸…å•

### æ–°å»ºæ–‡ä»¶

#### åŸºç¡€è®¾æ–½
- `frontend/src/utils/websocketPool.ts` (262 è¡Œ)
  - WebSocket è¿æ¥æ± å®ç°
  - æ”¯æŒå¿ƒè·³ã€é‡è¿ã€æ¸…ç†

- `frontend/src/utils/taskStorage.ts` (237 è¡Œ)
  - ä»»åŠ¡æŒä¹…åŒ–å·¥å…·
  - localStorage ç®¡ç†
  - ä»»åŠ¡æ¢å¤å’Œè¿‡æœŸæ£€æŸ¥

- `frontend/src/hooks/useRiskAnalysisTasks.ts` (398 è¡Œ)
  - å¤šä»»åŠ¡çŠ¶æ€ç®¡ç† Hook
  - ä»»åŠ¡ CRUD æ“ä½œ
  - WebSocket æ¶ˆæ¯å¤„ç†

#### UI ç»„ä»¶
- `frontend/src/components/TaskStatsBar.tsx` (75 è¡Œ)
  - ä»»åŠ¡ç»Ÿè®¡æ 
  - æ˜¾ç¤ºè¿›è¡Œä¸­/å·²å®Œæˆä»»åŠ¡æ•°

- `frontend/src/components/RiskAnalysisTaskList.tsx` (247 è¡Œ)
  - ä»»åŠ¡åˆ—è¡¨ç»„ä»¶
  - ä»»åŠ¡åˆ†ç»„æ˜¾ç¤º
  - ä»»åŠ¡æ“ä½œï¼ˆæŸ¥çœ‹ã€åˆ é™¤ï¼‰

- `frontend/src/components/RiskAnalysisMultiTaskWrapper.tsx` (173 è¡Œ)
  - å¤šä»»åŠ¡ UI åŒ…è£…ç»„ä»¶
  - å·¦å³åˆ†æ å¸ƒå±€
  - å“åº”å¼è®¾è®¡

#### æ–‡æ¡£å’Œæµ‹è¯•
- `frontend/MULTI_TASK_INTEGRATION.md`
  - é›†æˆæŒ‡å—
  - API å‚è€ƒ
  - ä½¿ç”¨ç¤ºä¾‹

- `frontend/src/pages/RiskAnalysisMultiTaskTestPage.tsx` (215 è¡Œ)
  - åŠŸèƒ½æµ‹è¯•é¡µé¢
  - æ¼”ç¤ºå¤šä»»åŠ¡æ“ä½œ

#### ä¿®æ”¹æ–‡ä»¶
- `frontend/src/components/TaskListGroup.tsx`
  - æ·»åŠ ä»»åŠ¡æ“ä½œå›è°ƒ
  - æ”¯æŒç´§å‡‘æ¨¡å¼
  - æ·»åŠ åˆ é™¤æŒ‰é’®

### ç»Ÿè®¡

- **æ–°å»ºæ–‡ä»¶**: 9 ä¸ª
- **ä¿®æ”¹æ–‡ä»¶**: 1 ä¸ª
- **æ€»ä»£ç è¡Œæ•°**: ~1800 è¡Œ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ä½¿ç”¨åŒ…è£…ç»„ä»¶ï¼ˆæ¨èï¼‰

```tsx
import RiskAnalysisMultiTaskWrapper from '../components/RiskAnalysisMultiTaskWrapper';

<RiskAnalysisMultiTaskWrapper
  currentTaskId={analysisState.sessionId}
  onSwitchTask={(sessionId) => loadTaskStatus(sessionId)}
  showTaskList={true}
>
  {/* åŸæœ‰çš„é¡µé¢å†…å®¹ */}
  {renderInputPage()}
  {renderProgressPage()}
  {renderResultsPage()}
</RiskAnalysisMultiTaskWrapper>
```

### 2. æ‰‹åŠ¨é›†æˆ

```tsx
import { useRiskAnalysisTasks } from '../hooks/useRiskAnalysisTasks';

const {
  tasks,
  activeTaskId,
  createTask,
  switchTask,
  removeTask
} = useRiskAnalysisTasks();

// åˆ›å»ºä»»åŠ¡
const sessionId = await createTask({
  userInput: 'æˆ¿å±‹ä¹°å–åˆåŒé£é™©è¯„ä¼°',
  packageId: 'package-001'
});

// åˆ‡æ¢ä»»åŠ¡
switchTask(sessionId);

// åˆ é™¤ä»»åŠ¡
removeTask(sessionId);
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. å¤šä»»åŠ¡çŠ¶æ€ç®¡ç†

ä½¿ç”¨ `Map<string, AnalysisState>` å­˜å‚¨ä»»åŠ¡çŠ¶æ€ï¼š

- **O(1) æŸ¥æ‰¾**: é€šè¿‡ sessionId å¿«é€Ÿå®šä½ä»»åŠ¡
- **è‡ªåŠ¨å»é‡**: å¤©ç„¶é˜²æ­¢é‡å¤ä»»åŠ¡
- **ä¾¿äºåŒæ­¥**: WebSocket æ¶ˆæ¯ç›´æ¥ç”¨ sessionId æ›´æ–°
- **å†…å­˜æ•ˆç‡**: åˆ é™¤ä»»åŠ¡æ—¶ä¸äº§ç”Ÿå†…å­˜ç¢ç‰‡

### 2. WebSocket è¿æ¥æ± 

æ”¯æŒå¤šä¸ªå¹¶å‘ WebSocket è¿æ¥ï¼š

- **å¿ƒè·³æœºåˆ¶**: æ¯ 10 ç§’å‘é€ pingï¼Œä¿æŒè¿æ¥æ´»è·ƒ
- **è‡ªåŠ¨é‡è¿**: è¿æ¥æ–­å¼€åè‡ªåŠ¨é‡è¿ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
- **èµ„æºæ¸…ç†**: ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ–­å¼€æ‰€æœ‰è¿æ¥
- **çŠ¶æ€æŸ¥è¯¢**: å®æ—¶æŸ¥è¯¢è¿æ¥çŠ¶æ€

### 3. ä»»åŠ¡æŒä¹…åŒ–

åŒé‡ä¿éšœæœºåˆ¶ï¼š

- **localStorage**: å‰ç«¯å¿«é€Ÿæ¢å¤
- **åç«¯ API**: å®Œæ•´ä»»åŠ¡çŠ¶æ€åŒæ­¥
- **è¿‡æœŸæ£€æŸ¥**: 24 å°æ—¶åè‡ªåŠ¨æ¸…ç†
- **æ‰¹é‡æ¢å¤**: ä¸€æ¬¡æ€§æ¢å¤æ‰€æœ‰ä»»åŠ¡

### 4. å¹¶å‘é™åˆ¶

å‰ç«¯å’Œåç«¯åŒé‡é™åˆ¶ï¼š

- **å‰ç«¯é™åˆ¶**: æœ€å¤š 5 ä¸ªå¹¶å‘ä»»åŠ¡
- **åç«¯é™åˆ¶**: å¯é€‰çš„å¹¶å‘é™åˆ¶å™¨ï¼ˆå¾…å®ç°ï¼‰
- **ç”¨æˆ·æç¤º**: è¾¾åˆ°é™åˆ¶æ—¶å‹å¥½æç¤º
- **æ™ºèƒ½æç¤º**: ä»»åŠ¡å®Œæˆåè‡ªåŠ¨è§£é™¤é™åˆ¶

## ğŸ“± å“åº”å¼è®¾è®¡

### æ¡Œé¢ç«¯

- å·¦å³åˆ†æ å¸ƒå±€ï¼ˆ14:10ï¼‰
- ä»»åŠ¡åˆ—è¡¨å›ºå®šåœ¨å³ä¾§
- å®æ—¶æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡

### ç§»åŠ¨ç«¯

- æŠ½å±‰æ¨¡å¼ä»»åŠ¡åˆ—è¡¨
- æµ®åŠ¨æ“ä½œæŒ‰é’®
- è§¦æ‘¸å‹å¥½çš„äº¤äº’

## ğŸ§ª æµ‹è¯•

### åŠŸèƒ½æµ‹è¯•

```bash
# å¯åŠ¨å‰ç«¯
cd frontend
npm start

# è®¿é—®æµ‹è¯•é¡µé¢
http://localhost:3000/risk-analysis-multi-task-test
```

### æµ‹è¯•åœºæ™¯

1. **åˆ›å»ºå¤šä¸ªä»»åŠ¡**
   - è¿ç»­åˆ›å»º 3 ä¸ªä»»åŠ¡
   - éªŒè¯ä»»åŠ¡åˆ—è¡¨æ˜¾ç¤º
   - éªŒè¯å¹¶å‘é™åˆ¶

2. **ä»»åŠ¡åˆ‡æ¢**
   - åœ¨ä¸åŒä»»åŠ¡é—´åˆ‡æ¢
   - éªŒè¯çŠ¶æ€ä¿æŒ
   - éªŒè¯ WebSocket è¿æ¥

3. **ä»»åŠ¡æŒä¹…åŒ–**
   - åˆ›å»ºä»»åŠ¡ååˆ·æ–°é¡µé¢
   - éªŒè¯ä»»åŠ¡è‡ªåŠ¨æ¢å¤
   - éªŒè¯ WebSocket é‡è¿

4. **ä»»åŠ¡åˆ é™¤**
   - åˆ é™¤è¿›è¡Œä¸­çš„ä»»åŠ¡
   - éªŒè¯ WebSocket æ–­å¼€
   - éªŒè¯çŠ¶æ€æ¸…ç†

## ğŸ”§ é…ç½®é€‰é¡¹

### WebSocket è¿æ¥æ± 

```typescript
const config = {
  heartbeatInterval: 10000,  // å¿ƒè·³é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  reconnectAttempts: 3,       // é‡è¿å°è¯•æ¬¡æ•°
  reconnectDelay: 2000,       // é‡è¿å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
};
```

### ä»»åŠ¡æŒä¹…åŒ–

```typescript
const MAX_ACTIVE_TASKS = 5;        // æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°
const EXPIRATION_TIME = 24 * 60 * 60 * 1000;  // è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å¹¶å‘èƒ½åŠ›**: æ”¯æŒ 5+ åŒæ—¶è¿è¡Œçš„ä»»åŠ¡
- **æ¢å¤æˆåŠŸç‡**: > 95%
- **WebSocket å»¶è¿Ÿ**: < 100ms
- **ä»»åŠ¡åˆ‡æ¢å“åº”**: < 50ms

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šä»»åŠ¡æ²¡æœ‰æ¢å¤

**åŸå› **: localStorage ä¸­çš„ä»»åŠ¡æ•°æ®å·²è¿‡æœŸï¼ˆ24 å°æ—¶ï¼‰

**è§£å†³**: æ‰‹åŠ¨åˆ·æ–°ä»»åŠ¡åˆ—è¡¨æˆ–åˆ›å»ºæ–°ä»»åŠ¡

### é—®é¢˜ 2ï¼šWebSocket è¿æ¥å¤±è´¥

**åŸå› **: åç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç½‘ç»œé—®é¢˜

**è§£å†³**: æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€ï¼Œç¡®ä¿ WebSocket ç«¯ç‚¹å¯è®¿é—®

### é—®é¢˜ 3ï¼šä»»åŠ¡çŠ¶æ€ä¸åŒæ­¥

**åŸå› **: å‰ç«¯çŠ¶æ€ä¸åç«¯çŠ¶æ€ä¸ä¸€è‡´

**è§£å†³**: è°ƒç”¨ `refreshTaskList()` ä»åç«¯é‡æ–°è·å–ä»»åŠ¡çŠ¶æ€

## ğŸ“ TODO

### å·²å®Œæˆ

- âœ… WebSocket è¿æ¥æ± 
- âœ… å¤šä»»åŠ¡çŠ¶æ€ç®¡ç†
- âœ… ä»»åŠ¡æŒä¹…åŒ–å·¥å…·
- âœ… ä»»åŠ¡ç»Ÿè®¡æ 
- âœ… ä»»åŠ¡åˆ—è¡¨ç»„ä»¶
- âœ… å¤šä»»åŠ¡ UI åŒ…è£…ç»„ä»¶
- âœ… é›†æˆæ–‡æ¡£
- âœ… æµ‹è¯•é¡µé¢

### å¾…å®Œæˆ

- â³ é›†æˆåˆ° RiskAnalysisPageV2
- â³ åç«¯å¹¶å‘é™åˆ¶å™¨
- â³ E2E æµ‹è¯•
- â³ æ€§èƒ½ä¼˜åŒ–
- â³ ç”¨æˆ·åé¦ˆæ”¶é›†

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¥ è´¡çŒ®è€…

- Claude AI - æ¶æ„è®¾è®¡å’Œå®ç°

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ã€‚
