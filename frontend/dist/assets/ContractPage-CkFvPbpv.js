import{r as o,z as Be,_ as _e,R as I,P as Ne,ah as me,aa as et,ac as pe,ab as Ae,ad as Ke,aN as tt,J as at,K as rt,L as nt,M as st,U as ot,ak as lt,p as $,x as it,u as ct,w as dt,F as X,s as H,j as e,S as B,B as R,b as Ze,I as Ee,q as ut,t as Ue,h as ge,aD as Me,bv as ft,d as xe,k as Ie,T as ht,c as pt,C as qe,e as xt,i as V,o as yt,G as Le,n as Oe,av as mt}from"./index-sxRqSD8J.js";import{E as gt}from"./EnhancedModuleNavBar-xaUgBEAI.js";import{c as le}from"./contractTemplates-DCEXET_L.js";import{u as We}from"./useSessionPersistence-DWuzG2HT.js";import{A as Ge,R as ye}from"./DownloadOutlined-BKh_Ur4T.js";import{M as Qe}from"./index-CZmWgoAJ.js";import{U as vt}from"./index-CkY6lFAS.js";import{R as jt}from"./InboxOutlined-BZzE62tZ.js";import{S as wt}from"./index-BXa-QjzY.js";import{F as bt}from"./Table-ChiYc0WU.js";import"./ArrowLeftOutlined-d8neHjqY.js";import"./DiffOutlined-Di0wPK4-.js";import"./PaperClipOutlined-hmdMyaw1.js";import"./DeleteOutlined-ff3SkuHt.js";import"./progress-uN8Nwtl0.js";import"./FileOutlined-CumPvWME.js";import"./useBubbleLock-DGqAWK6r.js";import"./index-DZjgJgae.js";import"./FolderOpenOutlined-XH3t9r-N.js";var St={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"},Ct=function(s,l){return o.createElement(Be,_e({},s,{ref:l,icon:St}))},Rt=o.forwardRef(Ct);function It(t,s){var l=t.disabled,n=t.prefixCls,c=t.character,u=t.characterRender,f=t.index,A=t.count,p=t.value,K=t.allowHalf,b=t.focused,M=t.onHover,N=t.onClick,y=function(h){M(h,f)},U=function(h){N(h,f)},q=function(h){h.keyCode===me.ENTER&&N(h,f)},L=f+1,g=new Set([n]);p===0&&f===0&&b?g.add("".concat(n,"-focused")):K&&p+.5>=L&&p<L?(g.add("".concat(n,"-half")),g.add("".concat(n,"-active")),b&&g.add("".concat(n,"-focused"))):(L<=p?g.add("".concat(n,"-full")):g.add("".concat(n,"-zero")),L===p&&b&&g.add("".concat(n,"-focused")));var x=typeof c=="function"?c(t):c,v=I.createElement("li",{className:Ne(Array.from(g)),ref:s},I.createElement("div",{onClick:l?null:U,onKeyDown:l?null:q,onMouseMove:l?null:y,role:"radio","aria-checked":p>f?"true":"false","aria-posinset":f+1,"aria-setsize":A,tabIndex:l?-1:0},I.createElement("div",{className:"".concat(n,"-first")},x),I.createElement("div",{className:"".concat(n,"-second")},x)));return u&&(v=u(v,t)),v}const _t=I.forwardRef(It);function kt(){var t=o.useRef({});function s(n){return t.current[n]}function l(n){return function(c){t.current[n]=c}}return[s,l]}function zt(t){var s=t.pageXOffset,l="scrollLeft";if(typeof s!="number"){var n=t.document;s=n.documentElement[l],typeof s!="number"&&(s=n.body[l])}return s}function Tt(t){var s,l,n=t.ownerDocument,c=n.body,u=n&&n.documentElement,f=t.getBoundingClientRect();return s=f.left,l=f.top,s-=u.clientLeft||c.clientLeft||0,l-=u.clientTop||c.clientTop||0,{left:s,top:l}}function Ht(t){var s=Tt(t),l=t.ownerDocument,n=l.defaultView||l.parentWindow;return s.left+=zt(n),s.left}var $t=["prefixCls","className","defaultValue","value","count","allowHalf","allowClear","keyboard","character","characterRender","disabled","direction","tabIndex","autoFocus","onHoverChange","onChange","onFocus","onBlur","onKeyDown","onMouseLeave"];function Mt(t,s){var l=t.prefixCls,n=l===void 0?"rc-rate":l,c=t.className,u=t.defaultValue,f=t.value,A=t.count,p=A===void 0?5:A,K=t.allowHalf,b=K===void 0?!1:K,M=t.allowClear,N=M===void 0?!0:M,y=t.keyboard,U=y===void 0?!0:y,q=t.character,L=q===void 0?"★":q,g=t.characterRender,x=t.disabled,v=t.direction,S=v===void 0?"ltr":v,h=t.tabIndex,Y=h===void 0?0:h,te=t.autoFocus,O=t.onHoverChange,W=t.onChange,Z=t.onFocus,ae=t.onBlur,ie=t.onKeyDown,re=t.onMouseLeave,ke=et(t,$t),ve=kt(),ne=pe(ve,2),ee=ne[0],F=ne[1],D=I.useRef(null),k=function(){if(!x){var i;(i=D.current)===null||i===void 0||i.focus()}};I.useImperativeHandle(s,function(){return{focus:k,blur:function(){if(!x){var i;(i=D.current)===null||i===void 0||i.blur()}}}});var G=Ae(u||0,{value:f}),je=pe(G,2),j=je[0],ze=je[1],we=Ae(null),se=pe(we,2),Te=se[0],Q=se[1],E=function(i,T){var m=S==="rtl",_=i+1;if(b){var De=ee(i),Pe=Ht(De),Ve=De.clientWidth;(m&&T-Pe>Ve/2||!m&&T-Pe<Ve/2)&&(_-=.5)}return _},P=function(i){ze(i),W?.(i)},He=I.useState(!1),ce=pe(He,2),$e=ce[0],oe=ce[1],de=function(){oe(!0),Z?.()},ue=function(){oe(!1),ae?.()},fe=I.useState(null),be=pe(fe,2),Se=be[0],he=be[1],Ce=function(i,T){var m=E(T,i.pageX);m!==Te&&(he(m),Q(null)),O?.(m)},Re=function(i){x||(he(null),Q(null),O?.(void 0)),i&&re?.(i)},a=function(i,T){var m=E(T,i.pageX),_=!1;N&&(_=m===j),Re(),P(_?0:m),Q(_?m:null)},r=function(i){var T=i.keyCode,m=S==="rtl",_=b?.5:1;U&&(T===me.RIGHT&&j<p&&!m?(P(j+_),i.preventDefault()):T===me.LEFT&&j>0&&!m||T===me.RIGHT&&j>0&&m?(P(j-_),i.preventDefault()):T===me.LEFT&&j<p&&m&&(P(j+_),i.preventDefault())),ie?.(i)};I.useEffect(function(){te&&!x&&k()},[]);var d=new Array(p).fill(0).map(function(C,i){return I.createElement(_t,{ref:F(i),index:i,count:p,disabled:x,prefixCls:"".concat(n,"-star"),allowHalf:b,value:Se===null?j:Se,onClick:a,onHover:Ce,key:C||i,character:L,characterRender:g,focused:$e})}),z=Ne(n,c,Ke(Ke({},"".concat(n,"-disabled"),x),"".concat(n,"-rtl"),S==="rtl"));return I.createElement("ul",_e({className:z,onMouseLeave:Re,tabIndex:x?-1:Y,onFocus:x?null:de,onBlur:x?null:ue,onKeyDown:x?null:r,ref:D},tt(ke,{aria:!0,data:!0,attr:!0})),d)}const Lt=I.forwardRef(Mt),Ot=t=>{const{componentCls:s}=t;return{[`${s}-star`]:{position:"relative",display:"inline-block",color:"inherit",cursor:"pointer","&:not(:last-child)":{marginInlineEnd:t.marginXS},"> div":{transition:`all ${t.motionDurationMid}, outline 0s`,"&:hover":{transform:t.starHoverScale},"&:focus":{outline:0},"&:focus-visible":{outline:`${st(t.lineWidth)} dashed ${t.starColor}`,transform:t.starHoverScale}},"&-first, &-second":{color:t.starBg,transition:`all ${t.motionDurationMid}`,userSelect:"none"},"&-first":{position:"absolute",top:0,insetInlineStart:0,width:"50%",height:"100%",overflow:"hidden",opacity:0},[`&-half ${s}-star-first, &-half ${s}-star-second`]:{opacity:1},[`&-half ${s}-star-first, &-full ${s}-star-second`]:{color:"inherit"}}}},Ft=t=>({[`&-rtl${t.componentCls}`]:{direction:"rtl"}}),Et=t=>{const{componentCls:s}=t;return{[s]:Object.assign(Object.assign(Object.assign(Object.assign({},nt(t)),{display:"inline-block",margin:0,padding:0,color:t.starColor,fontSize:t.starSize,lineHeight:1,listStyle:"none",outline:"none",[`&-disabled${s} ${s}-star`]:{cursor:"default","> div:hover":{transform:"scale(1)"}}}),Ot(t)),Ft(t))}},Bt=t=>({starColor:t.yellow6,starSize:t.controlHeightLG*.5,starHoverScale:"scale(1.1)",starBg:t.colorFillContent}),Nt=at("Rate",t=>{const s=rt(t,{});return Et(s)},Bt);var Dt=function(t,s){var l={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&s.indexOf(n)<0&&(l[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(t);c<n.length;c++)s.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(t,n[c])&&(l[n[c]]=t[n[c]]);return l};const Xe=o.forwardRef((t,s)=>{const{prefixCls:l,className:n,rootClassName:c,style:u,tooltips:f,character:A=o.createElement(Rt,null),disabled:p}=t,K=Dt(t,["prefixCls","className","rootClassName","style","tooltips","character","disabled"]),b=(h,{index:Y})=>f?o.createElement($,{title:f[Y]},h):h,{getPrefixCls:M,direction:N,rate:y}=o.useContext(ot),U=M("rate",l),[q,L,g]=Nt(U),x=Object.assign(Object.assign({},y?.style),u),v=o.useContext(lt),S=p??v;return q(o.createElement(Lt,Object.assign({ref:s,character:A,characterRender:b,disabled:S},K,{className:Ne(n,c,L,g,y?.className),style:x,prefixCls:U,direction:N})))});var Pt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},Vt=function(s,l){return o.createElement(Be,_e({},s,{ref:l,icon:Pt}))},At=o.forwardRef(Vt),Kt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},Ut=function(s,l){return o.createElement(Be,_e({},s,{ref:l,icon:Kt}))},Je=o.forwardRef(Ut);const{Header:pa,Content:xa}=mt,{Title:Ye,Text:w,Paragraph:qt}=ht,{TabPane:Fe}=Ze,{Search:Wt}=Ee,{Option:J}=ge,{Dragger:Gt}=vt,ya=()=>{const{user:t,logout:s}=it(),l=ct(),n=dt(),c=o.useRef(!1),u=o.useRef(!1),{hasSession:f,saveSession:A,clearSession:p,isLoading:K}=We("contract_page_session",{expirationTime:7200*1e3,autoRestore:!1,onRestore:(a,r)=>{console.log("[合同模板页] 恢复会话:",r),u.current=!0,D(r.activeTab||"query"),O(r.selectedCategory),Z(r.sortBy||"created_at"),S(r.currentPage||1),Y(r.pageSize||12),G(r.viewMode||"card"),r.searchQuery&&(ee(r.hasSearched),r.hasSearched&&de(r.searchQuery)),setTimeout(()=>{c.current=!0,u.current=!1},0)}}),b=a=>{if(u.current){console.log("[合同模板页] 正在恢复会话，跳过保存");return}A(Date.now().toString(),{activeTab:F,selectedCategory:te,sortBy:W,currentPage:v,pageSize:h,viewMode:k,searchQuery:a||"",hasSearched:ne})},[M,N]=o.useState(!1),[y,U]=o.useState([]),[q,L]=o.useState([]),[g,x]=o.useState(0),[v,S]=o.useState(1),[h,Y]=o.useState(12),[te,O]=o.useState(),[W,Z]=o.useState("created_at"),[ae]=o.useState("desc"),[ie,re]=o.useState(!1),[ke,ve]=o.useState([]),[ne,ee]=o.useState(!1),[F,D]=o.useState("query"),[k,G]=o.useState("card"),[je,j]=o.useState(!1),[ze,we]=o.useState(!1),[se]=X.useForm(),[Te,Q]=o.useState(!1),[E,P]=o.useState(null),[He,ce]=o.useState(!1);o.useEffect(()=>{(n.state||{}).action==="generate"&&D("generate"),$e()},[n.state]),o.useEffect(()=>{if(!(c.current||u.current))if(f){console.log("[合同模板页] 检测到会话，准备恢复"),u.current=!0;const a=localStorage.getItem("contract_page_session");if(a)try{const r=JSON.parse(a),{onRestore:d}=We.restore?.cache?.get("contract_page_session")||{};r.data&&(D(r.data.activeTab||"query"),O(r.data.selectedCategory),Z(r.data.sortBy||"created_at"),S(r.data.currentPage||1),Y(r.data.pageSize||12),G(r.data.viewMode||"card"),r.data.searchQuery&&(ee(r.data.hasSearched),r.data.hasSearched&&de(r.data.searchQuery)),H.success("已恢复之前的浏览状态"),setTimeout(()=>{c.current=!0,u.current=!1},100))}catch(r){console.error("[合同模板页] 恢复会话失败:",r),c.current=!0,u.current=!1}else c.current=!0}else c.current=!0},[]),o.useEffect(()=>{(F==="query"||F==="my-templates")&&oe()},[v,h,te,W,ae,F]),o.useEffect(()=>{c.current&&!u.current&&!K&&b()},[F,te,W,v,h,k,ne]);const $e=async()=>{try{const a=await le.getCategoryTree(!0),r=new Map;a.forEach(z=>{z.name&&r.set(z.name,(r.get(z.name)||0)+1)});const d=Array.from(r.entries()).map(([z,C])=>({category:z,count:C}));L(d)}catch(a){console.error("加载分类失败:",a)}},oe=async()=>{N(!0);try{const r={page:v,page_size:h,category:te,sort_by:W,sort_order:ae,scope:F==="my-templates"?"my":"public"},d=await le.getTemplates(r);U(d.templates),x(d.total_count)}catch(a){console.error("加载模板失败:",a),H.error("加载列表失败")}finally{N(!1)}},de=async a=>{if(!a.trim()){ee(!1),ve([]),b("");return}re(!0),ee(!0);try{const r=await le.searchTemplates({query:a.trim()});ve(r.templates),b(a),r.templates.length===0&&H.info("未找到相关模板")}catch(r){console.error("搜索失败:",r),H.error("搜索服务暂时不可用")}finally{re(!1)}},ue=async a=>{try{await le.downloadTemplate(a.id),H.success(`开始下载: ${a.name}`)}catch(r){console.error("下载失败:",r),H.error("下载失败")}},fe=async a=>{ce(!0),Q(!0),P(null);try{const r=await le.getTemplatePreview(a.id);P({name:a.name,content:r.content,file_type:r.file_type})}catch(r){console.error("预览失败:",r),r.response?.data?.detail?P({name:a.name,content:r.response.data.detail,file_type:"unknown"}):(H.error("预览失败"),Q(!1))}finally{ce(!1)}},be=async(a,r)=>{try{await le.rateTemplate(a,r),H.success("评分成功"),oe()}catch{H.error("评分失败")}},Se=async()=>{try{const a=await se.validateFields();we(!0);const r=new FormData;r.append("name",a.name),r.append("category",a.category),r.append("description",a.description||""),r.append("is_public",a.is_public?"true":"false"),a.keywords&&r.append("keywords",a.keywords.join(",")),a.file&&a.file.length>0&&r.append("file",a.file[0].originFileObj),await yt.uploadTemplate(r),H.success("上传成功！"),j(!1),se.resetFields(),F!=="my-templates"?D("my-templates"):oe()}catch(a){console.error(a),H.error("上传失败")}finally{we(!1)}},he=a=>{const r=t?.is_admin||!1,d=[e.jsx($,{title:"下载",children:e.jsx(ye,{onClick:()=>ue(a)},"download")},"download-tip"),e.jsx($,{title:"预览",children:e.jsx(Le,{onClick:()=>fe(a)},"view")},"view-tip")];return r&&d.push(e.jsx($,{title:"编辑",children:e.jsx(Oe,{onClick:()=>l(`/contract/${a.id}/edit`)},"edit")},"edit-tip")),d.push(e.jsx(Xe,{disabled:a.rating_count>0,defaultValue:a.rating,style:{fontSize:12},onChange:z=>be(a.id,z)},"rate")),e.jsx(xe,{hoverable:!0,className:"template-card",cover:e.jsx("div",{className:"template-preview-placeholder",style:{height:160,background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ie,{style:{fontSize:48,color:"#1890ff"}})}),actions:d,children:e.jsx(xe.Meta,{title:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.name}),a.is_public?e.jsx(V,{color:"green",children:"公开"}):e.jsx(V,{color:"orange",children:"私有"})]}),description:e.jsxs("div",{children:[e.jsx(w,{type:"secondary",style:{fontSize:12},ellipsis:!0,children:a.description||"暂无描述"}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(V,{color:"blue",children:a.category}),e.jsxs("span",{style:{fontSize:12,color:"#999",marginLeft:8},children:[e.jsx(ye,{})," ",a.download_count]})]})]})})},a.id)},Ce=()=>{const a=[{title:"模板名称",dataIndex:"name",key:"name",width:"25%",render:(r,d)=>e.jsxs(B,{children:[e.jsx(w,{strong:!0,ellipsis:{tooltip:r},style:{maxWidth:200},children:r}),d.is_public?e.jsx(V,{color:"green",children:"公开"}):e.jsx(V,{color:"orange",children:"私有"})]})},{title:"分类",dataIndex:"category",key:"category",width:"10%",render:r=>e.jsx(V,{color:"blue",children:r})},{title:"描述",dataIndex:"description",key:"description",width:"25%",render:r=>e.jsx(w,{type:"secondary",ellipsis:{tooltip:r||"暂无描述"},children:r||"暂无描述"})},{title:"评分",dataIndex:"rating",key:"rating",width:"10%",render:(r,d)=>e.jsxs(B,{children:[e.jsx(Xe,{disabled:!0,defaultValue:r,style:{fontSize:12}}),e.jsxs(w,{type:"secondary",style:{fontSize:12},children:["(",d.rating_count||0,")"]})]})},{title:"下载次数",dataIndex:"download_count",key:"download_count",width:"10%",render:r=>e.jsxs(w,{children:[e.jsx(ye,{})," ",r]})},{title:"操作",key:"action",width:"20%",render:(r,d)=>{const z=t?.is_admin||!1;return e.jsxs(B,{size:"small",children:[e.jsx($,{title:"下载",children:e.jsx(R,{type:"text",icon:e.jsx(ye,{}),onClick:()=>ue(d)})}),e.jsx($,{title:"预览",children:e.jsx(R,{type:"text",icon:e.jsx(Le,{}),onClick:()=>fe(d)})}),z&&e.jsx($,{title:"编辑",children:e.jsx(R,{type:"text",icon:e.jsx(Oe,{}),onClick:()=>l(`/contract/${d.id}/edit`)})})]})}}];return e.jsx(bt,{columns:a,dataSource:y,loading:M,rowKey:"id",pagination:!1,size:"middle"})},Re=a=>{const r=t?.is_admin||!1,d=[e.jsx($,{title:"下载",children:e.jsx(ye,{onClick:()=>ue(a)},"download")},"download-tip"),e.jsx($,{title:"预览",children:e.jsx(Le,{onClick:()=>fe(a)},"view")},"view-tip")];return r&&d.push(e.jsx($,{title:"编辑",children:e.jsx(Oe,{onClick:()=>l(`/contract/${a.id}/edit`)},"edit")},"edit-tip")),d.push(e.jsx($,{title:"匹配度",children:e.jsxs("span",{style:{fontSize:12,color:"#52c41a"},children:[(a.final_score*100).toFixed(0),"%"]})},"score")),e.jsx(xe,{hoverable:!0,className:"template-card",cover:e.jsx("div",{className:"template-preview-placeholder",style:{height:160,background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ie,{style:{fontSize:48,color:"#1890ff"}})}),actions:d,children:e.jsx(xe.Meta,{title:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.name}),e.jsx(V,{color:"purple",children:"智能"})]}),description:e.jsxs("div",{children:[e.jsx(w,{type:"secondary",style:{fontSize:12},ellipsis:!0,children:a.description||"暂无描述"}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(V,{color:"blue",children:a.category}),a.subcategory&&e.jsx(V,{color:"cyan",children:a.subcategory}),a.match_reason&&e.jsx("div",{style:{marginTop:4,fontSize:11,color:"#52c41a"},children:a.match_reason})]})]})})},a.id)};return e.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"#f0f2f5"},children:[e.jsx(gt,{currentModuleKey:"template-search",extra:e.jsxs(B,{children:[e.jsx(R,{type:"primary",icon:e.jsx(At,{}),onClick:()=>j(!0),children:"上传模板"}),e.jsx(R,{onClick:s,children:"退出"})]})}),e.jsxs("div",{style:{flex:1,padding:"24px",maxWidth:1400,margin:"0 auto",width:"100%"},children:[f&&!c.current&&e.jsx(Ge,{message:"发现未完成的浏览会话",description:"您上次浏览的模板状态已保存，是否恢复？",type:"info",showIcon:!0,closable:!0,action:e.jsxs(B,{children:[e.jsx(R,{size:"small",onClick:()=>{p(),c.current=!0},children:"忽略"}),e.jsx(R,{type:"primary",size:"small",onClick:()=>{c.current=!1},children:"恢复会话"})]}),style:{marginBottom:16}}),e.jsxs(Ze,{activeKey:F,onChange:D,type:"card",children:[e.jsxs(Fe,{tab:"模板广场",children:[e.jsxs("div",{style:{marginBottom:24,background:"#fff",padding:24,borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(Wt,{placeholder:"输入关键词，AI 智能匹配...",enterButton:e.jsx(ut,{}),size:"large",loading:ie,onSearch:de,onChange:a=>!a.target.value&&ee(!1),style:{maxWidth:600,marginBottom:0}}),e.jsxs(B,{children:[e.jsx(R,{type:k==="card"?"primary":"default",icon:e.jsx(Ue,{}),onClick:()=>G("card"),children:"卡片"}),e.jsx(R,{type:k==="list"?"primary":"default",icon:e.jsx(Je,{}),onClick:()=>G("list"),children:"列表"})]})]}),e.jsxs(B,{wrap:!0,children:[e.jsx(ge,{placeholder:"选择分类",allowClear:!0,onChange:a=>{O(a),S(1)},style:{width:150},children:q.map(a=>e.jsxs(J,{value:a.category,children:[a.category," (",a.count,")"]},a.category))}),e.jsxs(ge,{defaultValue:"created_at",onChange:a=>Z(a),style:{width:120},children:[e.jsx(J,{value:"created_at",children:"最新上传"}),e.jsx(J,{value:"download_count",children:"下载最多"}),e.jsx(J,{value:"rating",children:"评分最高"})]})]})]}),ne?e.jsx(Me,{grid:{gutter:16,xs:1,sm:2,md:3,lg:4},dataSource:ke,renderItem:Re}):e.jsxs(e.Fragment,{children:[k==="card"?e.jsx(Me,{grid:{gutter:16,xs:1,sm:2,md:3,lg:4},dataSource:y,loading:M,renderItem:he}):Ce(),e.jsx("div",{style:{textAlign:"center",marginTop:24},children:e.jsx(ft,{current:v,total:g,pageSize:h,onChange:(a,r)=>{S(a),r&&Y(r)}})})]})]},"query"),e.jsx(Fe,{tab:"智能生成",children:e.jsx("div",{style:{padding:"20px 0"},children:e.jsxs(xe,{hoverable:!0,onClick:()=>l("/contract-generation"),style:{textAlign:"center",padding:40,cursor:"pointer",transition:"all 0.3s ease",border:"2px solid #1890ff"},styles:{body:{padding:40}},children:[e.jsx(Ie,{style:{fontSize:64,color:"#1890ff",marginBottom:20,display:"block"}}),e.jsx(Ye,{level:3,style:{color:"#1890ff",marginBottom:12},children:"智能合同生成"}),e.jsx(qt,{type:"secondary",style:{fontSize:16,marginBottom:24},children:"AI 驱动的智能合同生成工具，支持单一合同、合同变更、合同解除等多种场景"}),e.jsxs(B,{direction:"vertical",size:"small",style:{width:"100%",maxWidth:400,margin:"0 auto"},children:[e.jsxs("div",{style:{textAlign:"left",background:"#f5f5f5",padding:"12px 16px",borderRadius:8},children:[e.jsx(w,{strong:!0,children:"✓ 智能需求分析"}),e.jsx("br",{}),e.jsx(w,{type:"secondary",style:{fontSize:12},children:"AI 自动理解您的合同需求"})]}),e.jsxs("div",{style:{textAlign:"left",background:"#f5f5f5",padding:"12px 16px",borderRadius:8},children:[e.jsx(w,{strong:!0,children:"✓ 多种合同类型"}),e.jsx("br",{}),e.jsx(w,{type:"secondary",style:{fontSize:12},children:"支持单一合同、合同变更、解除、规划等"})]}),e.jsxs("div",{style:{textAlign:"left",background:"#f5f5f5",padding:"12px 16px",borderRadius:8},children:[e.jsx(w,{strong:!0,children:"✓ 基于 RAG 模板库"}),e.jsx("br",{}),e.jsx(w,{type:"secondary",style:{fontSize:12},children:"从 450+ 专业合同模板中智能检索"})]})]}),e.jsx(R,{type:"primary",size:"large",icon:e.jsx(Ie,{}),style:{marginTop:24},onClick:a=>{a.stopPropagation(),l("/contract-generation")},children:"开始生成合同"})]})})},"generate"),e.jsxs(Fe,{tab:"我的模板",children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(w,{type:"secondary",children:"这里显示您上传的所有模板（包含公开和私有）。"}),e.jsxs(B,{children:[e.jsx(R,{type:k==="card"?"primary":"default",icon:e.jsx(Ue,{}),onClick:()=>G("card"),size:"small",children:"卡片"}),e.jsx(R,{type:k==="list"?"primary":"default",icon:e.jsx(Je,{}),onClick:()=>G("list"),size:"small",children:"列表"})]})]}),k==="card"?e.jsx(Me,{grid:{gutter:16,xs:1,sm:2,md:3,lg:4},dataSource:y,loading:M,renderItem:he}):Ce()]},"my-templates")]})]}),e.jsx(Qe,{title:"上传合同模板",open:je,onCancel:()=>j(!1),onOk:Se,confirmLoading:ze,children:e.jsxs(X,{form:se,layout:"vertical",children:[e.jsx(X.Item,{name:"file",label:"文件",rules:[{required:!0}],valuePropName:"fileList",getValueFromEvent:a=>Array.isArray(a)?a:a?.fileList,children:e.jsxs(Gt,{maxCount:1,accept:".docx,.doc,.pdf",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(jt,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此处"})]})}),e.jsxs(pt,{gutter:16,children:[e.jsx(qe,{span:12,children:e.jsx(X.Item,{name:"name",label:"名称",rules:[{required:!0}],children:e.jsx(Ee,{})})}),e.jsx(qe,{span:12,children:e.jsx(X.Item,{name:"category",label:"分类",rules:[{required:!0}],children:e.jsxs(ge,{children:[e.jsx(J,{value:"劳动人事",children:"劳动人事"}),e.jsx(J,{value:"房屋租赁",children:"房屋租赁"}),e.jsx(J,{value:"商务合作",children:"商务合作"}),e.jsx(J,{value:"其他",children:"其他"})]})})})]}),e.jsx(X.Item,{name:"keywords",label:"关键词",children:e.jsx(ge,{mode:"tags",placeholder:"输入关键词按回车"})}),e.jsx(X.Item,{name:"description",label:"描述",children:e.jsx(Ee.TextArea,{rows:2})}),t?.is_admin&&e.jsx(X.Item,{name:"is_public",label:"公开设置",valuePropName:"checked",children:e.jsx(wt,{checkedChildren:"公开",unCheckedChildren:"私有"})})]})}),e.jsx(Qe,{title:e.jsx(Ye,{level:4,style:{margin:0},children:E?.name||"模板预览"}),open:Te,onCancel:()=>Q(!1),footer:[e.jsx(R,{onClick:()=>Q(!1),children:"关闭"},"close")],width:800,style:{top:20},children:He?e.jsx("div",{style:{textAlign:"center",padding:"40px"},children:e.jsx(xt,{size:"large",tip:"加载预览内容..."})}):E?e.jsxs("div",{children:[e.jsx(B,{direction:"vertical",style:{width:"100%",marginBottom:16},children:e.jsxs(w,{type:"secondary",children:["文件类型: ",E.file_type?.toUpperCase(),E.preview_type==="unsupported"&&" (不支持在线预览)"]})}),e.jsx("div",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"4px",maxHeight:"500px",overflow:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:E.preview_type==="error"?"inherit":"monospace",fontSize:"13px",lineHeight:"1.6"},children:E.content}),E.preview_type==="unsupported"&&e.jsx(Ge,{message:"提示",description:"此文件格式不支持在线预览，请点击下载按钮下载文件后使用相应软件打开。",type:"info",showIcon:!0})]}):null})]})};export{ya as default};
