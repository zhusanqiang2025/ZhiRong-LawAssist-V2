import{r as a,z as $,_ as q,u as K,x as L,j as e,av as I,B as o,T as P,aw as Q,ax as S,y as u,d as V,S as h,I as _,s as p,o as F,l as B}from"./index-sxRqSD8J.js";import{R as G}from"./SendOutlined-Dcj6a8_n.js";var J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"},U=function(l,d){return a.createElement($,q({},l,{ref:d,icon:J}))},W=a.forwardRef(U);const{Header:X,Content:Y}=I,{TextArea:Z}=_,{Title:ee,Text:f}=P,ae=()=>{const[r,l]=a.useState([]),[d,g]=a.useState(""),[v,R]=a.useState([]),[C,A]=a.useState(!0),[N,x]=a.useState(!1),w=a.useRef(null),m=K(),{logout:T}=L(),M=[{id:"contract-generation",title:"åˆåŒç”Ÿæˆ",icon:e.jsx(u,{}),category:"contract",route:"/contract",hasBackend:!0},{id:"legal-analysis",title:"æ³•å¾‹åˆ†æž",icon:e.jsx(u,{}),category:"legal-consultation",route:"/analysis",hasBackend:!0},{id:"contract-review",title:"åˆåŒå®¡æŸ¥",icon:e.jsx(u,{}),category:"contract",route:"/review",hasBackend:!1},{id:"case-analysis",title:"æ¡ˆä»¶åˆ†æž",icon:e.jsx(u,{}),category:"case",route:"/case-analysis",hasBackend:!1}],z=["å¸®æˆ‘èµ·è‰ä¸€ä»½åŠ³åŠ¨åˆåŒ","åˆ†æžè¿™ä»½åˆåŒçš„é£Žé™©ç‚¹","ç”Ÿæˆä¸€ä»½ç§ŸèµåˆåŒæ¨¡æ¿","å¸®æˆ‘å®¡æŸ¥è¿™ä»½ä¿å¯†åè®®","èµ·è‰ä¸€ä»½å¾‹å¸ˆå‡½","è®¡ç®—è¯‰è®¼è´¹ç”¨","æŸ¥è¯¢ç›¸å…³æ³•å¾‹è§„å®š","åˆ†æžæ¡ˆä»¶èƒœè¯‰å¯èƒ½æ€§"];a.useEffect(()=>{b()},[r]),a.useEffect(()=>{r.length===0&&l([{id:"welcome",content:"æ‚¨å¥½ï¼æˆ‘æ˜¯æ™ºèžæ³•åŠ©2.0ï¼Œæ‚¨çš„å¤šæ¨¡åž‹èžåˆæ™ºèƒ½æ³•å¾‹åŠ©æ‰‹ã€‚è¯·å‘Šè¯‰æˆ‘æ‚¨é‡åˆ°çš„æ³•å¾‹é—®é¢˜æˆ–éœ€æ±‚ï¼Œæˆ‘ä¼šé€šè¿‡å¯¹è¯æ–¹å¼å¸®åŠ©æ‚¨æ˜Žç¡®å…·ä½“éœ€æ±‚ï¼Œå¹¶æŽ¨èæœ€åˆé€‚çš„å¤„ç†æ–¹æ¡ˆã€‚",role:"assistant",timestamp:new Date,suggestions:z}])},[]);const b=()=>{w.current?.scrollIntoView({behavior:"smooth"})},j=async()=>{if(!d.trim()){p.warning("è¯·è¾“å…¥æ‚¨çš„é—®é¢˜æˆ–éœ€æ±‚");return}const s={id:Date.now().toString(),content:d.trim(),role:"user",timestamp:new Date};l(t=>[...t,s]),g(""),x(!0),A(!1);try{const t=r.filter(c=>c.id!=="welcome").map(c=>({role:c.role,content:c.content,timestamp:c.timestamp.toISOString()})),i=(await F.smartChat(s.content,t)).data,y={id:(Date.now()+1).toString(),content:i.response,role:"assistant",timestamp:new Date,suggestions:i.suggestions||[],actionButtons:i.action_buttons||[]};l(c=>[...c,y]),R(i.suggestions||[]),x(!1),B.debug("AIå¯¹è¯å®Œæˆ",{userInput:s.content.substring(0,50),aiResponseLength:i.response.length,confidence:i.confidence})}catch(t){B.error("AIå¯¹è¯å¤±è´¥:",t);let n="æŠ±æ­‰ï¼ŒAIåŠ©æ‰‹æš‚æ—¶æ— æ³•å¤„ç†æ‚¨çš„è¯·æ±‚ã€‚è¯·ç¨åŽå†è¯•ã€‚";t.response?.status===401?n="æ‚¨çš„ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ã€‚":t.response?.status===500?n="AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åŽå†è¯•ã€‚":t.code==="ECONNABORTED"&&(n="è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥åŽé‡è¯•ã€‚");const i={id:(Date.now()+1).toString(),content:n,role:"assistant",timestamp:new Date};l(y=>[...y,i]),x(!1),t.response?.status!==401&&p.error("AIå¯¹è¯æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åŽé‡è¯•")}},k=s=>{g(s),setTimeout(()=>{j()},100)},D=s=>{s.hasBackend?m(s.route):p.info("è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼")},E=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),j())},O=s=>{s.route?s.params?m(s.route,{state:s.params}):m(s.route):p.info("è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼")},H=s=>e.jsxs("div",{className:`message ${s.role==="user"?"user-message":"assistant-message"}`,children:[e.jsx("div",{className:"message-avatar",children:s.role==="user"?e.jsx(S,{}):e.jsx(u,{})}),e.jsxs("div",{className:"message-content",children:[e.jsx("div",{className:"message-text",children:s.content}),e.jsx("div",{className:"message-time",children:s.timestamp.toLocaleTimeString()}),s.actionButtons&&s.actionButtons.length>0&&e.jsxs("div",{className:"message-action-buttons",style:{marginTop:"12px"},children:[e.jsx(f,{type:"secondary",style:{fontSize:"12px",marginBottom:"8px",display:"block"},children:"æŽ¨èæ“ä½œï¼š"}),e.jsx(h,{wrap:!0,children:s.actionButtons.map((t,n)=>e.jsx(o,{type:"primary",size:"small",icon:e.jsx("span",{style:{marginRight:"4px"},children:t.icon||"ðŸ”—"}),onClick:()=>O(t),style:{borderRadius:"6px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},title:t.description,children:t.title},n))})]}),s.suggestions&&s.suggestions.length>0&&e.jsxs("div",{className:"message-suggestions",style:{marginTop:"12px"},children:[e.jsx(f,{type:"secondary",style:{fontSize:"12px",marginBottom:"8px",display:"block"},children:"æˆ–è€…æ‚¨å¯ä»¥è¿™æ ·è¯´ï¼š"}),e.jsx(h,{wrap:!0,children:s.suggestions.map((t,n)=>e.jsx(o,{size:"small",type:"dashed",onClick:()=>k(t),children:t},n))})]})]})]},s.id);return e.jsxs(I,{className:"smart-chat-layout",children:[e.jsxs(X,{className:"chat-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(o,{type:"text",icon:e.jsx(W,{}),onClick:()=>m("/scenes"),className:"back-btn",children:"è¿”å›ž"}),e.jsx(ee,{level:4,className:"header-title",children:"æ™ºèƒ½å¯¹è¯"})]}),e.jsx("div",{className:"header-right",children:e.jsx(Q,{count:r.length-1,offset:[-10,0],children:e.jsx(o,{type:"text",icon:e.jsx(S,{}),onClick:T,children:"é€€å‡º"})})})]}),e.jsxs(Y,{className:"chat-content",children:[e.jsxs("div",{className:"chat-messages",ref:w,children:[r.map(H),N&&e.jsxs("div",{className:"typing-indicator",children:[e.jsx("div",{className:"typing-avatar",children:e.jsx(u,{})}),e.jsxs("div",{className:"typing-content",children:[e.jsx("span",{children:"AIåŠ©æ‰‹æ­£åœ¨æ€è€ƒ..."}),e.jsxs("div",{className:"typing-dots",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})]})]})]}),C&&e.jsx("div",{className:"quick-actions",children:e.jsx(V,{title:"å¿«æ·æœåŠ¡",size:"small",className:"quick-actions-card",children:e.jsx(h,{wrap:!0,children:M.map(s=>e.jsxs(o,{icon:s.icon,onClick:()=>D(s),className:"quick-action-btn",type:s.hasBackend?"primary":"default",children:[s.title,!s.hasBackend&&e.jsx("span",{className:"coming-soon",children:"å¼€å‘ä¸­"})]},s.id))})})}),e.jsxs("div",{className:"chat-input",children:[e.jsxs("div",{className:"input-container",children:[e.jsx(Z,{value:d,onChange:s=>g(s.target.value),onKeyPress:E,placeholder:"è¯·æè¿°æ‚¨çš„æ³•å¾‹é—®é¢˜æˆ–éœ€æ±‚...",rows:1,autoSize:{minRows:1,maxRows:4},className:"message-input"}),e.jsx(o,{type:"primary",icon:e.jsx(G,{}),onClick:j,disabled:!d.trim()||N,className:"send-button",children:"å‘é€"})]}),v.length>0&&e.jsx("div",{className:"suggestions-container",children:e.jsxs(h,{wrap:!0,children:[e.jsx(f,{type:"secondary",className:"suggestions-label",children:"å»ºè®®ï¼š"}),v.map((s,t)=>e.jsx(o,{size:"small",type:"link",onClick:()=>k(s),children:s},t))]})})]})]})]})};export{ae as default};
